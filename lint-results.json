[{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(account)\\account\\AccountClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(account)\\account\\addresses\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(account)\\account\\orders\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(account)\\account\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(account)\\account\\profile\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(account)\\account\\sizebook\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(account)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\AdminLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\customers\\[customerId]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":5,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":50},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[450,453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[450,453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7261,7264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7261,7264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10912,10915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10912,10915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { use, useState, useEffect } from 'react'\r\nimport Link from 'next/link'\r\nimport { ArrowLeft, Mail, Phone, MapPin, Calendar, ShoppingBag, TrendingUp, CreditCard } from 'lucide-react'\r\n\r\nexport default function CustomerDetailPage({ params }: { params: Promise<{ customerId: string }> }) {\r\n    const { customerId } = use(params)\r\n    const [isLoading, setIsLoading] = useState(true)\r\n    const [customer, setCustomer] = useState<any>(null)\r\n\r\n    useEffect(() => {\r\n        // Mock Data Fetching\r\n        setTimeout(() => {\r\n            setCustomer({\r\n                id: customerId,\r\n                firstName: 'Alex',\r\n                lastName: 'Morgan',\r\n                email: 'alex.morgan@example.com',\r\n                phone: '+1 (555) 123-4567',\r\n                joinDate: 'Oct 24, 2023',\r\n                ordersCount: 12,\r\n                totalSpent: 45200,\r\n                avgOrderValue: 3766,\r\n                lastOrderDate: 'Dec 15, 2024',\r\n                addresses: [\r\n                    {\r\n                        type: 'Default',\r\n                        street: '123 Fashion Ave, Suite 400',\r\n                        city: 'New York',\r\n                        state: 'NY',\r\n                        zip: '10001',\r\n                        country: 'USA'\r\n                    }\r\n                ],\r\n                recentOrders: [\r\n                    { id: '#ORD-7752', date: 'Dec 15, 2024', total: 5400, status: 'Delivered', items: 3 },\r\n                    { id: '#ORD-7231', date: 'Nov 02, 2024', total: 2100, status: 'Delivered', items: 1 },\r\n                    { id: '#ORD-6654', date: 'Sep 28, 2024', total: 8900, status: 'Returned', items: 4 },\r\n                ]\r\n            })\r\n            setIsLoading(false)\r\n        }, 800)\r\n    }, [customerId])\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-[60vh]\">\r\n                <div className=\"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen pb-20 animate-fade-in space-y-8\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Link\r\n                        href=\"/admin/customers\"\r\n                        className=\"p-2 hover:bg-white rounded-full transition-colors border border-transparent hover:border-gray-200\"\r\n                    >\r\n                        <ArrowLeft className=\"w-5 h-5 text-gray-500\" />\r\n                    </Link>\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-bold text-gray-900\">{customer.firstName} {customer.lastName}</h1>\r\n                        <div className=\"flex items-center gap-2 text-sm text-gray-500 mt-1\">\r\n                            <span className=\"px-2 py-0.5 bg-green-100 text-green-700 rounded-full text-xs font-semibold\">\r\n                                Active Customer\r\n                            </span>\r\n                            <span>•</span>\r\n                            <span>Customer since {customer.joinDate}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <button className=\"text-sm font-semibold text-gray-500 hover:text-gray-900\">\r\n                    Edit Customer\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                {/* Left Column: Stats & Orders */}\r\n                <div className=\"lg:col-span-2 space-y-8\">\r\n                    {/* Stats Grid */}\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\r\n                        <div className=\"bg-white p-5 rounded-xl border border-gray-200 shadow-sm\">\r\n                            <div className=\"flex items-center gap-3 mb-2\">\r\n                                <div className=\"p-2 bg-blue-50 text-blue-600 rounded-lg\">\r\n                                    <ShoppingBag className=\"w-4 h-4\" />\r\n                                </div>\r\n                                <span className=\"text-xs font-bold text-gray-500 uppercase tracking-wide\">Total Orders</span>\r\n                            </div>\r\n                            <p className=\"text-2xl font-bold text-gray-900\">{customer.ordersCount}</p>\r\n                        </div>\r\n                        <div className=\"bg-white p-5 rounded-xl border border-gray-200 shadow-sm\">\r\n                            <div className=\"flex items-center gap-3 mb-2\">\r\n                                <div className=\"p-2 bg-emerald-50 text-emerald-600 rounded-lg\">\r\n                                    <CreditCard className=\"w-4 h-4\" />\r\n                                </div>\r\n                                <span className=\"text-xs font-bold text-gray-500 uppercase tracking-wide\">Total Spent</span>\r\n                            </div>\r\n                            <p className=\"text-2xl font-bold text-gray-900\">₹{customer.totalSpent.toLocaleString()}</p>\r\n                        </div>\r\n                        <div className=\"bg-white p-5 rounded-xl border border-gray-200 shadow-sm\">\r\n                            <div className=\"flex items-center gap-3 mb-2\">\r\n                                <div className=\"p-2 bg-purple-50 text-purple-600 rounded-lg\">\r\n                                    <TrendingUp className=\"w-4 h-4\" />\r\n                                </div>\r\n                                <span className=\"text-xs font-bold text-gray-500 uppercase tracking-wide\">Avg Order Value</span>\r\n                            </div>\r\n                            <p className=\"text-2xl font-bold text-gray-900\">₹{customer.avgOrderValue.toLocaleString()}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Recent Orders */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden\">\r\n                        <div className=\"px-6 py-4 border-b border-gray-100 flex justify-between items-center\">\r\n                            <h3 className=\"font-bold text-gray-900\">Recent Orders</h3>\r\n                            <Link href=\"/admin/orders\" className=\"text-sm font-semibold text-primary hover:underline\">View all</Link>\r\n                        </div>\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full text-sm text-left\">\r\n                                <thead className=\"bg-gray-50 text-gray-500 font-medium border-b border-gray-100\">\r\n                                    <tr>\r\n                                        <th className=\"px-6 py-3\">Order</th>\r\n                                        <th className=\"px-6 py-3\">Date</th>\r\n                                        <th className=\"px-6 py-3\">Status</th>\r\n                                        <th className=\"px-6 py-3 text-right\">Total</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-gray-100\">\r\n                                    {customer.recentOrders.map((order: any) => (\r\n                                        <tr key={order.id} className=\"hover:bg-gray-50 transition-colors cursor-pointer group\">\r\n                                            <td className=\"px-6 py-4 font-semibold text-gray-900 group-hover:text-primary transition-colors\">\r\n                                                {order.id}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-gray-600\">{order.date}</td>\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${order.status === 'Delivered' ? 'bg-green-100 text-green-700' :\r\n                                                        order.status === 'Returned' ? 'bg-red-100 text-red-700' :\r\n                                                            'bg-gray-100 text-gray-700'\r\n                                                    }`}>\r\n                                                    {order.status}\r\n                                                </span>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-gray-900 font-medium text-right\">\r\n                                                ₹{order.total.toLocaleString()}\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right Column: Contact & Address */}\r\n                <div className=\"space-y-6\">\r\n                    {/* Contact Info */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6 space-y-4\">\r\n                        <h3 className=\"font-bold text-gray-900\">Contact Information</h3>\r\n\r\n                        <div className=\"space-y-3\">\r\n                            <div className=\"flex items-start gap-3\">\r\n                                <Mail className=\"w-4 h-4 text-gray-400 mt-1\" />\r\n                                <div>\r\n                                    <p className=\"text-sm font-medium text-gray-900\">{customer.email}</p>\r\n                                    <button className=\"text-xs text-primary hover:underline font-medium\">Copy email</button>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex items-start gap-3\">\r\n                                <Phone className=\"w-4 h-4 text-gray-400 mt-1\" />\r\n                                <div>\r\n                                    <p className=\"text-sm font-medium text-gray-900\">{customer.phone}</p>\r\n                                    <p className=\"text-xs text-gray-500\">Registered num.</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Default Address */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6 space-y-4\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <h3 className=\"font-bold text-gray-900\">Default Address</h3>\r\n                            <button className=\"text-xs font-semibold text-primary hover:underline\">Manage</button>\r\n                        </div>\r\n                        {customer.addresses.map((addr: any, idx: number) => (\r\n                            <div key={idx} className=\"flex items-start gap-3\">\r\n                                <MapPin className=\"w-4 h-4 text-gray-400 mt-1\" />\r\n                                <div className=\"text-sm text-gray-600 leading-relaxed\">\r\n                                    <p className=\"font-medium text-gray-900\">{customer.firstName} {customer.lastName}</p>\r\n                                    <p>{addr.street}</p>\r\n                                    <p>{addr.city}, {addr.state} {addr.zip}</p>\r\n                                    <p>{addr.country}</p>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Marketing Status */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6 space-y-4\">\r\n                        <h3 className=\"font-bold text-gray-900\">Marketing</h3>\r\n                        <div className=\"flex items-start gap-3\">\r\n                            <div className=\"mt-0.5\">\r\n                                <span className=\"w-2 h-2 rounded-full bg-green-500 block\"></span>\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm font-medium text-gray-900\">Subscribed</p>\r\n                                <p className=\"text-xs text-gray-500\">Users subscribed to email marketing.</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\customers\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\orders\\OrdersClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[822,825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[822,825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchOrders'. Either include it or remove the dependency array.","line":33,"column":8,"nodeType":"ArrayExpression","endLine":33,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [fetchOrders, filters, page]","fix":{"range":[981,996],"text":"[fetchOrders, filters, page]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":48,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1700,1703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1700,1703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport { ShoppingCart, Download } from 'lucide-react'\r\nimport Link from 'next/link'\r\nimport OrderFilters from '@/components/admin/OrderFilters'\r\nimport BulkActions from '@/components/admin/BulkActions'\r\nimport toast from 'react-hot-toast'\r\n\r\ninterface Order {\r\n    id: string\r\n    created_at: string\r\n    status: string\r\n    amount: number\r\n    currency: string\r\n    payment_method?: string\r\n    is_cod?: boolean\r\n    razorpay_risk_tier?: string\r\n    courier_name?: string\r\n    tracking_id?: string\r\n}\r\n\r\nexport default function OrdersClient() {\r\n    const [orders, setOrders] = useState<Order[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n    const [selectedIds, setSelectedIds] = useState<string[]>([])\r\n    const [filters, setFilters] = useState<any>({})\r\n    const [page, setPage] = useState(1)\r\n    const [totalPages, setTotalPages] = useState(1)\r\n\r\n    useEffect(() => {\r\n        fetchOrders()\r\n    }, [filters, page])\r\n\r\n    const fetchOrders = async () => {\r\n        setLoading(true)\r\n        try {\r\n            const params = new URLSearchParams({ ...filters, page: String(page), limit: '50' })\r\n            const response = await fetch(`/api/admin/orders?${params}`)\r\n            const data = await response.json()\r\n\r\n            if (response.ok) {\r\n                setOrders(data.orders)\r\n                setTotalPages(data.totalPages)\r\n            } else {\r\n                toast.error('Failed to fetch orders')\r\n            }\r\n        } catch (error) {\r\n            toast.error('Error fetching orders')\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    const handleFilter = (newFilters: any) => {\r\n        setFilters(newFilters)\r\n        setPage(1)\r\n        setSelectedIds([])\r\n    }\r\n\r\n    const handleReset = () => {\r\n        setFilters({})\r\n        setPage(1)\r\n        setSelectedIds([])\r\n    }\r\n\r\n    const handleSelectAll = () => {\r\n        if (selectedIds.length === orders.length) {\r\n            setSelectedIds([])\r\n        } else {\r\n            setSelectedIds(orders.map(o => o.id))\r\n        }\r\n    }\r\n\r\n    const handleSelectOne = (id: string) => {\r\n        if (selectedIds.includes(id)) {\r\n            setSelectedIds(selectedIds.filter(i => i !== id))\r\n        } else {\r\n            setSelectedIds([...selectedIds, id])\r\n        }\r\n    }\r\n\r\n    const handleBulkUpdate = async (newStatus: string) => {\r\n        const response = await fetch('/api/admin/orders/bulk', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ order_ids: selectedIds, new_status: newStatus }),\r\n        })\r\n\r\n        if (response.ok) {\r\n            setSelectedIds([])\r\n            await fetchOrders()\r\n        } else {\r\n            throw new Error('Bulk update failed')\r\n        }\r\n    }\r\n\r\n    const handleExport = async () => {\r\n        const params = new URLSearchParams(filters)\r\n        window.location.href = `/api/admin/orders/export?${params}`\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-gray-900\">Orders</h1>\r\n                    <p className=\"text-sm text-gray-500 mt-1\">{orders.length} orders (Page {page} of {totalPages})</p>\r\n                </div>\r\n                <button\r\n                    onClick={handleExport}\r\n                    className=\"flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 font-semibold text-sm\"\r\n                >\r\n                    <Download className=\"w-4 h-4\" />\r\n                    Export All\r\n                </button>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <OrderFilters onApply={handleFilter} onReset={handleReset} />\r\n\r\n            {/* Bulk Actions */}\r\n            <BulkActions\r\n                selectedIds={selectedIds}\r\n                onClearSelection={() => setSelectedIds([])}\r\n                onStatusUpdate={handleBulkUpdate}\r\n                onExport={handleExport}\r\n            />\r\n\r\n            {/* Orders Table */}\r\n            {loading ? (\r\n                <div className=\"bg-white rounded-lg border border-gray-200 p-12 text-center\">\r\n                    <p className=\"text-gray-500\">Loading orders...</p>\r\n                </div>\r\n            ) : orders.length === 0 ? (\r\n                <div className=\"bg-white rounded-lg border border-gray-200 p-12 text-center\">\r\n                    <ShoppingCart className=\"w-12 h-12 mx-auto mb-4 text-gray-300\" />\r\n                    <p className=\"text-gray-500\">No orders found</p>\r\n                    <p className=\"text-sm text-gray-400 mt-1\">Orders will appear here when customers make purchases</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"bg-white rounded-lg border border-gray-200 overflow-hidden\">\r\n                    <table className=\"min-w-full divide-y divide-gray-200\">\r\n                        <thead className=\"bg-gray-50\">\r\n                            <tr>\r\n                                <th className=\"px-4 py-3 text-left\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={selectedIds.length === orders.length && orders.length > 0}\r\n                                        onChange={handleSelectAll}\r\n                                        className=\"rounded border-gray-300\"\r\n                                    />\r\n                                </th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Order ID</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Date</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Payment</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Risk</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Status</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Courier</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Total</th>\r\n                                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                            {orders.map((order) => (\r\n                                <tr key={order.id} className=\"hover:bg-gray-50\">\r\n                                    <td className=\"px-4 py-4\">\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            checked={selectedIds.includes(order.id)}\r\n                                            onChange={() => handleSelectOne(order.id)}\r\n                                            className=\"rounded border-gray-300\"\r\n                                        />\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900\">\r\n                                        #{order.id.slice(0, 8)}\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                                        {new Date(order.created_at).toLocaleDateString()}\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                        <span className={`px-2 py-1 text-xs font-semibold rounded-full ${order.is_cod ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700'\r\n                                            }`}>\r\n                                            {order.payment_method || (order.is_cod ? 'COD' : 'PREPAID')}\r\n                                        </span>\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                        {order.razorpay_risk_tier && (\r\n                                            <span className={`px-2 py-1 text-xs font-semibold rounded-full ${order.razorpay_risk_tier === 'LOW' ? 'bg-green-100 text-green-700' :\r\n                                                order.razorpay_risk_tier === 'MEDIUM' ? 'bg-yellow-100 text-yellow-700' :\r\n                                                    'bg-red-100 text-red-700'\r\n                                                }`}>\r\n                                                {order.razorpay_risk_tier}\r\n                                            </span>\r\n                                        )}\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                        <span className={`px-2 py-1 text-xs font-semibold rounded-full ${order.status === 'PAYMENT_CONFIRMED' || order.status === 'COD_CONFIRMED' ? 'bg-green-100 text-green-800' :\r\n                                            order.status === 'FAILED' || order.status === 'CANCELLED' ? 'bg-red-100 text-red-800' :\r\n                                                'bg-yellow-100 text-yellow-800'\r\n                                            }`}>\r\n                                            {order.status}\r\n                                        </span>\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                                        {order.courier_name || '-'}\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                                        {order.currency} {order.amount.toLocaleString('en-IN')}\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm\">\r\n                                        <Link\r\n                                            href={`/admin/orders/${order.id}`}\r\n                                            className=\"text-primary hover:text-gray-900 font-semibold\"\r\n                                        >\r\n                                            View\r\n                                        </Link>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n\r\n                    {/* Pagination */}\r\n                    {totalPages > 1 && (\r\n                        <div className=\"px-6 py-4 bg-gray-50 border-t border-gray-200 flex items-center justify-between\">\r\n                            <button\r\n                                onClick={() => setPage(p => Math.max(1, p - 1))}\r\n                                disabled={page === 1}\r\n                                className=\"px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                            >\r\n                                Previous\r\n                            </button>\r\n                            <span className=\"text-sm text-gray-700\">\r\n                                Page {page} of {totalPages}\r\n                            </span>\r\n                            <button\r\n                                onClick={() => setPage(p => Math.min(totalPages, p + 1))}\r\n                                disabled={page === totalPages}\r\n                                className=\"px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                            >\r\n                                Next\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\orders\\[orderId]\\ShipmentActions.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":27,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":44,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Truck, RefreshCw } from 'lucide-react'\r\nimport toast from 'react-hot-toast'\r\nimport { createShipmentForOrder, refreshTrackingInfo } from '@/lib/admin/order-actions'\r\n\r\ninterface ShipmentActionsProps {\r\n    orderId: string\r\n    hasShipment: boolean\r\n}\r\n\r\nexport default function ShipmentActions({ orderId, hasShipment }: ShipmentActionsProps) {\r\n    const [creating, setCreating] = useState(false)\r\n    const [refreshing, setRefreshing] = useState(false)\r\n\r\n    const handleCreateShipment = async () => {\r\n        setCreating(true)\r\n        try {\r\n            const result = await createShipmentForOrder(orderId)\r\n            if (result.success) {\r\n                toast.success('Shipment created successfully!')\r\n                window.location.reload() // Refresh to show new shipment data\r\n            } else {\r\n                toast.error(result.error || 'Failed to create shipment')\r\n            }\r\n        } catch (error) {\r\n            toast.error('Error creating shipment')\r\n        } finally {\r\n            setCreating(false)\r\n        }\r\n    }\r\n\r\n    const handleRefreshTracking = async () => {\r\n        setRefreshing(true)\r\n        try {\r\n            const result = await refreshTrackingInfo(orderId)\r\n            if (result.success) {\r\n                toast.success('Tracking info refreshed!')\r\n                window.location.reload()\r\n            } else {\r\n                toast.error(result.error || 'Failed to refresh tracking')\r\n            }\r\n        } catch (error) {\r\n            toast.error('Error refreshing tracking')\r\n        } finally {\r\n            setRefreshing(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-4\">\r\n            <h3 className=\"font-semibold text-gray-900 mb-3 text-sm\">Shipment Actions</h3>\r\n            <div className=\"flex flex-col gap-2\">\r\n                {!hasShipment ? (\r\n                    <button\r\n                        onClick={handleCreateShipment}\r\n                        disabled={creating}\r\n                        className=\"flex items-center justify-center gap-2 px-4 py-2 bg-primary text-white rounded-md hover:bg-gray-900 font-semibold text-sm disabled:opacity-50\"\r\n                    >\r\n                        <Truck className=\"w-4 h-4\" />\r\n                        {creating ? 'Creating...' : 'Create Shipment'}\r\n                    </button>\r\n                ) : (\r\n                    <button\r\n                        onClick={handleRefreshTracking}\r\n                        disabled={refreshing}\r\n                        className=\"flex items-center justify-center gap-2 px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 font-semibold text-sm disabled:opacity-50\"\r\n                    >\r\n                        <RefreshCw className=\"w-4 h-4\" />\r\n                        {refreshing ? 'Refreshing...' : 'Refresh Tracking'}\r\n                    </button>\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\orders\\[orderId]\\page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":131,"column":49,"nodeType":"JSXOpeningElement","endLine":131,"endColumn":138}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabaseServer } from '@/lib/supabase/server'\r\nimport Link from 'next/link'\r\nimport { ArrowLeft, Package, User, CreditCard, Mail, MapPin, Calendar, Phone, CheckCircle, XCircle } from 'lucide-react'\r\nimport { notFound } from 'next/navigation'\r\nimport { adminAuth } from '@/lib/firebase/admin'\r\nimport ShippingInfoCard from '@/components/admin/ShippingInfoCard'\r\nimport ShipmentActions from './ShipmentActions'\r\n\r\nasync function getOrderDetails(orderId: string) {\r\n    // Fetch order with items\r\n    const { data: order, error: orderError } = await supabaseServer\r\n        .from('orders')\r\n        .select('*')\r\n        .eq('id', orderId)\r\n        .single()\r\n\r\n    if (orderError || !order) {\r\n        return null\r\n    }\r\n\r\n    // Fetch order items with variant and product details\r\n    const { data: items } = await supabaseServer\r\n        .from('order_items')\r\n        .select(`\r\n            *,\r\n            variants:variant_id (\r\n                id,\r\n                size,\r\n                color,\r\n                sku,\r\n                products:product_id (\r\n                    id,\r\n                    name,\r\n                    image_url\r\n                )\r\n            )\r\n        `)\r\n        .eq('order_id', orderId)\r\n\r\n    // Fetch Firebase Auth user details\r\n    let firebaseUser = null\r\n    try {\r\n        firebaseUser = await adminAuth.getUser(order.firebase_uid)\r\n    } catch (error) {\r\n        console.error('Failed to fetch Firebase user:', error)\r\n    }\r\n\r\n    return {\r\n        order,\r\n        items: items || [],\r\n        firebaseUser: firebaseUser || null\r\n    }\r\n}\r\n\r\nexport default async function OrderDetailPage({ params }: { params: Promise<{ orderId: string }> }) {\r\n    const { orderId } = await params\r\n    const data = await getOrderDetails(orderId)\r\n\r\n    if (!data) {\r\n        notFound()\r\n    }\r\n\r\n    const { order, items, firebaseUser } = data\r\n\r\n    // Calculate totals from items (with null safety)\r\n    const subtotal = items.reduce((sum, item) => sum + ((item.unit_price || 0) * (item.quantity || 0)), 0)\r\n    const total = order.amount || 0\r\n\r\n    return (\r\n        <div className=\"max-w-6xl mx-auto space-y-8 pb-20 animate-fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Link\r\n                        href=\"/admin/orders\"\r\n                        className=\"p-2 hover:bg-white rounded-full transition-colors border border-transparent hover:border-gray-200\"\r\n                    >\r\n                        <ArrowLeft className=\"w-5 h-5 text-gray-500\" />\r\n                    </Link>\r\n                    <div>\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <h1 className=\"text-2xl font-bold text-gray-900\">Order #{order.id.slice(0, 8)}</h1>\r\n                            <span className={`px-2.5 py-0.5 text-xs font-semibold rounded-full ${order.status === 'COMPLETED' || order.status === 'PAYMENT_CONFIRMED' ? 'bg-green-100 text-green-700' :\r\n                                order.status === 'COD_CONFIRMED' ? 'bg-blue-100 text-blue-700' :\r\n                                    order.status === 'FAILED' || order.status === 'CANCELLED' ? 'bg-red-100 text-red-700' :\r\n                                        'bg-yellow-100 text-yellow-700'\r\n                                }`}>\r\n                                {order.status}\r\n                            </span>\r\n                            {order.is_cod && (\r\n                                <span className=\"px-2.5 py-0.5 text-xs font-semibold rounded-full bg-purple-100 text-purple-700\">\r\n                                    COD\r\n                                </span>\r\n                            )}\r\n                            {order.razorpay_risk_tier && (\r\n                                <span className={`px-2.5 py-0.5 text-xs font-semibold rounded-full ${order.razorpay_risk_tier === 'LOW' ? 'bg-green-100 text-green-700' :\r\n                                    order.razorpay_risk_tier === 'MEDIUM' ? 'bg-yellow-100 text-yellow-700' :\r\n                                        'bg-red-100 text-red-700'\r\n                                    }`}>\r\n                                    Risk: {order.razorpay_risk_tier}\r\n                                </span>\r\n                            )}\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-500 mt-1 flex items-center gap-2\">\r\n                            <Calendar className=\"w-3.5 h-3.5\" />\r\n                            {new Date(order.created_at).toLocaleString()}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                {/* Left Column: Order Items & Payment */}\r\n                <div className=\"lg:col-span-2 space-y-6\">\r\n                    {/* Items Card */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden\">\r\n                        <div className=\"px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50\">\r\n                            <h3 className=\"font-bold text-gray-900 flex items-center gap-2\">\r\n                                <Package className=\"w-4 h-4 text-gray-500\" /> Order Items ({items.length})\r\n                            </h3>\r\n                        </div>\r\n                        <div className=\"divide-y divide-gray-100\">\r\n                            {items.map((item) => {\r\n                                const variant = item.variants\r\n                                const product = variant?.products\r\n\r\n                                return (\r\n                                    <div key={item.id} className=\"p-6 flex items-start gap-4\">\r\n                                        <div className=\"w-16 h-16 bg-gray-100 rounded-lg flex-shrink-0 border border-gray-200 overflow-hidden\">\r\n                                            {product?.image_url ? (\r\n                                                <img src={product.image_url} alt={product.name} className=\"w-full h-full object-cover\" />\r\n                                            ) : null}\r\n                                        </div>\r\n                                        <div className=\"flex-1 min-w-0\">\r\n                                            <p className=\"text-sm font-medium text-gray-900 truncate\">{product?.name || 'Product'}</p>\r\n                                            <p className=\"text-sm text-gray-500 truncate\">\r\n                                                {variant?.size && `Size: ${variant.size}`}\r\n                                                {variant?.size && variant?.color && ' / '}\r\n                                                {variant?.color && `Color: ${variant.color}`}\r\n                                            </p>\r\n                                            {variant?.sku && (\r\n                                                <div className=\"mt-1 flex items-center gap-2\">\r\n                                                    <span className=\"text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full\">\r\n                                                        SKU: {variant.sku}\r\n                                                    </span>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                        <div className=\"text-right\">\r\n                                            <p className=\"text-sm font-medium text-gray-900\">\r\n                                                {order.currency} {(item.unit_price || 0).toLocaleString()}\r\n                                            </p>\r\n                                            <p className=\"text-sm text-gray-500\">x {item.quantity || 0}</p>\r\n                                            <p className=\"text-sm font-bold text-gray-900 mt-1\">\r\n                                                {order.currency} {((item.unit_price || 0) * (item.quantity || 0)).toLocaleString()}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                )\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Payment Summary */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden\">\r\n                        <div className=\"px-6 py-4 border-b border-gray-100 bg-gray-50/50\">\r\n                            <h3 className=\"font-bold text-gray-900 flex items-center gap-2\">\r\n                                <CreditCard className=\"w-4 h-4 text-gray-500\" /> Payment\r\n                            </h3>\r\n                        </div>\r\n                        <div className=\"p-6 space-y-3\">\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-gray-600\">Subtotal</span>\r\n                                <span className=\"text-gray-600\">{items.length} items</span>\r\n                                <span className=\"text-gray-900\">{order.currency} {subtotal.toLocaleString()}</span>\r\n                            </div>\r\n                            <div className=\"pt-3 mt-3 border-t border-gray-100 flex justify-between items-center font-bold text-gray-900\">\r\n                                <span>Total</span>\r\n                                <span className=\"text-xl\">{order.currency} {total.toLocaleString()}</span>\r\n                            </div>\r\n                        </div>\r\n                        {order.razorpay_payment_id && (\r\n                            <div className=\"bg-gray-50 px-6 py-3 border-t border-gray-100\">\r\n                                <p className=\"text-xs text-gray-500\">Payment ID: {order.razorpay_payment_id}</p>\r\n                                {order.razorpay_order_id && (\r\n                                    <p className=\"text-xs text-gray-500 mt-1\">Order ID: {order.razorpay_order_id}</p>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right Column: Customer Info */}\r\n                <div className=\"space-y-6\">\r\n                    {/* Customer Card */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden\">\r\n                        <div className=\"px-6 py-4 border-b border-gray-100 bg-gray-50/50\">\r\n                            <h3 className=\"font-bold text-gray-900 flex items-center gap-2\">\r\n                                <User className=\"w-4 h-4 text-gray-500\" /> Customer\r\n                            </h3>\r\n                        </div>\r\n                        <div className=\"p-6 space-y-4\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className=\"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-500 font-bold border border-gray-200\">\r\n                                    {firebaseUser?.displayName?.[0]?.toUpperCase() ||\r\n                                        firebaseUser?.email?.[0]?.toUpperCase() ||\r\n                                        'U'}\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"text-sm font-medium text-gray-900\">\r\n                                        {firebaseUser?.displayName || order.customer_name || 'Customer'}\r\n                                    </div>\r\n                                    <div className=\"text-xs text-gray-500\">\r\n                                        UID: {order.firebase_uid.slice(0, 12)}...\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-3 pt-3 border-t border-gray-100\">\r\n                                {firebaseUser?.email && (\r\n                                    <div className=\"flex items-start gap-3\">\r\n                                        <Mail className=\"w-4 h-4 text-gray-400 mt-0.5\" />\r\n                                        <div className=\"flex-1\">\r\n                                            <p className=\"text-sm text-gray-900\">{firebaseUser.email}</p>\r\n                                            <div className=\"flex items-center gap-1 mt-0.5\">\r\n                                                {firebaseUser.emailVerified ? (\r\n                                                    <>\r\n                                                        <CheckCircle className=\"w-3 h-3 text-green-600\" />\r\n                                                        <span className=\"text-xs text-green-600\">Email Verified</span>\r\n                                                    </>\r\n                                                ) : (\r\n                                                    <>\r\n                                                        <XCircle className=\"w-3 h-3 text-gray-400\" />\r\n                                                        <span className=\"text-xs text-gray-500\">Email Not Verified</span>\r\n                                                    </>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"space-y-3 pt-3 border-t border-gray-100\">\r\n                                <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6\">\r\n                                    <div className=\"flex items-center gap-2 mb-4\">\r\n                                        <CreditCard className=\"w-5 h-5 text-gray-700\" />\r\n                                        <h2 className=\"font-semibold text-gray-900\">Payment Details</h2>\r\n                                    </div>\r\n                                    <div className=\"space-y-3 text-sm\">\r\n                                        <div className=\"flex justify-between\">\r\n                                            <span className=\"text-gray-600\">Payment Method</span>\r\n                                            <span className=\"font-medium\">\r\n                                                {order.payment_method || (order.is_cod ? 'COD' : 'PREPAID')}\r\n                                            </span>\r\n                                        </div>\r\n\r\n                                        {order.is_cod && (\r\n                                            <>\r\n                                                <div className=\"flex justify-between\">\r\n                                                    <span className=\"text-gray-600\">COD Fee</span>\r\n                                                    <span className=\"font-medium\">₹{order.cod_fee || 0}</span>\r\n                                                </div>\r\n                                                <div className=\"flex justify-between\">\r\n                                                    <span className=\"text-gray-600\">COD Status</span>\r\n                                                    <span className={`px-2 py-0.5 text-xs font-semibold rounded ${order.cod_allowed_by_razorpay ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'\r\n                                                        }`}>\r\n                                                        {order.cod_allowed_by_razorpay ? 'Approved' : 'Restricted'}\r\n                                                    </span>\r\n                                                </div>\r\n                                                {order.cod_eligibility_reason && (\r\n                                                    <div className=\"flex justify-between\">\r\n                                                        <span className=\"text-gray-600\">COD Reason</span>\r\n                                                        <span className=\"text-xs text-gray-500\">{order.cod_eligibility_reason}</span>\r\n                                                    </div>\r\n                                                )}\r\n                                            </>\r\n                                        )}\r\n\r\n                                        <div className=\"flex justify-between pt-2 border-t\">\r\n                                            <span className=\"text-gray-600\">Razorpay Order ID</span>\r\n                                            <span className=\"font-mono text-xs text-gray-500\">{order.razorpay_order_id}</span>\r\n                                        </div>\r\n                                        {order.razorpay_payment_id && (\r\n                                            <div className=\"flex justify-between\">\r\n                                                <span className=\"text-gray-600\">Payment ID</span>\r\n                                                <span className=\"font-mono text-xs text-gray-500\">{order.razorpay_payment_id}</span>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {order.gateway_notes && (\r\n                                            <details className=\"pt-2 border-t\">\r\n                                                <summary className=\"cursor-pointer text-xs text-gray-500 hover:text-gray-700\">\r\n                                                    View Razorpay Metadata\r\n                                                </summary>\r\n                                                <pre className=\"mt-2 p-2 bg-gray-50 rounded text-xs overflow-auto max-h-64\">\r\n                                                    {JSON.stringify(order.gateway_notes, null, 2)}\r\n                                                </pre>\r\n                                            </details>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                                {/* Phone Number Verification Status - Always show */}\r\n                                <div className=\"flex items-start gap-3\">\r\n                                    <Phone className=\"w-4 h-4 text-gray-400 mt-0.5\" />\r\n                                    <div className=\"flex-1\">\r\n                                        {firebaseUser?.phoneNumber ? (\r\n                                            <>\r\n                                                <p className=\"text-sm text-gray-900\">{firebaseUser.phoneNumber}</p>\r\n                                                <div className=\"flex items-center gap-1 mt-0.5\">\r\n                                                    <CheckCircle className=\"w-3 h-3 text-green-600\" />\r\n                                                    <span className=\"text-xs text-green-600\">Phone Verified (OTP)</span>\r\n                                                </div>\r\n                                            </>\r\n                                        ) : order.customer_phone ? (\r\n                                            <>\r\n                                                <p className=\"text-sm text-gray-900\">{order.customer_phone}</p>\r\n                                                <div className=\"flex items-center gap-1 mt-0.5\">\r\n                                                    <XCircle className=\"w-3 h-3 text-amber-500\" />\r\n                                                    <span className=\"text-xs text-amber-600\">Phone Not Verified</span>\r\n                                                </div>\r\n                                            </>\r\n                                        ) : (\r\n                                            <>\r\n                                                <p className=\"text-sm text-gray-500 italic\">No phone number</p>\r\n                                                <div className=\"flex items-center gap-1 mt-0.5\">\r\n                                                    <XCircle className=\"w-3 h-3 text-gray-400\" />\r\n                                                    <span className=\"text-xs text-gray-500\">Phone Not Added</span>\r\n                                                </div>\r\n                                            </>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {order.shipping_address && (\r\n                                <div className=\"space-y-3 pt-3 border-t border-gray-100\">\r\n                                    <div className=\"flex items-start gap-3\">\r\n                                        <MapPin className=\"w-4 h-4 text-gray-400 mt-0.5\" />\r\n                                        <div className=\"text-sm text-gray-600\">\r\n                                            <p className=\"font-medium text-gray-900 mb-0.5\">Shipping Address</p>\r\n                                            {(() => {\r\n                                                try {\r\n                                                    const addr = typeof order.shipping_address === 'string'\r\n                                                        ? JSON.parse(order.shipping_address)\r\n                                                        : order.shipping_address\r\n                                                    return (\r\n                                                        <>\r\n                                                            {addr.fullName && <p>{addr.fullName}</p>}\r\n                                                            {addr.addressLine1 && <p>{addr.addressLine1}</p>}\r\n                                                            {addr.addressLine2 && <p>{addr.addressLine2}</p>}\r\n                                                            <p>\r\n                                                                {[addr.city, addr.state, addr.pincode].filter(Boolean).join(', ')}\r\n                                                            </p>\r\n                                                        </>\r\n                                                    )\r\n                                                } catch {\r\n                                                    return <p>{String(order.shipping_address)}</p>\r\n                                                }\r\n                                            })()}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Shipping Information */}\r\n                    <ShippingInfoCard\r\n                        courierName={order.courier_name}\r\n                        trackingId={order.tracking_id}\r\n                        shipmentStatus={order.shipment_status}\r\n                        estimatedDeliveryDate={order.estimated_delivery_date}\r\n                        actualDeliveryDate={order.actual_delivery_date}\r\n                        actualShippingFee={order.actual_shipping_fee}\r\n                    />\r\n\r\n                    {/* Shipment Actions */}\r\n                    {(order.status === 'PAYMENT_CONFIRMED' || order.status === 'COD_CONFIRMED') && (\r\n                        <ShipmentActions\r\n                            orderId={order.id}\r\n                            hasShipment={!!order.shiprocket_shipment_id}\r\n                        />\r\n                    )}\r\n\r\n                    {/* Timeline */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6 overflow-hidden\">\r\n                        <h3 className=\"font-bold text-gray-900 mb-4\">Timeline</h3>\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"flex gap-4\">\r\n                                <div className=\"mt-1\">\r\n                                    <div className=\"w-2 h-2 rounded-full bg-green-500\"></div>\r\n                                </div>\r\n                                <div>\r\n                                    <p className=\"text-sm text-gray-900\">Order {order.status.toLowerCase()}</p>\r\n                                    <p className=\"text-xs text-gray-500\">{new Date(order.created_at).toLocaleString()}</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\orders\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sparkles' is defined but never used.","line":3,"column":82,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":90},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":67,"column":77,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2390,2433],"text":"Overview of your store&apos;s performance today."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2390,2433],"text":"Overview of your store&lsquo;s performance today."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2390,2433],"text":"Overview of your store&#39;s performance today."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2390,2433],"text":"Overview of your store&rsquo;s performance today."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabaseServer } from '@/lib/supabase/server'\r\nimport Link from 'next/link'\r\nimport { DollarSign, ShoppingCart, Users, TrendingUp, Plus, ArrowRight, Package, Sparkles } from 'lucide-react'\r\n\r\nasync function getDashboardData() {\r\n    const [productsCount, ordersCount, customersCount] = await Promise.all([\r\n        supabaseServer.from('products').select('*', { count: 'exact', head: true }),\r\n        supabaseServer.from('orders').select('*', { count: 'exact', head: true }),\r\n        supabaseServer.from('profiles').select('*', { count: 'exact', head: true }),\r\n    ])\r\n\r\n    return {\r\n        products: productsCount.count || 0,\r\n        orders: ordersCount.count || 0,\r\n        customers: customersCount.count || 0,\r\n    }\r\n}\r\n\r\nexport default async function AdminDashboard() {\r\n    const stats = await getDashboardData()\r\n\r\n    const statCards = [\r\n        {\r\n            name: 'Total Sales',\r\n            value: '₹0',\r\n            change: '+0%',\r\n            trend: 'neutral',\r\n            icon: DollarSign,\r\n            color: 'bg-emerald-500/10 text-emerald-600',\r\n            border: 'border-emerald-100',\r\n        },\r\n        {\r\n            name: 'Total Orders',\r\n            value: stats.orders.toString(),\r\n            change: '+0%',\r\n            trend: 'neutral',\r\n            icon: ShoppingCart,\r\n            color: 'bg-blue-500/10 text-blue-600',\r\n            border: 'border-blue-100',\r\n        },\r\n        {\r\n            name: 'Total Customers',\r\n            value: stats.customers.toString(),\r\n            change: '+0%',\r\n            trend: 'neutral',\r\n            icon: Users,\r\n            color: 'bg-purple-500/10 text-purple-600',\r\n            border: 'border-purple-100',\r\n        },\r\n        {\r\n            name: 'Active Products',\r\n            value: stats.products.toString(),\r\n            change: '+0%',\r\n            trend: 'neutral',\r\n            icon: Package,\r\n            color: 'bg-orange-500/10 text-orange-600',\r\n            border: 'border-orange-100',\r\n        },\r\n    ]\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-fade-in pb-10\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold text-gray-900 tracking-tight\">Dashboard</h1>\r\n                    <p className=\"text-gray-500 mt-1\">Overview of your store's performance today.</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    <span className=\"text-sm text-gray-500 bg-white px-3 py-1.5 rounded-full border border-gray-200 shadow-sm\">\r\n                        {new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\r\n                    </span>\r\n                    <Link\r\n                        href=\"/admin/products/new\"\r\n                        className=\"inline-flex items-center gap-2 bg-primary text-white px-4 py-2 rounded-xl text-sm font-medium hover:bg-gray-800 transition-all shadow-lg shadow-gray-900/20 active:scale-95\"\r\n                    >\r\n                        <Plus className=\"w-4 h-4\" />\r\n                        Add Product\r\n                    </Link>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Stats Grid */}\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n                {statCards.map((stat) => (\r\n                    <div\r\n                        key={stat.name}\r\n                        className={`bg-white rounded-2xl p-6 border ${stat.border} shadow-sm hover:shadow-md transition-all duration-200 group`}\r\n                    >\r\n                        <div className=\"flex items-start justify-between\">\r\n                            <div>\r\n                                <p className=\"text-sm font-medium text-gray-500\">{stat.name}</p>\r\n                                <h3 className=\"text-2xl font-bold text-gray-900 mt-2 tracking-tight group-hover:scale-105 transition-transform origin-left\">\r\n                                    {stat.value}\r\n                                </h3>\r\n                            </div>\r\n                            <div className={`p-3 rounded-xl ${stat.color} transition-colors`}>\r\n                                <stat.icon className=\"w-5 h-5\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"mt-4 flex items-center gap-2\">\r\n                            <span className=\"text-xs font-medium bg-gray-50 text-gray-600 px-2 py-1 rounded-lg\">\r\n                                {stat.change} vs last month\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                {/* Recent Orders */}\r\n                <div className=\"lg:col-span-2 bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden\">\r\n                    <div className=\"p-6 border-b border-gray-50 flex items-center justify-between\">\r\n                        <div>\r\n                            <h2 className=\"text-lg font-bold text-gray-900\">Recent Orders</h2>\r\n                            <p className=\"text-sm text-gray-500\">Latest transactions from your store</p>\r\n                        </div>\r\n                        <Link href=\"/admin/orders\" className=\"text-sm font-medium text-primary hover:text-gray-600 flex items-center gap-1 transition-colors\">\r\n                            View All <ArrowRight className=\"w-4 h-4\" />\r\n                        </Link>\r\n                    </div>\r\n\r\n                    <div className=\"p-12 text-center\">\r\n                        <div className=\"w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                            <ShoppingCart className=\"w-8 h-8 text-gray-300\" />\r\n                        </div>\r\n                        <h3 className=\"text-gray-900 font-medium mb-1\">Answer the first order</h3>\r\n                        <p className=\"text-gray-500 text-sm max-w-sm mx-auto\">\r\n                            No orders have been placed yet. Share your store link to get started!\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Quick Actions */}\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"bg-white rounded-2xl border border-gray-100 shadow-sm p-6\">\r\n                        <h2 className=\"text-lg font-bold text-gray-900 mb-4\">Quick Actions</h2>\r\n                        <div className=\"space-y-3\">\r\n                            <Link\r\n                                href=\"/admin/products/new\"\r\n                                className=\"group flex items-center justify-between p-4 rounded-xl bg-gray-50 hover:bg-white hover:shadow-md border border-transparent hover:border-gray-100 transition-all duration-200\"\r\n                            >\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"w-10 h-10 rounded-lg bg-blue-500/10 text-blue-600 flex items-center justify-center group-hover:bg-blue-500 group-hover:text-white transition-colors\">\r\n                                        <Plus className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <div className=\"text-left\">\r\n                                        <p className=\"font-semibold text-gray-900 text-sm\">Add Product</p>\r\n                                        <p className=\"text-xs text-gray-500\">Create a new listing</p>\r\n                                    </div>\r\n                                </div>\r\n                                <ArrowRight className=\"w-4 h-4 text-gray-400 group-hover:text-primary group-hover:translate-x-1 transition-all\" />\r\n                            </Link>\r\n\r\n                            <Link\r\n                                href=\"/admin/settings\"\r\n                                className=\"group flex items-center justify-between p-4 rounded-xl bg-gray-50 hover:bg-white hover:shadow-md border border-transparent hover:border-gray-100 transition-all duration-200\"\r\n                            >\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"w-10 h-10 rounded-lg bg-purple-500/10 text-purple-600 flex items-center justify-center group-hover:bg-purple-500 group-hover:text-white transition-colors\">\r\n                                        <TrendingUp className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <div className=\"text-left\">\r\n                                        <p className=\"font-semibold text-gray-900 text-sm\">Store Settings</p>\r\n                                        <p className=\"text-xs text-gray-500\">Manage configuration</p>\r\n                                    </div>\r\n                                </div>\r\n                                <ArrowRight className=\"w-4 h-4 text-gray-400 group-hover:text-primary group-hover:translate-x-1 transition-all\" />\r\n                            </Link>\r\n\r\n                            <Link\r\n                                href=\"/admin/customers\"\r\n                                className=\"group flex items-center justify-between p-4 rounded-xl bg-gray-50 hover:bg-white hover:shadow-md border border-transparent hover:border-gray-100 transition-all duration-200\"\r\n                            >\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"w-10 h-10 rounded-lg bg-orange-500/10 text-orange-600 flex items-center justify-center group-hover:bg-orange-500 group-hover:text-white transition-colors\">\r\n                                        <Users className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <div className=\"text-left\">\r\n                                        <p className=\"font-semibold text-gray-900 text-sm\">Customers</p>\r\n                                        <p className=\"text-xs text-gray-500\">View user base</p>\r\n                                    </div>\r\n                                </div>\r\n                                <ArrowRight className=\"w-4 h-4 text-gray-400 group-hover:text-primary group-hover:translate-x-1 transition-all\" />\r\n                            </Link>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\products\\ProductsTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\products\\[productId]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[446,449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[446,449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2545,2548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2545,2548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { use, useEffect, useState } from 'react'\r\nimport ProductForm from '@/components/admin/products/ProductForm'\r\n\r\nexport default function EditProductPage({ params }: { params: Promise<{ productId: string }> }) {\r\n    // In React 19/Next 15+, params is a promise we need to unwrap\r\n    const { productId } = use(params)\r\n    const [isLoading, setIsLoading] = useState(true)\r\n    const [productData, setProductData] = useState<any>(null)\r\n\r\n    useEffect(() => {\r\n        const fetchProduct = async () => {\r\n            const { supabase } = await import('@/lib/supabase/client')\r\n            // supabase is the client instance\r\n\r\n            // Fetch product\r\n            const { data: product, error: prodError } = await supabase\r\n                .from('products')\r\n                .select('*')\r\n                .eq('id', productId)\r\n                .single()\r\n\r\n            if (prodError || !product) {\r\n                console.error('Error fetching product:', prodError)\r\n                return\r\n            }\r\n\r\n            // Fetch variants\r\n            const { data: variants, error: varError } = await supabase\r\n                .from('variants')\r\n                .select('*')\r\n                .eq('product_id', productId)\r\n\r\n            if (varError) {\r\n                console.error('Error fetching variants:', varError)\r\n                return\r\n            }\r\n\r\n            // Transform for Form\r\n            // Unique options\r\n            const uniqueSizes = Array.from(new Set(variants?.map(v => v.size).filter(Boolean))) as string[]\r\n            const uniqueColors = Array.from(new Set(variants?.map(v => v.color).filter(Boolean))) as string[]\r\n\r\n            const options = []\r\n            if (uniqueSizes.length > 0) options.push({ id: crypto.randomUUID(), name: 'Size', values: uniqueSizes })\r\n            if (uniqueColors.length > 0) options.push({ id: crypto.randomUUID(), name: 'Color', values: uniqueColors })\r\n\r\n            const transformedVariants = variants?.map(v => ({\r\n                id: v.id,\r\n                title: `${v.size || ''} / ${v.color || ''}`,\r\n                price: v.price_override || product.base_price,\r\n                stock: v.stock_quantity,\r\n                sku: v.sku,\r\n                options: {\r\n                    ...(v.size && { Size: v.size }),\r\n                    ...(v.color && { Color: v.color })\r\n                }\r\n            })) || []\r\n\r\n            // Ensure images have IDs (migrated data might not)\r\n            const images = (product.images || []).map((img: any) => ({\r\n                id: img.id || crypto.randomUUID(),\r\n                url: img.url,\r\n                isPrimary: img.isPrimary || false\r\n            }))\r\n\r\n            console.log('Fetched product data:', { product, variants, images })\r\n\r\n            setProductData({\r\n                id: product.id,\r\n                title: product.name,\r\n                description: product.description,\r\n                price: product.base_price,\r\n                images,\r\n                variants: transformedVariants,\r\n                options\r\n            })\r\n            setIsLoading(false)\r\n        }\r\n\r\n        fetchProduct()\r\n    }, [productId])\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-[60vh]\">\r\n                <div className=\"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return <ProductForm initialData={productData} isEditing={true} />\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\products\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[215,218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[215,218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[230,233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[230,233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5484,5487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5484,5487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\r\n\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\nimport { revalidatePath } from 'next/cache'\r\nimport { requireAdmin } from '@/lib/admin/auth'\r\n\r\nexport async function upsertProduct(productData: any, variants: any[], isEditing: boolean, productId?: string) {\r\n    try {\r\n        // CRITICAL: Verify admin authorization before any operation\r\n        await requireAdmin()\r\n        \r\n        console.log('upsertProduct started:', { isEditing, productId })\r\n\r\n        // 1. Upsert Product\r\n        const { data: savedProduct, error: productError } = await supabaseAdmin\r\n            .from('products')\r\n            .upsert({\r\n                ...(isEditing && productId ? { id: productId } : {}),\r\n                ...productData,\r\n                // updated_at: new Date().toISOString() // Column does not exist\r\n            })\r\n            .select()\r\n            .single()\r\n\r\n        if (productError) {\r\n            console.error('Error saving product:', productError)\r\n            throw new Error(`Product Save Failed: ${productError.message}`)\r\n        }\r\n\r\n        if (!savedProduct) throw new Error('Product saved but no data returned')\r\n\r\n        const finalProductId = savedProduct.id\r\n\r\n        // 2. Handle Variants\r\n        // For simplicity in Admin, we can delete existing and re-insert, or upsert.\r\n        // Re-insert is safer for sync if we want to remove deleted variants.\r\n        \r\n        if (variants && variants.length > 0) {\r\n            // Transform variants for DB\r\n            const variantsToInsert = variants.map(v => {\r\n                const options = v.options || {}\r\n                const sizeKey = Object.keys(options).find(k => k.toLowerCase() === 'size')\r\n                const colorKey = Object.keys(options).find(k => k.toLowerCase() === 'color')\r\n\r\n                const size = sizeKey ? options[sizeKey] : null\r\n                const color = colorKey ? options[colorKey] : null\r\n\r\n                // Auto-generate SKU if missing\r\n                let sku = v.sku\r\n                if (!sku || sku.trim() === '') {\r\n                    const parts = [savedProduct.slug]\r\n                    if (size) parts.push(size)\r\n                    if (color) parts.push(color)\r\n                    \r\n                    // Fallback randomness if no options to distinguish\r\n                    if (!size && !color) {\r\n                        parts.push(Math.random().toString(36).substring(2, 6))\r\n                    }\r\n                    \r\n                    sku = parts.join('-').toUpperCase().replace(/[^A-Z0-9-]/g, '')\r\n                }\r\n\r\n                return {\r\n                    product_id: finalProductId,\r\n                    size,\r\n                    color,\r\n                    stock_quantity: v.stock || 0,\r\n                    price_override: v.price === savedProduct.base_price ? null : v.price,\r\n                    sku,\r\n                    enabled: true,\r\n                    images: [], // Default empty or map if you have variant images\r\n                }\r\n            })\r\n\r\n            // Deduplicate variants to avoid unique constraint violations\r\n            const uniqueVariants = new Map();\r\n            for (const v of variantsToInsert) {\r\n                const key = `${v.size || 'null'}-${v.color || 'null'}`;\r\n                if (!uniqueVariants.has(key)) {\r\n                    uniqueVariants.set(key, v);\r\n                }\r\n            }\r\n            const finalVariantsToInsert = Array.from(uniqueVariants.values());\r\n\r\n            // UPSERT variants to preserve IDs and avoid unique constraint violations\r\n            // We match using the unique index on (product_id, size, COALESCE(color, ''))\r\n            // Note: Supabase upsert doesn't support complex expressions, so we'll use a different approach\r\n            \r\n            // First, fetch existing variants for this product\r\n            const { data: existingVariants } = await supabaseAdmin\r\n                .from('variants')\r\n                .select('id, product_id, size, color')\r\n                .eq('product_id', finalProductId)\r\n\r\n            const existingMap = new Map();\r\n            if (existingVariants) {\r\n                for (const v of existingVariants) {\r\n                    const key = `${v.size || 'null'}-${v.color || ''}`;\r\n                    existingMap.set(key, v.id);\r\n                }\r\n            }\r\n\r\n            // Add IDs to matching variants for update, leave new ones without ID for insert\r\n            const variantsToUpsert = finalVariantsToInsert.map(v => {\r\n                const key = `${v.size || 'null'}-${v.color || ''}`;\r\n                const existingId = existingMap.get(key);\r\n                if (existingId) {\r\n                    return { ...v, id: existingId }; // Update existing\r\n                }\r\n                return v; // Insert new\r\n            });\r\n\r\n            // Now use upsert with the id field\r\n            const { error: variantError } = await supabaseAdmin\r\n                .from('variants')\r\n                .upsert(variantsToUpsert)\r\n\r\n            if (variantError) {\r\n                console.error('Error saving variants:', variantError)\r\n                throw new Error(`Variant Save Failed: ${variantError.message}`)\r\n            }\r\n        }\r\n\r\n        revalidatePath('/admin/products')\r\n        revalidatePath(`/admin/products/${finalProductId}`)\r\n        revalidatePath('/shop')\r\n        \r\n        return { success: true, productId: finalProductId }\r\n    } catch (error: any) {\r\n        console.error('upsertProduct exception:', error)\r\n        return { success: false, error: error.message }\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\products\\new\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\products\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(admin)\\admin\\settings\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":184,"column":61,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[12333,12549],"text":"\r\n                                        Configure your store&apos;s artificial intelligence capabilities. Enable automated descriptions, smart customer support, and market analysis.\r\n                                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[12333,12549],"text":"\r\n                                        Configure your store&lsquo;s artificial intelligence capabilities. Enable automated descriptions, smart customer support, and market analysis.\r\n                                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[12333,12549],"text":"\r\n                                        Configure your store&#39;s artificial intelligence capabilities. Enable automated descriptions, smart customer support, and market analysis.\r\n                                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[12333,12549],"text":"\r\n                                        Configure your store&rsquo;s artificial intelligence capabilities. Enable automated descriptions, smart customer support, and market analysis.\r\n                                    "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Sparkles, Settings, CreditCard, Bell, Truck, TrendingUp } from 'lucide-react'\r\n\r\nexport default function SettingsPage() {\r\n    const [activeTab, setActiveTab] = useState<'general' | 'ai'>('general')\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in pb-20\">\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-gray-900\">Settings</h1>\r\n                <p className=\"text-sm text-gray-500 mt-1\">Manage your store preferences and AI configuration</p>\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <div className=\"flex p-1 bg-gray-100/80 rounded-xl w-fit\">\r\n                <button\r\n                    onClick={() => setActiveTab('general')}\r\n                    className={`flex items-center gap-2 px-6 py-2.5 rounded-lg text-sm font-medium transition-all ${activeTab === 'general'\r\n                        ? 'bg-white text-gray-900 shadow-sm ring-1 ring-black/5'\r\n                        : 'text-gray-500 hover:text-gray-900'\r\n                        }`}\r\n                >\r\n                    <Settings className=\"w-4 h-4\" />\r\n                    General Settings\r\n                </button>\r\n                <button\r\n                    onClick={() => setActiveTab('ai')}\r\n                    className={`flex items-center gap-2 px-6 py-2.5 rounded-lg text-sm font-medium transition-all ${activeTab === 'ai'\r\n                        ? 'bg-white text-primary shadow-sm ring-1 ring-black/5'\r\n                        : 'text-gray-500 hover:text-gray-900'\r\n                        }`}\r\n                >\r\n                    <Sparkles className=\"w-4 h-4\" />\r\n                    AI Configuration\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n\r\n                {/* General Settings Tab */}\r\n                {activeTab === 'general' && (\r\n                    <>\r\n                        {/* Store Information */}\r\n                        <div className=\"bg-white rounded-xl border border-gray-200 p-6 shadow-sm\">\r\n                            <div className=\"flex items-center gap-3 mb-6\">\r\n                                <div className=\"p-2 bg-gray-50 rounded-lg\">\r\n                                    <Settings className=\"w-5 h-5 text-gray-600\" />\r\n                                </div>\r\n                                <h2 className=\"text-lg font-bold text-gray-900\">Store Information</h2>\r\n                            </div>\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-bold text-gray-700 mb-1\">Store Name</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        defaultValue=\"LUMIÈRE\"\r\n                                        className=\"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-bold text-gray-700 mb-1\">Store Email</label>\r\n                                    <input\r\n                                        type=\"email\"\r\n                                        defaultValue=\"contact@lumiere.com\"\r\n                                        className=\"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-bold text-gray-700 mb-1\">Currency</label>\r\n                                    <select className=\"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm\">\r\n                                        <option>INR (₹)</option>\r\n                                        <option>USD ($)</option>\r\n                                        <option>EUR (€)</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Notifications */}\r\n                        <div className=\"bg-white rounded-xl border border-gray-200 p-6 shadow-sm\">\r\n                            <div className=\"flex items-center gap-3 mb-6\">\r\n                                <div className=\"p-2 bg-gray-50 rounded-lg\">\r\n                                    <Bell className=\"w-5 h-5 text-gray-600\" />\r\n                                </div>\r\n                                <h2 className=\"text-lg font-bold text-gray-900\">Notifications</h2>\r\n                            </div>\r\n                            <div className=\"space-y-3\">\r\n                                <label className=\"flex items-center justify-between cursor-pointer p-3 hover:bg-gray-50 rounded-lg transition-colors border border-transparent hover:border-gray-100\">\r\n                                    <span className=\"text-sm font-medium text-gray-700\">Order notifications</span>\r\n                                    <input type=\"checkbox\" defaultChecked className=\"w-5 h-5 text-primary rounded focus:ring-primary border-gray-300\" />\r\n                                </label>\r\n                                <label className=\"flex items-center justify-between cursor-pointer p-3 hover:bg-gray-50 rounded-lg transition-colors border border-transparent hover:border-gray-100\">\r\n                                    <span className=\"text-sm font-medium text-gray-700\">Low stock alerts</span>\r\n                                    <input type=\"checkbox\" defaultChecked className=\"w-5 h-5 text-primary rounded focus:ring-primary border-gray-300\" />\r\n                                </label>\r\n                                <label className=\"flex items-center justify-between cursor-pointer p-3 hover:bg-gray-50 rounded-lg transition-colors border border-transparent hover:border-gray-100\">\r\n                                    <span className=\"text-sm font-medium text-gray-700\">Customer messages</span>\r\n                                    <input type=\"checkbox\" className=\"w-5 h-5 text-primary rounded focus:ring-primary border-gray-300\" />\r\n                                </label>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Payment Settings */}\r\n                        <div className=\"bg-white rounded-xl border border-gray-200 p-6 shadow-sm\">\r\n                            <div className=\"flex items-center gap-3 mb-6\">\r\n                                <div className=\"p-2 bg-gray-50 rounded-lg\">\r\n                                    <CreditCard className=\"w-5 h-5 text-gray-600\" />\r\n                                </div>\r\n                                <h2 className=\"text-lg font-bold text-gray-900\">Payment Settings</h2>\r\n                            </div>\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-bold text-gray-700 mb-1\">Razorpay Key ID</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"rzp_test_xxxxxxxxxxxx\"\r\n                                        className=\"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-mono\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-bold text-gray-700 mb-1\">Razorpay Key Secret</label>\r\n                                    <input\r\n                                        type=\"password\"\r\n                                        placeholder=\"••••••••••••••••\"\r\n                                        className=\"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-mono\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Shipping */}\r\n                        <div className=\"bg-white rounded-xl border border-gray-200 p-6 shadow-sm\">\r\n                            <div className=\"flex items-center gap-3 mb-6\">\r\n                                <div className=\"p-2 bg-gray-50 rounded-lg\">\r\n                                    <Truck className=\"w-5 h-5 text-gray-600\" />\r\n                                </div>\r\n                                <h2 className=\"text-lg font-bold text-gray-900\">Shipping</h2>\r\n                            </div>\r\n                            <div className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-bold text-gray-700 mb-1\">Standard Shipping Fee</label>\r\n                                    <div className=\"relative\">\r\n                                        <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-serif\">₹</span>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            defaultValue=\"0\"\r\n                                            className=\"w-full pl-8 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-bold text-gray-700 mb-1\">Free Shipping Above</label>\r\n                                    <div className=\"relative\">\r\n                                        <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-serif\">₹</span>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            defaultValue=\"1000\"\r\n                                            className=\"w-full pl-8 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </>\r\n                )}\r\n\r\n                {/* AI Configuration Tab */}\r\n                {activeTab === 'ai' && (\r\n                    <div className=\"col-span-1 lg:col-span-2 space-y-6\">\r\n                        <div className=\"bg-white rounded-xl border border-gray-200 p-8 shadow-sm relative overflow-hidden\">\r\n                            <div className=\"absolute top-0 right-0 p-8 opacity-5 pointer-events-none\">\r\n                                <Sparkles className=\"w-64 h-64 text-primary\" />\r\n                            </div>\r\n\r\n                            <div className=\"flex flex-col md:flex-row gap-8 relative z-10\">\r\n                                <div className=\"md:w-1/3 space-y-4\">\r\n                                    <div className=\"w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center text-primary mb-2\">\r\n                                        <Sparkles className=\"w-6 h-6\" />\r\n                                    </div>\r\n                                    <h2 className=\"text-xl font-bold text-gray-900\">Lumière AI Intelligence</h2>\r\n                                    <p className=\"text-gray-500 text-sm leading-relaxed\">\r\n                                        Configure your store's artificial intelligence capabilities. Enable automated descriptions, smart customer support, and market analysis.\r\n                                    </p>\r\n\r\n                                    <div className=\"p-4 bg-yellow-50 text-yellow-800 rounded-lg text-xs border border-yellow-100\">\r\n                                        <strong>Note:</strong> API usage is billed directly by your provider (OpenAI/Google).\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"md:w-2/3 space-y-6\">\r\n                                    {/* Main Toggle */}\r\n                                    <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-200\">\r\n                                        <div>\r\n                                            <h3 className=\"font-bold text-gray-900\">Enable AI Features</h3>\r\n                                            <p className=\"text-xs text-gray-500 mt-1\">Master switch for all AI capabilities</p>\r\n                                        </div>\r\n                                        <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                            <input type=\"checkbox\" defaultChecked className=\"sr-only peer\" />\r\n                                            <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary\"></div>\r\n                                        </label>\r\n                                    </div>\r\n\r\n                                    {/* API Key */}\r\n                                    <div className=\"bg-white p-4 rounded-xl border border-gray-200 shadow-sm\">\r\n                                        <label className=\"block text-sm font-bold text-gray-700 mb-2\">\r\n                                            OpenAI API Key\r\n                                        </label>\r\n                                        <div className=\"relative\">\r\n                                            <input\r\n                                                type=\"password\"\r\n                                                placeholder=\"sk-...\"\r\n                                                className=\"w-full pl-4 pr-10 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary font-mono text-sm transition-all\"\r\n                                            />\r\n                                            <div className=\"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-green-600 font-semibold bg-green-50 px-2 py-0.5 rounded-full hidden\">\r\n                                                Verified\r\n                                            </div>\r\n                                        </div>\r\n                                        <p className=\"text-xs text-gray-400 mt-2 flex items-center gap-1\">\r\n                                            <span className=\"w-1.5 h-1.5 rounded-full bg-green-500\"></span>\r\n                                            Securely stored and encrypted.\r\n                                        </p>\r\n                                    </div>\r\n\r\n                                    {/* Feature Toggles */}\r\n                                    <div className=\"space-y-3\">\r\n                                        <h3 className=\"text-sm font-bold text-gray-900 mb-2\">Active Features</h3>\r\n                                        <label className=\"flex items-center justify-between cursor-pointer p-4 border border-gray-200 rounded-xl hover:border-primary/50 hover:bg-primary/5 transition-all group\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"w-8 h-8 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center\">\r\n                                                    <Settings className=\"w-4 h-4\" />\r\n                                                </div>\r\n                                                <div>\r\n                                                    <span className=\"block text-sm font-bold text-gray-900 group-hover:text-primary transition-colors\">Auto-generate Descriptions</span>\r\n                                                    <span className=\"text-xs text-gray-500\">Generate SEO-friendly text for products</span>\r\n                                                </div>\r\n                                            </div>\r\n                                            <input type=\"checkbox\" defaultChecked className=\"w-5 h-5 text-primary rounded focus:ring-primary border-gray-300\" />\r\n                                        </label>\r\n\r\n                                        <label className=\"flex items-center justify-between cursor-pointer p-4 border border-gray-200 rounded-xl hover:border-primary/50 hover:bg-primary/5 transition-all group\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"w-8 h-8 rounded-lg bg-purple-50 text-purple-600 flex items-center justify-center\">\r\n                                                    <Sparkles className=\"w-4 h-4\" />\r\n                                                </div>\r\n                                                <div>\r\n                                                    <span className=\"block text-sm font-bold text-gray-900 group-hover:text-primary transition-colors\">Smart Chatbot</span>\r\n                                                    <span className=\"text-xs text-gray-500\">Automated customer support responses</span>\r\n                                                </div>\r\n                                            </div>\r\n                                            <input type=\"checkbox\" className=\"w-5 h-5 text-primary rounded focus:ring-primary border-gray-300\" />\r\n                                        </label>\r\n\r\n                                        <label className=\"flex items-center justify-between cursor-pointer p-4 border border-gray-200 rounded-xl hover:border-primary/50 hover:bg-primary/5 transition-all group\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"w-8 h-8 rounded-lg bg-orange-50 text-orange-600 flex items-center justify-center\">\r\n                                                    <TrendingUp className=\"w-4 h-4\" />\r\n                                                </div>\r\n                                                <div>\r\n                                                    <span className=\"block text-sm font-bold text-gray-900 group-hover:text-primary transition-colors\">Competitor Insight</span>\r\n                                                    <span className=\"text-xs text-gray-500\">Monitor prices and market trends</span>\r\n                                                </div>\r\n                                            </div>\r\n                                            <input type=\"checkbox\" className=\"w-5 h-5 text-primary rounded focus:ring-primary border-gray-300\" />\r\n                                        </label>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Sticky Save Button */}\r\n            <div className=\"fixed bottom-6 right-6 z-20\">\r\n                <button className=\"px-8 py-3 bg-gray-900 text-white font-bold rounded-full shadow-2xl hover:bg-black transform hover:-translate-y-1 transition-all flex items-center gap-2\">\r\n                    Save Changes\r\n                </button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(auth)\\auth\\AuthClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1100,1103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1100,1103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isPhoneValid' is assigned a value but never used.","line":97,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isEmailAuthValid' is assigned a value but never used.","line":100,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":100,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":138,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":138,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'clearError' is defined but never used.","line":155,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":155,"endColumn":26}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useEffect, useMemo, useRef, useState } from 'react'\r\nimport { useRouter, useSearchParams } from 'next/navigation'\r\nimport EnterStep from './steps/EnterStep'\r\nimport OtpStep from './steps/OtpStep'\r\nimport EmailStep from './steps/EmailStep'\r\nimport { auth } from '@/lib/firebase/client'\r\nimport {\r\n  RecaptchaVerifier,\r\n  signInWithPhoneNumber,\r\n  createUserWithEmailAndPassword,\r\n  signInWithEmailAndPassword,\r\n  sendSignInLinkToEmail,\r\n  isSignInWithEmailLink,\r\n  signInWithEmailLink,\r\n} from 'firebase/auth'\r\n\r\nexport type AuthStep = 'enter' | 'otp' | 'email'\r\n\r\nfunction validatePhoneNumber(phone: string): boolean {\r\n  return /^\\d{10}$/.test(phone)\r\n}\r\n\r\nfunction normalizePhone(value: string): string {\r\n  return value.replace(/\\D/g, '').slice(0, 10)\r\n}\r\n\r\nfunction validateEmail(email: string): boolean {\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\r\n  return emailRegex.test(email)\r\n}\r\n\r\nfunction validatePassword(password: string): boolean {\r\n  return password.length >= 6\r\n}\r\n\r\nfunction getFirebaseErrorMessage(error: unknown): string {\r\n  const err = error as any\r\n  const code = err?.code\r\n  const message = err?.message\r\n\r\n  switch (code) {\r\n    case 'auth/email-already-in-use':\r\n      return 'Email already registered. Please login instead.'\r\n    case 'auth/invalid-email':\r\n      return 'Invalid email address.'\r\n    case 'auth/weak-password':\r\n      return 'Password should be at least 6 characters.'\r\n    case 'auth/user-not-found':\r\n      return 'Email not registered. Please sign up first.'\r\n    case 'auth/wrong-password':\r\n      return 'Incorrect password.'\r\n    case 'auth/too-many-requests':\r\n      return 'Too many login attempts. Please try again later.'\r\n    case 'auth/network-request-failed':\r\n      return 'Network error. Please check your connection.'\r\n    case 'auth/invalid-credential':\r\n      return 'Invalid email or password.'\r\n    default:\r\n      return message || 'An error occurred. Please try again.'\r\n  }\r\n}\r\n\r\nexport default function AuthClient() {\r\n  const router = useRouter()\r\n  const searchParams = useSearchParams()\r\n  const otpInputRef = useRef<HTMLInputElement>(null!)\r\n\r\n  const redirectUrl = useMemo(() => searchParams.get('redirect') || '/', [searchParams])\r\n\r\n  const [step, setStep] = useState<AuthStep>('enter')\r\n  const [phone, setPhone] = useState('')\r\n  const [email, setEmail] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [code, setCode] = useState('')\r\n  const [loading, setLoading] = useState(false)\r\n  const [recaptchaLoading, setRecaptchaLoading] = useState(false)\r\n  const [error, setError] = useState('')\r\n  const [resendTimer, setResendTimer] = useState(0)\r\n  const [resendLoading, setResendLoading] = useState(false)\r\n\r\n  // Focus OTP input when entering OTP step\r\n  useEffect(() => {\r\n    if (step === 'otp' && otpInputRef.current) {\r\n      otpInputRef.current.focus()\r\n    }\r\n  }, [step])\r\n\r\n  // Resend timer countdown\r\n  useEffect(() => {\r\n    if (resendTimer <= 0) return\r\n    const id = window.setInterval(() => setResendTimer((prev) => prev - 1), 1000)\r\n    return () => window.clearInterval(id)\r\n  }, [resendTimer])\r\n\r\n  const isPhoneValid = validatePhoneNumber(phone)\r\n  const isEmailValid = validateEmail(email)\r\n  const isPasswordValid = validatePassword(password)\r\n  const isEmailAuthValid = isEmailValid && isPasswordValid\r\n\r\n  const finalRedirect = () => {\r\n    const storedRedirect = sessionStorage.getItem('auth_redirect')\r\n    const target = storedRedirect || redirectUrl || '/'\r\n    sessionStorage.removeItem('auth_redirect')\r\n    return target\r\n  }\r\n\r\n\r\n\r\n  async function sendOtp() {\r\n    setError('')\r\n    setRecaptchaLoading(true)\r\n    setLoading(true)\r\n\r\n    try {\r\n      if (!validatePhoneNumber(phone)) {\r\n        setError('Please enter a valid 10-digit mobile number')\r\n        return\r\n      }\r\n\r\n      sessionStorage.setItem('auth_redirect', redirectUrl)\r\n\r\n      let container = document.getElementById('recaptcha-container') as HTMLElement | null\r\n      if (!container) {\r\n        container = document.createElement('div')\r\n        container.id = 'recaptcha-container'\r\n        container.style.position = 'absolute'\r\n        container.style.visibility = 'hidden'\r\n        document.body.appendChild(container)\r\n      }\r\n\r\n      if (!window.recaptchaVerifier) {\r\n        try {\r\n          window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {\r\n            size: 'invisible',\r\n          })\r\n        } catch (err) {\r\n          setError('Failed to initialize security. Please refresh the page.')\r\n          window.recaptchaVerifier = undefined\r\n          return\r\n        }\r\n      }\r\n\r\n      setRecaptchaLoading(false)\r\n\r\n      const result = await signInWithPhoneNumber(auth, `+91${phone}`, window.recaptchaVerifier)\r\n\r\n      window.confirmationResult = result\r\n      setResendTimer(45)\r\n      setStep('otp')\r\n    } catch (err) {\r\n      try {\r\n        window.recaptchaVerifier?.clear()\r\n      } catch (clearError) {\r\n        // Ignore clear errors\r\n      }\r\n      window.recaptchaVerifier = undefined\r\n\r\n      const errorMessage = (err as Error).message\r\n\r\n      if (errorMessage.includes('invalid-phone-number')) {\r\n        setError('Invalid phone number format')\r\n      } else if (errorMessage.includes('too-many-requests')) {\r\n        setError('Too many login attempts. Please try again later.')\r\n      } else if (errorMessage.includes('network')) {\r\n        setError('Network error. Please check your connection.')\r\n      } else {\r\n        setError(errorMessage || 'Failed to send OTP. Please try again.')\r\n      }\r\n    } finally {\r\n      setLoading(false)\r\n      setRecaptchaLoading(false)\r\n    }\r\n  }\r\n\r\n  async function verifyOtp() {\r\n    setError('')\r\n\r\n    if (!window.confirmationResult) {\r\n      setError('OTP session expired. Please login again.')\r\n      setStep('enter')\r\n      return\r\n    }\r\n\r\n    if (!code.trim()) {\r\n      setError('Please enter the OTP code')\r\n      return\r\n    }\r\n\r\n    if (code.length !== 6) {\r\n      setError('OTP must be 6 digits')\r\n      return\r\n    }\r\n\r\n    setLoading(true)\r\n\r\n    try {\r\n      const result = await window.confirmationResult.confirm(code)\r\n      const idToken = await result.user.getIdToken()\r\n\r\n      const response = await fetch('/api/auth/session', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ idToken }),\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json()\r\n        throw new Error(errorData.error || 'Session creation failed')\r\n      }\r\n\r\n      router.push(finalRedirect())\r\n    } catch (err) {\r\n      const errorMessage = (err as Error).message\r\n\r\n      if (errorMessage.includes('invalid-verification-code')) {\r\n        setError('Invalid OTP. Please check and try again.')\r\n      } else if (errorMessage.includes('code-expired')) {\r\n        setError('OTP expired. Please request a new code.')\r\n      } else if (errorMessage.includes('too-many-requests')) {\r\n        setError('Too many attempts. Please try again later.')\r\n      } else if (errorMessage.includes('network')) {\r\n        setError('Network error. Please check your connection.')\r\n      } else {\r\n        setError(errorMessage || 'Failed to verify OTP. Please try again.')\r\n      }\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  async function resendOtp() {\r\n    setError('')\r\n    setResendLoading(true)\r\n\r\n    try {\r\n      if (!window.confirmationResult) {\r\n        setError('Session expired. Please login again.')\r\n        setStep('enter')\r\n        return\r\n      }\r\n\r\n      await sendOtp()\r\n    } catch (err) {\r\n      setError((err as Error).message || 'Failed to resend OTP')\r\n    } finally {\r\n      setResendLoading(false)\r\n    }\r\n  }\r\n\r\n  async function signupWithEmail() {\r\n    setError('')\r\n    setLoading(true)\r\n\r\n    try {\r\n      if (!validateEmail(email)) {\r\n        setError('Please enter a valid email address')\r\n        return\r\n      }\r\n\r\n      if (!validatePassword(password)) {\r\n        setError('Password must be at least 6 characters')\r\n        return\r\n      }\r\n\r\n      sessionStorage.setItem('auth_redirect', redirectUrl)\r\n\r\n      const result = await createUserWithEmailAndPassword(auth, email, password)\r\n      const idToken = await result.user.getIdToken()\r\n\r\n      const response = await fetch('/api/auth/session', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ idToken }),\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const data = await response.json()\r\n        throw new Error(data.error || 'Failed to create session')\r\n      }\r\n\r\n      router.push(finalRedirect())\r\n    } catch (err) {\r\n      setError(getFirebaseErrorMessage(err))\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  async function loginWithEmail() {\r\n    setError('')\r\n    setLoading(true)\r\n\r\n    try {\r\n      if (!validateEmail(email)) {\r\n        setError('Please enter a valid email address')\r\n        return\r\n      }\r\n\r\n      if (!validatePassword(password)) {\r\n        setError('Password must be at least 6 characters')\r\n        return\r\n      }\r\n\r\n      sessionStorage.setItem('auth_redirect', redirectUrl)\r\n\r\n      const result = await signInWithEmailAndPassword(auth, email, password)\r\n      const idToken = await result.user.getIdToken()\r\n\r\n      const response = await fetch('/api/auth/session', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ idToken }),\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const data = await response.json()\r\n        throw new Error(data.error || 'Failed to create session')\r\n      }\r\n\r\n      router.push(finalRedirect())\r\n    } catch (err) {\r\n      setError(getFirebaseErrorMessage(err))\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  async function sendEmailOtp() {\r\n    setError('')\r\n    setLoading(true)\r\n\r\n    try {\r\n      if (!isEmailValid) {\r\n        setError('Please enter a valid email address')\r\n        return\r\n      }\r\n\r\n      sessionStorage.setItem('auth_redirect', redirectUrl)\r\n\r\n      const actionCodeSettings = {\r\n        url: `${window.location.origin}/auth/email-verify?redirect=${encodeURIComponent(redirectUrl)}`,\r\n        handleCodeInApp: true,\r\n      }\r\n\r\n      await sendSignInLinkToEmail(auth, email, actionCodeSettings)\r\n      window.localStorage.setItem('emailForSignIn', email)\r\n      setError('')\r\n      alert(`Verification link sent to ${email}. Please check your inbox (and spam folder).`)\r\n    } catch (err) {\r\n      setError(getFirebaseErrorMessage(err))\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const onBackToEnter = () => {\r\n    setStep('enter')\r\n    setError('')\r\n    setCode('')\r\n    setPhone('')\r\n    setEmail('')\r\n    setPassword('')\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex flex-col bg-white\">\r\n      {/* Back button & top bar */}\r\n      <div className=\"sticky top-0 z-20 border-b border-gray-200 bg-white px-4 py-3\">\r\n        {step !== 'enter' && (\r\n          <button\r\n            type=\"button\"\r\n            onClick={onBackToEnter}\r\n            className=\"flex h-11 w-11 items-center justify-center rounded-lg transition-colors hover:bg-gray-100 active:bg-gray-200\"\r\n            aria-label=\"Go back\"\r\n          >\r\n            <svg className=\"h-6 w-6 text-gray-900\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n            </svg>\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Main content */}\r\n      <main className=\"flex flex-1 flex-col items-center justify-center px-4 py-8 sm:px-6\">\r\n        <div className=\"w-full max-w-sm space-y-6\">\r\n          {step === 'enter' && (\r\n            <EnterStep\r\n              phone={phone}\r\n              isPhoneValid={validatePhoneNumber(phone)}\r\n              error={error}\r\n              recaptchaLoading={recaptchaLoading}\r\n              loading={loading}\r\n              onPhoneChange={(value) => {\r\n                setPhone(normalizePhone(value))\r\n                setError('')\r\n              }}\r\n              onSendOtp={sendOtp}\r\n              onGoEmail={() => {\r\n                setStep('email')\r\n                setError('')\r\n                setPhone('')\r\n              }}\r\n            />\r\n          )}\r\n\r\n          {step === 'otp' && (\r\n            <OtpStep\r\n              code={code}\r\n              error={error}\r\n              loading={loading}\r\n              resendTimer={resendTimer}\r\n              resendLoading={resendLoading}\r\n              setCode={setCode}\r\n              onVerify={verifyOtp}\r\n              onResend={resendOtp}\r\n              onBack={onBackToEnter}\r\n              inputRef={otpInputRef}\r\n            />\r\n          )}\r\n\r\n          {step === 'email' && (\r\n            <EmailStep\r\n              email={email}\r\n              password={password}\r\n              isEmailValid={validateEmail(email)}\r\n              isPasswordValid={validatePassword(password)}\r\n              isEmailAuthValid={validateEmail(email) && validatePassword(password)}\r\n              error={error}\r\n              loading={loading}\r\n              onEmailChange={(value) => {\r\n                setEmail(value)\r\n                setError('')\r\n              }}\r\n              onPasswordChange={(value) => {\r\n                setPassword(value)\r\n                setError('')\r\n              }}\r\n              onSignup={signupWithEmail}\r\n              onLogin={loginWithEmail}\r\n              onSendEmailOtp={sendEmailOtp}\r\n              onBack={onBackToEnter}\r\n            />\r\n          )}\r\n        </div>\r\n      </main>\r\n\r\n      {/* Footer with trust markers */}\r\n      <footer className=\"border-t border-gray-200 bg-gray-50 px-4 py-4 text-center text-xs text-gray-600\">\r\n        <p>🔒 Secure &nbsp;|&nbsp; Your data is encrypted</p>\r\n      </footer>\r\n    </div>\r\n  )\r\n}\r\n\r\n// Support email link verification if the user returns to /auth after clicking an email link\r\nif (typeof window !== 'undefined') {\r\n  if (isSignInWithEmailLink(auth, typeof window !== 'undefined' ? window.location.href : '')) {\r\n    const emailForSignIn = window.localStorage.getItem('emailForSignIn')\r\n    if (emailForSignIn) {\r\n      signInWithEmailLink(auth, emailForSignIn, window.location.href)\r\n        .then(async (result) => {\r\n          const idToken = await result.user.getIdToken()\r\n          await fetch('/api/auth/session', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ idToken }),\r\n          })\r\n        })\r\n        .catch(() => { })\r\n    }\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(auth)\\auth\\email-verify\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2409,2412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2409,2412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { Suspense, useEffect, useState } from 'react'\r\nimport { useRouter, useSearchParams } from 'next/navigation'\r\nimport { auth } from '@/lib/firebase/client'\r\nimport { isSignInWithEmailLink, signInWithEmailLink } from 'firebase/auth'\r\n\r\nfunction EmailVerifyContent() {\r\n  const router = useRouter()\r\n  const searchParams = useSearchParams()\r\n  const [status, setStatus] = useState<'verifying' | 'success' | 'error'>('verifying')\r\n  const [error, setError] = useState<string>('')\r\n\r\n  useEffect(() => {\r\n    async function verifyEmailLink() {\r\n      try {\r\n        // Check if the URL is a sign-in with email link\r\n        if (!isSignInWithEmailLink(auth, window.location.href)) {\r\n          setStatus('error')\r\n          setError('Invalid verification link')\r\n          return\r\n        }\r\n\r\n        // Get the email from localStorage\r\n        let email = window.localStorage.getItem('emailForSignIn')\r\n\r\n        // If email is not in localStorage, prompt user to enter it\r\n        if (!email) {\r\n          email = window.prompt('Please provide your email for confirmation')\r\n        }\r\n\r\n        if (!email) {\r\n          setStatus('error')\r\n          setError('Email is required to complete verification')\r\n          return\r\n        }\r\n\r\n        // Sign in with email link\r\n        const result = await signInWithEmailLink(auth, email, window.location.href)\r\n\r\n        // Get the ID token\r\n        const idToken = await result.user.getIdToken()\r\n\r\n        // Create session via API\r\n        const response = await fetch('/api/auth/session', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify({ idToken }),\r\n        })\r\n\r\n        if (!response.ok) {\r\n          throw new Error('Failed to create session')\r\n        }\r\n\r\n        // Clear the email from localStorage\r\n        window.localStorage.removeItem('emailForSignIn')\r\n\r\n        // Get redirect URL from query params or session storage\r\n        const redirectUrl = searchParams.get('redirect') ||\r\n          sessionStorage.getItem('auth_redirect') ||\r\n          '/account'\r\n\r\n        // Clear session storage\r\n        sessionStorage.removeItem('auth_redirect')\r\n\r\n        setStatus('success')\r\n\r\n        // Redirect after a brief delay\r\n        setTimeout(() => {\r\n          router.push(redirectUrl)\r\n        }, 1500)\r\n\r\n      } catch (err: any) {\r\n        console.error('Email verification error:', err)\r\n        setStatus('error')\r\n        setError(err.message || 'Failed to verify email link')\r\n      }\r\n    }\r\n\r\n    verifyEmailLink()\r\n  }, [router, searchParams])\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 px-4\">\r\n      <div className=\"w-full max-w-md rounded-2xl bg-white p-8 text-center shadow-lg\">\r\n        {status === 'verifying' && (\r\n          <>\r\n            <div className=\"mx-auto mb-4 h-16 w-16 animate-spin rounded-full border-4 border-blue-200 border-t-blue-600\" />\r\n            <h2 className=\"mb-2 text-xl font-bold text-gray-900\">Verifying Email</h2>\r\n            <p className=\"text-sm text-gray-600\">Please wait while we verify your email address...</p>\r\n          </>\r\n        )}\r\n\r\n        {status === 'success' && (\r\n          <>\r\n            <div className=\"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-green-100\">\r\n              <svg className=\"h-8 w-8 text-green-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n              </svg>\r\n            </div>\r\n            <h2 className=\"mb-2 text-xl font-bold text-gray-900\">Email Verified!</h2>\r\n            <p className=\"text-sm text-gray-600\">Redirecting you now...</p>\r\n          </>\r\n        )}\r\n\r\n        {status === 'error' && (\r\n          <>\r\n            <div className=\"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-red-100\">\r\n              <svg className=\"h-8 w-8 text-red-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </div>\r\n            <h2 className=\"mb-2 text-xl font-bold text-gray-900\">Verification Failed</h2>\r\n            <p className=\"mb-4 text-sm text-gray-600\">{error}</p>\r\n            <button\r\n              onClick={() => router.push('/auth')}\r\n              className=\"rounded-lg bg-blue-600 px-6 py-2 text-sm font-semibold text-white hover:bg-blue-700\"\r\n            >\r\n              Back to Login\r\n            </button>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default function EmailVerifyPage() {\r\n  return (\r\n    <Suspense fallback={\r\n      <div className=\"flex min-h-screen items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100\">\r\n        <div className=\"h-16 w-16 animate-spin rounded-full border-4 border-blue-200 border-t-blue-600\" />\r\n      </div>\r\n    }>\r\n      <EmailVerifyContent />\r\n    </Suspense>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(auth)\\auth\\forgot-password\\ForgotPasswordClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[532,535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[532,535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":95,"column":48,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3445,3553],"text":"\r\n                Enter your email address and we&apos;ll send you a link to reset your password.\r\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3445,3553],"text":"\r\n                Enter your email address and we&lsquo;ll send you a link to reset your password.\r\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3445,3553],"text":"\r\n                Enter your email address and we&#39;ll send you a link to reset your password.\r\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3445,3553],"text":"\r\n                Enter your email address and we&rsquo;ll send you a link to reset your password.\r\n              "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport Link from 'next/link'\r\nimport { auth } from '@/lib/firebase/client'\r\nimport { sendPasswordResetEmail } from 'firebase/auth'\r\nimport BrandLogo from '@/components/BrandLogo'\r\n\r\n// Email validation\r\nfunction validateEmail(email: string): boolean {\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\r\n  return emailRegex.test(email)\r\n}\r\n\r\n// Get readable error message from Firebase error codes\r\nfunction getFirebaseErrorMessage(error: unknown): string {\r\n  const err = error as any\r\n  const code = err?.code\r\n  const message = err?.message\r\n\r\n  switch (code) {\r\n    case 'auth/user-not-found':\r\n      return 'No account found with this email address.'\r\n    case 'auth/invalid-email':\r\n      return 'Invalid email address.'\r\n    case 'auth/too-many-requests':\r\n      return 'Too many reset attempts. Please try again later.'\r\n    case 'auth/network-request-failed':\r\n      return 'Network error. Please check your connection.'\r\n    default:\r\n      return message || 'Failed to send reset email. Please try again.'\r\n  }\r\n}\r\n\r\nexport default function ForgotPasswordClient() {\r\n  const [email, setEmail] = useState('')\r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState('')\r\n  const [success, setSuccess] = useState(false)\r\n\r\n  const isEmailValid = validateEmail(email)\r\n\r\n  async function handleResetPassword(e: React.FormEvent) {\r\n    e.preventDefault()\r\n    setError('')\r\n    setSuccess(false)\r\n    setLoading(true)\r\n\r\n    try {\r\n      if (!isEmailValid) {\r\n        setError('Please enter a valid email address')\r\n        setLoading(false)\r\n        return\r\n      }\r\n\r\n      // Send password reset email via Firebase\r\n      await sendPasswordResetEmail(auth, email)\r\n\r\n      // Show success message\r\n      setSuccess(true)\r\n      setEmail('')\r\n    } catch (err) {\r\n      setError(getFirebaseErrorMessage(err))\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen flex-col bg-gray-50 text-gray-900 font-sans\">\r\n      <header className=\"sticky top-0 z-10 flex items-center justify-between border-b border-gray-200 bg-white px-6 py-4 shadow-sm lg:px-10\">\r\n        <div className=\"flex items-center\">\r\n          <BrandLogo />\r\n        </div>\r\n\r\n        <Link href=\"/auth/login\" className=\"flex items-center gap-2 text-sm font-medium text-gray-600 transition-colors hover:text-blue-600\">\r\n          Back to Login\r\n        </Link>\r\n      </header>\r\n\r\n      <main className=\"relative flex flex-grow items-center justify-center overflow-hidden px-4 py-12 sm:px-6 lg:px-8\">\r\n        <div className=\"absolute -left-[10%] -top-[10%] h-[500px] w-[500px] rounded-full bg-blue-600/5 blur-[100px]\" />\r\n        <div className=\"absolute -right-[10%] -bottom-[10%] h-[500px] w-[500px] rounded-full bg-blue-600/5 blur-[120px]\" />\r\n\r\n        <div className=\"relative z-10 w-full max-w-md overflow-hidden rounded-xl border border-gray-100 bg-white shadow-xl\">\r\n          <div className=\"h-1.5 w-full bg-blue-600\" />\r\n\r\n          <div className=\"p-8 pb-6\">\r\n            <div className=\"mb-8 text-center\">\r\n              <div className=\"mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-blue-50 text-3xl mx-auto\">\r\n                🔐\r\n              </div>\r\n              <h1 className=\"mb-2 text-2xl font-bold tracking-tight text-gray-900\">Reset Password</h1>\r\n              <p className=\"text-sm text-gray-500\">\r\n                Enter your email address and we'll send you a link to reset your password.\r\n              </p>\r\n            </div>\r\n\r\n            {success ? (\r\n              <div className=\"space-y-4\">\r\n                <div className=\"rounded-lg bg-green-50 p-4 border border-green-200\">\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <svg className=\"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                      <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                    <div>\r\n                      <h3 className=\"font-semibold text-green-900\">Email sent!</h3>\r\n                      <p className=\"mt-1 text-sm text-green-700\">\r\n                        Check your email for a link to reset your password. The link will expire in 1 hour.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <Link\r\n                  href=\"/auth/login\"\r\n                  className=\"flex w-full items-center justify-center rounded-lg bg-blue-600 px-4 py-3 text-sm font-bold text-white shadow-sm transition-all hover:bg-blue-700 hover:shadow-md active:scale-[0.98]\"\r\n                >\r\n                  Back to Login\r\n                </Link>\r\n              </div>\r\n            ) : (\r\n              <form className=\"space-y-5\" onSubmit={handleResetPassword}>\r\n                <div>\r\n                  <label htmlFor=\"email\" className=\"mb-2 block text-sm font-semibold text-gray-900\">\r\n                    Email Address\r\n                  </label>\r\n                  <div className=\"relative rounded-lg border border-gray-200 shadow-sm transition-all focus-within:border-blue-600 focus-within:ring-1 focus-within:ring-blue-600\">\r\n                    <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\">\r\n                      <svg className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\r\n                      </svg>\r\n                    </div>\r\n                    <input\r\n                      type=\"email\"\r\n                      id=\"email\"\r\n                      name=\"email\"\r\n                      value={email}\r\n                      onChange={(e) => {\r\n                        setEmail(e.target.value)\r\n                        setError('')\r\n                      }}\r\n                      className=\"block w-full border-0 bg-transparent py-3 pl-10 pr-4 text-sm text-gray-900 placeholder-gray-400 focus:ring-0\"\r\n                      placeholder=\"name@example.com\"\r\n                      disabled={loading}\r\n                      autoComplete=\"email\"\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Email validation feedback */}\r\n                  {email && !isEmailValid && (\r\n                    <p className=\"mt-2 text-xs text-orange-600 flex items-center gap-1\">\r\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                        <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n                      </svg>\r\n                      Invalid email format\r\n                    </p>\r\n                  )}\r\n                  {email && isEmailValid && (\r\n                    <p className=\"mt-2 text-xs text-green-600 flex items-center gap-1\">\r\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                        <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\r\n                      </svg>\r\n                      Valid email\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Error message */}\r\n                {error && (\r\n                  <div className=\"rounded-lg bg-red-50 p-3 border border-red-200\">\r\n                    <p className=\"text-sm text-red-800 font-medium\">{error}</p>\r\n                  </div>\r\n                )}\r\n\r\n                <button\r\n                  type=\"submit\"\r\n                  disabled={loading || !isEmailValid}\r\n                  className=\"flex w-full items-center justify-center gap-2 rounded-lg bg-blue-600 px-4 py-3 text-sm font-bold text-white shadow-sm transition-all hover:bg-blue-700 hover:shadow-md active:scale-[0.98] disabled:cursor-not-allowed disabled:opacity-60\"\r\n                >\r\n                  {loading ? (\r\n                    <>\r\n                      <svg className=\"h-4 w-4 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      Sending reset link…\r\n                    </>\r\n                  ) : (\r\n                    'Send Reset Link'\r\n                  )}\r\n                </button>\r\n\r\n                <p className=\"text-center text-xs text-gray-500\">\r\n                  Remember your password?{' '}\r\n                  <Link href=\"/auth/login\" className=\"font-medium text-blue-600 hover:underline\">\r\n                    Back to login\r\n                  </Link>\r\n                </p>\r\n              </form>\r\n            )}\r\n\r\n            <div className=\"relative my-6\">\r\n              <div className=\"absolute inset-0 flex items-center\" aria-hidden=\"true\">\r\n                <div className=\"w-full border-t border-gray-200\" />\r\n              </div>\r\n            </div>\r\n\r\n            <p className=\"text-center text-xs text-gray-500\">\r\n              By continuing, you agree to Crown And Crest&apos;s{' '}\r\n              <a href=\"#\" className=\"font-medium text-blue-600 hover:underline\">\r\n                Terms of Use\r\n              </a>\r\n              {' '}and{' '}\r\n              <a href=\"#\" className=\"font-medium text-blue-600 hover:underline\">\r\n                Privacy Policy\r\n              </a>\r\n              .\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between border-t border-gray-100 bg-gray-50 px-8 py-4 text-xs font-medium text-gray-500\">\r\n            <div className=\"flex items-center gap-1.5\">\r\n              <svg className=\"h-4 w-4 text-green-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\" />\r\n              </svg>\r\n              <span>100% Secure</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-1.5\">\r\n              <svg className=\"h-4 w-4 text-blue-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path d=\"M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z\" />\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0\" />\r\n              </svg>\r\n              <span>Fast Reset</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"absolute bottom-6 w-full text-center\">\r\n          <p className=\"text-xs text-gray-400\">© 2024 Crown And Crest. All rights reserved.</p>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(auth)\\auth\\forgot-password\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(auth)\\auth\\login\\LoginClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isSignInWithEmailLink' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'signInWithEmailLink' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1182,1185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1182,1185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter, useSearchParams } from 'next/navigation'\nimport Link from 'next/link'\nimport BrandLogo from '@/components/BrandLogo'\nimport { auth } from '@/lib/firebase/client'\nimport {\n  RecaptchaVerifier,\n  signInWithPhoneNumber,\n  createUserWithEmailAndPassword,\n  signInWithEmailAndPassword,\n  sendSignInLinkToEmail,\n  isSignInWithEmailLink,\n  signInWithEmailLink,\n} from 'firebase/auth'\n\n// Phone validation: Indian phone numbers (10 digits)\nfunction validatePhoneNumber(phone: string): boolean {\n  return /^\\d{10}$/.test(phone)\n}\n\n// Normalize phone input: remove non-digits, limit to 10\nfunction normalizePhone(value: string): string {\n  return value.replace(/\\D/g, '').slice(0, 10)\n}\n\n// Email validation\nfunction validateEmail(email: string): boolean {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n  return emailRegex.test(email)\n}\n\n// Password validation: at least 6 characters\nfunction validatePassword(password: string): boolean {\n  return password.length >= 6\n}\n\n// Get readable error message from Firebase error codes\nfunction getFirebaseErrorMessage(error: unknown): string {\n  const err = error as any\n  const code = err?.code\n  const message = err?.message\n\n  switch (code) {\n    case 'auth/email-already-in-use':\n      return 'Email already registered. Please login instead.'\n    case 'auth/invalid-email':\n      return 'Invalid email address.'\n    case 'auth/weak-password':\n      return 'Password should be at least 6 characters.'\n    case 'auth/user-not-found':\n      return 'Email not registered. Please sign up first.'\n    case 'auth/wrong-password':\n      return 'Incorrect password.'\n    case 'auth/too-many-requests':\n      return 'Too many login attempts. Please try again later.'\n    case 'auth/network-request-failed':\n      return 'Network error. Please check your connection.'\n    case 'auth/invalid-credential':\n      return 'Invalid email or password.'\n    default:\n      return message || 'An error occurred. Please try again.'\n  }\n}\n\nexport default function LoginClient() {\n  const [phone, setPhone] = useState('')\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [recaptchaLoading, setRecaptchaLoading] = useState(false)\n  const [error, setError] = useState('')\n  const [authMethod, setAuthMethod] = useState<'phone' | 'email' | 'email-otp'>('phone')\n  const router = useRouter()\n  const searchParams = useSearchParams()\n  const redirectUrl = searchParams.get('redirect') || '/'\n\n  useEffect(() => {\n    // Check if we have a stored redirect URL from session\n    const storedRedirect = sessionStorage.getItem('auth_redirect')\n    if (storedRedirect) {\n      // Keep it for after login\n    }\n  }, [])\n\n  // Phone validation\n  const isPhoneValid = validatePhoneNumber(phone)\n\n  // Email validation\n  const isEmailValid = validateEmail(email)\n  const isPasswordValid = validatePassword(password)\n  const isEmailAuthValid = isEmailValid && isPasswordValid\n\n  async function sendOtp() {\n    setError('')\n    setRecaptchaLoading(true)\n    setLoading(true)\n\n    try {\n      // Validate phone before Firebase call\n      if (!isPhoneValid) {\n        setError('Please enter a valid 10-digit mobile number')\n        setRecaptchaLoading(false)\n        setLoading(false)\n        return Promise.reject(new Error('Invalid phone number'))\n      }\n\n      // Store redirect intent for after login\n      sessionStorage.setItem('auth_redirect', redirectUrl)\n\n      // Get reCAPTCHA container (use existing one from JSX)\n      let container = document.getElementById('recaptcha-container') as HTMLElement | null\n      if (!container) {\n        container = document.createElement('div')\n        container.id = 'recaptcha-container'\n        container.style.position = 'absolute'\n        container.style.visibility = 'hidden'\n        document.body.appendChild(container)\n      }\n\n      // Initialize reCAPTCHA with error handling (only if not already initialized)\n      if (!window.recaptchaVerifier) {\n        try {\n          window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {\n            size: 'invisible',\n          })\n        } catch (err) {\n          setError('Failed to initialize security. Please refresh the page.')\n          setRecaptchaLoading(false)\n          setLoading(false)\n          window.recaptchaVerifier = undefined\n          return Promise.reject(err)\n        }\n      }\n\n      // After reCAPTCHA is ready, hide loading\n      setRecaptchaLoading(false)\n\n      const result = await signInWithPhoneNumber(\n        auth,\n        `+91${phone}`,\n        window.recaptchaVerifier\n      )\n\n      window.confirmationResult = result\n      router.push('/auth/otp')\n    } catch (err) {\n      // Clean up verifier on error\n      if (window.recaptchaVerifier) {\n        try {\n          window.recaptchaVerifier.clear()\n        } catch {\n          // Ignore cleanup errors\n        }\n        window.recaptchaVerifier = undefined\n      }\n\n      const errorMessage = (err as Error).message\n\n      // Parse Firebase errors\n      if (errorMessage.includes('invalid-phone-number')) {\n        setError('Invalid phone number format')\n      } else if (errorMessage.includes('too-many-requests')) {\n        setError('Too many login attempts. Please try again later.')\n      } else if (errorMessage.includes('network')) {\n        setError('Network error. Please check your connection.')\n      } else {\n        setError(errorMessage || 'Failed to send OTP. Please try again.')\n      }\n\n      setRecaptchaLoading(false)\n      throw err\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function signupWithEmail() {\n    setError('')\n    setLoading(true)\n\n    try {\n      if (!isEmailValid) {\n        setError('Please enter a valid email address')\n        setLoading(false)\n        return\n      }\n\n      if (!isPasswordValid) {\n        setError('Password must be at least 6 characters')\n        setLoading(false)\n        return\n      }\n\n      // Store redirect intent\n      sessionStorage.setItem('auth_redirect', redirectUrl)\n\n      // Create user with Firebase\n      const result = await createUserWithEmailAndPassword(auth, email, password)\n\n      // Get ID token\n      const idToken = await result.user.getIdToken()\n\n      // Create session via secure API\n      const response = await fetch('/api/auth/session', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ idToken }),\n      })\n\n      if (!response.ok) {\n        const data = await response.json()\n        throw new Error(data.error || 'Failed to create session')\n      }\n\n      // Session created successfully, redirect\n      // Use redirect from URL parameter first, then sessionStorage as fallback\n      const storedRedirect = sessionStorage.getItem('auth_redirect')\n      const finalRedirect = storedRedirect || redirectUrl || '/'\n      sessionStorage.removeItem('auth_redirect')\n\n      // Use router.push instead of router.replace to ensure proper page load\n      router.push(finalRedirect)\n    } catch (err) {\n      setError(getFirebaseErrorMessage(err))\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function loginWithEmail() {\n    setError('')\n    setLoading(true)\n\n    try {\n      if (!isEmailValid) {\n        setError('Please enter a valid email address')\n        setLoading(false)\n        return\n      }\n\n      if (!isPasswordValid) {\n        setError('Password must be at least 6 characters')\n        setLoading(false)\n        return\n      }\n\n      // Store redirect intent\n      sessionStorage.setItem('auth_redirect', redirectUrl)\n\n      // Sign in with Firebase\n      const result = await signInWithEmailAndPassword(auth, email, password)\n\n      // Get ID token\n      const idToken = await result.user.getIdToken()\n\n      // Create session via secure API\n      const response = await fetch('/api/auth/session', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ idToken }),\n      })\n\n      if (!response.ok) {\n        const data = await response.json()\n        throw new Error(data.error || 'Failed to create session')\n      }\n\n      // Session created successfully, redirect\n      // Use redirect from URL parameter first, then sessionStorage as fallback\n      const storedRedirect = sessionStorage.getItem('auth_redirect')\n      const finalRedirect = storedRedirect || redirectUrl || '/'\n      sessionStorage.removeItem('auth_redirect')\n\n      // Use router.push instead of router.replace to ensure proper page load\n      router.push(finalRedirect)\n    } catch (err) {\n      setError(getFirebaseErrorMessage(err))\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  async function sendEmailOtp() {\n    setError('')\n    setLoading(true)\n\n    try {\n      // Validate email before Firebase call\n      if (!isEmailValid) {\n        setError('Please enter a valid email address')\n        setLoading(false)\n        return\n      }\n\n      // Store redirect intent\n      sessionStorage.setItem('auth_redirect', redirectUrl)\n\n      // Configure email link settings\n      const actionCodeSettings = {\n        // URL to redirect to after email link is clicked\n        url: `${window.location.origin}/auth/email-verify?redirect=${encodeURIComponent(redirectUrl)}`,\n        handleCodeInApp: true,\n      }\n\n      // Send sign-in link to email\n      await sendSignInLinkToEmail(auth, email, actionCodeSettings)\n\n      // Store email in localStorage to retrieve after redirect\n      window.localStorage.setItem('emailForSignIn', email)\n\n      // Show success message\n      setError('') // Clear any errors\n      alert(`Verification link sent to ${email}. Please check your inbox (and spam folder).`)\n    } catch (err) {\n      setError(getFirebaseErrorMessage(err))\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleEmailAuthSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    // Determine if signup or login based on error history\n    // Try signup first, if email exists error will guide user to login\n    await signupWithEmail()\n  }\n\n  const handleEmailChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setEmail(e.target.value)\n    setError('') // Clear error when user changes input\n  }\n\n  const handlePasswordChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setPassword(e.target.value)\n    setError('') // Clear error when user changes input\n  }\n\n  const handlePhoneChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const normalized = normalizePhone(e.target.value)\n    setPhone(normalized)\n    setError('') // Clear error when user changes input\n  }\n\n  return (\n    <div className=\"flex min-h-screen flex-col bg-gray-50 text-gray-900 font-sans\">\n      <header className=\"border-b border-neutral-200\">\n        <div className=\"mx-auto max-w-7xl px-4 py-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between gap-6\">\n            <Link href=\"/\" className=\"flex items-center flex-shrink-0 text-neutral-900 hover:text-accent transition-colors duration-200\" aria-label=\"Home\">\n              <BrandLogo />\n            </Link>\n\n            <a href=\"#\" className=\"font-inter text-sm font-medium text-neutral-600 hover:text-accent transition-colors duration-200\">\n              Need Help?\n            </a>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"relative flex flex-grow items-center justify-center overflow-hidden px-4 py-12 sm:px-6 lg:px-8\">\n        <div className=\"absolute -left-[10%] -top-[10%] h-[500px] w-[500px] rounded-full bg-blue-600/5 blur-[100px]\" />\n        <div className=\"absolute -right-[10%] -bottom-[10%] h-[500px] w-[500px] rounded-full bg-blue-600/5 blur-[120px]\" />\n\n        <div className=\"relative z-10 w-full max-w-md overflow-hidden rounded-xl border border-gray-100 bg-white shadow-xl\">\n          <div className=\"h-1.5 w-full bg-blue-600\" />\n\n          <div className=\"p-8 pb-6\">\n            <div className=\"mb-8 text-center\">\n              <h1 className=\"mb-2 text-2xl font-bold tracking-tight text-gray-900\">Login or Sign Up</h1>\n              <p className=\"text-sm text-gray-500\">Choose your preferred login method</p>\n            </div>\n\n            {/* Auth Method Tabs */}\n            <div className=\"mb-6 flex gap-2 rounded-lg bg-gray-100 p-1\">\n              <button\n                type=\"button\"\n                onClick={() => { setAuthMethod('phone'); setError('') }}\n                className={`flex-1 rounded-md px-4 py-2 text-sm font-medium transition-all ${authMethod === 'phone'\n                    ? 'bg-white text-blue-600 shadow-sm'\n                    : 'text-gray-600 hover:text-gray-900'\n                  }`}\n              >\n                Phone OTP\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => { setAuthMethod('email-otp'); setError('') }}\n                className={`flex-1 rounded-md px-4 py-2 text-sm font-medium transition-all ${authMethod === 'email-otp'\n                    ? 'bg-white text-blue-600 shadow-sm'\n                    : 'text-gray-600 hover:text-gray-900'\n                  }`}\n              >\n                Email OTP\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => { setAuthMethod('email'); setError('') }}\n                className={`flex-1 rounded-md px-4 py-2 text-sm font-medium transition-all ${authMethod === 'email'\n                    ? 'bg-white text-blue-600 shadow-sm'\n                    : 'text-gray-600 hover:text-gray-900'\n                  }`}\n              >\n                Password\n              </button>\n            </div>\n\n            {/* Phone OTP Form */}\n            {authMethod === 'phone' && (\n              <form className=\"space-y-5\" onSubmit={(e) => e.preventDefault()}>\n                <div>\n                  <label htmlFor=\"mobile\" className=\"mb-2 block text-sm font-semibold text-gray-900\">\n                    Mobile Number\n                  </label>\n                  <div className=\"flex rounded-lg border border-gray-200 shadow-sm transition-all focus-within:border-blue-600 focus-within:ring-1 focus-within:ring-blue-600\">\n                    <span className=\"inline-flex select-none items-center rounded-l-lg border-r border-gray-200 bg-gray-50 px-4 text-sm font-medium text-gray-500\">\n                      +91\n                    </span>\n                    <input\n                      type=\"tel\"\n                      id=\"mobile\"\n                      name=\"mobile\"\n                      value={phone}\n                      onChange={handlePhoneChange}\n                      className=\"block w-full min-w-0 flex-1 border-0 bg-transparent py-3 px-4 text-gray-900 placeholder-gray-400 focus:ring-0 sm:text-sm\"\n                      placeholder=\"Enter 10-digit mobile number\"\n                      maxLength={10}\n                      disabled={loading}\n                    />\n                  </div>\n\n                  {/* Phone validation feedback */}\n                  {phone && !isPhoneValid && (\n                    <p className=\"mt-2 text-xs text-orange-600 flex items-center gap-1\">\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                        <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                      </svg>\n                      Enter exactly 10 digits\n                    </p>\n                  )}\n                  {phone && isPhoneValid && (\n                    <p className=\"mt-2 text-xs text-green-600 flex items-center gap-1\">\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                        <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                      </svg>\n                      Valid phone number\n                    </p>\n                  )}\n                </div>\n\n                {/* Error message */}\n                {error && (\n                  <div className=\"rounded-lg bg-red-50 p-3 border border-red-200\">\n                    <p className=\"text-sm text-red-800 font-medium\">{error}</p>\n                  </div>\n                )}\n\n                {/* reCAPTCHA loading state */}\n                {recaptchaLoading && (\n                  <div className=\"flex items-center gap-3 rounded-lg bg-blue-50 p-4 border border-blue-200\">\n                    <div className=\"animate-spin\">\n                      <svg className=\"h-5 w-5 text-blue-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                      </svg>\n                    </div>\n                    <span className=\"text-sm font-medium text-blue-700\">Securing login with reCAPTCHA…</span>\n                  </div>\n                )}\n\n                <button\n                  type=\"button\"\n                  onClick={sendOtp}\n                  disabled={loading || !isPhoneValid || recaptchaLoading}\n                  className=\"flex w-full items-center justify-center gap-2 rounded-lg bg-blue-600 px-4 py-3 text-sm font-bold text-white shadow-sm transition-all hover:bg-blue-700 hover:shadow-md active:scale-[0.98] disabled:cursor-not-allowed disabled:opacity-60\"\n                >\n                  {loading ? (\n                    <>\n                      <svg className=\"h-4 w-4 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m0 0h6m0 0h-6m0 0h-6\" />\n                      </svg>\n                      Sending OTP…\n                    </>\n                  ) : (\n                    'Send OTP'\n                  )}\n                </button>\n\n                <p className=\"text-center text-xs text-gray-500\">\n                  By continuing, you agree to Crown And Crest&apos;s{' '}\n                  <a href=\"#\" className=\"font-medium text-blue-600 hover:underline\">Terms of Use</a>\n                  {' '}and{' '}\n                  <a href=\"#\" className=\"font-medium text-blue-600 hover:underline\">Privacy Policy</a>.\n                </p>\n              </form>\n            )}\n\n            {/* Email OTP Form */}\n            {authMethod === 'email-otp' && (\n              <form className=\"space-y-5\" onSubmit={(e) => { e.preventDefault(); sendEmailOtp(); }}>\n                <div>\n                  <label htmlFor=\"email-otp\" className=\"mb-2 block text-sm font-semibold text-gray-900\">\n                    Email Address\n                  </label>\n                  <div className=\"relative rounded-lg border border-gray-200 shadow-sm transition-all focus-within:border-blue-600 focus-within:ring-1 focus-within:ring-blue-600\">\n                    <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\">\n                      <svg className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\n                      </svg>\n                    </div>\n                    <input\n                      type=\"email\"\n                      id=\"email-otp\"\n                      name=\"email\"\n                      value={email}\n                      onChange={handleEmailChange}\n                      className=\"block w-full border-0 bg-transparent py-3 pl-10 pr-4 text-sm text-gray-900 placeholder-gray-400 focus:ring-0\"\n                      placeholder=\"name@example.com\"\n                      disabled={loading}\n                      autoComplete=\"email\"\n                    />\n                  </div>\n\n                  {/* Email validation feedback */}\n                  {email && !isEmailValid && (\n                    <p className=\"mt-2 text-xs text-orange-600 flex items-center gap-1\">\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                        <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                      </svg>\n                      Invalid email format\n                    </p>\n                  )}\n                  {email && isEmailValid && (\n                    <p className=\"mt-2 text-xs text-green-600 flex items-center gap-1\">\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                        <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                      </svg>\n                      Valid email\n                    </p>\n                  )}\n                </div>\n\n                {/* Error message */}\n                {error && (\n                  <div className=\"rounded-lg bg-red-50 p-3 border border-red-200\">\n                    <p className=\"text-sm text-red-800 font-medium\">{error}</p>\n                  </div>\n                )}\n\n                <button\n                  type=\"submit\"\n                  disabled={loading || !isEmailValid}\n                  className=\"flex w-full items-center justify-center gap-2 rounded-lg bg-blue-600 px-4 py-3 text-sm font-semibold text-white shadow-sm transition-all hover:bg-blue-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 disabled:cursor-not-allowed disabled:bg-gray-400\"\n                >\n                  {loading ? (\n                    <>\n                      <svg className=\"h-4 w-4 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m0 0h6m0 0h-6m0 0h-6\" />\n                      </svg>\n                      Sending verification link…\n                    </>\n                  ) : (\n                    'Send Verification Link'\n                  )}\n                </button>\n\n                <p className=\"text-center text-xs text-gray-500\">\n                  We&apos;ll send a verification link to your email. Click the link to login instantly.\n                </p>\n              </form>\n            )}\n\n            {/* Email/Password Form */}\n            {authMethod === 'email' && (\n              <form className=\"space-y-4\" onSubmit={handleEmailAuthSubmit}>\n                <div>\n                  <label htmlFor=\"email\" className=\"mb-2 block text-sm font-semibold text-gray-900\">\n                    Email Address\n                  </label>\n                  <div className=\"relative rounded-lg border border-gray-200 shadow-sm transition-all focus-within:border-blue-600 focus-within:ring-1 focus-within:ring-blue-600\">\n                    <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\">\n                      <svg className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\n                      </svg>\n                    </div>\n                    <input\n                      type=\"email\"\n                      id=\"email\"\n                      name=\"email\"\n                      value={email}\n                      onChange={handleEmailChange}\n                      className=\"block w-full border-0 bg-transparent py-3 pl-10 pr-4 text-sm text-gray-900 placeholder-gray-400 focus:ring-0\"\n                      placeholder=\"name@example.com\"\n                      disabled={loading}\n                      autoComplete=\"email\"\n                    />\n                  </div>\n\n                  {/* Email validation feedback */}\n                  {email && !isEmailValid && (\n                    <p className=\"mt-2 text-xs text-orange-600 flex items-center gap-1\">\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                        <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                      </svg>\n                      Invalid email format\n                    </p>\n                  )}\n                  {email && isEmailValid && (\n                    <p className=\"mt-2 text-xs text-green-600 flex items-center gap-1\">\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                        <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                      </svg>\n                      Valid email\n                    </p>\n                  )}\n                </div>\n\n                <div>\n                  <label htmlFor=\"password\" className=\"mb-2 block text-sm font-semibold text-gray-900\">\n                    Password\n                  </label>\n                  <div className=\"relative rounded-lg border border-gray-200 shadow-sm transition-all focus-within:border-blue-600 focus-within:ring-1 focus-within:ring-blue-600\">\n                    <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\">\n                      <svg className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\n                      </svg>\n                    </div>\n                    <input\n                      type=\"password\"\n                      id=\"password\"\n                      name=\"password\"\n                      value={password}\n                      onChange={handlePasswordChange}\n                      className=\"block w-full border-0 bg-transparent py-3 pl-10 pr-4 text-sm text-gray-900 placeholder-gray-400 focus:ring-0\"\n                      placeholder=\"••••••••\"\n                      disabled={loading}\n                      autoComplete=\"current-password\"\n                    />\n                  </div>\n\n                  {/* Password validation feedback */}\n                  {password && !isPasswordValid && (\n                    <p className=\"mt-2 text-xs text-orange-600 flex items-center gap-1\">\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                        <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                      </svg>\n                      At least 6 characters required\n                    </p>\n                  )}\n                  {password && isPasswordValid && (\n                    <p className=\"mt-2 text-xs text-green-600 flex items-center gap-1\">\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                        <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                      </svg>\n                      Valid password\n                    </p>\n                  )}\n\n                  <div className=\"mt-2 flex justify-end\">\n                    <Link href=\"/auth/forgot-password\" className=\"text-xs font-medium text-blue-600 hover:text-blue-700 hover:underline\">\n                      Forgot Password?\n                    </Link>\n                  </div>\n                </div>\n\n                {/* Error message for email auth */}\n                {error && authMethod === 'email' && (\n                  <div className=\"rounded-lg bg-red-50 p-3 border border-red-200\">\n                    <p className=\"text-sm text-red-800 font-medium\">{error}</p>\n                    {error.includes('Email already registered') && (\n                      <button\n                        type=\"button\"\n                        onClick={loginWithEmail}\n                        className=\"mt-2 text-xs font-medium text-red-700 hover:text-red-800 hover:underline\"\n                      >\n                        Login instead\n                      </button>\n                    )}\n                  </div>\n                )}\n\n                {/* Submit button for email auth */}\n                <button\n                  type=\"submit\"\n                  disabled={loading || !isEmailAuthValid}\n                  className=\"flex w-full items-center justify-center rounded-lg bg-blue-600 px-4 py-3 text-sm font-bold text-white shadow-sm transition-all hover:bg-blue-700 hover:shadow-md active:scale-[0.98] disabled:cursor-not-allowed disabled:opacity-60\"\n                >\n                  {loading ? (\n                    <>\n                      <svg className=\"h-4 w-4 animate-spin mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                      </svg>\n                      Signing up…\n                    </>\n                  ) : (\n                    'Sign Up or Login'\n                  )}\n                </button>\n              </form>\n            )}\n          </div>\n\n          <div className=\"flex items-center justify-between border-t border-gray-100 bg-gray-50 px-8 py-4 text-xs font-medium text-gray-500\">\n            <div className=\"flex items-center gap-1.5\">\n              <svg className=\"h-4 w-4 text-green-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\" />\n              </svg>\n              <span>100% Secure</span>\n            </div>\n            <div className=\"flex items-center gap-1.5\">\n              <svg className=\"h-4 w-4 text-blue-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path d=\"M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z\" />\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0\" />\n              </svg>\n              <span>Easy Returns</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"absolute bottom-6 w-full text-center\">\n          <p className=\"text-xs text-gray-400\">© 2024 Crown And Crest. All rights reserved.</p>\n        </div>\n      </main>\n\n      <div id=\"recaptcha-container\" style={{ position: 'absolute', visibility: 'hidden' }} />\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(auth)\\auth\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(auth)\\auth\\otp\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(auth)\\auth\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(auth)\\auth\\steps\\EmailStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onBack' is defined but never used.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":9},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":128,"column":15,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[4170,4239],"text":"\r\n            We&apos;ll email you a link to sign in instantly\r\n          "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[4170,4239],"text":"\r\n            We&lsquo;ll email you a link to sign in instantly\r\n          "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[4170,4239],"text":"\r\n            We&#39;ll email you a link to sign in instantly\r\n          "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[4170,4239],"text":"\r\n            We&rsquo;ll email you a link to sign in instantly\r\n          "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\r\n\r\ntype Props = {\r\n  email: string\r\n  password: string\r\n  isEmailValid: boolean\r\n  isPasswordValid: boolean\r\n  isEmailAuthValid: boolean\r\n  error: string\r\n  loading: boolean\r\n  onEmailChange: (value: string) => void\r\n  onPasswordChange: (value: string) => void\r\n  onSignup: () => Promise<void> | void\r\n  onLogin: () => Promise<void> | void\r\n  onSendEmailOtp: () => Promise<void> | void\r\n  onBack: () => void\r\n}\r\n\r\nexport default function EmailStep({\r\n  email,\r\n  password,\r\n  isEmailValid,\r\n  isPasswordValid,\r\n  isEmailAuthValid,\r\n  error,\r\n  loading,\r\n  onEmailChange,\r\n  onPasswordChange,\r\n  onSignup,\r\n  onLogin,\r\n  onSendEmailOtp,\r\n  onBack,\r\n}: Props) {\r\n  const [mode, setMode] = useState<'password' | 'magic'>('password')\r\n\r\n  return (\r\n    <div className=\"space-y-6 animate-fade-in\">\r\n      <div>\r\n        <h1 className=\"font-display text-3xl font-bold text-gray-900 mb-2\">\r\n          Email Login\r\n        </h1>\r\n        <p className=\"text-gray-600 text-sm\">\r\n          Password or verification link\r\n        </p>\r\n      </div>\r\n\r\n      <div className=\"flex gap-2 rounded-lg bg-gray-100 p-1\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setMode('password')}\r\n          className={`flex-1 rounded-lg px-3 py-2 text-sm font-medium transition-all ${\r\n            mode === 'password'\r\n              ? 'bg-white text-gray-900 shadow-sm'\r\n              : 'text-gray-600 hover:text-gray-900'\r\n          }`}\r\n        >\r\n          Password\r\n        </button>\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setMode('magic')}\r\n          className={`flex-1 rounded-lg px-3 py-2 text-sm font-medium transition-all ${\r\n            mode === 'magic'\r\n              ? 'bg-white text-gray-900 shadow-sm'\r\n              : 'text-gray-600 hover:text-gray-900'\r\n          }`}\r\n        >\r\n          Link\r\n        </button>\r\n      </div>\r\n\r\n      {mode === 'magic' && (\r\n        <form\r\n          className=\"space-y-4\"\r\n          onSubmit={(e) => {\r\n            e.preventDefault()\r\n            onSendEmailOtp()\r\n          }}\r\n        >\r\n          <div className=\"space-y-2\">\r\n            <label htmlFor=\"email-magic\" className=\"block text-sm font-semibold text-gray-900\">\r\n              Email\r\n            </label>\r\n            <input\r\n              id=\"email-magic\"\r\n              type=\"email\"\r\n              value={email}\r\n              onChange={(e) => onEmailChange(e.target.value)}\r\n              placeholder=\"name@example.com\"\r\n              disabled={loading}\r\n              autoComplete=\"email\"\r\n              className=\"w-full h-12 rounded-xl border border-gray-300 bg-white px-4 text-gray-900 placeholder-gray-400 transition-all focus:border-accent focus:ring-1 focus:ring-accent/20 disabled:bg-gray-50\"\r\n            />\r\n            {email && !isEmailValid && (\r\n              <p className=\"text-xs text-red-600 flex items-center gap-1\">\r\n                <span>⚠</span> Invalid email\r\n              </p>\r\n            )}\r\n            {email && isEmailValid && (\r\n              <p className=\"text-xs text-green-600 flex items-center gap-1\">\r\n                <span>✓</span> Valid email\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"rounded-lg border border-red-200 bg-red-50 p-3 animate-fade-in\">\r\n              <p className=\"text-sm text-red-700 font-medium\">{error}</p>\r\n            </div>\r\n          )}\r\n\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading || !isEmailValid}\r\n            className=\"w-full h-12 rounded-xl bg-gray-900 text-white font-semibold text-sm transition-all duration-200 hover:bg-accent active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n          >\r\n            {loading ? (\r\n              <>\r\n                <div className=\"inline-flex h-4 w-4 animate-spinner rounded-full border-2 border-white border-t-transparent\" />\r\n                <span>Sending…</span>\r\n              </>\r\n            ) : (\r\n              'Send Link'\r\n            )}\r\n          </button>\r\n\r\n          <p className=\"text-xs text-gray-600 text-center\">\r\n            We'll email you a link to sign in instantly\r\n          </p>\r\n        </form>\r\n      )}\r\n\r\n      {mode === 'password' && (\r\n        <form\r\n          className=\"space-y-4\"\r\n          onSubmit={(e) => {\r\n            e.preventDefault()\r\n            onSignup()\r\n          }}\r\n        >\r\n          <div className=\"space-y-2\">\r\n            <label htmlFor=\"email\" className=\"block text-sm font-semibold text-gray-900\">\r\n              Email\r\n            </label>\r\n            <input\r\n              id=\"email\"\r\n              type=\"email\"\r\n              value={email}\r\n              onChange={(e) => onEmailChange(e.target.value)}\r\n              placeholder=\"name@example.com\"\r\n              disabled={loading}\r\n              autoComplete=\"email\"\r\n              className=\"w-full h-12 rounded-xl border border-gray-300 bg-white px-4 text-gray-900 placeholder-gray-400 transition-all focus:border-accent focus:ring-1 focus:ring-accent/20 disabled:bg-gray-50\"\r\n            />\r\n            {email && !isEmailValid && (\r\n              <p className=\"text-xs text-red-600 flex items-center gap-1\">\r\n                <span>⚠</span> Invalid email\r\n              </p>\r\n            )}\r\n            {email && isEmailValid && (\r\n              <p className=\"text-xs text-green-600 flex items-center gap-1\">\r\n                <span>✓</span> Valid email\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <label htmlFor=\"password\" className=\"block text-sm font-semibold text-gray-900\">\r\n              Password\r\n            </label>\r\n            <input\r\n              id=\"password\"\r\n              type=\"password\"\r\n              value={password}\r\n              onChange={(e) => onPasswordChange(e.target.value)}\r\n              placeholder=\"••••••••\"\r\n              disabled={loading}\r\n              autoComplete=\"current-password\"\r\n              className=\"w-full h-12 rounded-xl border border-gray-300 bg-white px-4 text-gray-900 placeholder-gray-400 transition-all focus:border-accent focus:ring-1 focus:ring-accent/20 disabled:bg-gray-50\"\r\n            />\r\n            {password && !isPasswordValid && (\r\n              <p className=\"text-xs text-red-600 flex items-center gap-1\">\r\n                <span>⚠</span> At least 6 characters\r\n              </p>\r\n            )}\r\n            {password && isPasswordValid && (\r\n              <p className=\"text-xs text-green-600 flex items-center gap-1\">\r\n                <span>✓</span> Strong enough\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"rounded-lg border border-red-200 bg-red-50 p-3 animate-fade-in\">\r\n              <p className=\"text-sm text-red-700 font-medium\">{error}</p>\r\n              {error.includes('Email already registered') && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={onLogin}\r\n                  className=\"mt-2 text-xs font-medium text-red-700 hover:underline\"\r\n                >\r\n                  Try logging in instead\r\n                </button>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"space-y-2\">\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading || !isEmailAuthValid}\r\n              className=\"w-full h-12 rounded-xl bg-gray-900 text-white font-semibold text-sm transition-all duration-200 hover:bg-accent active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n            >\r\n              {loading ? (\r\n                <>\r\n                  <div className=\"inline-flex h-4 w-4 animate-spinner rounded-full border-2 border-white border-t-transparent\" />\r\n                  <span>Creating…</span>\r\n                </>\r\n              ) : (\r\n                'Sign Up'\r\n              )}\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              onClick={onLogin}\r\n              disabled={loading || !isEmailAuthValid}\r\n              className=\"w-full h-12 rounded-xl border-2 border-gray-900 text-gray-900 font-semibold text-sm transition-all duration-200 hover:bg-gray-50 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              {loading ? 'Processing…' : 'Sign In'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(auth)\\auth\\steps\\EnterStep.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":31,"column":25,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[651,705],"text":"\r\n          Choose how you&apos;d like to sign in\r\n        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[651,705],"text":"\r\n          Choose how you&lsquo;d like to sign in\r\n        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[651,705],"text":"\r\n          Choose how you&#39;d like to sign in\r\n        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[651,705],"text":"\r\n          Choose how you&rsquo;d like to sign in\r\n        "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react'\r\n\r\ntype Props = {\r\n  phone: string\r\n  isPhoneValid: boolean\r\n  error: string\r\n  recaptchaLoading: boolean\r\n  loading: boolean\r\n  onPhoneChange: (value: string) => void\r\n  onSendOtp: () => void\r\n  onGoEmail: () => void\r\n}\r\n\r\nexport default function EnterStep({\r\n  phone,\r\n  isPhoneValid,\r\n  error,\r\n  recaptchaLoading,\r\n  loading,\r\n  onPhoneChange,\r\n  onSendOtp,\r\n  onGoEmail,\r\n}: Props) {\r\n  return (\r\n    <div className=\"space-y-6 animate-fade-in\">\r\n      <div>\r\n        <h1 className=\"font-display text-3xl font-bold text-gray-900 mb-2\">\r\n          Welcome Back\r\n        </h1>\r\n        <p className=\"text-gray-600 text-sm\">\r\n          Choose how you'd like to sign in\r\n        </p>\r\n      </div>\r\n\r\n      <form className=\"space-y-4\" onSubmit={(e) => e.preventDefault()}>\r\n        <div className=\"space-y-2\">\r\n          <label htmlFor=\"phone\" className=\"block text-sm font-semibold text-gray-900\">\r\n            Mobile Number\r\n          </label>\r\n          <div className=\"relative\">\r\n            <div className=\"flex rounded-xl border border-gray-300 overflow-hidden transition-all focus-within:border-accent focus-within:ring-1 focus-within:ring-accent/20\">\r\n              <span className=\"inline-flex items-center px-4 text-sm font-medium text-gray-600 bg-gray-50 border-r border-gray-300\">\r\n                +91\r\n              </span>\r\n              <input\r\n                id=\"phone\"\r\n                type=\"tel\"\r\n                inputMode=\"numeric\"\r\n                value={phone}\r\n                onChange={(e) => onPhoneChange(e.target.value)}\r\n                placeholder=\"Enter 10-digit number\"\r\n                maxLength={10}\r\n                disabled={loading || recaptchaLoading}\r\n                className=\"flex-1 px-4 py-3 text-gray-900 placeholder-gray-400 bg-white border-0 focus:ring-0 disabled:bg-gray-50\"\r\n              />\r\n            </div>\r\n            {phone && !isPhoneValid && (\r\n              <p className=\"mt-2 text-xs text-red-600 flex items-center gap-1\">\r\n                <span>⚠</span> Must be 10 digits\r\n              </p>\r\n            )}\r\n            {phone && isPhoneValid && (\r\n              <p className=\"mt-2 text-xs text-green-600 flex items-center gap-1\">\r\n                <span>✓</span> Valid number\r\n              </p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"rounded-lg border border-red-200 bg-red-50 p-3 animate-fade-in\">\r\n            <p className=\"text-sm text-red-700 font-medium\">{error}</p>\r\n          </div>\r\n        )}\r\n\r\n        {recaptchaLoading && (\r\n          <div className=\"rounded-lg bg-blue-50 border border-blue-200 p-3 flex items-center gap-2 animate-fade-in\">\r\n            <div className=\"inline-flex h-4 w-4 animate-spinner rounded-full border-2 border-blue-600 border-t-transparent\" />\r\n            <span className=\"text-sm text-blue-700\">Securing login…</span>\r\n          </div>\r\n        )}\r\n\r\n        <button\r\n          type=\"button\"\r\n          onClick={onSendOtp}\r\n          disabled={loading || !isPhoneValid || recaptchaLoading}\r\n          className=\"w-full h-12 rounded-xl bg-gray-900 text-white font-semibold text-sm transition-all duration-200 hover:bg-accent active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n        >\r\n          {loading ? (\r\n            <>\r\n              <div className=\"inline-flex h-4 w-4 animate-spinner rounded-full border-2 border-white border-t-transparent\" />\r\n              <span>Sending…</span>\r\n            </>\r\n          ) : (\r\n            'Continue with Phone'\r\n          )}\r\n        </button>\r\n\r\n        <div className=\"relative\">\r\n          <div className=\"absolute inset-0 flex items-center\">\r\n            <div className=\"w-full border-t border-gray-300\" />\r\n          </div>\r\n          <div className=\"relative flex justify-center text-sm\">\r\n            <span className=\"px-2 bg-white text-gray-600\">or</span>\r\n          </div>\r\n        </div>\r\n\r\n        <button\r\n          type=\"button\"\r\n          onClick={onGoEmail}\r\n          disabled={loading}\r\n          className=\"w-full h-12 rounded-xl border-2 border-gray-900 text-gray-900 font-semibold text-sm transition-all duration-200 hover:bg-gray-50 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n        >\r\n          Continue with Email\r\n        </button>\r\n      </form>\r\n\r\n      <div className=\"text-center space-y-3\">\r\n        <p className=\"text-xs text-gray-600\">\r\n          By continuing, you agree to our{' '}\r\n          <a href=\"#\" className=\"text-accent font-semibold hover:underline\">\r\n            Terms\r\n          </a>\r\n          {' '}and{' '}\r\n          <a href=\"#\" className=\"text-accent font-semibold hover:underline\">\r\n            Privacy Policy\r\n          </a>\r\n        </p>\r\n        <p className=\"text-xs text-gray-500\">\r\n          © 2024 Crown And Crest\r\n        </p>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(auth)\\auth\\steps\\OtpStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onBack' is defined but never used.","line":25,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react'\r\n\r\ntype Props = {\r\n  code: string\r\n  error: string\r\n  loading: boolean\r\n  resendTimer: number\r\n  resendLoading: boolean\r\n  setCode: (value: string) => void\r\n  onVerify: () => void\r\n  onResend: () => void\r\n  onBack: () => void\r\n  inputRef?: React.RefObject<HTMLInputElement>\r\n}\r\n\r\nexport default function OtpStep({\r\n  code,\r\n  error,\r\n  loading,\r\n  resendTimer,\r\n  resendLoading,\r\n  setCode,\r\n  onVerify,\r\n  onResend,\r\n  onBack,\r\n  inputRef,\r\n}: Props) {\r\n  const canResend = resendTimer === 0 && !resendLoading\r\n\r\n  useEffect(() => {\r\n    if (inputRef?.current && !inputRef.current.value) {\r\n      inputRef.current.focus()\r\n    }\r\n  }, [inputRef])\r\n\r\n  return (\r\n    <div className=\"space-y-6 animate-fade-in\">\r\n      <div>\r\n        <h1 className=\"font-display text-3xl font-bold text-gray-900 mb-2\">\r\n          Enter OTP\r\n        </h1>\r\n        <p className=\"text-gray-600 text-sm\">\r\n          We sent a code to your phone\r\n        </p>\r\n      </div>\r\n\r\n      <form className=\"space-y-4\" onSubmit={(e) => e.preventDefault()}>\r\n        <div className=\"space-y-2\">\r\n          <label htmlFor=\"otp\" className=\"block text-sm font-semibold text-gray-900\">\r\n            One-Time Code\r\n          </label>\r\n          <input\r\n            ref={inputRef}\r\n            id=\"otp\"\r\n            type=\"text\"\r\n            inputMode=\"numeric\"\r\n            value={code}\r\n            onChange={(e) => {\r\n              const normalized = e.target.value.replace(/\\D/g, '').slice(0, 6)\r\n              setCode(normalized)\r\n            }}\r\n            placeholder=\"000000\"\r\n            maxLength={6}\r\n            disabled={loading}\r\n            className=\"w-full h-14 rounded-xl border border-gray-300 bg-white px-4 text-center text-2xl font-semibold tracking-widest text-gray-900 placeholder-gray-400 transition-all focus:border-accent focus:ring-1 focus:ring-accent/20 disabled:bg-gray-50\"\r\n          />\r\n          {code && code.length !== 6 && (\r\n            <p className=\"text-xs text-red-600 flex items-center gap-1\">\r\n              <span>⚠</span> Enter 6 digits\r\n            </p>\r\n          )}\r\n          {code && code.length === 6 && (\r\n            <p className=\"text-xs text-green-600 flex items-center gap-1\">\r\n              <span>✓</span> Valid code\r\n            </p>\r\n          )}\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"rounded-lg border border-red-200 bg-red-50 p-3 animate-fade-in\">\r\n            <p className=\"text-sm text-red-700 font-medium\">{error}</p>\r\n          </div>\r\n        )}\r\n\r\n        <button\r\n          type=\"button\"\r\n          onClick={onVerify}\r\n          disabled={loading || code.length !== 6}\r\n          className=\"w-full h-12 rounded-xl bg-gray-900 text-white font-semibold text-sm transition-all duration-200 hover:bg-accent active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n        >\r\n          {loading ? (\r\n            <>\r\n              <div className=\"inline-flex h-4 w-4 animate-spinner rounded-full border-2 border-white border-t-transparent\" />\r\n              <span>Verifying…</span>\r\n            </>\r\n          ) : (\r\n            'Verify Code'\r\n          )}\r\n        </button>\r\n\r\n        <div className=\"rounded-lg bg-gray-50 border border-gray-200 p-4 text-center\">\r\n          {resendTimer > 0 ? (\r\n            <p className=\"text-sm text-gray-600\">\r\n              Resend available in <span className=\"font-semibold text-accent\">{resendTimer}s</span>\r\n            </p>\r\n          ) : (\r\n            <button\r\n              type=\"button\"\r\n              onClick={onResend}\r\n              disabled={!canResend}\r\n              className=\"w-full px-4 py-2 rounded-lg border border-gray-900 text-gray-900 font-semibold text-sm transition-all hover:bg-gray-100 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              {resendLoading ? 'Resending…' : 'Resend Code'}\r\n            </button>\r\n          )}\r\n        </div>\r\n      </form>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(auth)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\cart\\CartClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ArrowRight' is defined but never used.","line":7,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[634,637],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[634,637],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":14,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCart'. Either include it or remove the dependency array.","line":32,"column":8,"nodeType":"ArrayExpression","endLine":32,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadCart, user]","fix":{"range":[1410,1416],"text":"[loadCart, user]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":108,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":133,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":133,"endColumn":25},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":163,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[6742,6797],"text":"Looks like you haven&apos;t added anything to your cart yet."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[6742,6797],"text":"Looks like you haven&lsquo;t added anything to your cart yet."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[6742,6797],"text":"Looks like you haven&#39;t added anything to your cart yet."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[6742,6797],"text":"Looks like you haven&rsquo;t added anything to your cart yet."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect, useRef } from 'react'\r\nimport Image from 'next/image'\r\nimport Link from 'next/link'\r\nimport { useRouter } from 'next/navigation'\r\nimport { Minus, Plus, Trash2, ArrowRight, Lock } from 'lucide-react'\r\nimport { getGuestCart, updateGuestCartQuantity, removeFromGuestCart } from '@/lib/cart/guestCart'\r\nimport { getCart, getGuestCartDetails, updateCartQuantity, removeFromCart as removeFromCartAction, syncGuestCart } from '@/lib/cart/actions'\r\nimport type { CartItem } from '@/types/cart'\r\nimport { useToast } from '@/hooks/useToast'\r\n\r\nexport default function CartClient({ user }: { user?: any }) {\r\n    const router = useRouter()\r\n    const { showSuccess, showError } = useToast()\r\n    const [cartItems, setCartItems] = useState<CartItem[]>([])\r\n    const [isLoading, setIsLoading] = useState(true)\r\n    const [subtotal, setSubtotal] = useState(0)\r\n    const hasSyncedRef = useRef(false) // Prevent duplicate syncs\r\n\r\n    useEffect(() => {\r\n        loadCart()\r\n\r\n        // Listen for storage events (updates from other tabs or addToCart calls)\r\n        const handleStorageChange = (e: StorageEvent) => {\r\n            if (e.key === 'guest_cart' && !user) {\r\n                loadCart()\r\n            }\r\n        }\r\n        window.addEventListener('storage', handleStorageChange)\r\n        return () => window.removeEventListener('storage', handleStorageChange)\r\n    }, [user])\r\n\r\n    const loadCart = async () => {\r\n        setIsLoading(true)\r\n\r\n        try {\r\n            if (user) {\r\n                // AUTHENTICATED: Sync guest cart if exists, then fetch auth cart\r\n                const guestCartStr = localStorage.getItem('guest_cart')\r\n                if (guestCartStr && !hasSyncedRef.current) {\r\n                    try {\r\n                        const guestItems = JSON.parse(guestCartStr)\r\n                        if (Array.isArray(guestItems) && guestItems.length > 0) {\r\n                            // CRITICAL FIX: Clear guest cart BEFORE syncing to prevent race condition\r\n                            localStorage.removeItem('guest_cart')\r\n                            hasSyncedRef.current = true // Mark as synced\r\n\r\n                            // Now sync the items (this triggers revalidatePath, but guest cart is already cleared)\r\n                            await syncGuestCart(guestItems)\r\n                        }\r\n                    } catch (e) {\r\n                        console.error('Failed to parse guest cart during sync', e)\r\n                    }\r\n                }\r\n\r\n                // HARD GUARD: Read ONLY auth cart when authenticated\r\n                const items = await getCart()\r\n                setCartItems(items)\r\n                calculateTotals(items)\r\n            } else {\r\n                // GUEST: Fetch from Local Storage\r\n                const guestItems = getGuestCart()\r\n                if (guestItems.length === 0) {\r\n                    setCartItems([])\r\n                    setSubtotal(0)\r\n                    setIsLoading(false)\r\n                    return\r\n                }\r\n                const details = await getGuestCartDetails(guestItems)\r\n                setCartItems(details)\r\n                calculateTotals(details)\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to load cart', error)\r\n            showError('Failed to load cart items')\r\n        } finally {\r\n            setIsLoading(false)\r\n        }\r\n    }\r\n\r\n    const calculateTotals = (items: CartItem[]) => {\r\n        const total = items.reduce((sum, item) => {\r\n            // Check for price overrides or default to base price\r\n            const price = item.variants?.price_override ?? item.products.base_price\r\n            return sum + (price * item.quantity)\r\n        }, 0)\r\n        setSubtotal(total)\r\n    }\r\n\r\n    const handleUpdateQuantity = async (item: CartItem, newQuantity: number) => {\r\n        if (newQuantity < 1) return\r\n        if (newQuantity > (item.variants.stock_quantity || 99)) {\r\n            showError('Cannot add more than available stock')\r\n            return\r\n        }\r\n\r\n        if (user) {\r\n            // Server Action\r\n            try {\r\n                await updateCartQuantity(item.id, newQuantity)\r\n                // Optimistic update\r\n                const updatedItems = cartItems.map(i =>\r\n                    i.id === item.id ? { ...i, quantity: newQuantity } : i\r\n                )\r\n                setCartItems(updatedItems)\r\n                calculateTotals(updatedItems)\r\n            } catch (err) {\r\n                showError('Failed to update quantity')\r\n            }\r\n        } else {\r\n            // Local Storage\r\n            const success = updateGuestCartQuantity(item.product_id, item.variant_id, newQuantity)\r\n            if (success) {\r\n                const updatedItems = cartItems.map(i =>\r\n                    i.id === item.id ? { ...i, quantity: newQuantity } : i\r\n                )\r\n                setCartItems(updatedItems)\r\n                calculateTotals(updatedItems)\r\n            }\r\n        }\r\n    }\r\n\r\n    const handleRemove = async (item: CartItem) => {\r\n        if (user) {\r\n            // Server Action\r\n            try {\r\n                await removeFromCartAction(item.id)\r\n                const updatedItems = cartItems.filter(i => i.id !== item.id)\r\n                setCartItems(updatedItems)\r\n                calculateTotals(updatedItems)\r\n                showSuccess('Item removed from cart')\r\n            } catch (err) {\r\n                showError('Failed to remove item')\r\n            }\r\n        } else {\r\n            // Local Storage\r\n            const success = removeFromGuestCart(item.product_id, item.variant_id)\r\n            if (success) {\r\n                const updatedItems = cartItems.filter(i => i.id !== item.id)\r\n                setCartItems(updatedItems)\r\n                calculateTotals(updatedItems)\r\n                showSuccess('Item removed from cart')\r\n            }\r\n        }\r\n    }\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"min-h-[60vh] flex items-center justify-center\">\r\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-black\"></div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (cartItems.length === 0) {\r\n        return (\r\n            <div className=\"min-h-[60vh] flex flex-col items-center justify-center text-center px-4\">\r\n                <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-6\">\r\n                    <Trash2 className=\"w-8 h-8 text-gray-400\" />\r\n                </div>\r\n                <h2 className=\"text-2xl font-display text-gray-900 mb-2\">Your cart is empty</h2>\r\n                <p className=\"text-gray-500 mb-8 max-w-sm\">Looks like you haven't added anything to your cart yet.</p>\r\n                <Link\r\n                    href=\"/shop\"\r\n                    className=\"bg-black text-white px-8 py-3 rounded text-sm font-bold tracking-widest uppercase hover:bg-gray-800 transition-colors\"\r\n                >\r\n                    Start Shopping\r\n                </Link>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-12\">\r\n            <h1 className=\"text-3xl font-display text-gray-900 mb-8\">Shopping Cart <span className=\"text-gray-400 text-lg\">({cartItems.length} items)</span></h1>\r\n\r\n            <div className=\"flex flex-col lg:flex-row gap-12\">\r\n                {/* Cart Items */}\r\n                <div className=\"flex-1 space-y-8\">\r\n                    {cartItems.map((item) => (\r\n                        <div key={item.id} className=\"flex gap-4 md:gap-8 pb-8 border-b border-gray-100 last:border-0 relative group\">\r\n                            <div className=\"relative w-24 h-32 md:w-32 md:h-40 bg-gray-100 rounded-lg overflow-hidden shrink-0\">\r\n                                <Image\r\n                                    src={item.products.image_url || '/placeholder.png'}\r\n                                    alt={item.products.name}\r\n                                    fill\r\n                                    className=\"object-cover\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"flex-1 flex flex-col justify-between\">\r\n                                <div>\r\n                                    <div className=\"flex justify-between items-start mb-2\">\r\n                                        <Link href={`/product/${item.products.slug}`} className=\"text-lg font-bold text-gray-900 hover:underline decoration-1 underline-offset-4\">\r\n                                            {item.products.name}\r\n                                        </Link>\r\n                                        <p className=\"text-lg font-bold text-gray-900\">₹{(item.products.base_price * item.quantity).toLocaleString('en-IN')}</p>\r\n                                    </div>\r\n                                    <p className=\"text-sm text-gray-500 mb-1\">{item.products.category}</p>\r\n                                    <div className=\"flex gap-4 text-sm text-gray-600\">\r\n                                        <p>Size: <span className=\"font-medium text-gray-900\">{item.variants.size}</span></p>\r\n                                        <p>Color: <span className=\"font-medium text-gray-900\">{item.variants.color}</span></p>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex justify-between items-end\">\r\n                                    <div className=\"flex items-center border border-gray-200 rounded\">\r\n                                        <button\r\n                                            onClick={() => handleUpdateQuantity(item, item.quantity - 1)}\r\n                                            className=\"p-2 hover:bg-gray-50 text-gray-600 disabled:opacity-50\"\r\n                                            disabled={item.quantity <= 1}\r\n                                        >\r\n                                            <Minus className=\"w-3 h-3\" />\r\n                                        </button>\r\n                                        <span className=\"w-8 text-center text-sm font-medium\">{item.quantity}</span>\r\n                                        <button\r\n                                            onClick={() => handleUpdateQuantity(item, item.quantity + 1)}\r\n                                            className=\"p-2 hover:bg-gray-50 text-gray-600\"\r\n                                        >\r\n                                            <Plus className=\"w-3 h-3\" />\r\n                                        </button>\r\n                                    </div>\r\n\r\n                                    <button\r\n                                        onClick={() => handleRemove(item)}\r\n                                        className=\"text-xs text-red-500 hover:text-red-600 font-medium underline underline-offset-4\"\r\n                                    >\r\n                                        Remove\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Summary */}\r\n                <div className=\"lg:w-96 shrink-0\">\r\n                    <div className=\"bg-gray-50 rounded-xl p-6 sticky top-24\">\r\n                        <h2 className=\"text-lg font-bold text-gray-900 mb-6 uppercase tracking-wider\">Order Summary</h2>\r\n\r\n                        <div className=\"space-y-4 mb-6\">\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-gray-600\">Subtotal</span>\r\n                                <span className=\"font-medium text-gray-900\">₹{subtotal.toLocaleString('en-IN')}</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-gray-600\">Shipping</span>\r\n                                <span className=\"text-green-600 font-medium\">Free</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-gray-600\">Tax</span>\r\n                                <span className=\"text-gray-500 text-xs\">(Calculated at checkout)</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"border-t border-gray-200 pt-4 mb-8\">\r\n                            <div className=\"flex justify-between items-end\">\r\n                                <span className=\"text-base font-bold text-gray-900\">Total</span>\r\n                                <span className=\"text-2xl font-bold text-gray-900\">₹{subtotal.toLocaleString('en-IN')}</span>\r\n                            </div>\r\n                            <p className=\"text-xs text-gray-500 mt-1\">Inclusive of all taxes</p>\r\n                        </div>\r\n\r\n                        <Link\r\n                            href=\"/checkout\"\r\n                            className=\"w-full bg-black text-white flex items-center justify-center gap-2 py-4 rounded-lg font-bold text-sm uppercase tracking-widest hover:bg-gray-900 transition-all hover:scale-[1.02] active:scale-[0.98] shadow-lg shadow-black/20\"\r\n                        >\r\n                            <Lock className=\"w-4 h-4\" /> Secure Checkout\r\n                        </Link>\r\n\r\n                        <div className=\"mt-6 flex justify-center gap-4 opacity-50 grayscale\">\r\n                            {/* Payment Icons Placeholder */}\r\n                            <div className=\"h-6 w-10 bg-gray-200 rounded\"></div>\r\n                            <div className=\"h-6 w-10 bg-gray-200 rounded\"></div>\r\n                            <div className=\"h-6 w-10 bg-gray-200 rounded\"></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\cart\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\checkout\\CheckoutClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Truck' is defined but never used.","line":7,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":7,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":61},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[482,485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[482,485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[847,850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[847,850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showSuccess' is assigned a value but never used.","line":30,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'showError'. Either include it or remove the dependency array.","line":76,"column":8,"nodeType":"ArrayExpression","endLine":76,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [router, showError]","fix":{"range":[2418,2426],"text":"[router, showError]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4448,4451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4448,4451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\nimport Image from 'next/image'\r\nimport Link from 'next/link'\r\nimport { Lock, Truck, ChevronRight, ShoppingBag, AlertCircle } from 'lucide-react'\r\nimport { getCart } from '@/lib/cart/actions'\r\nimport type { CartItem } from '@/types/cart'\r\nimport { useToast } from '@/hooks/useToast'\r\n\r\n// Declare Razorpay on window\r\ndeclare global {\r\n    interface Window {\r\n        Razorpay: any\r\n    }\r\n}\r\n\r\n/**\r\n * MAGIC CHECKOUT IMPLEMENTATION\r\n * \r\n * This checkout is powered entirely by Razorpay Magic Checkout.\r\n * - NO custom address/phone forms\r\n * - NO manual payment UI\r\n * - Razorpay handles: address, phone, payment method, COD\r\n * - We only display cart and launch Magic Checkout\r\n */\r\nexport default function CheckoutClient({ user }: { user: any }) {\r\n    const router = useRouter()\r\n    const { showSuccess, showError, showLoading } = useToast()\r\n    const [cartItems, setCartItems] = useState<CartItem[]>([])\r\n    const [isLoading, setIsLoading] = useState(true)\r\n    const [subtotal, setSubtotal] = useState(0)\r\n    const [isProcessing, setIsProcessing] = useState(false)\r\n\r\n    // Load Razorpay Script\r\n    useEffect(() => {\r\n        const script = document.createElement('script')\r\n        script.src = 'https://checkout.razorpay.com/v1/checkout.js'\r\n        script.async = true\r\n        document.body.appendChild(script)\r\n        return () => {\r\n            document.body.removeChild(script)\r\n        }\r\n    }, [])\r\n\r\n    // Load Cart\r\n    useEffect(() => {\r\n        const loadCart = async () => {\r\n            setIsLoading(true)\r\n            try {\r\n                const items = await getCart()\r\n\r\n                if (items.length === 0) {\r\n                    router.push('/cart')\r\n                    return\r\n                }\r\n\r\n                setCartItems(items)\r\n\r\n                const total = items.reduce((sum, item) => {\r\n                    const price = item.variants.price_override ?? item.products.base_price\r\n                    return sum + (price * item.quantity)\r\n                }, 0)\r\n                setSubtotal(total)\r\n\r\n            } catch (error) {\r\n                console.error('Failed to load cart', error)\r\n                showError('Failed to load checkout')\r\n            } finally {\r\n                setIsLoading(false)\r\n            }\r\n        }\r\n\r\n        loadCart()\r\n    }, [router])\r\n\r\n    /**\r\n     * MAGIC CHECKOUT LAUNCH\r\n     * \r\n     * 1. Create Razorpay order via /api/razorpay/order\r\n     * 2. Launch Magic Checkout UI\r\n     * 3. Razorpay handles everything else\r\n     * 4. Webhook processes payment/COD\r\n     */\r\n    const handleMagicCheckout = async () => {\r\n        if (isProcessing) return\r\n\r\n        setIsProcessing(true)\r\n        showLoading('Preparing checkout...')\r\n\r\n        try {\r\n            // 1. Create Razorpay Magic Checkout order\r\n            const res = await fetch('/api/razorpay/order', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n            })\r\n\r\n            const data = await res.json()\r\n\r\n            if (!res.ok) {\r\n                throw new Error(data.error || 'Failed to create order')\r\n            }\r\n\r\n            console.log('[MAGIC_CHECKOUT] Order created:', data.order_id)\r\n\r\n            // 2. Launch Razorpay Magic Checkout\r\n            const options = {\r\n                key: process.env.NEXT_PUBLIC_RAZORPAY_KEY_ID,\r\n                order_id: data.razorpay_order_id,\r\n                amount: (subtotal + 20) * 100, // Amount in paise (includes shipping)\r\n                currency: data.currency,\r\n                name: 'Crown & Crest',\r\n                description: 'Premium Fashion Order',\r\n                callback_url: `${window.location.origin}/order/success?orderId=${data.order_id}`,\r\n                notes: {\r\n                    internal_order_id: data.order_id\r\n                },\r\n                prefill: {\r\n                    email: user.email,\r\n                },\r\n                theme: {\r\n                    color: '#000000'\r\n                },\r\n                modal: {\r\n                    ondismiss: function () {\r\n                        setIsProcessing(false)\r\n                        showError('Checkout cancelled')\r\n                    }\r\n                }\r\n            }\r\n\r\n            const rzp = new window.Razorpay(options)\r\n            rzp.open()\r\n\r\n        } catch (error: any) {\r\n            console.error('[MAGIC_CHECKOUT] Error:', error)\r\n            showError(error.message || 'Failed to initiate checkout')\r\n            setIsProcessing(false)\r\n        }\r\n    }\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n                <div className=\"text-center\">\r\n                    <div className=\"w-16 h-16 border-4 border-gray-300 border-t-black rounded-full animate-spin mx-auto mb-4\" />\r\n                    <p className=\"text-gray-600\">Loading checkout...</p>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 pb-32 md:pb-10\">\r\n            {/* Header */}\r\n            <div className=\"bg-white border-b border-gray-200 sticky top-0 z-20\">\r\n                <div className=\"max-w-3xl mx-auto px-4 h-14 flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <Link href=\"/cart\" className=\"text-gray-500 hover:text-gray-900\">\r\n                            <ChevronRight className=\"w-5 h-5 rotate-180\" />\r\n                        </Link>\r\n                        <h1 className=\"font-bold text-gray-900 tracking-wide uppercase text-sm\">Secure Checkout</h1>\r\n                    </div>\r\n                    <Lock className=\"w-4 h-4 text-gray-400\" />\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"max-w-3xl mx-auto px-4 py-8\">\r\n                {/* Magic Checkout Notice */}\r\n                <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6\">\r\n                    <div className=\"flex items-start gap-3\">\r\n                        <ShoppingBag className=\"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5\" />\r\n                        <div>\r\n                            <h3 className=\"font-semibold text-gray-900 text-sm mb-1\">Powered by Razorpay Magic Checkout</h3>\r\n                            <p className=\"text-xs text-gray-600\">\r\n                                Your address and payment details will be collected securely by Razorpay.\r\n                                COD option available based on your location and order value.\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Order Summary */}\r\n                <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6\">\r\n                    <h2 className=\"font-bold text-gray-900 mb-4\">Order Summary</h2>\r\n\r\n                    <div className=\"space-y-4\">\r\n                        {cartItems.map((item) => {\r\n                            const price = item.variants.price_override ?? item.products.base_price\r\n                            return (\r\n                                <div key={item.id} className=\"flex items-center gap-4\">\r\n                                    <div className=\"relative w-16 h-16 bg-gray-100 rounded\">\r\n                                        {item.products.image_url && (\r\n                                            <Image\r\n                                                src={item.products.image_url}\r\n                                                alt={item.products.name}\r\n                                                fill\r\n                                                className=\"object-cover rounded\"\r\n                                            />\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"flex-1\">\r\n                                        <p className=\"font-medium text-sm\">{item.products.name}</p>\r\n                                        <p className=\"text-xs text-gray-500\">\r\n                                            {item.variants.size} × {item.quantity}\r\n                                        </p>\r\n                                    </div>\r\n                                    <div className=\"text-right\">\r\n                                        <p className=\"font-semibold\">₹{(price * item.quantity).toLocaleString('en-IN')}</p>\r\n                                    </div>\r\n                                </div>\r\n                            )\r\n                        })}\r\n                    </div>\r\n\r\n                    <div className=\"border-t mt-4 pt-4 space-y-2\">\r\n                        <div className=\"flex justify-between text-sm\">\r\n                            <span className=\"text-gray-600\">Subtotal</span>\r\n                            <span className=\"font-medium\">₹{subtotal.toLocaleString('en-IN')}</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between text-sm\">\r\n                            <span className=\"text-gray-600\">Shipping</span>\r\n                            <span className=\"font-medium\">₹20</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between text-base font-bold pt-2 border-t\">\r\n                            <span>Total</span>\r\n                            <span>₹{(subtotal + 20).toLocaleString('en-IN')}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Logged in as */}\r\n                <div className=\"flex items-center gap-2 text-xs text-gray-600 bg-gray-50 p-3 rounded-lg mb-6\">\r\n                    <Lock className=\"w-3 h-3\" />\r\n                    Logged in as {user.email}\r\n                </div>\r\n\r\n                {/* Checkout Button */}\r\n                <button\r\n                    onClick={handleMagicCheckout}\r\n                    disabled={isProcessing}\r\n                    className=\"w-full bg-black text-white py-4 rounded-lg font-bold text-sm uppercase tracking-widest hover:bg-gray-800 transition-all shadow-xl disabled:bg-gray-400 disabled:shadow-none flex items-center justify-center gap-2\"\r\n                >\r\n                    {isProcessing ? (\r\n                        <>\r\n                            <div className=\"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                            Processing...\r\n                        </>\r\n                    ) : (\r\n                        <>\r\n                            <Lock className=\"w-4 h-4\" />\r\n                            Proceed to Secure Checkout\r\n                        </>\r\n                    )}\r\n                </button>\r\n\r\n                {/* Security Notice */}\r\n                <p className=\"text-center text-xs text-gray-500 mt-4\">\r\n                    🔒 Your payment information is encrypted and secure\r\n                </p>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\checkout\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\order\\failure\\OrderFailureClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[322,325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[322,325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport Link from 'next/link'\r\nimport { AlertCircle, Copy, RefreshCw, ArrowRight } from 'lucide-react'\r\nimport { motion } from 'framer-motion'\r\nimport { useToast } from '@/hooks/useToast'\r\nimport { useRouter } from 'next/navigation'\r\n\r\nexport default function OrderFailureClient({ orderData }: { orderData: any }) {\r\n    const { showSuccess } = useToast()\r\n    const router = useRouter()\r\n    const { order } = orderData\r\n\r\n    const copyOrderId = () => {\r\n        navigator.clipboard.writeText(order.id)\r\n        showSuccess('Order ID copied to clipboard')\r\n    }\r\n\r\n    const handleRetry = () => {\r\n        // Redirect to checkout to try again\r\n        // Note: This starts a NEW order flow. The failed one remains as failed.\r\n        router.push('/checkout')\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\r\n            <div className=\"max-w-7xl mx-auto\">\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-12 items-center min-h-[60vh]\">\r\n\r\n                    {/* LEFT COLUMN: Error Message & Actions */}\r\n                    <div className=\"lg:col-span-7 flex flex-col items-center lg:items-start text-center lg:text-left space-y-8\">\r\n\r\n                        {/* Animation */}\r\n                        <motion.div\r\n                            initial={{ scale: 0 }}\r\n                            animate={{ scale: 1 }}\r\n                            transition={{ type: \"spring\", stiffness: 260, damping: 20 }}\r\n                            className=\"w-24 h-24 bg-red-50 rounded-full flex items-center justify-center mb-4\"\r\n                        >\r\n                            <AlertCircle className=\"w-12 h-12 text-red-500\" />\r\n                        </motion.div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <h1 className=\"text-4xl font-display text-gray-900 tracking-tight\">Payment Incomplete</h1>\r\n                            <p className=\"text-lg text-gray-500 max-w-md\">\r\n                                Your order is not confirmed yet. Please retry the payment to complete your purchase.\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Order ID Badge */}\r\n                        <div\r\n                            onClick={copyOrderId}\r\n                            className=\"bg-white px-6 py-4 rounded-xl border border-gray-200 flex items-center gap-4 w-full max-w-md cursor-pointer hover:border-black transition-colors group shadow-sm\"\r\n                        >\r\n                            <div className=\"flex-1 text-left\">\r\n                                <p className=\"text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1\">Order ID</p>\r\n                                <p className=\"text-lg font-mono font-bold text-gray-900\">#{order.id.slice(0, 12).toUpperCase()}</p>\r\n                            </div>\r\n                            <Copy className=\"w-5 h-5 text-gray-400 group-hover:text-black\" />\r\n                        </div>\r\n\r\n                        {/* Total Amount */}\r\n                        <div className=\"w-full max-w-md bg-white p-4 rounded-xl border border-gray-100 flex justify-between items-center shadow-sm\">\r\n                            <span className=\"text-sm text-gray-500\">Total Amount</span>\r\n                            <span className=\"text-xl font-bold text-gray-900\">₹{order.amount.toLocaleString('en-IN')}</span>\r\n                        </div>\r\n\r\n                        {/* Action Buttons */}\r\n                        <div className=\"flex flex-col gap-4 w-full max-w-md pt-4\">\r\n                            <button\r\n                                onClick={handleRetry}\r\n                                className=\"w-full bg-black text-white px-8 py-4 rounded-xl font-bold text-sm uppercase tracking-widest hover:bg-gray-900 transition-all shadow-lg shadow-black/20 flex items-center justify-center gap-2 transform active:scale-[0.98]\"\r\n                            >\r\n                                <RefreshCw className=\"w-4 h-4\" /> Retry Payment\r\n                            </button>\r\n                            <Link\r\n                                href=\"/shop\"\r\n                                className=\"w-full bg-white text-gray-900 border border-gray-200 px-8 py-4 rounded-xl font-bold text-sm uppercase tracking-widest hover:bg-gray-50 hover:border-gray-300 transition-all flex items-center justify-center gap-2\"\r\n                            >\r\n                                <ArrowRight className=\"w-4 h-4\" /> Continue Shopping\r\n                            </Link>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* RIGHT COLUMN: Illustration or Help (Simplified for Failure) */}\r\n                    <div className=\"hidden lg:flex lg:col-span-5 justify-center opacity-50\">\r\n                        <div className=\"relative w-full aspect-square max-w-md\">\r\n                            {/* Abstract decorative element */}\r\n                            <div className=\"absolute inset-0 bg-red-50 rounded-full blur-3xl opacity-50\"></div>\r\n                            <div className=\"relative z-10 p-8 border-2 border-dashed border-red-100 rounded-2xl h-full flex items-center justify-center text-center\">\r\n                                <div>\r\n                                    <p className=\"font-display text-2xl text-red-300 mb-2\">Need Help?</p>\r\n                                    <p className=\"text-gray-400\">If money was deducted, it will be refunded automatically within 5-7 business days.</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\order\\failure\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\order\\success\\OrderSuccessClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":3,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapPin' is defined but never used.","line":6,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Home' is defined but never used.","line":6,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":70},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'OrderWithItems' is defined but never used.","line":9,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[434,437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[434,437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7775,7778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7775,7778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport Link from 'next/link'\r\nimport Image from 'next/image'\r\nimport { Check, Copy, Calendar, MapPin, ArrowRight, ShoppingBag, Home, Truck } from 'lucide-react'\r\nimport { motion } from 'framer-motion'\r\nimport { useToast } from '@/hooks/useToast'\r\nimport type { OrderWithItems } from '@/types/order'\r\n\r\nexport default function OrderSuccessClient({ orderData }: { orderData: any }) {\r\n    const { showSuccess } = useToast()\r\n    const { order, items } = orderData\r\n\r\n    const deliveryDate = new Date(new Date(order.created_at).getTime() + 5 * 24 * 60 * 60 * 1000)\r\n\r\n    const copyOrderId = () => {\r\n        navigator.clipboard.writeText(order.id)\r\n        showSuccess('Order ID copied to clipboard')\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\r\n            <div className=\"max-w-7xl mx-auto\">\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-12 items-start\">\r\n\r\n                    {/* LEFT COLUMN: Success Message & Actions */}\r\n                    <div className=\"lg:col-span-7 flex flex-col items-center lg:items-start text-center lg:text-left space-y-8 lg:sticky lg:top-24\">\r\n\r\n                        {/* Animation */}\r\n                        <motion.div\r\n                            initial={{ scale: 0 }}\r\n                            animate={{ scale: 1 }}\r\n                            transition={{ type: \"spring\", stiffness: 260, damping: 20 }}\r\n                            className=\"w-24 h-24 bg-green-500 rounded-full flex items-center justify-center shadow-lg shadow-green-200\"\r\n                        >\r\n                            <motion.div\r\n                                initial={{ pathLength: 0 }}\r\n                                animate={{ pathLength: 1 }}\r\n                                transition={{ duration: 0.5, delay: 0.2 }}\r\n                            >\r\n                                <Check className=\"w-12 h-12 text-white stroke-[3]\" />\r\n                            </motion.div>\r\n                        </motion.div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <h1 className=\"text-4xl font-display text-gray-900 tracking-tight\">Payment Successful</h1>\r\n                            <p className=\"text-lg text-gray-500 max-w-md\">\r\n                                Thank you for your purchase! Your order has been confirmed and will be shipped shortly.\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Order ID Badge */}\r\n                        <div\r\n                            onClick={copyOrderId}\r\n                            className=\"flex items-center gap-2 bg-white px-4 py-2 rounded-full border border-gray-200 text-sm font-medium text-gray-600 cursor-pointer hover:border-black transition-colors group\"\r\n                        >\r\n                            <span>Order ID: <span className=\"text-gray-900 font-bold\">#{order.id.slice(0, 8).toUpperCase()}</span></span>\r\n                            <Copy className=\"w-3.5 h-3.5 text-gray-400 group-hover:text-black\" />\r\n                        </div>\r\n\r\n                        {/* Action Buttons */}\r\n                        <div className=\"flex flex-col sm:flex-row gap-4 w-full max-w-md lg:max-w-none pt-4\">\r\n                            <Link\r\n                                href=\"/account/orders\" // Assuming this exists or will exist\r\n                                className=\"flex-1 bg-black text-white px-8 py-4 rounded-xl font-bold text-sm uppercase tracking-widest hover:bg-gray-800 transition-all shadow-lg shadow-black/20 flex items-center justify-center gap-2\"\r\n                            >\r\n                                <ShoppingBag className=\"w-4 h-4\" /> View Order\r\n                            </Link>\r\n                            <Link\r\n                                href=\"/shop\"\r\n                                className=\"flex-1 bg-white text-gray-900 border border-gray-200 px-8 py-4 rounded-xl font-bold text-sm uppercase tracking-widest hover:bg-gray-50 hover:border-gray-300 transition-all flex items-center justify-center gap-2\"\r\n                            >\r\n                                <ArrowRight className=\"w-4 h-4\" /> Continue Shopping\r\n                            </Link>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* RIGHT COLUMN: Order Details Cards */}\r\n                    <div className=\"lg:col-span-5 space-y-6\">\r\n\r\n                        {/* Delivery Details Card */}\r\n                        <motion.div\r\n                            initial={{ opacity: 0, y: 20 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            transition={{ delay: 0.3 }}\r\n                            className=\"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 overflow-hidden relative\"\r\n                        >\r\n                            <div className=\"absolute top-0 right-0 p-4 opacity-5\">\r\n                                <Truck className=\"w-24 h-24 rotate-[-15deg]\" />\r\n                            </div>\r\n\r\n                            <h2 className=\"text-xs font-bold text-gray-400 uppercase tracking-widest mb-6\">Delivery Details</h2>\r\n\r\n                            <div className=\"space-y-4 relative z-10\">\r\n                                <div>\r\n                                    <h3 className=\"font-bold text-gray-900 text-lg mb-1\">{order.shipping_address?.fullName || 'Guest User'}</h3>\r\n                                    <p className=\"text-gray-500 leading-relaxed\">\r\n                                        {order.shipping_address?.addressLine1}<br />\r\n                                        {order.shipping_address?.city}, {order.shipping_address?.state} - {order.shipping_address?.pincode}\r\n                                    </p>\r\n                                    {order.customer_phone && (\r\n                                        <p className=\"text-gray-500 mt-1\">Phone: +91 {order.customer_phone}</p>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center gap-4 bg-indigo-50 p-4 rounded-xl\">\r\n                                    <div className=\"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center shrink-0\">\r\n                                        <Calendar className=\"w-5 h-5 text-indigo-600\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <p className=\"text-[10px] font-bold text-indigo-400 uppercase tracking-wider\">Estimated Delivery</p>\r\n                                        <p className=\"text-sm font-bold text-indigo-900\">\r\n                                            {deliveryDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </motion.div>\r\n\r\n                        {/* Order Summary Card */}\r\n                        <motion.div\r\n                            initial={{ opacity: 0, y: 20 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            transition={{ delay: 0.4 }}\r\n                            className=\"bg-white rounded-2xl shadow-sm border border-gray-100 p-6\"\r\n                        >\r\n                            <h2 className=\"text-xs font-bold text-gray-400 uppercase tracking-widest mb-6\">Order Summary</h2>\r\n\r\n                            <div className=\"space-y-6\">\r\n                                {items.map((item: any, idx: number) => (\r\n                                    <div key={idx} className=\"flex gap-4\">\r\n                                        <div className=\"relative w-16 h-20 bg-gray-100 rounded-lg overflow-hidden shrink-0\">\r\n                                            <Image\r\n                                                src={\r\n                                                    item.variants?.products?.image_url ||\r\n                                                    (Array.isArray(item.variants?.products) ? item.variants.products[0]?.image_url : null) ||\r\n                                                    '/placeholder.png'\r\n                                                }\r\n                                                alt={item.product_name || 'Product'}\r\n                                                fill\r\n                                                className=\"object-cover\"\r\n                                            />\r\n                                        </div>\r\n                                        <div>\r\n                                            <h4 className=\"font-bold text-gray-900 text-sm\">{item.product_name}</h4>\r\n                                            <div className=\"flex items-center gap-3 mt-1 text-xs text-gray-500 font-medium\">\r\n                                                {/* Variant label might be null in DB snapshot, handle gracefully */}\r\n                                                {item.variant_label ? (\r\n                                                    <span className=\"bg-gray-100 px-2 py-0.5 rounded text-gray-600\">{item.variant_label}</span>\r\n                                                ) : (\r\n                                                    <span>Qty: {item.quantity}</span>\r\n                                                )}\r\n                                            </div>\r\n                                            <p className=\"text-sm font-bold text-gray-900 mt-2\">₹{(item.unit_price || item.price_at_purchase || 0).toLocaleString('en-IN')}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <div className=\"border-t border-gray-100 mt-6 pt-6 space-y-3\">\r\n                                <div className=\"flex justify-between items-center\">\r\n                                    <span className=\"text-sm text-gray-500\">Payment Method</span>\r\n                                    <span className=\"text-sm font-medium text-gray-900\">Online (Razorpay)</span>\r\n                                </div>\r\n                                <div className=\"flex justify-between items-center text-lg font-bold\">\r\n                                    <span className=\"text-gray-900\">Total Paid</span>\r\n                                    <span className=\"text-gray-900\">₹{order.amount.toLocaleString('en-IN')}</span>\r\n                                </div>\r\n                            </div>\r\n                        </motion.div>\r\n\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\order\\success\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\product\\[slug]\\ProductDetailClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Share2' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used.","line":11,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Minus' is defined but never used.","line":16,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":17,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":9},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[652,655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[652,655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":392,"column":77,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[21742,21840],"text":"&quot;The fabric is incredibly soft and the fit is true to size. I've worn it to three events already!\""},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[21742,21840],"text":"&ldquo;The fabric is incredibly soft and the fit is true to size. I've worn it to three events already!\""},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[21742,21840],"text":"&#34;The fabric is incredibly soft and the fit is true to size. I've worn it to three events already!\""},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[21742,21840],"text":"&rdquo;The fabric is incredibly soft and the fit is true to size. I've worn it to three events already!\""},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":392,"column":138,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[21742,21840],"text":"\"The fabric is incredibly soft and the fit is true to size. I&apos;ve worn it to three events already!\""},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[21742,21840],"text":"\"The fabric is incredibly soft and the fit is true to size. I&lsquo;ve worn it to three events already!\""},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[21742,21840],"text":"\"The fabric is incredibly soft and the fit is true to size. I&#39;ve worn it to three events already!\""},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[21742,21840],"text":"\"The fabric is incredibly soft and the fit is true to size. I&rsquo;ve worn it to three events already!\""},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":392,"column":174,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[21742,21840],"text":"\"The fabric is incredibly soft and the fit is true to size. I've worn it to three events already!&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[21742,21840],"text":"\"The fabric is incredibly soft and the fit is true to size. I've worn it to three events already!&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[21742,21840],"text":"\"The fabric is incredibly soft and the fit is true to size. I've worn it to three events already!&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[21742,21840],"text":"\"The fabric is incredibly soft and the fit is true to size. I've worn it to three events already!&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport Image from 'next/image'\r\nimport Link from 'next/link'\r\nimport { useRouter } from 'next/navigation'\r\nimport {\r\n    Heart,\r\n    Share2,\r\n    Star,\r\n    ChevronRight,\r\n    Truck,\r\n    ShieldCheck,\r\n    RefreshCw,\r\n    ChevronDown,\r\n    Minus,\r\n    Plus\r\n} from 'lucide-react'\r\nimport { motion, AnimatePresence } from 'framer-motion'\r\nimport { addToGuestCart } from '@/lib/cart/guestCart'\r\nimport { addToCart } from '@/lib/cart/actions'\r\nimport { useToast } from '@/hooks/useToast'\r\n\r\ninterface ProductVariant {\r\n    id: string\r\n    title: string\r\n    price: number\r\n    stock: number\r\n    options: any // JSONB\r\n}\r\n\r\ninterface Product {\r\n    id: string\r\n    name: string\r\n    slug: string\r\n    description: string | null\r\n    base_price: number\r\n    image_url: string | null\r\n    category: string | null\r\n    product_variants: ProductVariant[]\r\n}\r\n\r\n\r\n\r\nexport default function ProductDetailClient({ product, relatedProducts = [] }: { product: Product, relatedProducts?: Product[] }) {\r\n    const router = useRouter()\r\n    const { showSuccess, showError } = useToast()\r\n    // Compute unique sizes and colors from actual variants\r\n    const uniqueSizes = Array.from(new Set(product.product_variants.map(v => v.options?.Size).filter(Boolean))) as string[]\r\n    const uniqueColors = Array.from(new Set(product.product_variants.map(v => v.options?.Color).filter(Boolean))) as string[]\r\n\r\n    const [selectedSize, setSelectedSize] = useState<string>(uniqueSizes[0] || '')\r\n    const [selectedColor, setSelectedColor] = useState<string>(uniqueColors[0] || '')\r\n    const [isWishlisted, setIsWishlisted] = useState(false)\r\n    const [expandedAccordion, setExpandedAccordion] = useState<string | null>('description')\r\n    const [isAddingToCart, setIsAddingToCart] = useState(false)\r\n\r\n    // Helper to find hex for color name (simple map or fallback)\r\n    const getColorHex = (name: string) => {\r\n        const map: Record<string, string> = {\r\n            'Black': '#000000', 'Midnight Black': '#000000',\r\n            'White': '#FFFFFF', 'Ivory': '#F5F5DC',\r\n            'Red': '#FF0000', 'Dusty Rose': '#DCAE96',\r\n            'Blue': '#0000FF', 'Navy': '#000080',\r\n            'Green': '#008000', 'Olive': '#808000',\r\n            'Beige': '#F5F5DC'\r\n        }\r\n        return map[name] || '#CCCCCC'\r\n    }\r\n\r\n    const getSelectedVariantId = () => {\r\n        const match = product.product_variants.find(v =>\r\n            v.options?.Size === selectedSize && v.options?.Color === selectedColor\r\n        )\r\n        return match ? match.id : null\r\n    }\r\n\r\n    const isOutOfStock = product.product_variants.length === 0\r\n\r\n    // Helper: Check if user is authenticated (has session cookie)\r\n    const isAuthenticated = () => {\r\n        if (typeof document === 'undefined') return false\r\n        return document.cookie.split(';').some(cookie => cookie.trim().startsWith('session='))\r\n    }\r\n\r\n    const handleAddToCart = async () => {\r\n        if (isOutOfStock) return\r\n\r\n        setIsAddingToCart(true)\r\n        try {\r\n            const variantId = getSelectedVariantId()\r\n\r\n            if (!variantId) {\r\n                console.warn('No matching variant found for selection')\r\n                showError(\"Selected combination is unavailable.\")\r\n                return\r\n            }\r\n\r\n            // HARD GUARD: Route to correct cart based on authentication\r\n            if (isAuthenticated()) {\r\n                // AUTHENTICATED: Use server action (writes to cart_items table)\r\n                const formData = new FormData()\r\n                formData.append('productId', product.id)\r\n                formData.append('variantId', variantId)\r\n                formData.append('quantity', '1')\r\n\r\n                const result = await addToCart(null, formData)\r\n\r\n                if (result.success) {\r\n                    showSuccess(`${product.name} (${selectedSize}, ${selectedColor}) has been added.`)\r\n                } else {\r\n                    showError(result.error || \"Failed to add to cart. Please try again.\")\r\n                }\r\n            } else {\r\n                // GUEST: Use guest cart (writes to localStorage)\r\n                const success = addToGuestCart(product.id, variantId, 1)\r\n\r\n                if (success) {\r\n                    showSuccess(`${product.name} (${selectedSize}, ${selectedColor}) has been added.`)\r\n                } else {\r\n                    showError(\"Failed to add to cart. Please try again.\")\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error(error)\r\n            showError(\"An unexpected error occurred.\")\r\n        } finally {\r\n            setIsAddingToCart(false)\r\n        }\r\n    }\r\n\r\n    const handleBuyNow = async () => {\r\n        await handleAddToCart()\r\n        router.push('/checkout')\r\n    }\r\n\r\n    // Mock images if only one is provided (for carousel demo)\r\n    const images = product.image_url\r\n        ? [product.image_url, product.image_url, product.image_url]\r\n        : []\r\n    const [currentImageIndex, setCurrentImageIndex] = useState(0)\r\n\r\n\r\n    const toggleAccordion = (id: string) => {\r\n        setExpandedAccordion(expandedAccordion === id ? null : id)\r\n    }\r\n\r\n    return (\r\n        <div className=\"bg-white min-h-screen pb-24 md:pb-0\">\r\n            {/* Mobile Header - Usually Layout handles this but this is a specific overlay style if needed */}\r\n            {/* Using standard layout header for now, maybe add breadcrumbs */}\r\n\r\n            <div className=\"max-w-7xl mx-auto md:px-6 lg:px-8 md:py-8\">\r\n                <div className=\"flex flex-col md:flex-row gap-8 lg:gap-16\">\r\n\r\n                    {/* Left Column: Images */}\r\n                    <div className=\"w-full md:w-1/2 lg:w-[55%]\">\r\n                        {/* Mobile Carousel */}\r\n                        <div className=\"md:hidden relative aspect-[3/4] w-full bg-gray-100 overflow-hidden\">\r\n                            <AnimatePresence mode='wait'>\r\n                                <motion.div\r\n                                    key={currentImageIndex}\r\n                                    initial={{ opacity: 0 }}\r\n                                    animate={{ opacity: 1 }}\r\n                                    exit={{ opacity: 0 }}\r\n                                    transition={{ duration: 0.3 }}\r\n                                    className=\"absolute inset-0\"\r\n                                >\r\n                                    <Image\r\n                                        src={images[currentImageIndex] || '/placeholder.png'}\r\n                                        alt={product.name}\r\n                                        fill\r\n                                        priority\r\n                                        className=\"object-cover\"\r\n                                    />\r\n                                </motion.div>\r\n                            </AnimatePresence>\r\n\r\n                            <button\r\n                                onClick={() => setIsWishlisted(!isWishlisted)}\r\n                                className=\"absolute top-4 right-4 p-3 rounded-full bg-white/80 backdrop-blur-sm shadow-sm z-10\"\r\n                            >\r\n                                <Heart className={`w-5 h-5 ${isWishlisted ? 'fill-red-500 text-red-500' : 'text-gray-900'}`} />\r\n                            </button>\r\n\r\n                            {/* Carousel Indicators */}\r\n                            <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2\">\r\n                                {images.map((_, idx) => (\r\n                                    <button\r\n                                        key={idx}\r\n                                        onClick={() => setCurrentImageIndex(idx)}\r\n                                        className={`w-2 h-2 rounded-full transition-all ${currentImageIndex === idx ? 'bg-white w-4' : 'bg-white/50'\r\n                                            }`}\r\n                                    />\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Desktop Grid */}\r\n                        <div className=\"hidden md:grid grid-cols-2 gap-4\">\r\n                            {images.map((img, idx) => (\r\n                                <div key={idx} className={`relative bg-gray-100 aspect-[3/4] rounded-lg overflow-hidden ${idx === 0 ? 'col-span-2 aspect-[4/5]' : ''}`}>\r\n                                    <Image\r\n                                        src={img}\r\n                                        alt={`${product.name} ${idx + 1}`}\r\n                                        fill\r\n                                        className=\"object-cover hover:scale-105 transition-transform duration-500\"\r\n                                    />\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Right Column: Details */}\r\n                    <div className=\"w-full md:w-1/2 lg:w-[45%] px-4 md:px-0 md:sticky md:top-24 h-fit\">\r\n                        <div className=\"mb-6 mt-6 md:mt-0\">\r\n                            <p className=\"text-xs font-bold tracking-widest text-gray-500 uppercase mb-2\">{product.category || 'Collection'}</p>\r\n                            <h1 className=\"text-3xl font-display text-gray-900 mb-2\">{product.name}</h1>\r\n                            <div className=\"flex items-center gap-2 mb-4\">\r\n                                <span className=\"bg-black text-white text-xs px-2 py-0.5 rounded flex items-center gap-1\">\r\n                                    4.8 <Star className=\"w-3 h-3 fill-current\" />\r\n                                </span>\r\n                                <span className=\"text-sm text-gray-500 underline decoration-gray-300 underline-offset-4\">124 Ratings</span>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-baseline gap-3 mb-1\">\r\n                                <span className=\"text-2xl font-bold text-gray-900\">₹{product.base_price.toLocaleString('en-IN')}</span>\r\n                                <span className=\"text-lg text-gray-400 line-through\">₹{(product.base_price * 1.3).toLocaleString('en-IN')}</span>\r\n                                <span className=\"text-red-600 font-medium bg-red-50 px-2 py-1 rounded text-sm\">24% OFF</span>\r\n                            </div>\r\n                            <p className=\"text-xs text-green-600 font-medium\">Inclusive of all taxes • Free Shipping</p>\r\n                        </div>\r\n\r\n                        {/* Pincode Check */}\r\n                        <div className=\"mb-8\">\r\n                            <div className=\"flex items-center gap-2 text-xs font-bold text-gray-900 uppercase tracking-widest mb-3\">\r\n                                <Truck className=\"w-4 h-4\" /> Check Delivery\r\n                            </div>\r\n                            <div className=\"relative\">\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Enter Pincode\"\r\n                                    className=\"w-full pl-4 pr-20 py-3 border border-gray-300 rounded-lg text-sm focus:ring-black focus:border-black\"\r\n                                />\r\n                                <button className=\"absolute right-2 top-1/2 -translate-y-1/2 text-xs font-bold text-black px-3 py-1.5 hover:bg-gray-100 rounded\">\r\n                                    CHECK\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Color Selection */}\r\n                        <div className=\"mb-6\">\r\n                            <p className=\"text-sm text-gray-700 mb-2\">Color: <span className=\"text-gray-900 font-medium\">{selectedColor}</span></p>\r\n                            {uniqueColors.length > 0 ? (\r\n                                <div className=\"flex gap-3\">\r\n                                    {uniqueColors.map(color => (\r\n                                        <button\r\n                                            key={color}\r\n                                            onClick={() => setSelectedColor(color)}\r\n                                            className={`w-10 h-10 rounded-full border-2 ${selectedColor === color ? 'border-black ring-1 ring-black ring-offset-2' : 'border-transparent'\r\n                                                }`}\r\n                                        >\r\n                                            <div\r\n                                                className=\"w-full h-full rounded-full border border-gray-200\"\r\n                                                style={{ backgroundColor: getColorHex(color) }}\r\n                                            />\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            ) : (\r\n                                <p className=\"text-sm text-gray-400 italic\">No colors available</p>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Size Selection */}\r\n                        <div className=\"mb-6\">\r\n                            <div className=\"flex justify-between items-center mb-2\">\r\n                                <p className=\"text-sm text-gray-700\">Select Size</p>\r\n                                <button className=\"text-xs font-medium text-gray-900 underline decoration-gray-400 underline-offset-4\">Size Guide</button>\r\n                            </div>\r\n                            {uniqueSizes.length > 0 ? (\r\n                                <div className=\"grid grid-cols-5 gap-3\">\r\n                                    {uniqueSizes.map(size => (\r\n                                        <button\r\n                                            key={size}\r\n                                            onClick={() => setSelectedSize(size)}\r\n                                            className={`h-10 rounded-lg text-sm font-medium border flex items-center justify-center transition-all ${selectedSize === size\r\n                                                ? 'border-gray-900 bg-gray-900 text-white shadow-md'\r\n                                                : 'border-gray-200 text-gray-900 hover:border-gray-400'\r\n                                                }`}\r\n                                        >\r\n                                            {size}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            ) : (\r\n                                <p className=\"text-sm text-gray-400 italic\">No sizes available</p>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* AI Recommendation */}\r\n                        <div className=\"bg-gray-50 rounded-xl p-4 mb-8 flex gap-3 items-center\">\r\n                            <div className=\"w-8 h-8 rounded-full bg-black flex items-center justify-center text-white\">\r\n                                <span className=\"text-xs font-bold\">AI</span>\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm font-bold text-gray-900\">Recommended Size: M</p>\r\n                                <p className=\"text-xs text-gray-500\">Based on your Daily Wear profile</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Desktop Actions */}\r\n                        <div className=\"hidden md:flex gap-4 mb-8\">\r\n                            <button\r\n                                onClick={handleBuyNow}\r\n                                disabled={isAddingToCart}\r\n                                className=\"flex-1 bg-white border border-gray-900 text-gray-900 font-bold text-sm tracking-widest rounded uppercase py-4 hover:bg-gray-50 transition-colors disabled:opacity-50\"\r\n                            >\r\n                                Buy Now\r\n                            </button>\r\n                            <button\r\n                                onClick={handleAddToCart}\r\n                                disabled={isAddingToCart}\r\n                                className=\"flex-1 bg-black text-white font-bold text-sm tracking-widest rounded uppercase py-4 shadow-lg shadow-black/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:scale-100\"\r\n                            >\r\n                                {isAddingToCart ? 'Adding...' : 'Add to Cart'}\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* Trust Badges */}\r\n                        <div className=\"grid grid-cols-3 gap-4 mb-8 py-6 border-y border-gray-100\">\r\n                            <div className=\"flex flex-col items-center gap-2 text-center\">\r\n                                <div className=\"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center\">\r\n                                    <RefreshCw className=\"w-4 h-4 text-gray-700\" />\r\n                                </div>\r\n                                <span className=\"text-[10px] font-bold text-gray-900 uppercase tracking-wide\">Easy Returns</span>\r\n                            </div>\r\n                            <div className=\"flex flex-col items-center gap-2 text-center\">\r\n                                <div className=\"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center\">\r\n                                    <Truck className=\"w-4 h-4 text-gray-700\" />\r\n                                </div>\r\n                                <span className=\"text-[10px] font-bold text-gray-900 uppercase tracking-wide\">COD Available</span>\r\n                            </div>\r\n                            <div className=\"flex flex-col items-center gap-2 text-center\">\r\n                                <div className=\"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center\">\r\n                                    <ShieldCheck className=\"w-4 h-4 text-gray-700\" />\r\n                                </div>\r\n                                <span className=\"text-[10px] font-bold text-gray-900 uppercase tracking-wide\">Secure Payment</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Accordions */}\r\n                        <div className=\"space-y-4\">\r\n                            {['Product Description', 'Delivery & Returns', 'Materials & Care'].map((section) => (\r\n                                <div key={section} className=\"border-b border-gray-100 last:border-0 pb-4\">\r\n                                    <button\r\n                                        onClick={() => toggleAccordion(section.toLowerCase().split(' ')[0])}\r\n                                        className=\"w-full flex justify-between items-center py-2\"\r\n                                    >\r\n                                        <span className=\"text-sm font-bold text-gray-900 uppercase tracking-wider\">{section}</span>\r\n                                        <ChevronDown className={`w-4 h-4 transition-transform ${expandedAccordion === section.toLowerCase().split(' ')[0] ? 'rotate-180' : ''}`} />\r\n                                    </button>\r\n                                    <AnimatePresence>\r\n                                        {expandedAccordion === section.toLowerCase().split(' ')[0] && (\r\n                                            <motion.div\r\n                                                initial={{ height: 0, opacity: 0 }}\r\n                                                animate={{ height: 'auto', opacity: 1 }}\r\n                                                exit={{ height: 0, opacity: 0 }}\r\n                                                className=\"overflow-hidden\"\r\n                                            >\r\n                                                <p className=\"text-sm text-gray-600 py-2 leading-relaxed\">\r\n                                                    {product.description || \"Experience luxury with this premium piece from Lumière. Crafted with attention to detail and designed for the modern aesthetic.\"}\r\n                                                </p>\r\n                                            </motion.div>\r\n                                        )}\r\n                                    </AnimatePresence>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        {/* Reviews Teaser */}\r\n                        <div className=\"mt-8 pt-8 border-t border-gray-100\">\r\n                            <div className=\"flex justify-between items-center mb-4\">\r\n                                <h3 className=\"text-sm font-bold text-gray-900 uppercase tracking-wider\">Reviews <span className=\"bg-gray-100 px-2 py-0.5 rounded-full text-xs ml-1\">120</span></h3>\r\n                                <button className=\"text-xs underline text-gray-500\">View all</button>\r\n                            </div>\r\n                            <div className=\"bg-gray-50 p-4 rounded-xl\">\r\n                                <div className=\"flex gap-1 mb-2\">\r\n                                    {[1, 2, 3, 4, 5].map(i => <Star key={i} className=\"w-3 h-3 fill-black text-black\" />)}\r\n                                </div>\r\n                                <p className=\"text-sm font-bold text-gray-900 mb-1\">Stunning quality</p>\r\n                                <p className=\"text-xs text-gray-600 italic\">\"The fabric is incredibly soft and the fit is true to size. I've worn it to three events already!\"</p>\r\n                                <p className=\"text-[10px] text-gray-400 mt-2 uppercase tracking-wide\">— Sarah J., Verified Buyer</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Complete The Look Section */}\r\n                {relatedProducts && relatedProducts.length > 0 && (\r\n                    <div className=\"mt-16 md:mt-24 border-t border-gray-100 pt-16\">\r\n                        <h2 className=\"text-xl font-display text-gray-900 mb-8 uppercase tracking-widest\">Complete The Look</h2>\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-8\">\r\n                            {relatedProducts.map(related => (\r\n                                <Link key={related.id} href={`/product/${related.slug}`} className=\"group block\">\r\n                                    <div className=\"aspect-[3/4] relative bg-gray-100 rounded-lg overflow-hidden mb-3\">\r\n                                        <Image\r\n                                            src={related.image_url || '/placeholder.png'}\r\n                                            alt={related.name}\r\n                                            fill\r\n                                            className=\"object-cover group-hover:scale-105 transition-transform duration-500\"\r\n                                        />\r\n                                    </div>\r\n                                    <h3 className=\"text-sm font-medium text-gray-900 group-hover:underline decoration-1 underline-offset-4\">{related.name}</h3>\r\n                                    <p className=\"text-sm text-gray-500\">₹{related.base_price.toLocaleString('en-IN')}</p>\r\n                                </Link>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Sticky Bottom Bar (Mobile) */}\r\n            <div className=\"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100 md:hidden z-50 flex gap-4 backdrop-blur-md bg-white/95\">\r\n                <div className=\"flex-1\">\r\n                    <p className=\"text-lg font-bold text-gray-900\">₹{product.base_price.toLocaleString('en-IN')}</p>\r\n                    <p className=\"text-[10px] text-red-600 font-medium\">Inclusive of taxes</p>\r\n                </div>\r\n                <button\r\n                    onClick={handleBuyNow}\r\n                    disabled={isAddingToCart}\r\n                    className=\"flex-1 bg-white border border-gray-900 text-gray-900 font-bold text-sm tracking-widest rounded uppercase py-3 disabled:opacity-50\"\r\n                >\r\n                    Buy Now\r\n                </button>\r\n                <button\r\n                    onClick={handleAddToCart}\r\n                    disabled={isAddingToCart}\r\n                    className=\"flex-1 bg-black text-white font-bold text-sm tracking-widest rounded uppercase py-3 shadow-lg shadow-black/20 disabled:opacity-50\"\r\n                >\r\n                    {isAddingToCart ? 'Adding...' : 'Add to Cart'}\r\n                </button>\r\n            </div>\r\n\r\n            {/* Desktop Action Bar (Placeholder, normally sticky side but integrated above) */}\r\n            <div className=\"hidden md:block fixed bottom-8 left-1/2 -translate-x-1/2 z-40\">\r\n                {/* Can add a floating bar for desktop if scrolled past summary */}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\product\\[slug]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1347,1350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1347,1350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1808,1811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1808,1811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { Metadata } from 'next'\r\nimport { notFound } from 'next/navigation'\r\nimport { supabaseServer } from '@/lib/supabase/server'\r\nimport ProductDetailClient from './ProductDetailClient'\r\n\r\n// Revalidate every 30 minutes\r\nexport const revalidate = 1800\r\n\r\ninterface Props {\r\n    params: Promise<{ slug: string }>\r\n}\r\n\r\nasync function getProduct(slug: string) {\r\n    console.log('Fetching product for slug:', slug)\r\n    const { data: product, error } = await supabaseServer\r\n        .from('products')\r\n        .select(`\r\nid,\r\n    name,\r\n    slug,\r\n    description,\r\n    base_price,\r\n    image_url,\r\n    category,\r\n    variants(\r\n        id,\r\n        stock_quantity,\r\n        size,\r\n        color,\r\n        images\r\n    )\r\n        `)\r\n        .eq('slug', slug)\r\n        // .eq('is_active', true)\r\n        .single()\r\n\r\n    if (error) {\r\n        console.error('Error fetching product:', JSON.stringify(error, null, 2))\r\n        return null\r\n    }\r\n\r\n    if (!product) {\r\n        console.error('Product not found (null data)')\r\n        return null\r\n    }\r\n\r\n    // Transform variants to match Client expectations if needed, or update Client\r\n    // For now, let's map it to what Client expects or just pass it as is if we update Client type\r\n    const transformedProduct = {\r\n        ...product,\r\n        product_variants: product.variants?.map((v: any) => ({\r\n            id: v.id,\r\n            title: `${v.size || ''} / ${v.color || ''}`, // Synthetic title\r\n            price: product.base_price, // Variant price not available, using base price\r\n            stock: v.stock_quantity,\r\n            options: { Size: v.size, Color: v.color } // Synthetic options\r\n        })) || []\r\n    }\r\n    // Remove the raw variants array from the object we pass down to avoid confusion\r\n    delete (transformedProduct as any).variants\r\n\r\n    console.log('Product fetched successfully:', product.name)\r\n    console.log('Transformed Variants:', JSON.stringify(transformedProduct.product_variants, null, 2))\r\n    return transformedProduct\r\n}\r\n\r\nexport async function generateMetadata({ params }: Props): Promise<Metadata> {\r\n    const { slug } = await params\r\n    const product = await getProduct(slug)\r\n\r\n    if (!product) {\r\n        return {\r\n            title: 'Product Not Found',\r\n        }\r\n    }\r\n\r\n    return {\r\n        title: `${product.name} | Crown & Crest`,\r\n        description: product.description?.substring(0, 160) || 'Premium fashion by Crown & Crest',\r\n        openGraph: {\r\n            images: product.image_url ? [product.image_url] : [],\r\n        },\r\n    }\r\n}\r\n\r\nasync function getRelatedProducts(category: string | null, currentId: string) {\r\n    if (!category) return []\r\n\r\n    const { data: products } = await supabaseServer\r\n        .from('products')\r\n        .select('id, name, slug, base_price, image_url, category')\r\n        .eq('category', category)\r\n        .neq('id', currentId)\r\n        // .eq('is_active', true) \r\n        .limit(4)\r\n\r\n    return products || []\r\n}\r\n\r\nexport default async function ProductPage({ params }: Props) {\r\n    const { slug } = await params\r\n    const product = await getProduct(slug)\r\n\r\n    if (!product) {\r\n        notFound()\r\n    }\r\n\r\n    const relatedProducts = await getRelatedProducts(product.category, product.id)\r\n\r\n    return <ProductDetailClient product={product} relatedProducts={relatedProducts} />\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\shop\\ShopClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronLeft' is defined but never used.","line":7,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used.","line":7,"column":59,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":65},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ArrowUpDown' is defined but never used.","line":7,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":78},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronDown' is defined but never used.","line":7,"column":80,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":91},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mobileFiltersOpen' is assigned a value but never used.","line":28,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setMobileFiltersOpen' is assigned a value but never used.","line":28,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mobileSortOpen' is assigned a value but never used.","line":29,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sortBy' is assigned a value but never used.","line":42,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'allCategories' is assigned a value but never used.","line":45,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sizes' is assigned a value but never used.","line":46,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toggleSize' is assigned a value but never used.","line":72,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":72,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSort' is assigned a value but never used.","line":77,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":77,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalFilters' is assigned a value but never used.","line":124,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":124,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useMemo } from 'react'\r\nimport Link from 'next/link'\r\nimport Image from 'next/image'\r\nimport { useRouter, useSearchParams } from 'next/navigation'\r\nimport { ChevronRight, X, SlidersHorizontal, ChevronLeft, Filter, ArrowUpDown, ChevronDown } from 'lucide-react'\r\n\r\ninterface Product {\r\n    id: string\r\n    name: string\r\n    slug: string\r\n    base_price: number\r\n    image_url: string | null\r\n    category: string | null\r\n}\r\n\r\ninterface ShopClientProps {\r\n    initialProducts: Product[]\r\n}\r\n\r\nexport default function ShopClient({ initialProducts }: ShopClientProps) {\r\n    const [products] = useState<Product[]>(initialProducts)\r\n    const router = useRouter()\r\n    const searchParams = useSearchParams()\r\n\r\n    // UI States (Mobile drawers)\r\n    const [mobileFiltersOpen, setMobileFiltersOpen] = useState(false)\r\n    const [mobileSortOpen, setMobileSortOpen] = useState(false)\r\n\r\n    // Read State from URL\r\n    const selectedCategories = useMemo(() => {\r\n        const param = searchParams.get('category')\r\n        return param ? param.split(',') : []\r\n    }, [searchParams])\r\n\r\n    const selectedSize = searchParams.get('size') || ''\r\n\r\n    const currentMinPrice = searchParams.get('minPrice')\r\n    const currentMaxPrice = searchParams.get('maxPrice')\r\n\r\n    const sortBy = searchParams.get('sort') || 'recommended'\r\n\r\n    // Mock constants\r\n    const allCategories = ['Dresses', 'Tops & Tunics', 'Sarees', 'Kurtas', 'Jumpsuits']\r\n    const sizes = ['XS', 'S', 'M', 'L', 'XL', 'XXL']\r\n\r\n    const updateURL = (newParams: Record<string, string | null>) => {\r\n        const params = new URLSearchParams(searchParams.toString())\r\n        Object.entries(newParams).forEach(([key, value]) => {\r\n            if (value === null) {\r\n                params.delete(key)\r\n            } else {\r\n                params.set(key, value)\r\n            }\r\n        })\r\n        router.push(`/shop?${params.toString()}`, { scroll: false })\r\n    }\r\n\r\n    const toggleCategory = (category: string) => {\r\n        const current = new Set(selectedCategories)\r\n        if (current.has(category)) {\r\n            current.delete(category)\r\n        } else {\r\n            current.add(category)\r\n        }\r\n\r\n        const newValue = Array.from(current).join(',')\r\n        updateURL({ category: newValue || null })\r\n    }\r\n\r\n    const toggleSize = (size: string) => {\r\n        const newValue = selectedSize === size ? null : size\r\n        updateURL({ size: newValue })\r\n    }\r\n\r\n    const setSort = (value: string) => {\r\n        updateURL({ sort: value })\r\n        setMobileSortOpen(false)\r\n    }\r\n\r\n    const isPriceRangeActive = (rangeLabel: string) => {\r\n        switch (rangeLabel) {\r\n            case 'Under ₹1,000': return currentMaxPrice === '1000' && !currentMinPrice\r\n            case '₹1,000 - ₹2,500': return currentMinPrice === '1000' && currentMaxPrice === '2500'\r\n            case '₹2,500 - ₹5,000': return currentMinPrice === '2500' && currentMaxPrice === '5000'\r\n            case 'Above ₹5,000': return currentMinPrice === '5000' && !currentMaxPrice\r\n            default: return false\r\n        }\r\n    }\r\n\r\n    const togglePriceRange = (rangeLabel: string) => {\r\n        let min = null\r\n        let max = null\r\n\r\n        // If clicking the active one, toggle off\r\n        if (isPriceRangeActive(rangeLabel)) {\r\n            updateURL({ minPrice: null, maxPrice: null })\r\n            return\r\n        }\r\n\r\n        switch (rangeLabel) {\r\n            case 'Under ₹1,000':\r\n                max = '1000'\r\n                break\r\n            case '₹1,000 - ₹2,500':\r\n                min = '1000'; max = '2500'\r\n                break\r\n            case '₹2,500 - ₹5,000':\r\n                min = '2500'; max = '5000'\r\n                break\r\n            case 'Above ₹5,000':\r\n                min = '5000'\r\n                break\r\n        }\r\n\r\n        updateURL({ minPrice: min, maxPrice: max })\r\n    }\r\n\r\n    const clearAllFilters = () => {\r\n        router.push('/shop')\r\n    }\r\n\r\n    const totalFilters = selectedCategories.length + (selectedSize ? 1 : 0) + (currentMinPrice || currentMaxPrice ? 1 : 0)\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-background-light\">\r\n            <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n                {/* Header */}\r\n                <div className=\"flex flex-col md:flex-row md:items-center justify-between mb-8\">\r\n                    <div>\r\n                        {/* Breadcrumbs */}\r\n                        <nav className=\"flex text-sm text-gray-500 mb-2\">\r\n                            <ol className=\"flex items-center space-x-2\">\r\n                                <li><Link href=\"/\" className=\"hover:text-gray-900\">Home</Link></li>\r\n                                <li><ChevronRight className=\"w-4 h-4\" /></li>\r\n                                <li><span className=\"text-gray-900 font-medium\">New Arrivals</span></li>\r\n                            </ol>\r\n                        </nav>\r\n                        <h1 className=\"text-3xl font-display text-gray-900\">New Arrivals</h1>\r\n                        <p className=\"text-gray-500 mt-1 text-sm\">{products.length} products found</p>\r\n                    </div>\r\n\r\n                    {/* Sort Dropdown */}\r\n                    <div className=\"mt-4 md:mt-0 relative group z-20\">\r\n                        <button className=\"flex items-center space-x-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded px-4 py-2 hover:bg-gray-50 transition-colors\">\r\n                            <SlidersHorizontal className=\"w-4 h-4\" />\r\n                            <span>Sort by: Popularity</span>\r\n                            <ChevronRight className=\"w-4 h-4 rotate-90\" />\r\n                        </button>\r\n                        <div className=\"absolute right-0 mt-2 w-48 bg-white rounded shadow-xl border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200\">\r\n                            <div className=\"py-1\">\r\n                                <a className=\"block px-4 py-2 text-sm text-gray-900 bg-gray-100 font-medium\" href=\"#\">Popularity</a>\r\n                                <a className=\"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50\" href=\"#\">New Arrivals</a>\r\n                                <a className=\"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50\" href=\"#\">Price: Low to High</a>\r\n                                <a className=\"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50\" href=\"#\">Price: High to Low</a>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex flex-col lg:flex-row gap-8\">\r\n                    {/* Sidebar Filters - Desktop */}\r\n                    <aside className=\"w-full lg:w-64 flex-shrink-0 hidden lg:block\">\r\n                        <div className=\"sticky top-24 space-y-8 pr-4 overflow-y-auto max-h-[calc(100vh-8rem)]\">\r\n                            {/* Category */}\r\n                            <div>\r\n                                <h3 className=\"text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4\">Category</h3>\r\n                                <div className=\"space-y-3\">\r\n                                    {['Dresses', 'Tops & Tunics', 'Sarees', 'Kurtas', 'Jumpsuits'].map((category) => (\r\n                                        <label key={category} className=\"flex items-center group cursor-pointer\">\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                checked={selectedCategories.includes(category)}\r\n                                                onChange={() => toggleCategory(category)}\r\n                                                className=\"form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary\"\r\n                                            />\r\n                                            <span className=\"ml-3 text-sm text-gray-700 group-hover:text-primary transition-colors\">{category}</span>\r\n                                        </label>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"border-t border-gray-200\"></div>\r\n\r\n                            {/* Size */}\r\n                            <div>\r\n                                <h3 className=\"text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4\">Size</h3>\r\n                                <div className=\"grid grid-cols-3 gap-2\">\r\n                                    {['XS', 'S', 'M', 'L', 'XL', 'XXL'].map((size) => (\r\n                                        <button\r\n                                            key={size}\r\n                                            onClick={() => setSelectedSize(size === selectedSize ? '' : size)}\r\n                                            className={`px-3 py-2 text-xs font-medium border rounded transition-all ${size === selectedSize\r\n                                                ? 'border-primary bg-primary text-white shadow-sm'\r\n                                                : size === 'XXL'\r\n                                                    ? 'border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed line-through'\r\n                                                    : 'border-gray-200 hover:border-primary text-gray-700 hover:text-primary'\r\n                                                }`}\r\n                                            disabled={size === 'XXL'}\r\n                                        >\r\n                                            {size}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"border-t border-gray-200\"></div>\r\n\r\n                            {/* Color */}\r\n                            <div>\r\n                                <h3 className=\"text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4\">Color</h3>\r\n                                <div className=\"flex flex-wrap gap-3\">\r\n                                    <button className=\"w-8 h-8 rounded-full bg-black border-2 border-white ring-1 ring-gray-300 focus:ring-2 focus:ring-offset-2 focus:ring-primary\"></button>\r\n                                    <button className=\"w-8 h-8 rounded-full bg-[#f5f5dc] border border-gray-300 hover:ring-2 hover:ring-primary hover:ring-offset-1\"></button>\r\n                                    <button className=\"w-8 h-8 rounded-full bg-red-900 border border-gray-300 hover:ring-2 hover:ring-primary hover:ring-offset-1\"></button>\r\n                                    <button className=\"w-8 h-8 rounded-full bg-blue-900 border border-gray-300 hover:ring-2 hover:ring-primary hover:ring-offset-1\"></button>\r\n                                    <button className=\"w-8 h-8 rounded-full bg-green-700 border border-gray-300 hover:ring-2 hover:ring-primary hover:ring-offset-1\"></button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"border-t border-gray-200\"></div>\r\n\r\n                            {/* Price */}\r\n                            <div>\r\n                                <h3 className=\"text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4\">Price</h3>\r\n                                <div className=\"space-y-3\">\r\n                                    {[\r\n                                        'Under ₹1,000',\r\n                                        '₹1,000 - ₹2,500',\r\n                                        '₹2,500 - ₹5,000',\r\n                                        'Above ₹5,000'\r\n                                    ].map((range) => (\r\n                                        <label key={range} className=\"flex items-center group cursor-pointer\">\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                checked={isPriceRangeActive(range)}\r\n                                                onChange={() => togglePriceRange(range)}\r\n                                                className=\"form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary\"\r\n                                            />\r\n                                            <span className=\"ml-3 text-sm text-gray-700 group-hover:text-primary transition-colors\">{range}</span>\r\n                                        </label>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </aside>\r\n\r\n                    {/* Main Content */}\r\n                    <main className=\"flex-1\">\r\n                        {/* Active Filters */}\r\n                        <div className=\"flex flex-wrap gap-2 mb-6\">\r\n                            {selectedCategories.map((category) => (\r\n                                <span key={category} className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800\">\r\n                                    {category}\r\n                                    <button onClick={() => toggleCategory(category)} className=\"ml-2 text-gray-500 hover:text-gray-700\">\r\n                                        <X className=\"w-3 h-3\" />\r\n                                    </button>\r\n                                </span>\r\n                            ))}\r\n                            {selectedSize && (\r\n                                <span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800\">\r\n                                    Size: {selectedSize}\r\n                                    <button onClick={() => setSelectedSize('')} className=\"ml-2 text-gray-500 hover:text-gray-700\">\r\n                                        <X className=\"w-3 h-3\" />\r\n                                    </button>\r\n                                </span>\r\n                            )}\r\n                            {(selectedCategories.length > 0 || selectedSize) && (\r\n                                <button onClick={clearAllFilters} className=\"text-xs text-gray-500 underline hover:text-primary ml-2\">\r\n                                    Clear all\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Product Grid */}\r\n                        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-6 gap-y-10\">\r\n                            {products.length > 0 ? (\r\n                                products.map((product, index) => (\r\n                                    <div key={product.id} className=\"group relative\">\r\n                                        <div className=\"aspect-[3/4] w-full overflow-hidden rounded-lg bg-gray-200\">\r\n                                            {product.image_url ? (\r\n                                                <Image\r\n                                                    src={product.image_url}\r\n                                                    alt={product.name}\r\n                                                    fill\r\n                                                    className=\"object-cover object-center group-hover:scale-105 transition-transform duration-300\"\r\n                                                />\r\n                                            ) : (\r\n                                                <div className=\"w-full h-full flex items-center justify-center text-gray-400\">\r\n                                                    No Image\r\n                                                </div>\r\n                                            )}\r\n\r\n                                            {/* Badges */}\r\n                                            {index === 0 && (\r\n                                                <div className=\"absolute bottom-4 left-4\">\r\n                                                    <span className=\"bg-white/90 text-gray-900 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider backdrop-blur-sm shadow-sm\">\r\n                                                        Bestseller\r\n                                                    </span>\r\n                                                </div>\r\n                                            )}\r\n                                            {index === 2 && (\r\n                                                <div className=\"absolute bottom-4 left-4\">\r\n                                                    <span className=\"bg-white/90 text-gray-900 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider backdrop-blur-sm shadow-sm\">\r\n                                                        Trending\r\n                                                    </span>\r\n                                                </div>\r\n                                            )}\r\n\r\n                                            {/* Favorite Button */}\r\n                                            <button className=\"absolute top-4 right-4 p-2 rounded-full bg-white/70 text-gray-900 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-white\">\r\n                                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\" />\r\n                                                </svg>\r\n                                            </button>\r\n                                        </div>\r\n\r\n                                        {/* Product Info */}\r\n                                        <div className=\"mt-4 flex justify-between\">\r\n                                            <div>\r\n                                                <h3 className=\"text-sm font-medium text-gray-900\">\r\n                                                    <Link href={`/product/${product.slug}`}>\r\n                                                        <span aria-hidden=\"true\" className=\"absolute inset-0\"></span>\r\n                                                        {product.name}\r\n                                                    </Link>\r\n                                                </h3>\r\n                                                <p className=\"mt-1 text-xs text-gray-500\">{product.category || 'LUMIÈRE'}</p>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"mt-2 flex items-baseline gap-2\">\r\n                                            <p className=\"text-sm font-semibold text-gray-900\">₹{product.base_price.toLocaleString('en-IN')}</p>\r\n                                            {index % 3 === 0 && (\r\n                                                <>\r\n                                                    <p className=\"text-xs text-gray-400 line-through\">₹{(product.base_price * 1.3).toLocaleString('en-IN')}</p>\r\n                                                    <p className=\"text-xs text-red-600 font-medium\">(24% OFF)</p>\r\n                                                </>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                ))\r\n                            ) : (\r\n                                <div className=\"col-span-full text-center py-12 text-gray-500\">\r\n                                    No products available\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Load More */}\r\n                        {products.length >= 8 && (\r\n                            <div className=\"mt-16 flex justify-center\">\r\n                                <button className=\"px-8 py-3 border border-gray-200 text-sm font-medium rounded-full text-gray-900 hover:bg-gray-50 transition-colors uppercase tracking-widest\">\r\n                                    Load More\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </main>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\(storefront)\\shop\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2779,2782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2779,2782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabaseServer } from '@/lib/supabase/server'\r\nimport { Metadata } from 'next'\r\nimport ShopClient from './ShopClient'\r\n\r\nexport const metadata: Metadata = {\r\n    title: 'Shop | Crown & Crest',\r\n    description: 'Browse our premium collection of fashion and accessories',\r\n}\r\n\r\nexport const revalidate = 1800 // 30 minutes ISR\r\n\r\ninterface Product {\r\n    id: string\r\n    name: string\r\n    slug: string\r\n    base_price: number\r\n    image_url: string | null\r\n    category: string | null\r\n}\r\n\r\ninterface SearchParams {\r\n    category?: string | string[]\r\n    sort?: string\r\n    minPrice?: string\r\n    maxPrice?: string\r\n    size?: string\r\n}\r\n\r\nasync function getProducts(searchParams: SearchParams) {\r\n    // Determine if we need to filter by size (requires inner join on variants)\r\n    const filterBySize = !!searchParams.size\r\n\r\n    // Build the select string\r\n    let selectString = 'id, name, slug, base_price, image_url, category'\r\n\r\n    if (filterBySize) {\r\n        selectString += ', product_variants!inner(options)'\r\n    }\r\n\r\n    let query = supabaseServer\r\n        .from('products')\r\n        .select(selectString)\r\n    // .eq('is_active', true)\r\n    // .eq('published', true)\r\n\r\n    // 1. Category Filter\r\n    if (searchParams.category) {\r\n        const categories = Array.isArray(searchParams.category)\r\n            ? searchParams.category\r\n            : searchParams.category.split(',')\r\n        query = query.in('category', categories)\r\n    }\r\n\r\n    // 2. Price Filter\r\n    if (searchParams.minPrice) {\r\n        query = query.gte('base_price', Number(searchParams.minPrice))\r\n    }\r\n    if (searchParams.maxPrice) {\r\n        query = query.lte('base_price', Number(searchParams.maxPrice))\r\n    }\r\n\r\n    // 3. Size Filter\r\n    if (searchParams.size) {\r\n        // Now valid because we included product_variants!inner(options) in select\r\n        query = query.contains('product_variants.options', JSON.stringify({ Size: searchParams.size }))\r\n    }\r\n\r\n    // 4. Sorting\r\n    switch (searchParams.sort) {\r\n        case 'price_asc':\r\n            query = query.order('base_price', { ascending: true })\r\n            break\r\n        case 'price_desc':\r\n            query = query.order('base_price', { ascending: false })\r\n            break\r\n        case 'newest':\r\n            query = query.order('created_at', { ascending: false })\r\n            break\r\n        default: // 'recommended'\r\n            query = query.order('created_at', { ascending: false })\r\n            break\r\n    }\r\n\r\n    // execute\r\n    const { data: products, error } = await query.limit(50)\r\n\r\n    if (error) {\r\n        console.error('Failed to fetch filtered products details:', JSON.stringify(error, null, 2))\r\n        return []\r\n    }\r\n\r\n    // Map to Product interface\r\n    return products.map((p: any) => ({\r\n        id: p.id,\r\n        name: p.name,\r\n        slug: p.slug,\r\n        base_price: p.base_price, // Will differ if alias didn't work, but it usually does. Check returned data type.\r\n        image_url: p.image_url,\r\n        category: p.category\r\n    })) as Product[]\r\n}\r\n\r\nexport default async function ShopPage({\r\n    searchParams,\r\n}: {\r\n    searchParams: Promise<SearchParams>\r\n}) {\r\n    // Next.js 15+ searchParams is a promise\r\n    const params = await searchParams\r\n    const products = await getProducts(params)\r\n\r\n    return <ShopClient initialProducts={products} />\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\HomeClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\admin\\orders\\bulk\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\admin\\orders\\export\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2579,2582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2579,2582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4081,4084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4081,4084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\nimport { getCurrentUser } from '@/lib/auth'\r\n\r\n/**\r\n * Admin API: Export Orders to CSV\r\n * \r\n * Same query params as GET /api/admin/orders\r\n * Returns CSV file stream\r\n */\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    // Admin auth check\r\n    const user = await getCurrentUser()\r\n    if (!user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    const adminUids = process.env.ADMIN_UIDS?.split(',') || []\r\n    if (!adminUids.includes(user.uid)) {\r\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 })\r\n    }\r\n\r\n    const { searchParams } = new URL(req.url)\r\n    \r\n    // Extract filters (same as orders route)\r\n    const paymentMethod = searchParams.get('payment_method')\r\n    const riskTier = searchParams.get('risk_tier')\r\n    const courier = searchParams.get('courier')\r\n    const status = searchParams.get('status')\r\n    const pincode = searchParams.get('pincode')\r\n    const dateFrom = searchParams.get('date_from')\r\n    const dateTo = searchParams.get('date_to')\r\n\r\n    // Build query (no pagination for export)\r\n    let query = supabaseAdmin\r\n      .from('orders')\r\n      .select('*')\r\n      .order('created_at', { ascending: false })\r\n\r\n    // Apply filters\r\n    if (paymentMethod) query = query.eq('payment_method', paymentMethod)\r\n    if (riskTier) query = query.eq('razorpay_risk_tier', riskTier)\r\n    if (courier) query = query.eq('courier_name', courier)\r\n    if (status) query = query.eq('status', status)\r\n    if (pincode) query = query.filter('shipping_address->>pincode', 'eq', pincode)\r\n    if (dateFrom) query = query.gte('created_at', dateFrom)\r\n    if (dateTo) query = query.lte('created_at', dateTo)\r\n\r\n    const { data: orders, error } = await query\r\n\r\n    if (error) {\r\n      console.error('[ADMIN_EXPORT] Error:', error)\r\n      return NextResponse.json({ error: error.message }, { status: 500 })\r\n    }\r\n\r\n    // Generate CSV\r\n    const csv = generateOrdersCsv(orders || [])\r\n\r\n    // Return CSV file\r\n    return new NextResponse(csv, {\r\n      headers: {\r\n        'Content-Type': 'text/csv',\r\n        'Content-Disposition': `attachment; filename=\"orders-${new Date().toISOString().split('T')[0]}.csv\"`,\r\n      },\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('[ADMIN_EXPORT] Error:', error)\r\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\r\n  }\r\n}\r\n\r\n/**\r\n * Generate CSV from orders data\r\n */\r\nfunction generateOrdersCsv(orders: any[]): string {\r\n  // CSV Headers\r\n  const headers = [\r\n    'Order ID',\r\n    'Date',\r\n    'Customer UID',\r\n    'Customer Phone',\r\n    'Payment Method',\r\n    'COD Fee',\r\n    'Amount',\r\n    'Currency',\r\n    'Risk Tier',\r\n    'Status',\r\n    'Courier',\r\n    'Tracking ID',\r\n    'Pincode',\r\n    'Shipment Status',\r\n    'Estimated Delivery',\r\n    'Actual Delivery',\r\n    'Razorpay Order ID',\r\n    'Razorpay Payment ID',\r\n  ]\r\n\r\n  // Build CSV rows\r\n  const rows = orders.map((order) => {\r\n    const address = order.shipping_address\r\n      ? (typeof order.shipping_address === 'string' \r\n          ? JSON.parse(order.shipping_address) \r\n          : order.shipping_address)\r\n      : null\r\n\r\n    return [\r\n      order.id.slice(0, 12),\r\n      new Date(order.created_at).toLocaleString(),\r\n      order.firebase_uid.slice(0, 12),\r\n      order.customer_phone || '',\r\n      order.payment_method || (order.is_cod ? 'COD' : 'PREPAID'),\r\n      order.cod_fee || '0',\r\n      order.amount,\r\n      order.currency,\r\n      order.razorpay_risk_tier || '',\r\n      order.status,\r\n      order.courier_name || '',\r\n      order.tracking_id || '',\r\n      address?.pincode || '',\r\n      order.shipment_status || '',\r\n      order.estimated_delivery_date || '',\r\n      order.actual_delivery_date || '',\r\n      order.razorpay_order_id || '',\r\n      order.razorpay_payment_id || '',\r\n    ].map(escapeCSV).join(',')\r\n  })\r\n\r\n  return [headers.join(','), ...rows].join('\\n')\r\n}\r\n\r\n/**\r\n * Escape CSV field\r\n */\r\nfunction escapeCSV(field: any): string {\r\n  const str = String(field)\r\n  if (str.includes(',') || str.includes('\"') || str.includes('\\n')) {\r\n    return `\"${str.replace(/\"/g, '\"\"')}\"`\r\n  }\r\n  return str\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\admin\\orders\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\auth\\logout\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\auth\\session\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":81,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { cookies } from 'next/headers'\nimport { adminAuth } from '@/lib/firebase/admin'\nimport { supabaseAdmin } from '@/lib/supabase/admin'\nimport crypto from 'crypto'\n\nconst SESSION_EXPIRY_DAYS = 7\nconst SESSION_EXPIRY_SECONDS = SESSION_EXPIRY_DAYS * 24 * 60 * 60\n\n// Session signing helpers\nfunction signSession(uid: string): string {\n  const payload = JSON.stringify({\n    uid,\n    iat: Date.now()\n  })\n  \n  const secret = process.env.SESSION_SECRET || 'fallback-secret-change-in-production'\n  const signature = crypto\n    .createHmac('sha256', secret)\n    .update(payload)\n    .digest('base64')\n  \n  const sessionValue = `${Buffer.from(payload).toString('base64')}.${signature}`\n  return sessionValue\n}\n\nexport async function POST(req: Request) {\n  try {\n    const { idToken } = await req.json()\n\n    if (!idToken) {\n      return new Response(JSON.stringify({ error: 'Missing ID token' }), {\n        status: 400,\n      })\n    }\n\n    // Verify Firebase ID token server-side\n    let decodedToken\n    try {\n      decodedToken = await adminAuth.verifyIdToken(idToken)\n    } catch (error) {\n      console.error('Token verification failed:', error)\n      return new Response(JSON.stringify({ error: 'Invalid or expired token' }), {\n        status: 401,\n      })\n    }\n\n    const uid = decodedToken.uid\n\n    // Verify user exists in database, or create if new signup\n    let user\n    const { data: existingUser, error: userError } = await supabaseAdmin\n      .from('users')\n      .select('firebase_uid')\n      .eq('firebase_uid', uid)\n      .single()\n\n    if (userError && userError.code === 'PGRST116') {\n      // User not found - create new user for first-time signups\n      const { data: newUser, error: createError } = await supabaseAdmin\n        .from('users')\n        .insert({\n          firebase_uid: uid,\n          role: 'customer',\n        })\n        .select()\n        .single()\n\n      if (createError) {\n        console.error('User creation failed:', createError)\n        return new Response(JSON.stringify({ error: 'Failed to create user record' }), {\n          status: 500,\n        })\n      }\n      user = newUser\n    } else if (userError || !existingUser) {\n      console.error('User lookup failed:', userError)\n      return new Response(JSON.stringify({ error: 'User not found' }), {\n        status: 404,\n      })\n    } else {\n      user = existingUser\n    }\n\n    // Create signed session cookie\n    const cookieStore = await cookies()\n    const signedSession = signSession(uid)\n\n    cookieStore.set('session', signedSession, {\n      httpOnly: true,\n      sameSite: 'lax',\n      secure: process.env.NODE_ENV === 'production',\n      path: '/',\n      maxAge: SESSION_EXPIRY_SECONDS,\n    })\n\n    return new Response(JSON.stringify({ success: true }))\n  } catch (error) {\n    console.error('Session creation error:', error)\n    return new Response(JSON.stringify({ error: 'Session creation failed' }), {\n      status: 500,\n    })\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\auth\\validate-phone\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1838,1841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1838,1841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\r\nimport { adminAuth } from '@/lib/firebase/admin'\r\nimport { getCurrentUser } from '@/lib/auth'\r\n\r\n/**\r\n * Phone Validation API\r\n * \r\n * Checks if a phone number is available for verification or already registered\r\n * Prevents phone hijacking by verifying ownership\r\n */\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    // Get current authenticated user\r\n    const currentUser = await getCurrentUser()\r\n    \r\n    if (!currentUser) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    const { phoneNumber } = await req.json()\r\n\r\n    // Validate phone number format\r\n    if (!phoneNumber || typeof phoneNumber !== 'string') {\r\n      return NextResponse.json(\r\n        { error: 'Invalid phone number' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    // Ensure E.164 format (+91XXXXXXXXXX)\r\n    const formattedPhone = phoneNumber.startsWith('+') \r\n      ? phoneNumber \r\n      : `+91${phoneNumber.replace(/^0+/, '')}`\r\n\r\n    try {\r\n      // Check if phone exists in Firebase Auth\r\n      const userRecord = await adminAuth.getUserByPhoneNumber(formattedPhone)\r\n\r\n      // Phone exists - check ownership\r\n      if (userRecord.uid === currentUser.uid) {\r\n        // Phone belongs to current user\r\n        return NextResponse.json({\r\n          status: 'OWNED_BY_USER',\r\n          needsVerification: false,\r\n          message: 'This is your verified phone number'\r\n        })\r\n      } else {\r\n        // Phone belongs to different user - SECURITY BLOCK\r\n        return NextResponse.json({\r\n          status: 'OWNED_BY_OTHER',\r\n          needsVerification: false,\r\n          message: 'This number is already registered to another account. Please use a different number.'\r\n        })\r\n      }\r\n    } catch (error: any) {\r\n      // Phone not found in Firebase - available for verification\r\n      if (error.code === 'auth/user-not-found') {\r\n        return NextResponse.json({\r\n          status: 'AVAILABLE',\r\n          needsVerification: true,\r\n          message: 'Phone verification required',\r\n          formattedPhone\r\n        })\r\n      }\r\n\r\n      // Other Firebase errors\r\n      console.error('[validate-phone] Firebase error:', error)\r\n      return NextResponse.json(\r\n        { error: 'Failed to validate phone number' },\r\n        { status: 500 }\r\n      )\r\n    }\r\n  } catch (error) {\r\n    console.error('[validate-phone] Server error:', error)\r\n    return NextResponse.json(\r\n      { error: 'Internal server error' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\cron\\cleanup-notifications\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1063,1066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1063,1066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\r\nimport { cleanupExpiredNotifications } from '@/lib/notifications/actions'\r\n\r\n/**\r\n * Notification Cleanup Cron Job\r\n * Runs daily to delete expired notifications\r\n * \r\n * Protected by CRON_SECRET environment variable\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  // Verify cron secret for security\r\n  const authHeader = request.headers.get('authorization')\r\n  const cronSecret = process.env.CRON_SECRET\r\n\r\n  if (!cronSecret) {\r\n    return NextResponse.json(\r\n      { error: 'CRON_SECRET not configured' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n\r\n  if (authHeader !== `Bearer ${cronSecret}`) {\r\n    return NextResponse.json(\r\n      { error: 'Unauthorized' },\r\n      { status: 401 }\r\n    )\r\n  }\r\n\r\n  try {\r\n    console.log('[Cron] Running notification cleanup...')\r\n    \r\n    await cleanupExpiredNotifications()\r\n\r\n    console.log('[Cron] Notification cleanup complete')\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      timestamp: new Date().toISOString()\r\n    })\r\n  } catch (error: any) {\r\n    console.error('[Cron] Notification cleanup failed:', error)\r\n    \r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: error.message,\r\n        timestamp: new Date().toISOString()\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n// Allow POST as well for manual triggers\r\nexport async function POST(request: NextRequest) {\r\n  return GET(request)\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\cron\\cleanup-reservations\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\cron\\health-check\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1172,1175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1172,1175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\r\nimport { runHealthCheck } from '@/lib/ai/health-monitor'\r\n\r\n/**\r\n * Health Check Cron Job\r\n * Runs every 30 minutes to check AI model availability\r\n * \r\n * Protected by CRON_SECRET environment variable\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  // Verify cron secret for security\r\n  const authHeader = request.headers.get('authorization')\r\n  const cronSecret = process.env.CRON_SECRET\r\n\r\n  if (!cronSecret) {\r\n    return NextResponse.json(\r\n      { error: 'CRON_SECRET not configured' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n\r\n  if (authHeader !== `Bearer ${cronSecret}`) {\r\n    return NextResponse.json(\r\n      { error: 'Unauthorized' },\r\n      { status: 401 }\r\n    )\r\n  }\r\n\r\n  try {\r\n    console.log('[Cron] Running health check...')\r\n    const startTime = Date.now()\r\n\r\n    const results = await runHealthCheck()\r\n\r\n    const duration = Date.now() - startTime\r\n\r\n    console.log('[Cron] Health check complete:', results)\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      results,\r\n      duration: `${duration}ms`,\r\n      timestamp: new Date().toISOString()\r\n    })\r\n  } catch (error: any) {\r\n    console.error('[Cron] Health check failed:', error)\r\n    \r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: error.message,\r\n        timestamp: new Date().toISOString()\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n// Allow POST as well for manual triggers\r\nexport async function POST(request: NextRequest) {\r\n  return GET(request)\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\products\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\razorpay\\cancel\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\razorpay\\cod\\eligibility\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'customer_details' is assigned a value but never used.","line":24,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":47}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\n\r\n/**\r\n * Razorpay Magic Checkout: COD Eligibility API\r\n * \r\n * Called by Razorpay to determine:\r\n * - Whether COD is allowed for this order\r\n * - COD fee (if applicable)\r\n * - Reason codes for admin storage\r\n * \r\n * Request from Razorpay:\r\n * {\r\n *   \"order_id\": \"order_xxx\",\r\n *   \"amount\": 2500,\r\n *   \"customer_details\": {\r\n *     \"email\": \"user@example.com\",\r\n *     \"phone\": \"+919876543210\"\r\n *   }\r\n * }\r\n */\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { order_id, amount, customer_details } = await req.json()\r\n    \r\n    console.log('[COD_ELIGIBILITY] Request for order:', order_id, 'Amount:', amount)\r\n\r\n    // Fetch order from database to get order details\r\n    const { data: order } = await supabaseAdmin\r\n      .from('orders')\r\n      .select('*')\r\n      .eq('razorpay_order_id', order_id)\r\n      .single()\r\n\r\n    if (!order) {\r\n      console.error('[COD_ELIGIBILITY] Order not found:', order_id)\r\n      return NextResponse.json({\r\n        cod_available: false,\r\n        reason: 'ORDER_NOT_FOUND'\r\n      })\r\n    }\r\n\r\n    // COD ELIGIBILITY LOGIC (LENIENT FOR NEW BRAND)\r\n    // Start permissive, tighten later based on RTO data\r\n    \r\n    let codAvailable = true\r\n    let codFee = 0\r\n    let reason = ''\r\n\r\n    // Rule 1: Maximum order value for COD\r\n    const MAX_COD_AMOUNT = 10000 // ₹10,000\r\n    if (amount > MAX_COD_AMOUNT) {\r\n      codAvailable = false\r\n      reason = 'ORDER_VALUE_TOO_HIGH'\r\n    }\r\n\r\n    // Rule 2: COD fee for orders above threshold\r\n    const COD_FEE_THRESHOLD = 2000 // Charge fee for orders > ₹2,000\r\n    const COD_FEE_AMOUNT = 50 // ₹50 COD fee\r\n    \r\n    if (codAvailable && amount > COD_FEE_THRESHOLD) {\r\n      codFee = COD_FEE_AMOUNT\r\n      reason = 'COD_FEE_APPLICABLE'\r\n    }\r\n\r\n    // Rule 3: New customers - allow COD (no blocking)\r\n    // TODO: Add repeat customer logic later\r\n    if (codAvailable && !reason) {\r\n      reason = 'FIRST_ORDER_ALLOWED'\r\n    }\r\n\r\n    // Store eligibility decision in order for admin reference\r\n    await supabaseAdmin\r\n      .from('orders')\r\n      .update({\r\n        cod_allowed_by_razorpay: codAvailable,\r\n        cod_eligibility_reason: reason,\r\n        cod_fee: codFee,\r\n      })\r\n      .eq('id', order.id)\r\n\r\n    console.log('[COD_ELIGIBILITY] Decision:', {\r\n      cod_available: codAvailable,\r\n      cod_fee: codFee,\r\n      reason\r\n    })\r\n\r\n    return NextResponse.json({\r\n      cod_available: codAvailable,\r\n      cod_fee: codFee,\r\n      reason,\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('[COD_ELIGIBILITY] Error:', error)\r\n    // Default to allowing COD on error (lenient approach)\r\n    return NextResponse.json({\r\n      cod_available: true,\r\n      cod_fee: 0,\r\n      reason: 'ERROR_DEFAULT_ALLOW'\r\n    })\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\razorpay\\order\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":20,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\r\nimport { getCurrentUser } from '@/lib/auth'\r\nimport { createRazorpayOrder } from '@/lib/razorpay'\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\nimport { validateCartForCheckout } from '@/lib/checkout/actions'\r\n\r\n/**\r\n * Razorpay Magic Checkout Order Creation API\r\n * \r\n * This endpoint creates a Razorpay order configured for Magic Checkout.\r\n * Magic Checkout handles: address collection, payment method selection, COD eligibility\r\n * \r\n * Flow:\r\n * 1. Validate cart (stock, prices)\r\n * 2. Create internal order (status = CREATED)\r\n * 3. Reserve stock\r\n * 4. Create Razorpay order with Magic Checkout parameters\r\n * 5. Return order IDs to frontend\r\n */\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    // Auth check\r\n    const user = await getCurrentUser()\r\n    if (!user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    console.log('[MAGIC_CHECKOUT] Creating order for user:', user.uid)\r\n\r\n    // 1️⃣ VALIDATE CART\r\n    const validation = await validateCartForCheckout()\r\n    \r\n    if (!validation.success || !validation.items || !validation.totalAmount) {\r\n      console.log('[MAGIC_CHECKOUT] Validation failed:', validation.error)\r\n      return NextResponse.json(\r\n        { error: validation.error || 'Cart validation failed' }, \r\n        { status: 400 }\r\n      )\r\n    }\r\n    \r\n    const { items: preparedItems, totalAmount } = validation\r\n    console.log('[MAGIC_CHECKOUT] Cart validated:', preparedItems.length, 'items, ₹', totalAmount)\r\n    \r\n    // Build stock reservation items\r\n    const reservationItems = preparedItems.map((item) => ({\r\n      variant_id: item.variant_id,\r\n      qty: item.quantity,\r\n    }))\r\n\r\n    // 2️⃣ CREATE INTERNAL ORDER\r\n    const { data: order, error: orderError } = await supabaseAdmin\r\n      .from('orders')\r\n      .insert({\r\n        firebase_uid: user.uid,\r\n        amount: totalAmount,\r\n        currency: 'INR',\r\n        status: 'CREATED',\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (orderError || !order) {\r\n      console.error('[MAGIC_CHECKOUT] Order creation failed:', orderError)\r\n      return NextResponse.json(\r\n        { error: 'Failed to create order' }, \r\n        { status: 500 }\r\n      )\r\n    }\r\n    \r\n    console.log('[MAGIC_CHECKOUT] Internal order created:', order.id)\r\n\r\n    try {\r\n      // 3️⃣ RESERVE STOCK (atomic, all-or-nothing)\r\n      const { error: reserveError } = await supabaseAdmin.rpc('reserve_stock', {\r\n        p_order_id: order.id,\r\n        p_uid: user.uid,\r\n        p_items: reservationItems,\r\n        p_ttl_seconds: 900, // 15 minutes\r\n      })\r\n\r\n      if (reserveError) {\r\n        console.error('[MAGIC_CHECKOUT] Stock reservation failed:', reserveError)\r\n        \r\n        // Cleanup order\r\n        await supabaseAdmin.from('orders').delete().eq('id', order.id)\r\n        \r\n        if (reserveError.message?.includes('OUT_OF_STOCK')) {\r\n          return NextResponse.json(\r\n            { error: 'OUT_OF_STOCK', message: 'One or more items are out of stock' },\r\n            { status: 409 }\r\n          )\r\n        }\r\n        \r\n        return NextResponse.json(\r\n          { error: 'Stock reservation failed' }, \r\n          { status: 500 }\r\n        )\r\n      }\r\n\r\n      console.log('[MAGIC_CHECKOUT] Stock reserved successfully')\r\n\r\n      // 4️⃣ CREATE RAZORPAY MAGIC CHECKOUT ORDER\r\n      const razorpayOrder = await createRazorpayOrder(\r\n        totalAmount,\r\n        order.id.slice(0, 40) // Receipt ID\r\n      )\r\n      \r\n      console.log('[MAGIC_CHECKOUT] Razorpay order created:', razorpayOrder.id)\r\n\r\n      // 5️⃣ UPDATE ORDER WITH RAZORPAY DETAILS\r\n      await supabaseAdmin\r\n        .from('orders')\r\n        .update({ \r\n          razorpay_order_id: razorpayOrder.id,\r\n          status: 'PAYMENT_PENDING',\r\n        })\r\n        .eq('id', order.id)\r\n      \r\n      // 6️⃣ CREATE ORDER ITEMS (price snapshots)\r\n      const orderItems = preparedItems.map((item) => ({\r\n        order_id: order.id,\r\n        variant_id: item.variant_id,\r\n        quantity: item.quantity,\r\n        price_at_purchase: item.price_at_purchase,\r\n      }))\r\n      \r\n      const { error: itemsError } = await supabaseAdmin\r\n        .from('order_items')\r\n        .insert(orderItems)\r\n      \r\n      if (itemsError) {\r\n        console.error('[MAGIC_CHECKOUT] Failed to create order items:', itemsError)\r\n        throw new Error('Failed to create order items')\r\n      }\r\n      \r\n      console.log('[MAGIC_CHECKOUT] Order items created:', orderItems.length)\r\n\r\n      // SUCCESS - Return order data for Magic Checkout\r\n      return NextResponse.json({\r\n        success: true,\r\n        order_id: order.id,\r\n        razorpay_order_id: razorpayOrder.id,\r\n        amount: totalAmount,\r\n        currency: 'INR',\r\n      })\r\n\r\n    } catch (error) {\r\n      // ROLLBACK ON ERROR\r\n      console.error('[MAGIC_CHECKOUT] Error during checkout:', error)\r\n      \r\n      // Release reservations\r\n      try {\r\n        await supabaseAdmin.rpc('release_reservation', {\r\n          p_order_id: order.id,\r\n        })\r\n      } catch (releaseError) {\r\n        console.error('[MAGIC_CHECKOUT] Failed to release reservations:', releaseError)\r\n      }\r\n      \r\n      // Delete order\r\n      await supabaseAdmin.from('orders').delete().eq('id', order.id)\r\n      \r\n      return NextResponse.json(\r\n        { error: 'Checkout failed' }, \r\n        { status: 500 }\r\n      )\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('[MAGIC_CHECKOUT] Unexpected error:', error)\r\n    return NextResponse.json(\r\n      { error: 'Internal server error' }, \r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\razorpay\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getCart' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2111,2114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2111,2114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { getCurrentUser } from '@/lib/auth'\nimport { createRazorpayOrder } from '@/lib/razorpay'\nimport { supabaseAdmin } from '@/lib/supabase/admin'\nimport { getCart } from '@/lib/cart/actions'\nimport { validateCartForCheckout } from '@/lib/checkout/actions'\n\nexport async function POST(req: Request) {\n  const user = await getCurrentUser()\n  if (!user) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  }\n\n  const { amount, shippingAddress, customerPhone } = await req.json()\n  console.log('[RAZORPAY] Creating order for user:', user.uid, 'amount:', amount)\n\n  // 1️⃣ VALIDATE CART (re-fetch, check stock, resolve prices)\n  const validation = await validateCartForCheckout()\n  \n  if (!validation.success || !validation.items || !validation.totalAmount) {\n    console.log('[RAZORPAY] Validation failed:', validation.error)\n    return NextResponse.json({ error: validation.error || 'Validation failed' }, { status: 400 })\n  }\n  \n  const { items: preparedItems, totalAmount: validatedAmount } = validation\n  console.log('[RAZORPAY] Validation passed. Items:', preparedItems.length, 'Total:', validatedAmount)\n  \n  // Verify amount matches (prevent client-side tampering)\n  if (Math.abs(amount - validatedAmount) > 1) {\n    console.log('[RAZORPAY] Amount mismatch. Client:', amount, 'Server:', validatedAmount)\n    return NextResponse.json({ error: 'Price mismatch. Please refresh and try again.' }, { status: 400 })\n  }\n  \n  // Build reservation items from validated cart\n  const reservationItems = preparedItems.map((item) => ({\n    variant_id: item.variant_id,\n    qty: item.quantity,\n  }))\n\n  // 2️⃣ CHECK FOR EXISTING ORDER (retry-safe)\n  // If user already has a pending order within last 15 minutes, reuse it\n  const { data: existingOrders } = await supabaseAdmin\n    .from('orders')\n    .select('*')\n    .eq('firebase_uid', user.uid)\n    .in('status', ['CREATED', 'PAYMENT_PENDING'])\n    .gte('created_at', new Date(Date.now() - 15 * 60 * 1000).toISOString())\n    .order('created_at', { ascending: false })\n    .limit(1)\n\n  let order: any\n\n  if (existingOrders && existingOrders.length > 0) {\n    order = existingOrders[0]\n    console.log('[RAZORPAY] Reusing existing order:', order.id)\n    \n    // If order already has razorpay_order_id, return it immediately\n    if (order.razorpay_order_id) {\n      return NextResponse.json({\n        orderId: order.id,\n        razorpayOrderId: order.razorpay_order_id,\n        amount: order.amount,\n      })\n    }\n  } else {\n    // Create new order\n    const { data: newOrder, error: orderError } = await supabaseAdmin\n      .from('orders')\n      .insert({\n        firebase_uid: user.uid,\n        amount,\n        currency: 'INR',\n        status: 'CREATED',\n        shipping_address: shippingAddress,\n        customer_phone: customerPhone,\n      })\n      .select()\n      .single()\n\n    if (orderError || !newOrder) {\n      console.error('[RAZORPAY] Order create error:', orderError)\n      return NextResponse.json({ error: 'Order create failed' }, { status: 500 })\n    }\n    \n    order = newOrder\n    console.log('[RAZORPAY] Order created:', order.id)\n  }\n\n  try {\n    // 3️⃣ RESERVE STOCK (atomic, all-or-nothing)\n    // This decrements stock_quantity and creates reservation records\n    // If ANY variant is out of stock, entire transaction rolls back\n    const { error: reserveError } = await supabaseAdmin.rpc(\n      'reserve_stock',\n      {\n        p_order_id: order.id,\n        p_uid: user.uid,\n        p_items: reservationItems, // Pass as array, not stringified\n        p_ttl_seconds: 900, // 15 minutes expiry\n      }\n    )\n\n    if (reserveError) {\n      console.error('[RAZORPAY] Stock reservation error:', reserveError)\n      \n      // Clean up order on reservation failure\n      await supabaseAdmin.from('orders').delete().eq('id', order.id)\n      \n      // Check if it's an out-of-stock error\n      if (reserveError.message?.includes('OUT_OF_STOCK')) {\n        console.log('[RAZORPAY] OUT_OF_STOCK error')\n        return NextResponse.json(\n          { error: 'OUT_OF_STOCK', message: 'One or more items are out of stock' },\n          { status: 409 }\n        )\n      }\n      \n      console.error('[RAZORPAY] Reservation failed:', reserveError.message)\n      return NextResponse.json(\n        { error: 'Reservation failed', message: reserveError.message },\n        { status: 500 }\n      )\n    }\n\n    console.log('[RAZORPAY] Stock reserved successfully')\n\n    // 4️⃣ Create Razorpay order (only after successful reservation)\n    const razorpayOrder = await createRazorpayOrder(\n      amount,\n      order.id.slice(0, 40)\n    )\n    console.log('[RAZORPAY] Razorpay order created:', razorpayOrder.id)\n\n    // 5️⃣ Update order with Razorpay details and mark as PAYMENT_PENDING\n    await supabaseAdmin\n      .from('orders')\n      .update({ \n        razorpay_order_id: razorpayOrder.id,\n        status: 'PAYMENT_PENDING',\n      })\n      .eq('id', order.id)\n    \n    // 6️⃣ Create order_items with price snapshots\n    const orderItems = preparedItems.map((item) => ({\n      order_id: order.id,\n      variant_id: item.variant_id,\n      quantity: item.quantity,\n      price_at_purchase: item.price_at_purchase, // SNAPSHOT: variant.price_override ?? product.base_price\n    }))\n    \n    const { error: itemsError } = await supabaseAdmin\n      .from('order_items')\n      .insert(orderItems)\n    \n    if (itemsError) {\n      console.error('[RAZORPAY] Failed to create order items:', itemsError)\n      // This is critical - rollback everything\n      throw new Error('Failed to create order items')\n    }\n    \n    console.log('[RAZORPAY] Order items created:', orderItems.length)\n\n    return NextResponse.json({\n      orderId: order.id,\n      razorpayOrderId: razorpayOrder.id,\n      amount,\n    })\n\n  } catch (error) {\n    // Rollback: release reservations and delete order\n    console.error('[RAZORPAY] Checkout error:', error)\n    \n    try {\n      // Release any reservations that might have been created\n      await supabaseAdmin.rpc('release_reservation', {\n        p_order_id: order.id,\n      })\n      console.log('[RAZORPAY] Reservations released during rollback')\n    } catch (releaseError) {\n      console.error('[RAZORPAY] Error releasing reservations during rollback:', releaseError)\n    }\n    \n    // Delete the order\n    await supabaseAdmin.from('orders').delete().eq('id', order.id)\n    console.log('[RAZORPAY] Order deleted during rollback')\n    \n    return NextResponse.json(\n      { error: 'Checkout failed', message: 'An error occurred during checkout' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\razorpay\\shipping\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2657,2660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2657,2660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\nimport { checkPincodeServiceability } from '@/lib/shiprocket/pincode'\r\nimport { getShippingRates, selectBestCourier } from '@/lib/shiprocket/shipping'\r\n\r\n/**\r\n * Razorpay Magic Checkout: Shipping Options API\r\n * \r\n * Called by Razorpay to determine:\r\n * - Whether a pincode is serviceable (AUTHORITATIVE via Shiprocket)\r\n * - Shipping charges (calculated via Shiprocket rates)\r\n * - Delivery estimates (from Shiprocket courier ETAs)\r\n * - COD availability (Shiprocket serviceability + Razorpay risk)\r\n * \r\n * Request from Razorpay:\r\n * {\r\n *   \"pincode\": \"400001\",\r\n *   \"cod\": true,\r\n *   \"order_id\": \"order_xxx\"\r\n * }\r\n */\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { pincode, cod, order_id } = await req.json()\r\n    \r\n    console.log('[SHIPPING_API] Razorpay request for pincode:', pincode, 'COD:', cod, 'Order:', order_id)\r\n\r\n    // Validate pincode format (6 digits)\r\n    if (!pincode || !/^\\d{6}$/.test(pincode)) {\r\n      console.log('[SHIPPING_API] Invalid pincode format')\r\n      return NextResponse.json({\r\n        serviceable: false,\r\n        cod: false,\r\n        error: 'Invalid pincode format'\r\n      })\r\n    }\r\n\r\n    // 1️⃣ CHECK SHIPROCKET SERVICEABILITY (AUTHORITATIVE)\r\n    const serviceability = await checkPincodeServiceability(pincode)\r\n    \r\n    if (!serviceability.serviceable) {\r\n      console.log('[SHIPPING_API] Pincode not serviceable:', pincode)\r\n      return NextResponse.json({\r\n        serviceable: false,\r\n        cod: false,\r\n        shipping_fee: 0,\r\n        estimated_delivery_days: 0,\r\n      })\r\n    }\r\n\r\n    console.log('[SHIPPING_API] Pincode serviceable:', {\r\n      cod: serviceability.codAvailable,\r\n      days: serviceability.estimatedDays\r\n    })\r\n\r\n    // 2️⃣ FETCH ORDER TO GET WEIGHT & VALUE\r\n    let orderWeight = 0.5 // Default 500g\r\n    let orderValue = 0\r\n    \r\n    if (order_id) {\r\n      try {\r\n        const { data: order } = await supabaseAdmin\r\n          .from('orders')\r\n          .select(`\r\n            amount,\r\n            razorpay_order_id,\r\n            order_items (\r\n              quantity,\r\n              variants:variant_id (\r\n                products:product_id (\r\n                  shipping_weight\r\n                )\r\n              )\r\n            )\r\n          `)\r\n          .eq('razorpay_order_id', order_id)\r\n          .single()\r\n\r\n        if (order) {\r\n          orderValue = order.amount\r\n          \r\n          // Calculate total weight from items\r\n          const items = order.order_items || []\r\n          orderWeight = items.reduce((total: number, item: any) => {\r\n            const weight = item.variants?.products?.shipping_weight || 0.5\r\n            return total + (weight * item.quantity)\r\n          }, 0)\r\n          \r\n          orderWeight = Math.max(orderWeight, 0.5) // Minimum 500g\r\n          console.log('[SHIPPING_API] Order weight:', orderWeight, 'kg, Value:', orderValue)\r\n        }\r\n      } catch (error) {\r\n        console.warn('[SHIPPING_API] Could not fetch order details:', error)\r\n      }\r\n    }\r\n\r\n    // 3️⃣ GET SHIPPING RATES FROM SHIPROCKET\r\n    const pickupPincode = process.env.WAREHOUSE_PINCODE || '110001' // Default Delhi\r\n    const codAmount = cod ? orderValue : undefined\r\n    \r\n    const courierOptions = await getShippingRates({\r\n      pickupPincode,\r\n      deliveryPincode: pincode,\r\n      weight: orderWeight,\r\n      codAmount,\r\n      declaredValue: orderValue || 1000, // Fallback value\r\n    })\r\n\r\n    // 4️⃣ SELECT BEST COURIER\r\n    const bestCourier = selectBestCourier(courierOptions)\r\n    \r\n    if (!bestCourier) {\r\n      console.warn('[SHIPPING_API] No courier options available, using fallback')\r\n      return NextResponse.json({\r\n        serviceable: true,\r\n        cod: serviceability.codAvailable,\r\n        shipping_fee: 20, // Fallback flat rate\r\n        estimated_delivery_days: serviceability.estimatedDays,\r\n      })\r\n    }\r\n\r\n    // 5️⃣ COD VALIDATION (Shiprocket + Razorpay)\r\n    // Razorpay's 'cod' param indicates if COD is allowed by their risk engine\r\n    // We combine with Shiprocket's COD availability for this pincode\r\n    const codAllowed = cod && serviceability.codAvailable && bestCourier.supportsCod\r\n\r\n    console.log('[SHIPPING_API] Final shipping:', {\r\n      courier: bestCourier.courierName,\r\n      fee: bestCourier.rate,\r\n      days: bestCourier.estimatedDays,\r\n      cod: codAllowed\r\n    })\r\n\r\n    return NextResponse.json({\r\n      serviceable: true,\r\n      cod: codAllowed,\r\n      shipping_fee: Math.round(bestCourier.rate),\r\n      estimated_delivery_days: bestCourier.estimatedDays,\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('[SHIPPING_API] Error:', error)\r\n    \r\n    // Graceful fallback on error\r\n    return NextResponse.json({\r\n      serviceable: true,\r\n      cod: true,\r\n      shipping_fee: 20, // Flat ₹20 fallback\r\n      estimated_delivery_days: 7,\r\n    })\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\razorpay\\verify\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'snapshotRes' is assigned a value but never used.","line":98,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":98,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'commitResult' is assigned a value but never used.","line":135,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":135,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\nimport { revalidatePath } from 'next/cache'\nimport crypto from 'crypto'\nimport { supabaseAdmin } from '@/lib/supabase/admin'\nimport { getCurrentUser } from '@/lib/auth'\nimport { clearCart } from '@/lib/cart/actions'\nimport { trackPaymentError } from '@/lib/observability/errorTracking'\nimport { logInfo, logError, logWarn } from '@/lib/observability/structuredLogging'\n\nexport async function POST(req: Request) {\n  const user = await getCurrentUser()\n\n  if (!user) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  }\n\n  const body = await req.json()\n  const {\n    razorpay_order_id,\n    razorpay_payment_id,\n    razorpay_signature,\n    orderId,\n  } = body\n\n  const verifyStartTime = Date.now()\n\n  // 1️⃣ Fetch order FIRST\n  const { data: order, error } = await supabaseAdmin\n    .from('orders')\n    .select('*')\n    .eq('id', orderId)\n    .single()\n\n  if (error || !order) {\n    await trackPaymentError(new Error('Order not found'), orderId, {\n      userId: user.uid,\n      action: 'fetch_order',\n    })\n    return NextResponse.json({ error: 'Order not found' }, { status: 404 })\n  }\n\n  logInfo.paymentVerificationStart(orderId)\n\n  // 2️⃣ HARD STOP if already COMPLETED (idempotent check)\n  if (order.status === 'COMPLETED') {\n    // Order already processed, return success immediately\n    // Do NOT reprocess: stock, items, or cart operations\n    return NextResponse.json({\n      success: true,\n      orderId: order.id,\n      message: 'Order already completed',\n    })\n  }\n\n  // 3️⃣ Verify signature\n  const expectedSignature = crypto\n    .createHmac('sha256', process.env.RAZORPAY_KEY_SECRET!)\n    .update(`${razorpay_order_id}|${razorpay_payment_id}`)\n    .digest('hex')\n\n  if (expectedSignature !== razorpay_signature) {\n    // Payment verification failed\n    logError.paymentVerificationFailed(orderId, 'invalid_signature')\n    \n    await trackPaymentError(new Error('Invalid payment signature'), orderId, {\n      userId: user.uid,\n      action: 'verify_signature',\n      paymentId: razorpay_payment_id,\n    })\n\n    // Release reservations\n    try {\n      await supabaseAdmin.rpc('release_reservation', {\n        p_order_id: orderId,\n      })\n    } catch (releaseError) {\n      await trackPaymentError(releaseError, orderId, {\n        userId: user.uid,\n        action: 'release_reservation_after_sig_fail',\n      })\n    }\n\n    // Mark order as FAILED\n    await supabaseAdmin\n      .from('orders')\n      .update({ status: 'FAILED' })\n      .eq('id', orderId)\n\n    return NextResponse.json(\n      { error: 'Invalid payment signature' },\n      { status: 400 }\n    )\n  }\n\n  // 4️⃣ STEP 1: Create order items snapshot (FATAL - must succeed)\n  // CRITICAL: Items MUST be created BEFORE stock commit to prevent stock loss\n  try {\n    const { data: snapshotRes, error: snapshotErr } = await supabaseAdmin.rpc('create_order_items_snapshot', {\n      p_order_id: orderId,\n      p_uid: order.firebase_uid,\n    })\n    \n    if (snapshotErr) {\n      logError.paymentVerificationFailed(orderId, 'order_items_snapshot_failed')\n\n      await trackPaymentError(snapshotErr, orderId, {\n        userId: user.uid,\n        action: 'create_order_snapshot',\n      })\n      \n      // CRITICAL: Payment succeeded but order items creation failed - abort\n      return NextResponse.json(\n        { error: 'Order items creation failed, please contact support' },\n        { status: 500 }\n      )\n    }\n  } catch (snapshotEx) {\n    logError.paymentVerificationFailed(orderId, 'order_items_snapshot_exception')\n\n    await trackPaymentError(snapshotEx, orderId, {\n      userId: user.uid,\n      action: 'create_order_snapshot_exception',\n    })\n    \n    // CRITICAL: Payment succeeded but order items creation failed - abort\n    return NextResponse.json(\n      { error: 'Order items creation failed, please contact support' },\n      { status: 500 }\n    )\n  }\n\n  // 4️⃣ STEP 2: Commit stock reservations (FATAL - must succeed)\n  // CRITICAL: Only commit stock AFTER order_items are guaranteed to exist\n  try {\n    const { data: commitResult, error: commitError } = await supabaseAdmin.rpc(\n      'commit_reservation',\n      {\n        p_order_id: orderId,\n      }\n    )\n\n    if (commitError) {\n      logError.inventoryCommitFailed(orderId, orderId, commitError.message)\n      \n      await trackPaymentError(commitError, orderId, {\n        userId: user.uid,\n        action: 'commit_reservation',\n        paymentId: razorpay_payment_id,\n      })\n      \n      // CRITICAL: Payment succeeded but stock commit failed - abort\n      return NextResponse.json(\n        { error: 'Stock commit failed, please contact support' },\n        { status: 500 }\n      )\n    }\n\n    logInfo.inventoryCommit(orderId, 1, Date.now() - verifyStartTime)\n  } catch (commitError) {\n    logError.inventoryCommitFailed(orderId, orderId, commitError instanceof Error ? commitError.message : String(commitError))\n    \n    await trackPaymentError(commitError, orderId, {\n      userId: user.uid,\n      action: 'commit_reservation_exception',\n      paymentId: razorpay_payment_id,\n    })\n    \n    // CRITICAL: Payment succeeded but stock commit failed - abort\n    return NextResponse.json(\n      { error: 'Stock commit failed, please contact support' },\n      { status: 500 }\n    )\n  }\n\n  // 4️⃣ STEP 3: Atomic update with status guard (prevents double-processing)\n  const { error: updateError } = await supabaseAdmin\n    .from('orders')\n    .update({\n      razorpay_payment_id,\n      razorpay_signature,\n      status: 'COMPLETED',\n    })\n    .eq('id', orderId)\n    .eq('status', 'PAYMENT_PENDING') // 🔐 IDENTITY GUARD - only update if still pending\n\n  if (updateError) {\n    // Order already processed or not in PAYMENT_PENDING state\n    await trackPaymentError(updateError, orderId, {\n      userId: user.uid,\n      action: 'update_order_status',\n      paymentId: razorpay_payment_id,\n    })\n    return NextResponse.json(\n      { error: 'Order already processed or invalid state' },\n      { status: 409 }\n    )\n  }\n\n  const verifyDuration = Date.now() - verifyStartTime\n  logInfo.paymentVerificationComplete(orderId, verifyDuration)\n\n  // 5️⃣ Clear cart after payment is confirmed and stock is committed\n  // NON-CRITICAL: Cart state never affects payment success\n  try {\n    await clearCart(order.firebase_uid)\n    revalidatePath('/cart')\n    revalidatePath('/')\n  } catch (cartClearError) {\n    logWarn.paymentVerificationRetry(orderId, 1, cartClearError instanceof Error ? cartClearError.message : String(cartClearError))\n\n    await trackPaymentError(cartClearError, orderId, {\n      userId: user.uid,\n      action: 'clear_cart_after_payment',\n    })\n    // Cart clear failure does NOT affect payment success\n  }\n\n  return NextResponse.json({ success: true, orderId: order.id })\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\razorpay\\webhook\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2846,2849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2846,2849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2860,2863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2860,2863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2872,2875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2872,2875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3812,3815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3812,3815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3826,3829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3826,3829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3838,3841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3838,3841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4653,4656],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4653,4656],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4667,4670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4667,4670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5376,5379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5376,5379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5382,5385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5382,5385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\r\nimport crypto from 'crypto'\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\n\r\n/**\r\n * Razorpay Magic Checkout Webhook Handler\r\n * \r\n * Handles events from Razorpay:\r\n * - payment.captured (Prepaid payment success)\r\n * - order.paid (COD order confirmed)\r\n * - payment.failed (Payment failure)\r\n * \r\n * Stores ALL Magic Checkout metadata for admin use\r\n */\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const rawBody = await req.text()\r\n    const signature = req.headers.get('x-razorpay-signature')\r\n    \r\n    if (!signature) {\r\n      console.error('[WEBHOOK] Missing signature header')\r\n      return NextResponse.json({ error: 'Missing signature' }, { status: 400 })\r\n    }\r\n\r\n    // 1️⃣ VERIFY RAZORPAY SIGNATURE (CRITICAL)\r\n    const expectedSignature = crypto\r\n      .createHmac('sha256', process.env.RAZORPAY_WEBHOOK_SECRET!)\r\n      .update(rawBody)\r\n      .digest('hex')\r\n\r\n    if (expectedSignature !== signature) {\r\n      console.error('[WEBHOOK] Invalid signature')\r\n      return NextResponse.json({ error: 'Invalid signature' }, { status: 401 })\r\n    }\r\n\r\n    const event = JSON.parse(rawBody)\r\n    const eventType = event.event\r\n    const payload = event.payload\r\n\r\n    console.log('[WEBHOOK] Received event:', eventType)\r\n\r\n    // Extract order ID from notes\r\n    const notes = payload.order?.entity?.notes || payload.payment?.entity?.notes || {}\r\n    const internalOrderId = notes.internal_order_id\r\n\r\n    if (!internalOrderId) {\r\n      console.error('[WEBHOOK] Missing internal_order_id in notes')\r\n      return NextResponse.json({ error: 'Missing order ID' }, { status: 400 })\r\n    }\r\n\r\n    // Fetch order from database\r\n    const { data: order, error: fetchError } = await supabaseAdmin\r\n      .from('orders')\r\n      .select('*')\r\n      .eq('id', internalOrderId)\r\n      .single()\r\n\r\n    if (fetchError || !order) {\r\n      console.error('[WEBHOOK] Order not found:', internalOrderId)\r\n      return NextResponse.json({ error: 'Order not found' }, { status: 404 })\r\n    }\r\n\r\n    // 2️⃣ HANDLE DIFFERENT EVENT TYPES\r\n    switch (eventType) {\r\n      case 'payment.captured':\r\n        await handlePaymentCaptured(order, payload, event)\r\n        break\r\n\r\n      case 'order.paid':\r\n        await handleOrderPaid(order, payload, event)\r\n        break\r\n\r\n      case 'payment.failed':\r\n        await handlePaymentFailed(order, payload)\r\n        break\r\n\r\n      default:\r\n        console.log('[WEBHOOK] Unhandled event type:', eventType)\r\n    }\r\n\r\n    return NextResponse.json({ success: true })\r\n\r\n  } catch (error) {\r\n    console.error('[WEBHOOK] Error processing webhook:', error)\r\n    return NextResponse.json({ error: 'Webhook processing failed' }, { status: 500 })\r\n  }\r\n}\r\n\r\n/**\r\n * PREPAID PAYMENT SUCCESS\r\n */\r\nasync function handlePaymentCaptured(order: any, payload: any, event: any) {\r\n  const payment = payload.payment.entity\r\n  \r\n  console.log('[WEBHOOK] Processing payment.captured for order:', order.id)\r\n\r\n  // Extract address and customer details from payment\r\n  const customerDetails = payment.notes || {}\r\n  const shippingAddress = extractShippingAddress(payment)\r\n\r\n  // Update order with payment details\r\n  await supabaseAdmin\r\n    .from('orders')\r\n    .update({\r\n      status: 'PAYMENT_CONFIRMED',\r\n      payment_method: 'PREPAID',\r\n      is_cod: false,\r\n      razorpay_payment_id: payment.id,\r\n      shipping_address: shippingAddress,\r\n      customer_phone: customerDetails.phone || payment.contact,\r\n      gateway_notes: event, // Store full Razorpay payload\r\n    })\r\n    .eq('id', order.id)\r\n    .eq('status', 'PAYMENT_PENDING') // Only update if still pending\r\n\r\n  console.log('[WEBHOOK] Order updated to PAYMENT_CONFIRMED')\r\n}\r\n\r\n/**\r\n * COD ORDER CONFIRMED\r\n */\r\nasync function handleOrderPaid(order: any, payload: any, event: any) {\r\n  const orderEntity = payload.order.entity\r\n  \r\n  console.log('[WEBHOOK] Processing order.paid (COD) for order:', order.id)\r\n\r\n  // Extract COD metadata\r\n  const codFee = orderEntity.cod_fee || 0\r\n  const shippingAddress = extractShippingAddress(orderEntity)\r\n\r\n  // Update order with COD details\r\n  await supabaseAdmin\r\n    .from('orders')\r\n    .update({\r\n      status: 'COD_CONFIRMED',\r\n      payment_method: 'COD',\r\n      is_cod: true,\r\n      cod_fee: codFee,\r\n      shipping_address: shippingAddress,\r\n      customer_phone: orderEntity.notes?.phone,\r\n      gateway_notes: event, // Store full Razorpay payload\r\n    })\r\n    .eq('id', order.id)\r\n\r\n  console.log('[WEBHOOK] Order updated to COD_CONFIRMED with COD fee:', codFee)\r\n}\r\n\r\n/**\r\n * PAYMENT FAILED\r\n */\r\nasync function handlePaymentFailed(order: any, payload: any) {\r\n  console.log('[WEBHOOK] Processing payment.failed for order:', order.id)\r\n\r\n  // Release stock reservations\r\n  try {\r\n    await supabaseAdmin.rpc('release_reservation', {\r\n      p_order_id: order.id,\r\n    })\r\n    console.log('[WEBHOOK] Stock reservations released')\r\n  } catch (error) {\r\n    console.error('[WEBHOOK] Failed to release reservations:', error)\r\n  }\r\n\r\n  // Mark order as failed\r\n  await supabaseAdmin\r\n    .from('orders')\r\n    .update({\r\n      status: 'FAILED',\r\n      gateway_notes: payload,\r\n    })\r\n    .eq('id', order.id)\r\n\r\n  console.log('[WEBHOOK] Order marked as FAILED')\r\n}\r\n\r\n/**\r\n * Extract shipping address from Razorpay payload\r\n */\r\nfunction extractShippingAddress(entity: any): any {\r\n  const address = entity.customer_details?.shipping_address || entity.shipping_address\r\n\r\n  if (!address) return null\r\n\r\n  return {\r\n    fullName: entity.customer_details?.name || '',\r\n    addressLine1: address.line1 || '',\r\n    addressLine2: address.line2 || '',\r\n    city: address.city || '',\r\n    state: address.state || '',\r\n    pincode: address.zipcode || address.postal_code || '',\r\n    country: address.country || 'India',\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\shipping\\pincode\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\api\\shiprocket\\webhook\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'activities' is assigned a value but never used.","line":44,"column":75,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":85},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2093,2096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2093,2096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\r\nimport crypto from 'crypto'\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\nimport { mapShiprocketStatus } from '@/lib/shiprocket/shipment'\r\n\r\n/**\r\n * Shiprocket Webhook Handler\r\n * \r\n * Receives tracking updates from Shiprocket\r\n * Updates order shipment status in database\r\n * \r\n * Events handled:\r\n * - SHIPMENT_CREATED\r\n * - PICKUP_SCHEDULED\r\n * - PICKED_UP\r\n * - IN_TRANSIT\r\n * - OUT_FOR_DELIVERY\r\n * - DELIVERED\r\n * - RTO_INITIATED\r\n * - RTO_DELIVERED\r\n */\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const rawBody = await req.text()\r\n    const signature = req.headers.get('x-shiprocket-signature')\r\n\r\n    // Verify webhook signature (if Shiprocket provides one)\r\n    if (process.env.SHIPROCKET_WEBHOOK_SECRET && signature) {\r\n      const expectedSignature = crypto\r\n        .createHmac('sha256', process.env.SHIPROCKET_WEBHOOK_SECRET)\r\n        .update(rawBody)\r\n        .digest('hex')\r\n\r\n      if (expectedSignature !== signature) {\r\n        console.error('[SHIPROCKET_WEBHOOK] Invalid signature')\r\n        return NextResponse.json({ error: 'Invalid signature' }, { status: 401 })\r\n      }\r\n    }\r\n\r\n    const event = JSON.parse(rawBody)\r\n    console.log('[SHIPROCKET_WEBHOOK] Received event:', event.event)\r\n\r\n    const { data } = event\r\n    const { awb, order_id, shipment_status, current_status, courier_name, activities } = data\r\n\r\n    // Find order by Shiprocket order ID or AWB\r\n    const { data: order, error: orderError } = await supabaseAdmin\r\n      .from('orders')\r\n      .select('id, shipment_status')\r\n      .or(`shiprocket_order_id.eq.${order_id},tracking_id.eq.${awb}`)\r\n      .single()\r\n\r\n    if (orderError || !order) {\r\n      console.error('[SHIPROCKET_WEBHOOK] Order not found:', order_id, awb)\r\n      return NextResponse.json({ error: 'Order not found' }, { status: 404 })\r\n    }\r\n\r\n    // Map Shiprocket status to our internal status\r\n    const newStatus = mapShiprocketStatus(current_status || shipment_status)\r\n\r\n    // Update order with latest tracking info\r\n    const updateData: any = {\r\n      shipment_status: newStatus,\r\n      last_tracking_update: new Date().toISOString(),\r\n    }\r\n\r\n    // Update courier name if provided\r\n    if (courier_name) {\r\n      updateData.courier_name = courier_name\r\n    }\r\n\r\n    // Update tracking ID if provided\r\n    if (awb && !order.tracking_id) {\r\n      updateData.tracking_id = awb\r\n    }\r\n\r\n    // Set delivery date if delivered\r\n    if (newStatus === 'DELIVERED' && !order.actual_delivery_date) {\r\n      updateData.actual_delivery_date = new Date().toISOString().split('T')[0]\r\n    }\r\n\r\n    await supabaseAdmin\r\n      .from('orders')\r\n      .update(updateData)\r\n      .eq('id', order.id)\r\n\r\n    console.log('[SHIPROCKET_WEBHOOK] Order updated:', order.id, 'Status:', newStatus)\r\n\r\n    return NextResponse.json({ success: true })\r\n\r\n  } catch (error) {\r\n    console.error('[SHIPROCKET_WEBHOOK] Error processing webhook:', error)\r\n    return NextResponse.json({ error: 'Webhook processing failed' }, { status: 500 })\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\robots.txt\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\app\\sitemap.xml\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\AdminNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\AuthHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\BrandLogo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\ErrorBoundary.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[735,738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[735,738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":48,"column":31,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[1442,1577],"text":"\r\n                            We&apos;re sorry, but something unexpected happened. Please try refreshing the page.\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[1442,1577],"text":"\r\n                            We&lsquo;re sorry, but something unexpected happened. Please try refreshing the page.\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[1442,1577],"text":"\r\n                            We&#39;re sorry, but something unexpected happened. Please try refreshing the page.\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[1442,1577],"text":"\r\n                            We&rsquo;re sorry, but something unexpected happened. Please try refreshing the page.\r\n                        "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { Component, ReactNode } from 'react'\r\n\r\ninterface Props {\r\n    children: ReactNode\r\n    fallback?: ReactNode\r\n}\r\n\r\ninterface State {\r\n    hasError: boolean\r\n    error?: Error\r\n}\r\n\r\n/**\r\n * Error Boundary Component\r\n * Catches React errors in child components and displays fallback UI\r\n * Must be a class component as React doesn't support error boundaries with hooks yet\r\n */\r\nexport default class ErrorBoundary extends Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props)\r\n        this.state = { hasError: false }\r\n    }\r\n\r\n    static getDerivedStateFromError(error: Error): State {\r\n        return { hasError: true, error }\r\n    }\r\n\r\n    componentDidCatch(error: Error, errorInfo: any) {\r\n        console.error('Error Boundary caught:', error, errorInfo)\r\n    }\r\n\r\n    render() {\r\n        if (this.state.hasError) {\r\n            if (this.props.fallback) {\r\n                return this.props.fallback\r\n            }\r\n\r\n            return (\r\n                <div className=\"min-h-screen flex items-center justify-center bg-gray-50 px-4\">\r\n                    <div className=\"max-w-md w-full text-center\">\r\n                        <div className=\"text-6xl mb-4\">⚠️</div>\r\n                        <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n                            Something went wrong\r\n                        </h1>\r\n                        <p className=\"text-gray-600 mb-6\">\r\n                            We're sorry, but something unexpected happened. Please try refreshing the page.\r\n                        </p>\r\n                        <button\r\n                            onClick={() => window.location.reload()}\r\n                            className=\"px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors\"\r\n                        >\r\n                            Refresh Page\r\n                        </button>\r\n                        {process.env.NODE_ENV === 'development' && this.state.error && (\r\n                            <div className=\"mt-6 p-4 bg-red-50 border border-red-200 rounded-lg text-left\">\r\n                                <p className=\"text-sm font-mono text-red-900\">\r\n                                    {this.state.error.toString()}\r\n                                </p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )\r\n        }\r\n\r\n        return this.props.children\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\Footer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\Header.client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'links' is assigned a value but never used.","line":59,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport Link from 'next/link'\nimport { usePathname } from 'next/navigation'\nimport { useState } from 'react'\nimport BrandLogo from './BrandLogo'\n\nconst ShoppingBagIcon = ({ className = 'w-7 h-7' }: { className?: string }) => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    fill=\"none\"\n    viewBox=\"0 0 24 24\"\n    strokeWidth={1.5}\n    stroke=\"currentColor\"\n    className={className}\n    aria-hidden=\"true\"\n  >\n    <path\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n      d=\"M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 0 1-1.12-1.243l1.264-12A1.125 1.125 0 0 1 5.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zm7.5 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0z\"\n    />\n  </svg>\n)\n\nconst AccountIcon = ({ className = 'w-7 h-7' }: { className?: string }) => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    fill=\"none\"\n    viewBox=\"0 0 24 24\"\n    strokeWidth={1.5}\n    stroke=\"currentColor\"\n    className={className}\n    aria-hidden=\"true\"\n  >\n    <path\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n      d=\"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0L12 21m-4.017-2.275A5.963 5.963 0 0 1 12 15.75v-1.5\"\n    />\n  </svg>\n)\n\nconst MenuIcon = ({ className = 'w-7 h-7' }: { className?: string }) => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    fill=\"none\"\n    viewBox=\"0 0 24 24\"\n    strokeWidth={1.5}\n    stroke=\"currentColor\"\n    className={className}\n    aria-hidden=\"true\"\n  >\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M3.75 6.75h16.5M3.75 12h16.5M3.75 17.25h16.5\" />\n  </svg>\n)\n\n\nconst links = [\n  { href: '/shop', label: 'Shop' },\n  { href: '/new', label: 'New Arrivals' },\n  { href: '/men', label: 'Men' },\n  { href: '/women', label: 'Women' },\n  { href: '/collections', label: 'Collections' },\n  { href: '/about', label: 'About' },\n]\n\nexport default function HeaderClient({\n  isLoggedIn,\n  cartCount,\n  firstName,\n  categories = [],\n}: {\n  isLoggedIn: boolean\n  cartCount: number\n  firstName?: string\n  categories?: string[]\n}) {\n  const pathname = usePathname()\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false)\n\n  const isActive = (href: string) => pathname?.startsWith(href)\n\n  // Combined links: Static + Dynamic Categories\n  const navLinks = [\n    { href: '/shop', label: 'Shop' },\n    { href: '/new', label: 'New Arrivals' },\n    ...categories.map(cat => ({ href: `/shop?category=${encodeURIComponent(cat)}`, label: cat })),\n    { href: '/about', label: 'About' },\n  ]\n\n  return (\n    <header className=\"w-full border-b border-neutral-200 sticky top-0 bg-white z-50\">\n      <nav aria-label=\"Primary\" className=\"mx-auto max-w-7xl px-4 py-4 sm:px-6 lg:px-8\">\n        <div className=\"flex items-center justify-between gap-6\">\n          {/* Logo */}\n          <Link href=\"/\" className=\"flex items-center flex-shrink-0 text-neutral-900 hover:text-accent transition-colors duration-200\" aria-label=\"Home\">\n            <BrandLogo priority />\n          </Link>\n\n          {/* Desktop Navigation */}\n          <ul className=\"hidden md:flex items-center gap-8 font-inter text-sm font-medium text-neutral-900\">\n            {navLinks.map(({ href, label }) => (\n              <li key={label}>\n                <Link\n                  href={href}\n                  className={`relative py-1 transition-colors duration-200 after:absolute after:bottom-0 after:left-0 after:w-0 after:h-0.5 after:bg-accent after:transition-all after:duration-300 hover:after:w-full ${isActive(href) ? 'font-semibold' : ''\n                    }`}\n                >\n                  {label}\n                </Link>\n              </li>\n            ))}\n          </ul>\n\n          {/* Right Actions */}\n          <div className=\"flex items-center gap-4 ml-auto\">\n            {/* Desktop Account Link */}\n            <div className=\"hidden md:block\">\n              {isLoggedIn ? (\n                <Link\n                  href=\"/account\"\n                  className=\"font-inter text-sm font-medium text-neutral-900 hover:text-accent transition-colors duration-200\"\n                >\n                  {firstName ? `Hi, ${firstName}` : 'Account'}\n                </Link>\n              ) : (\n                <Link\n                  href=\"/auth/login\"\n                  className=\"font-inter text-sm font-medium text-neutral-900 hover:text-accent transition-colors duration-200\"\n                >\n                  Sign In\n                </Link>\n              )}\n            </div>\n\n            {/* Mobile Account Icon */}\n            <Link\n              href={isLoggedIn ? '/account' : '/auth/login'}\n              className=\"md:hidden text-neutral-900 hover:text-accent transition-colors duration-200\"\n              aria-label={isLoggedIn ? 'Account' : 'Sign In'}\n            >\n              <AccountIcon />\n            </Link>\n\n            {/* Shopping Bag */}\n            <Link\n              href=\"/cart\"\n              className=\"relative text-neutral-900 hover:text-accent transition-colors duration-200\"\n              aria-label={`Cart with ${cartCount} items`}\n            >\n              <ShoppingBagIcon />\n              {cartCount > 0 && (\n                <span className=\"absolute -top-2 -right-2 flex h-5 w-5 items-center justify-center rounded-full bg-neutral-900 text-xs font-semibold text-white\">\n                  {cartCount > 99 ? '99+' : cartCount}\n                </span>\n              )}\n            </Link>\n\n            {/* Mobile Menu Button */}\n            <button\n              type=\"button\"\n              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n              className=\"md:hidden text-neutral-900 hover:text-accent transition-colors duration-200 p-1\"\n              aria-controls=\"mobile-menu\"\n              aria-expanded={mobileMenuOpen}\n            >\n              <span className=\"sr-only\">Open main menu</span>\n              <MenuIcon />\n            </button>\n          </div>\n        </div>\n\n        {/* Mobile Menu */}\n        {mobileMenuOpen && (\n          <div className=\"md:hidden mt-4 border-t border-neutral-200 pt-4\" id=\"mobile-menu\">\n            <ul className=\"space-y-2\">\n              {navLinks.map(({ href, label }) => (\n                <li key={label}>\n                  <Link\n                    href={href}\n                    onClick={() => setMobileMenuOpen(false)}\n                    className={`block py-2 font-inter text-[15px] font-medium text-neutral-900 hover:text-accent transition-colors duration-200 ${isActive(href) ? 'font-semibold text-accent' : ''\n                      }`}\n                  >\n                    {label}\n                  </Link>\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n      </nav>\n    </header>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\Header.server.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\OrderFeedback.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\PhoneVerificationModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1050,1053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1050,1053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1495,1498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1495,1498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1553,1556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1553,1556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2275,2278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2275,2278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2885,2888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2885,2888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4166,4169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4166,4169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":175,"column":31,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[6323,6462],"text":"\r\n                            We&apos;ll send a 6-digit OTP to verify your phone number. Standard SMS rates may apply.\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[6323,6462],"text":"\r\n                            We&lsquo;ll send a 6-digit OTP to verify your phone number. Standard SMS rates may apply.\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[6323,6462],"text":"\r\n                            We&#39;ll send a 6-digit OTP to verify your phone number. Standard SMS rates may apply.\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[6323,6462],"text":"\r\n                            We&rsquo;ll send a 6-digit OTP to verify your phone number. Standard SMS rates may apply.\r\n                        "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { Phone, X, Loader2, CheckCircle, AlertCircle } from 'lucide-react'\r\nimport { RecaptchaVerifier, signInWithPhoneNumber, linkWithPhoneNumber } from 'firebase/auth'\r\nimport { auth } from '@/lib/firebase/client'\r\n\r\ninterface PhoneVerificationModalProps {\r\n    isOpen: boolean\r\n    onClose: () => void\r\n    phoneNumber: string\r\n    onVerified: () => void\r\n    verifyOnly?: boolean  // If true, only verify OTP without linking to account\r\n}\r\n\r\ntype VerificationState = 'IDLE' | 'SENDING_OTP' | 'OTP_SENT' | 'VERIFYING' | 'VERIFIED' | 'ERROR'\r\n\r\nexport default function PhoneVerificationModal({\r\n    isOpen,\r\n    onClose,\r\n    phoneNumber,\r\n    onVerified,\r\n    verifyOnly = false\r\n}: PhoneVerificationModalProps) {\r\n    const [state, setState] = useState<VerificationState>('IDLE')\r\n    const [otp, setOtp] = useState('')\r\n    const [error, setError] = useState('')\r\n    const [resendTimer, setResendTimer] = useState(0)\r\n    const [confirmationResult, setConfirmationResult] = useState<any>(null)\r\n\r\n    // Start resend timer\r\n    useEffect(() => {\r\n        if (resendTimer > 0) {\r\n            const timer = setTimeout(() => setResendTimer(resendTimer - 1), 1000)\r\n            return () => clearTimeout(timer)\r\n        }\r\n    }, [resendTimer])\r\n\r\n    // Setup reCAPTCHA on mount\r\n    useEffect(() => {\r\n        if (!isOpen) return\r\n\r\n        const setupRecaptcha = async () => {\r\n            try {\r\n                if (!(window as any).recaptchaVerifier) {\r\n                    (window as any).recaptchaVerifier = new RecaptchaVerifier(\r\n                        auth,\r\n                        'recaptcha-container',\r\n                        {\r\n                            size: 'invisible',\r\n                            callback: () => {\r\n                                // reCAPTCHA solved\r\n                            }\r\n                        }\r\n                    )\r\n                }\r\n            } catch (error) {\r\n                console.error('reCAPTCHA setup error:', error)\r\n            }\r\n        }\r\n\r\n        setupRecaptcha()\r\n    }, [isOpen])\r\n\r\n    const sendOTP = async () => {\r\n        setState('SENDING_OTP')\r\n        setError('')\r\n\r\n        try {\r\n            const appVerifier = (window as any).recaptchaVerifier\r\n            const user = auth.currentUser\r\n\r\n            if (!user) {\r\n                throw new Error('No authenticated user')\r\n            }\r\n\r\n            // Link phone to existing account (or just verify if verifyOnly)\r\n            const confirmation = verifyOnly\r\n                ? await signInWithPhoneNumber(auth, phoneNumber, appVerifier)\r\n                : await linkWithPhoneNumber(user, phoneNumber, appVerifier)\r\n            setConfirmationResult(confirmation)\r\n            setState('OTP_SENT')\r\n            setResendTimer(30) // 30 second cooldown\r\n        } catch (error: any) {\r\n            console.error('Send OTP error:', error)\r\n\r\n            let errorMessage = 'Failed to send OTP'\r\n            if (error.code === 'auth/too-many-requests') {\r\n                errorMessage = 'Too many attempts. Please try again later.'\r\n            } else if (error.code === 'auth/invalid-phone-number') {\r\n                errorMessage = 'Invalid phone number format'\r\n            } else if (error.code === 'auth/provider-already-linked') {\r\n                errorMessage = 'This phone is already linked to your account'\r\n                setState('VERIFIED')\r\n                setTimeout(() => onVerified(), 1000)\r\n                return\r\n            }\r\n\r\n            setError(errorMessage)\r\n            setState('ERROR')\r\n        }\r\n    }\r\n\r\n    const verifyOTP = async () => {\r\n        if (!confirmationResult || otp.length !== 6) {\r\n            setError('Please enter 6-digit OTP')\r\n            return\r\n        }\r\n\r\n        setState('VERIFYING')\r\n        setError('')\r\n\r\n        try {\r\n            await confirmationResult.confirm(otp)\r\n            setState('VERIFIED')\r\n\r\n            // Success - close modal and notify parent\r\n            setTimeout(() => {\r\n                onVerified()\r\n                onClose()\r\n            }, 1500)\r\n        } catch (error: any) {\r\n            console.error('Verify OTP error:', error)\r\n\r\n            let errorMessage = 'Invalid OTP'\r\n            if (error.code === 'auth/invalid-verification-code') {\r\n                errorMessage = 'Invalid OTP. Please check and try again.'\r\n            } else if (error.code === 'auth/code-expired') {\r\n                errorMessage = 'OTP expired. Please request a new one.'\r\n            }\r\n\r\n            setError(errorMessage)\r\n            setState('ERROR')\r\n        }\r\n    }\r\n\r\n    const handleResend = () => {\r\n        if (resendTimer > 0) return\r\n        setOtp('')\r\n        setState('IDLE')\r\n    }\r\n\r\n    if (!isOpen) return null\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n            <div className=\"bg-white rounded-xl max-w-md w-full p-6 relative animate-fade-in\">\r\n                {/* Close button */}\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"absolute top-4 right-4 p-2 hover:bg-gray-100 rounded-full transition-colors\"\r\n                    disabled={state === 'SENDING_OTP' || state === 'VERIFYING'}\r\n                >\r\n                    <X className=\"w-5 h-5 text-gray-500\" />\r\n                </button>\r\n\r\n                {/* Header */}\r\n                <div className=\"flex items-center gap-3 mb-6\">\r\n                    <div className=\"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center\">\r\n                        <Phone className=\"w-6 h-6 text-primary\" />\r\n                    </div>\r\n                    <div>\r\n                        <h2 className=\"text-xl font-bold text-gray-900\">Verify Phone Number</h2>\r\n                        <p className=\"text-sm text-gray-500\">{phoneNumber}</p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* reCAPTCHA container (invisible) */}\r\n                <div id=\"recaptcha-container\"></div>\r\n\r\n                {/* Content based on state */}\r\n                {(state === 'IDLE' || state === 'SENDING_OTP') && (\r\n                    <div className=\"space-y-4\">\r\n                        <p className=\"text-sm text-gray-600\">\r\n                            We'll send a 6-digit OTP to verify your phone number. Standard SMS rates may apply.\r\n                        </p>\r\n                        <button\r\n                            onClick={sendOTP}\r\n                            disabled={state === 'SENDING_OTP'}\r\n                            className=\"w-full py-3 bg-primary text-white font-semibold rounded-lg hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                        >\r\n                            {state === 'SENDING_OTP' ? (\r\n                                <>\r\n                                    <Loader2 className=\"w-5 h-5 animate-spin\" />\r\n                                    Sending OTP...\r\n                                </>\r\n                            ) : (\r\n                                'Send OTP'\r\n                            )}\r\n                        </button>\r\n                    </div>\r\n                )}\r\n\r\n                {(state === 'OTP_SENT' || state === 'VERIFYING') && (\r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Enter 6-digit OTP\r\n                            </label>\r\n                            <input\r\n                                type=\"text\"\r\n                                inputMode=\"numeric\"\r\n                                maxLength={6}\r\n                                value={otp}\r\n                                onChange={(e) => setOtp(e.target.value.replace(/\\D/g, ''))}\r\n                                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-center text-2xl tracking-widest\"\r\n                                placeholder=\"000000\"\r\n                                disabled={state === 'VERIFYING'}\r\n                                autoFocus\r\n                            />\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={verifyOTP}\r\n                            disabled={state === 'VERIFYING' || otp.length !== 6}\r\n                            className=\"w-full py-3 bg-primary text-white font-semibold rounded-lg hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                        >\r\n                            {state === 'VERIFYING' ? (\r\n                                <>\r\n                                    <Loader2 className=\"w-5 h-5 animate-spin\" />\r\n                                    Verifying...\r\n                                </>\r\n                            ) : (\r\n                                'Verify OTP'\r\n                            )}\r\n                        </button>\r\n\r\n                        {/* Resend */}\r\n                        <div className=\"text-center\">\r\n                            {resendTimer > 0 ? (\r\n                                <p className=\"text-sm text-gray-500\">\r\n                                    Resend OTP in {resendTimer}s\r\n                                </p>\r\n                            ) : (\r\n                                <button\r\n                                    onClick={handleResend}\r\n                                    className=\"text-sm text-primary font-semibold hover:underline\"\r\n                                >\r\n                                    Resend OTP\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {state === 'VERIFIED' && (\r\n                    <div className=\"text-center py-8\">\r\n                        <CheckCircle className=\"w-16 h-16 text-green-600 mx-auto mb-4\" />\r\n                        <h3 className=\"text-lg font-bold text-gray-900 mb-2\">Phone Verified!</h3>\r\n                        <p className=\"text-sm text-gray-600\">Your phone number has been successfully verified.</p>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Error message */}\r\n                {error && (\r\n                    <div className=\"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2\">\r\n                        <AlertCircle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\r\n                        <p className=\"text-sm text-red-800\">{error}</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\SizebookBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\Toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\VariantSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\admin\\BulkActions.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":36,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Check, Download } from 'lucide-react'\r\nimport toast from 'react-hot-toast'\r\n\r\ninterface BulkActionsProps {\r\n    selectedIds: string[]\r\n    onClearSelection: () => void\r\n    onStatusUpdate: (newStatus: string) => Promise<void>\r\n    onExport: () => void\r\n}\r\n\r\nexport default function BulkActions({\r\n    selectedIds,\r\n    onClearSelection,\r\n    onStatusUpdate,\r\n    onExport,\r\n}: BulkActionsProps) {\r\n    const [isUpdating, setIsUpdating] = useState(false)\r\n    const [showStatusModal, setShowStatusModal] = useState(false)\r\n    const [selectedStatus, setSelectedStatus] = useState('')\r\n\r\n    const handleStatusUpdate = async () => {\r\n        if (!selectedStatus) {\r\n            toast.error('Please select a status')\r\n            return\r\n        }\r\n\r\n        setIsUpdating(true)\r\n        try {\r\n            await onStatusUpdate(selectedStatus)\r\n            setShowStatusModal(false)\r\n            setSelectedStatus('')\r\n            toast.success(`Updated ${selectedIds.length} orders`)\r\n        } catch (error) {\r\n            toast.error('Failed to update orders')\r\n        } finally {\r\n            setIsUpdating(false)\r\n        }\r\n    }\r\n\r\n    if (selectedIds.length === 0) return null\r\n\r\n    return (\r\n        <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4 flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-2\">\r\n                <Check className=\"w-5 h-5 text-primary\" />\r\n                <span className=\"font-semibold text-gray-900\">\r\n                    {selectedIds.length} order{selectedIds.length !== 1 ? 's' : ''} selected\r\n                </span>\r\n                <button\r\n                    onClick={onClearSelection}\r\n                    className=\"text-sm text-gray-500 hover:text-gray-700 ml-2\"\r\n                >\r\n                    Clear\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"flex gap-2\">\r\n                <button\r\n                    onClick={() => setShowStatusModal(true)}\r\n                    className=\"px-4 py-2 bg-primary text-white rounded-md hover:bg-gray-900 font-semibold text-sm\"\r\n                >\r\n                    Update Status\r\n                </button>\r\n\r\n                <button\r\n                    onClick={onExport}\r\n                    className=\"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 font-semibold text-sm flex items-center gap-2\"\r\n                >\r\n                    <Download className=\"w-4 h-4\" />\r\n                    Export CSV\r\n                </button>\r\n            </div>\r\n\r\n            {/* Status Update Modal */}\r\n            {showStatusModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n                    <div className=\"bg-white rounded-lg p-6 max-w-md w-full mx-4\">\r\n                        <h3 className=\"text-lg font-bold text-gray-900 mb-4\">\r\n                            Update Order Status\r\n                        </h3>\r\n\r\n                        <p className=\"text-sm text-gray-600 mb-4\">\r\n                            Update {selectedIds.length} order{selectedIds.length !== 1 ? 's' : ''} to:\r\n                        </p>\r\n\r\n                        <select\r\n                            value={selectedStatus}\r\n                            onChange={(e) => setSelectedStatus(e.target.value)}\r\n                            className=\"w-full rounded-md border border-gray-300 px-3 py-2 mb-4\"\r\n                        >\r\n                            <option value=\"\">Select Status</option>\r\n                            <option value=\"PAYMENT_CONFIRMED\">Payment Confirmed</option>\r\n                            <option value=\"COD_CONFIRMED\">COD Confirmed</option>\r\n                            <option value=\"CANCELLED\">Cancelled</option>\r\n                            <option value=\"NEEDS_REVIEW\">Needs Review</option>\r\n                        </select>\r\n\r\n                        <div className=\"flex gap-2 justify-end\">\r\n                            <button\r\n                                onClick={() => setShowStatusModal(false)}\r\n                                disabled={isUpdating}\r\n                                className=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 font-semibold text-sm\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={handleStatusUpdate}\r\n                                disabled={isUpdating || !selectedStatus}\r\n                                className=\"px-4 py-2 bg-primary text-white rounded-md hover:bg-gray-900 font-semibold text-sm disabled:opacity-50\"\r\n                            >\r\n                                {isUpdating ? 'Updating...' : 'Confirm'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\admin\\OrderFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\admin\\ShippingInfoCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\admin\\products\\ProductForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":6,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HelpCircle' is defined but never used.","line":6,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GripVertical' is defined but never used.","line":6,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ImageIcon' is defined but never used.","line":6,"column":81,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":90},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supabase' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[876,879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[876,879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2313,2316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2313,2316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2404,2407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2404,2407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'variants'. Either include it or remove the dependency array.","line":150,"column":8,"nodeType":"ArrayExpression","endLine":150,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [options, hasVariants, price, variants]","fix":{"range":[5545,5574],"text":"[options, hasVariants, price, variants]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addOption' is assigned a value but never used.","line":152,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":152,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'removeOption' is assigned a value but never used.","line":153,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":153,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateOptionName' is assigned a value but never used.","line":155,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":155,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":178,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6643,6646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6643,6646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toastId' is assigned a value but never used.","line":192,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":192,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8940,8943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8940,8943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":347,"column":41,"nodeType":"JSXOpeningElement","endLine":347,"endColumn":121},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":432,"column":83,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[21875,21899],"text":"Customers won&apos;t see this"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[21875,21899],"text":"Customers won&lsquo;t see this"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[21875,21899],"text":"Customers won&#39;t see this"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[21875,21899],"text":"Customers won&rsquo;t see this"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'idx' is defined but never used.","line":489,"column":63,"nodeType":null,"messageId":"unusedVar","endLine":489,"endColumn":66}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect, useCallback, useRef } from 'react'\r\nimport Link from 'next/link'\r\nimport { useRouter } from 'next/navigation'\r\nimport { ArrowLeft, Plus, Upload, X, HelpCircle, GripVertical, Trash2, Image as ImageIcon } from 'lucide-react'\r\nimport { supabase } from '@/lib/supabase/client'\r\nimport { useToast } from '@/hooks/useToast'\r\nimport { uploadProductImage } from '@/lib/cloudinary/actions'\r\nimport { upsertProduct } from '@/app/(admin)/admin/products/actions'\r\n\r\n\r\ntype ProductOptions = {\r\n    id: string\r\n    name: string\r\n    values: string[]\r\n}\r\n\r\ntype ProductVariant = {\r\n    id: string\r\n    title: string\r\n    price: number\r\n    stock: number\r\n    sku: string\r\n    options: Record<string, string>\r\n}\r\n\r\ntype ProductImage = {\r\n    id: string\r\n    url: string\r\n    isPrimary?: boolean\r\n}\r\n\r\ntype ProductFormProps = {\r\n    initialData?: any\r\n    isEditing?: boolean\r\n}\r\n\r\nexport default function ProductForm({ initialData, isEditing = false }: ProductFormProps) {\r\n    const [isLoading, setIsLoading] = useState(false)\r\n    const [hasVariants, setHasVariants] = useState(isEditing ? (initialData?.variants?.length > 0) : false)\r\n\r\n    // Form State\r\n    const [title, setTitle] = useState(initialData?.title || '')\r\n    const [description, setDescription] = useState(initialData?.description || '')\r\n    const [price, setPrice] = useState(initialData?.price || '')\r\n    const [compareAtPrice, setCompareAtPrice] = useState(initialData?.compareAtPrice || '')\r\n    const [costPerItem, setCostPerItem] = useState(initialData?.costPerItem || '')\r\n    const [sku, setSku] = useState(initialData?.sku || '')\r\n    const [barcode, setBarcode] = useState(initialData?.barcode || '')\r\n\r\n    // Images State\r\n    const [images, setImages] = useState<ProductImage[]>(initialData?.images || [])\r\n    const fileInputRef = useRef<HTMLInputElement>(null)\r\n\r\n    // Variants State\r\n    // Variants State\r\n    // Force Size and Color to exist\r\n    const defaultOptions = [\r\n        { id: crypto.randomUUID(), name: 'Size', values: [] },\r\n        { id: crypto.randomUUID(), name: 'Color', values: [] }\r\n    ]\r\n\r\n    const mergedOptions = initialData?.options && initialData.options.length > 0\r\n        ? [\r\n            // Find existing or use default\r\n            initialData.options.find((o: any) => o.name === 'Size') || defaultOptions[0],\r\n            initialData.options.find((o: any) => o.name === 'Color') || defaultOptions[1]\r\n        ]\r\n        : defaultOptions\r\n\r\n    const [options, setOptions] = useState<ProductOptions[]>(mergedOptions)\r\n    const [variants, setVariants] = useState<ProductVariant[]>(initialData?.variants || [])\r\n\r\n    // --- Image Handling Logic ---\r\n    const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (e.target.files && e.target.files.length > 0) {\r\n            const newImages: ProductImage[] = Array.from(e.target.files).map(file => ({\r\n                id: crypto.randomUUID(),\r\n                url: URL.createObjectURL(file), // Create local preview URL\r\n                isPrimary: false\r\n            }))\r\n\r\n            // If it's the first image being added, make it primary\r\n            if (images.length === 0 && newImages.length > 0) {\r\n                newImages[0].isPrimary = true\r\n            }\r\n\r\n            setImages([...images, ...newImages])\r\n        }\r\n    }\r\n\r\n    const removeImage = (id: string) => {\r\n        const newImages = images.filter(img => img.id !== id)\r\n        // Reassign primary if the primary image was deleted\r\n        if (images.find(img => img.id === id)?.isPrimary && newImages.length > 0) {\r\n            newImages[0].isPrimary = true\r\n        }\r\n        setImages(newImages)\r\n    }\r\n\r\n    const setPrimaryImage = (id: string) => {\r\n        setImages(images.map(img => ({\r\n            ...img,\r\n            isPrimary: img.id === id\r\n        })))\r\n    }\r\n\r\n    // --- Variants Logic ---\r\n    useEffect(() => {\r\n        if (!hasVariants) return\r\n\r\n        const generateVariants = () => {\r\n            const validOptions = options.filter(opt => opt.name && opt.values.length > 0)\r\n            if (validOptions.length === 0) return []\r\n\r\n            const cartesian = (sets: string[][]) => {\r\n                return sets.reduce<string[][]>((acc, set) => {\r\n                    return acc.flatMap(x => set.map(y => [...x, y]))\r\n                }, [[]])\r\n            }\r\n\r\n            const combinations = cartesian(validOptions.map(opt => opt.values))\r\n\r\n            return combinations.map(combo => {\r\n                const variantOptions: Record<string, string> = {}\r\n                validOptions.forEach((opt, idx) => {\r\n                    variantOptions[opt.name] = combo[idx]\r\n                })\r\n\r\n                // Create a unique key for this combination to check for existing data\r\n                const comboKey = combo.join(' / ')\r\n                const existing = variants.find(v => v.title === comboKey)\r\n\r\n                return {\r\n                    id: existing?.id || crypto.randomUUID(),\r\n                    title: comboKey,\r\n                    price: existing?.price || Number(price) || 0,\r\n                    stock: existing?.stock || 0,\r\n                    sku: existing?.sku || '',\r\n                    options: variantOptions\r\n                }\r\n            })\r\n        }\r\n\r\n        const newVariants = generateVariants()\r\n        if (JSON.stringify(newVariants?.map(v => v.title)) !== JSON.stringify(variants.map(v => v.title))) {\r\n            setVariants(newVariants || [])\r\n        }\r\n    }, [options, hasVariants, price])\r\n\r\n    const addOption = () => setOptions([...options, { id: crypto.randomUUID(), name: '', values: [] }])\r\n    const removeOption = (id: string) => setOptions(options.filter(opt => opt.id !== id))\r\n\r\n    const updateOptionName = (id: string, name: string) => {\r\n        setOptions(options.map(opt => opt.id === id ? { ...opt, name } : opt))\r\n    }\r\n\r\n    const addOptionValue = (id: string, value: string) => {\r\n        if (!value.trim()) return\r\n        setOptions(options.map(opt => {\r\n            if (opt.id === id && !opt.values.includes(value.trim())) {\r\n                return { ...opt, values: [...opt.values, value.trim()] }\r\n            }\r\n            return opt\r\n        }))\r\n    }\r\n\r\n    const removeOptionValue = (id: string, valueToRemove: string) => {\r\n        setOptions(options.map(opt => {\r\n            if (opt.id === id) {\r\n                return { ...opt, values: opt.values.filter(v => v !== valueToRemove) }\r\n            }\r\n            return opt\r\n        }))\r\n    }\r\n\r\n    const updateVariant = (id: string, field: keyof ProductVariant, value: any) => {\r\n        setVariants(variants.map(v => v.id === id ? { ...v, [field]: value } : v))\r\n    }\r\n\r\n    const { showSuccess, showError, showLoading } = useToast()\r\n    const router = useRouter()\r\n\r\n    const handleSave = async () => {\r\n        if (!title) {\r\n            showError('Please enter a product title')\r\n            return\r\n        }\r\n\r\n        setIsLoading(true)\r\n        const toastId = showLoading('Saving product...')\r\n\r\n        try {\r\n            // 1. Upload new images\r\n            const uploadedImages = await Promise.all(images.map(async (img) => {\r\n                if (img.url.startsWith('blob:')) {\r\n                    const file = await fetch(img.url).then(r => r.blob())\r\n                    const formData = new FormData()\r\n                    formData.append('file', file)\r\n\r\n                    // Use Server Action for upload\r\n                    const data = await uploadProductImage(formData)\r\n\r\n                    if (!data || !data.secure_url) {\r\n                        throw new Error('Failed to upload image')\r\n                    }\r\n\r\n                    return { ...img, url: data.secure_url }\r\n                }\r\n                return img\r\n            }))\r\n\r\n            // 2. Prepare Product Data\r\n            const slug = title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '')\r\n            const productData = {\r\n                name: title,\r\n                slug,\r\n                description,\r\n                base_price: Number(price),\r\n                // compare_at_price: compareAtPrice ? Number(compareAtPrice) : null,\r\n                // cost_per_item: costPerItem ? Number(costPerItem) : null,\r\n                // sku, \r\n                is_active: true,\r\n                images: uploadedImages, // JSONB array\r\n                image_url: uploadedImages.find(i => i.isPrimary)?.url || uploadedImages[0]?.url || null\r\n            }\r\n\r\n            // 3. Call Server Action\r\n            const result = await upsertProduct(productData, variants, isEditing, initialData?.id)\r\n\r\n            if (!result.success) {\r\n                throw new Error(result.error)\r\n            }\r\n\r\n            showSuccess('Product saved successfully')\r\n            router.push('/admin/products')\r\n            router.refresh()\r\n        } catch (error: any) {\r\n            console.error('Error saving product:', error)\r\n            showError(error.message || 'Failed to save product')\r\n        } finally {\r\n            setIsLoading(false)\r\n            // toast.dismiss(toastId) // useToast dismiss might be needed if showLoading doesn't auto-dismiss\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-6xl mx-auto space-y-8 pb-20 animate-fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between sticky top-4 z-10 bg-gray-50/80 backdrop-blur-sm p-4 -mx-4 rounded-xl border border-gray-200/50 shadow-sm transition-all\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Link\r\n                        href=\"/admin/products\"\r\n                        className=\"p-2 hover:bg-white rounded-full transition-colors border border-transparent hover:border-gray-200\"\r\n                    >\r\n                        <ArrowLeft className=\"w-5 h-5 text-gray-500\" />\r\n                    </Link>\r\n                    <h1 className=\"text-2xl font-bold text-gray-900\">\r\n                        {isEditing ? 'Edit Product' : 'Add Product'}\r\n                    </h1>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    <Link\r\n                        href=\"/admin/products\"\r\n                        className=\"px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-white hover:text-gray-900 rounded-lg transition-colors border border-transparent hover:border-gray-300\"\r\n                    >\r\n                        Discard\r\n                    </Link>\r\n                    <button\r\n                        onClick={handleSave}\r\n                        className=\"px-6 py-2 bg-primary text-white text-sm font-bold rounded-lg hover:bg-gray-800 transition-all shadow-lg shadow-gray-900/10 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        disabled={isLoading}\r\n                    >\r\n                        {isLoading ? 'Saving...' : 'Save'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                {/* Left Column - Main Info */}\r\n                <div className=\"lg:col-span-2 space-y-6\">\r\n                    {/* Basic Info */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6 space-y-6\">\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-bold text-gray-700\">Title</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={title}\r\n                                onChange={(e) => setTitle(e.target.value)}\r\n                                placeholder=\"Short Sleeve T-Shirt\"\r\n                                className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-medium\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-bold text-gray-700\">Description</label>\r\n                            <div className=\"relative\">\r\n                                <textarea\r\n                                    rows={6}\r\n                                    value={description}\r\n                                    onChange={(e) => setDescription(e.target.value)}\r\n                                    placeholder=\"Describe your product...\"\r\n                                    className=\"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm resize-none\"\r\n                                />\r\n                                <div className=\"absolute bottom-3 right-3 flex gap-2\">\r\n                                    <button type=\"button\" className=\"p-1.5 text-gray-400 hover:text-gray-600 bg-white rounded border border-gray-200 hover:border-gray-300 transition-colors text-xs font-medium px-2\">\r\n                                        ✨ AI Generate\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Media Handling */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6 space-y-4\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <label className=\"text-sm font-bold text-gray-700\">Media</label>\r\n                            <button className=\"text-xs font-semibold text-primary hover:underline\">Add from URL</button>\r\n                        </div>\r\n\r\n                        {/* Hidden File Input */}\r\n                        <input\r\n                            type=\"file\"\r\n                            multiple\r\n                            accept=\"image/*\"\r\n                            ref={fileInputRef}\r\n                            onChange={handleFileSelect}\r\n                            className=\"hidden\"\r\n                        />\r\n\r\n                        {images.length === 0 ? (\r\n                            <div\r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                className=\"border-2 border-dashed border-gray-200 rounded-xl p-8 hover:bg-gray-50 transition-colors cursor-pointer group text-center\"\r\n                            >\r\n                                <div className=\"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform\">\r\n                                    <Upload className=\"w-5 h-5 text-gray-500\" />\r\n                                </div>\r\n                                <p className=\"text-sm font-medium text-gray-900\">Click to upload or drag and drop</p>\r\n                                <p className=\"text-xs text-gray-500 mt-1\">SVG, PNG, JPG or GIF (max. 800x400px)</p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"grid grid-cols-4 gap-4\">\r\n                                {images.map((img) => (\r\n                                    <div key={img.id} className=\"relative group aspect-square bg-gray-100 rounded-lg overflow-hidden border border-gray-200 shadow-sm\">\r\n                                        {/* Image Preview */}\r\n                                        <img src={img.url} alt=\"Product media\" className=\"w-full h-full object-cover\" />\r\n\r\n                                        {/* Primary Badge */}\r\n                                        {img.isPrimary && (\r\n                                            <div className=\"absolute top-2 left-2 bg-black/70 text-white text-[10px] font-bold px-2 py-1 rounded-md backdrop-blur-sm\">\r\n                                                Primary\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {/* Hover Actions */}\r\n                                        <div className=\"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2\">\r\n                                            {!img.isPrimary && (\r\n                                                <button\r\n                                                    onClick={() => setPrimaryImage(img.id)}\r\n                                                    className=\"px-3 py-1 bg-white text-xs font-bold rounded-full hover:bg-gray-100\"\r\n                                                >\r\n                                                    Set as Primary\r\n                                                </button>\r\n                                            )}\r\n                                            <button\r\n                                                onClick={() => removeImage(img.id)}\r\n                                                className=\"p-1.5 bg-white text-red-600 rounded-full hover:bg-red-50\"\r\n                                            >\r\n                                                <Trash2 className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n\r\n                                {/* Add More Button */}\r\n                                <button\r\n                                    onClick={() => fileInputRef.current?.click()}\r\n                                    className=\"aspect-square flex flex-col items-center justify-center border-2 border-dashed border-gray-200 rounded-lg hover:bg-gray-50 transition-colors\"\r\n                                >\r\n                                    <Upload className=\"w-5 h-5 text-gray-400 mb-1\" />\r\n                                    <span className=\"text-xs font-semibold text-gray-500\">Add</span>\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Pricing */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6\">\r\n                        <label className=\"text-sm font-bold text-gray-700 mb-4 block\">Pricing</label>\r\n                        <div className=\"grid grid-cols-2 gap-6\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Price</label>\r\n                                <div className=\"relative\">\r\n                                    <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-serif\">₹</span>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={price}\r\n                                        onChange={(e) => setPrice(e.target.value)}\r\n                                        placeholder=\"0.00\"\r\n                                        className=\"w-full pl-8 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-medium\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Compare-at price</label>\r\n                                <div className=\"relative\">\r\n                                    <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-serif\">₹</span>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={compareAtPrice}\r\n                                        onChange={(e) => setCompareAtPrice(e.target.value)}\r\n                                        placeholder=\"0.00\"\r\n                                        className=\"w-full pl-8 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-medium\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"mt-4 pt-4 border-t border-gray-100 grid grid-cols-2 gap-6\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Cost per item</label>\r\n                                <div className=\"relative\">\r\n                                    <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-serif\">₹</span>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={costPerItem}\r\n                                        onChange={(e) => setCostPerItem(e.target.value)}\r\n                                        placeholder=\"0.00\"\r\n                                        className=\"w-full pl-8 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-medium\"\r\n                                    />\r\n                                </div>\r\n                                <p className=\"text-xs text-gray-400\">Customers won't see this</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Inventory */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6 space-y-4\">\r\n                        <label className=\"text-sm font-bold text-gray-700\">Inventory</label>\r\n                        <div className=\"grid grid-cols-2 gap-6\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">SKU (Stock Keeping Unit)</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={sku}\r\n                                    onChange={(e) => setSku(e.target.value)}\r\n                                    className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-medium\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Barcode (ISBN, UPC, GTIN)</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={barcode}\r\n                                    onChange={(e) => setBarcode(e.target.value)}\r\n                                    className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-medium\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Variants */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6 space-y-6\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <label className=\"text-sm font-bold text-gray-700\">Variants</label>\r\n                            {!hasVariants && (\r\n                                <button\r\n                                    onClick={() => setHasVariants(true)}\r\n                                    className=\"text-xs font-semibold text-primary hover:underline\"\r\n                                >\r\n                                    + Add options like size or color\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            {!hasVariants ? (\r\n                                <p className=\"text-sm text-gray-500\">\r\n                                    This product currently has no variants. Add options to create variants.\r\n                                </p>\r\n                            ) : (\r\n                                <div className=\"space-y-6 animate-fade-in\">\r\n                                    {/* Options Management */}\r\n                                    <div className=\"border border-gray-200 rounded-xl p-4 space-y-4 bg-gray-50/50\">\r\n                                        <div className=\"flex items-center justify-between mb-2\">\r\n                                            <h3 className=\"text-sm font-bold text-gray-800\">Options</h3>\r\n                                        </div>\r\n\r\n                                        {options.map((option, idx) => (\r\n                                            <div key={option.id} className=\"bg-white p-4 rounded-lg border border-gray-200 shadow-sm space-y-3\">\r\n                                                <div className=\"flex items-center justify-between\">\r\n                                                    <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Option Name</label>\r\n                                                </div>\r\n                                                <input\r\n                                                    type=\"text\"\r\n                                                    value={option.name}\r\n                                                    readOnly\r\n                                                    className=\"w-full px-4 py-2.5 bg-gray-100 border border-gray-200 rounded-lg text-gray-500 text-sm font-medium cursor-not-allowed\"\r\n                                                />\r\n                                                <div className=\"space-y-2\">\r\n                                                    <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Option Values</label>\r\n                                                    <div className=\"flex flex-wrap gap-2\">\r\n                                                        {option.values.map(val => (\r\n                                                            <span key={val} className=\"inline-flex items-center gap-1.5 px-3 py-1 bg-gray-100 rounded-full text-xs font-medium text-gray-700 group\">\r\n                                                                {val}\r\n                                                                <button onClick={() => removeOptionValue(option.id, val)} className=\"text-gray-400 hover:text-gray-600\">\r\n                                                                    <X className=\"w-3 h-3\" />\r\n                                                                </button>\r\n                                                            </span>\r\n                                                        ))}\r\n                                                        <form\r\n                                                            onSubmit={(e) => {\r\n                                                                e.preventDefault()\r\n                                                                const input = e.currentTarget.elements.namedItem('valInput') as HTMLInputElement\r\n                                                                if (input.value) {\r\n                                                                    addOptionValue(option.id, input.value)\r\n                                                                    input.value = ''\r\n                                                                }\r\n                                                            }}\r\n                                                            className=\"inline-flex\"\r\n                                                        >\r\n                                                            <input\r\n                                                                name=\"valInput\"\r\n                                                                type=\"text\"\r\n                                                                placeholder={`Add ${option.name}...`}\r\n                                                                className=\"px-3 py-1 bg-white border border-gray-200 rounded-full text-xs focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none min-w-[100px]\"\r\n                                                                onBlur={(e) => {\r\n                                                                    if (e.target.value) {\r\n                                                                        addOptionValue(option.id, e.target.value)\r\n                                                                        e.target.value = ''\r\n                                                                    }\r\n                                                                }}\r\n                                                            />\r\n                                                        </form>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n\r\n                                    {/* Variants Table Preview */}\r\n                                    {variants.length > 0 && (\r\n                                        <div className=\"border border-gray-200 rounded-xl overflow-hidden shadow-sm\">\r\n                                            <div className=\"bg-gray-50 px-4 py-3 border-b border-gray-200 flex justify-between items-center\">\r\n                                                <h3 className=\"text-sm font-bold text-gray-800\">Preview Variants ({variants.length})</h3>\r\n                                            </div>\r\n                                            <div className=\"overflow-x-auto max-w-full\">\r\n                                                <table className=\"w-full text-sm text-left whitespace-nowrap\">\r\n                                                    <thead className=\"bg-gray-50 text-gray-500 font-medium border-b border-gray-200\">\r\n                                                        <tr>\r\n                                                            <th className=\"px-4 py-3 min-w-[150px]\">Variant</th>\r\n                                                            <th className=\"px-4 py-3 w-[150px]\">Price</th>\r\n                                                            <th className=\"px-4 py-3 w-[120px]\">Quantity</th>\r\n                                                            <th className=\"px-4 py-3 min-w-[150px]\">SKU</th>\r\n                                                            <th className=\"px-4 py-3 text-right w-[80px]\">Actions</th>\r\n                                                        </tr>\r\n                                                    </thead>\r\n                                                    <tbody className=\"divide-y divide-gray-100\">\r\n                                                        {variants.map((variant) => (\r\n                                                            <tr key={variant.id} className=\"bg-white hover:bg-gray-50 group transition-colors\">\r\n                                                                <td className=\"px-4 py-3 font-medium text-gray-900\">{variant.title}</td>\r\n                                                                <td className=\"px-4 py-3\">\r\n                                                                    <div className=\"relative\">\r\n                                                                        <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs\">₹</span>\r\n                                                                        <input\r\n                                                                            type=\"number\"\r\n                                                                            value={variant.price}\r\n                                                                            onChange={(e) => updateVariant(variant.id, 'price', Number(e.target.value))}\r\n                                                                            className=\"w-full pl-6 pr-2 py-1.5 bg-gray-50 border border-gray-200 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary outline-none\"\r\n                                                                        />\r\n                                                                    </div>\r\n                                                                </td>\r\n                                                                <td className=\"px-4 py-3\">\r\n                                                                    <input\r\n                                                                        type=\"number\"\r\n                                                                        value={variant.stock}\r\n                                                                        onChange={(e) => updateVariant(variant.id, 'stock', Number(e.target.value))}\r\n                                                                        className=\"w-full px-2 py-1.5 bg-gray-50 border border-gray-200 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary outline-none\"\r\n                                                                    />\r\n                                                                </td>\r\n                                                                <td className=\"px-4 py-3\">\r\n                                                                    <input\r\n                                                                        type=\"text\"\r\n                                                                        value={variant.sku}\r\n                                                                        onChange={(e) => updateVariant(variant.id, 'sku', e.target.value)}\r\n                                                                        placeholder=\"SKU\"\r\n                                                                        className=\"w-full px-2 py-1.5 bg-gray-50 border border-gray-200 rounded text-xs focus:ring-1 focus:ring-primary focus:border-primary outline-none\"\r\n                                                                    />\r\n                                                                </td>\r\n                                                                <td className=\"px-4 py-3 text-right\">\r\n                                                                    <button className=\"text-gray-400 hover:text-gray-600 p-1 rounded hover:bg-gray-100\">\r\n                                                                        <Trash2 className=\"w-4 h-4\" />\r\n                                                                    </button>\r\n                                                                </td>\r\n                                                            </tr>\r\n                                                        ))}\r\n                                                    </tbody>\r\n                                                </table>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Search Engine Listing */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6 space-y-4\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <label className=\"text-sm font-bold text-gray-700\">Search engine listing</label>\r\n                            <button className=\"text-xs font-semibold text-primary hover:underline\">Edit</button>\r\n                        </div>\r\n                        <p className=\"text-xs text-gray-500\">\r\n                            Add a title and description to see how this product might appear in a search engine listing.\r\n                        </p>\r\n                        <div className=\"bg-gray-50 p-4 rounded-lg border border-gray-100\">\r\n                            <h4 className=\"text-blue-600 text-sm font-medium hover:underline cursor-pointer truncate\">\r\n                                {title || 'Short Sleeve T-Shirt'}\r\n                            </h4>\r\n                            <p className=\"text-green-700 text-xs mt-0.5 truncate\">\r\n                                https://crownandcrest.com/products/{initialData?.id || 'short-sleeve-t-shirt'}\r\n                            </p>\r\n                            <p className=\"text-gray-500 text-xs mt-1 line-clamp-2\">\r\n                                {description || 'Describe your product...'}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right Column - Organization */}\r\n                <div className=\"space-y-6\">\r\n                    {/* Status */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6 space-y-4\">\r\n                        <label className=\"text-sm font-bold text-gray-700\">Status</label>\r\n                        <select className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-medium appearance-none\">\r\n                            <option value=\"active\">Active</option>\r\n                            <option value=\"draft\">Draft</option>\r\n                        </select>\r\n                        <p className=\"text-xs text-gray-500\">\r\n                            This product will be hidden from all sales channels.\r\n                        </p>\r\n                    </div>\r\n\r\n                    {/* Organization */}\r\n                    <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-6 space-y-6\">\r\n                        <label className=\"text-sm font-bold text-gray-700\">Product Organization</label>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Product Category</label>\r\n                            <select className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-medium\">\r\n                                <option>Apparel & Accessories</option>\r\n                                <option>Home & Garden</option>\r\n                                <option>Electronics</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Product Type</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"e.g. T-Shirt\"\r\n                                className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-medium\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Vendor</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"e.g. Nike\"\r\n                                className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-medium\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Collections</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Search collections...\"\r\n                                className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-medium\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Tags</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Vintage, Cotton, Summer\"\r\n                                className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm font-medium\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\ui\\Badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\ui\\Button.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tokens' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ButtonHTMLAttributes, forwardRef } from 'react'\r\nimport { tokens } from '@/lib/design/tokens'\r\n\r\n// ============================================\r\n// BUTTON VARIANTS (CANONICAL)\r\n// ============================================\r\n\r\ntype ButtonVariant = 'primary' | 'secondary' | 'ghost' | 'danger'\r\ntype ButtonSize = 'sm' | 'md' | 'lg'\r\n\r\ninterface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {\r\n  variant?: ButtonVariant\r\n  size?: ButtonSize\r\n  fullWidth?: boolean\r\n  loading?: boolean\r\n}\r\n\r\nexport const Button = forwardRef<HTMLButtonElement, ButtonProps>(\r\n  (\r\n    {\r\n      variant = 'primary',\r\n      size = 'md',\r\n      fullWidth = false,\r\n      loading = false,\r\n      disabled,\r\n      className = '',\r\n      children,\r\n      ...props\r\n    },\r\n    ref\r\n  ) => {\r\n    // MOBILE-FIRST: Full-width on mobile, inline on desktop\r\n    const baseStyles = `\r\n      w-full md:w-auto\r\n      inline-flex items-center justify-center\r\n      font-medium transition-all duration-200\r\n      disabled:opacity-50 disabled:cursor-not-allowed\r\n      focus:outline-none focus:ring-2 focus:ring-offset-2\r\n    `\r\n\r\n    const variantStyles = {\r\n      primary: `\r\n        bg-brand-black text-white\r\n        hover:bg-brand-darkGray\r\n        focus:ring-brand-black\r\n      `,\r\n      secondary: `\r\n        bg-white text-brand-black border border-neutral-200\r\n        hover:bg-neutral-50 hover:border-neutral-300\r\n        focus:ring-neutral-300\r\n      `,\r\n      ghost: `\r\n        bg-transparent text-brand-black\r\n        hover:bg-neutral-100\r\n        focus:ring-neutral-300\r\n      `,\r\n      danger: `\r\n        bg-status-error text-white\r\n        hover:bg-red-700\r\n        focus:ring-status-error\r\n      `,\r\n    }\r\n\r\n    // MOBILE-FIRST: 40px/44px/56px tap targets\r\n    const sizeStyles = {\r\n      sm: 'h-10 px-4 text-sm rounded-md',   /* 40px mobile tap target */\r\n      md: 'h-11 px-6 text-base rounded-lg', /* 44px mobile tap target */\r\n      lg: 'h-14 px-8 text-lg rounded-lg',   /* 56px large tap target */\r\n    }\r\n\r\n    // fullWidth prop overrides the mobile-first behavior\r\n    const widthStyle = fullWidth ? 'w-full md:w-full' : ''\r\n\r\n    return (\r\n      <button\r\n        ref={ref}\r\n        disabled={disabled || loading}\r\n        className={`\r\n          ${baseStyles}\r\n          ${variantStyles[variant]}\r\n          ${sizeStyles[size]}\r\n          ${widthStyle}\r\n          ${className}\r\n        `.trim().replace(/\\s+/g, ' ')}\r\n        {...props}\r\n      >\r\n        {loading ? (\r\n          <span className=\"inline-block w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin mr-2\" />\r\n        ) : null}\r\n        {children}\r\n      </button>\r\n    )\r\n  }\r\n)\r\n\r\nButton.displayName = 'Button'\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\ui\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\ui\\Input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\ui\\Modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\ui\\MonochromeButtons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\ui\\MonochromeCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\ui\\Table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\ui\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\components\\ui\\toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\hooks\\useToast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\hooks\\useVariantMedia.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\admin\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\admin\\order-actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1460,1463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1460,1463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2384,2387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2384,2387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3436,3439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3436,3439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":178,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4753,4756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4753,4756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Admin Order Management Actions\r\n// Server-only functions for order status updates and bulk operations\r\n\r\n'use server'\r\n\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\nimport { getCurrentUser } from '@/lib/auth'\r\nimport { OrderStatus } from '@/types/order'\r\nimport { createShipment } from '@/lib/shiprocket/shipment'\r\nimport { getTrackingDetails } from '@/lib/shiprocket/shipment'\r\n\r\n/**\r\n * Verify user has admin permissions\r\n */\r\nasync function requireAdmin(): Promise<string> {\r\n  const user = await getCurrentUser()\r\n  if (!user) {\r\n    throw new Error('Unauthorized')\r\n  }\r\n\r\n  const adminUids = process.env.ADMIN_UIDS?.split(',') || []\r\n  if (!adminUids.includes(user.uid)) {\r\n    throw new Error('Forbidden: Admin access required')\r\n  }\r\n\r\n  return user.uid\r\n}\r\n\r\n/**\r\n * Update order status\r\n */\r\nexport async function updateOrderStatus(\r\n  orderId: string,\r\n  newStatus: OrderStatus\r\n): Promise<{ success: boolean; error?: string }> {\r\n  try {\r\n    await requireAdmin()\r\n\r\n    const { error } = await supabaseAdmin\r\n      .from('orders')\r\n      .update({ \r\n        status: newStatus,\r\n        updated_at: new Date().toISOString(), \r\n      })\r\n      .eq('id', orderId)\r\n\r\n    if (error) {\r\n      console.error('[ADMIN] Error updating order status:', error)\r\n      return { success: false, error: error.message }\r\n    }\r\n\r\n    console.log('[ADMIN] Order status updated:', orderId, newStatus)\r\n    return { success: true }\r\n\r\n  } catch (error: any) {\r\n    console.error('[ADMIN] requireAdmin failed:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\n/**\r\n * Bulk update order status\r\n */\r\nexport async function bulkUpdateOrderStatus(\r\n  orderIds: string[],\r\n  newStatus: OrderStatus\r\n): Promise<{ success: boolean; count: number; error?: string }> {\r\n  try {\r\n    await requireAdmin()\r\n\r\n    const { data, error } = await supabaseAdmin\r\n      .from('orders')\r\n      .update({ \r\n        status: newStatus,\r\n        updated_at: new Date().toISOString(),\r\n      })\r\n      .in('id', orderIds)\r\n      .select('id')\r\n\r\n    if (error) {\r\n      console.error('[ADMIN] Error in bulk update:', error)\r\n      return { success: false, count: 0, error: error.message }\r\n    }\r\n\r\n    const count = data?.length || 0\r\n    console.log('[ADMIN] Bulk status update:', count, 'orders to', newStatus)\r\n    \r\n    return { success: true, count }\r\n\r\n  } catch (error: any) {\r\n    console.error('[ADMIN] requireAdmin failed:', error)\r\n    return { success: false, count: 0, error: error.message }\r\n  }\r\n}\r\n\r\n/**\r\n * Create Shiprocket shipment for an order\r\n */\r\nexport async function createShipmentForOrder(\r\n  orderId: string\r\n): Promise<{ success: boolean; error?: string; shipmentId?: number; awb?: string }> {\r\n  try {\r\n    await requireAdmin()\r\n\r\n    // Check if shipment already exists\r\n    const { data: order } = await supabaseAdmin\r\n      .from('orders')\r\n      .select('shiprocket_shipment_id, tracking_id')\r\n      .eq('id', orderId)\r\n      .single()\r\n\r\n    if (order?.shiprocket_shipment_id) {\r\n      return {\r\n        success: false,\r\n        error: 'Shipment already created for this order',\r\n      }\r\n    }\r\n\r\n    // Create shipment\r\n    const shipment = await createShipment(orderId)\r\n\r\n    console.log('[ADMIN] Shipment created:', shipment.shipmentId)\r\n    \r\n    return {\r\n      success: true,\r\n      shipmentId: shipment.shipmentId,\r\n      awb: shipment.awbCode || undefined,\r\n    }\r\n\r\n  } catch (error: any) {\r\n    console.error('[ADMIN] Error creating shipment:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\n/**\r\n * Refresh tracking info for an order\r\n */\r\nexport async function refreshTrackingInfo(\r\n  orderId: string\r\n): Promise<{ success: boolean; error?: string }> {\r\n  try {\r\n    await requireAdmin()\r\n\r\n    // Get order AWB\r\n    const { data: order } = await supabaseAdmin\r\n      .from('orders')\r\n      .select('tracking_id')\r\n      .eq('id', orderId)\r\n      .single()\r\n\r\n    if (!order?.tracking_id) {\r\n      return { success: false, error: 'No tracking ID found' }\r\n    }\r\n\r\n    // Fetch latest tracking data\r\n    const trackingData = await getTrackingDetails(order.tracking_id)\r\n\r\n    if (!trackingData) {\r\n      return { success: false, error: 'Failed to fetch tracking data' }\r\n    }\r\n\r\n    // Update order with latest tracking info\r\n    const latestActivity = trackingData.tracking_data.shipment_track_activities[0]\r\n    \r\n    await supabaseAdmin\r\n      .from('orders')\r\n      .update({\r\n        shipment_status: latestActivity?.sr_status_label || 'IN_TRANSIT',\r\n        last_tracking_update: new Date().toISOString(),\r\n      })\r\n      .eq('id', orderId)\r\n\r\n    console.log('[ADMIN] Tracking info refreshed for:', orderId)\r\n    \r\n    return { success: true }\r\n\r\n  } catch (error: any) {\r\n    console.error('[ADMIN] Error refreshing tracking:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\ai\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[733,736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[733,736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'imageUrl' is defined but never used.","line":181,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":181,"endColumn":11}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\r\n\r\nimport { generateText as generateTextFromClient } from './client'\r\nimport { generateWithFailover } from './failover'\r\n\r\n/**\r\n * AI Generation Actions\r\n * Server actions for AI-powered content generation with automatic failover\r\n */\r\n\r\nexport interface AIOptions {\r\n  temperature?: number\r\n  maxTokens?: number\r\n  model?: string\r\n}\r\n\r\nexport interface ImageAnalysis {\r\n  score: number\r\n  issues: string[]\r\n  suggestions: string[]\r\n  seoFriendly: boolean\r\n  altTextSuggestion?: string\r\n}\r\n\r\n// Export direct client for backward compatibility\r\nexport const generateTextDirect = generateTextFromClient\r\n\r\n// Use failover by default for production reliability\r\nexport const generateText = async (prompt: string, options?: any) => {\r\n  try {\r\n    // Try failover first for automatic model switching\r\n    const result = await generateWithFailover(prompt, options)\r\n    console.log(`[AI] Generated with ${result.modelUsed} after ${result.attemptCount} attempts`)\r\n    return result.content\r\n  } catch (error) {\r\n    // Fallback to direct generation if failover not configured\r\n    console.warn('[AI] Failover failed, using direct generation:', error)\r\n    return generateTextFromClient(prompt, options)\r\n  }\r\n}\r\n\r\n/**\r\n * Generate product description\r\n */\r\nexport async function generateProductDescription(\r\n  productName: string,\r\n  category: string,\r\n  tone: 'professional' | 'casual' | 'luxury' | 'technical' = 'professional'\r\n): Promise<string> {\r\n  const toneInstructions = {\r\n    professional: 'Write in a professional, informative tone suitable for business customers.',\r\n    casual: 'Write in a friendly, conversational tone that feels approachable.',\r\n    luxury: 'Write in an elegant, sophisticated tone emphasizing premium quality.',\r\n    technical: 'Write in a detailed, technical tone focusing on specifications and features.'\r\n  }\r\n\r\n  const prompt = `Write a compelling product description for an e-commerce product.\r\n\r\nProduct Name: ${productName}\r\nCategory: ${category}\r\nTone: ${tone}\r\n\r\n${toneInstructions[tone]}\r\n\r\nRequirements:\r\n- 2-3 paragraphs\r\n- Highlight key benefits and features\r\n- Include a call-to-action\r\n- SEO-friendly language\r\n- No pricing information\r\n\r\nDescription:`\r\n\r\n  return generateText(prompt, { temperature: 0.8, maxTokens: 300 })\r\n}\r\n\r\n/**\r\n * Generate SEO meta title\r\n */\r\nexport async function generateMetaTitle(\r\n  productName: string,\r\n  keywords: string[] = []\r\n): Promise<string> {\r\n  const keywordsText = keywords.length > 0 ? `\\nKeywords to include: ${keywords.join(', ')}` : ''\r\n  \r\n  const prompt = `Generate an SEO-optimized meta title for this product:\r\n\r\nProduct: ${productName}${keywordsText}\r\n\r\nRequirements:\r\n- Maximum 60 characters\r\n- Include primary keyword naturally\r\n- Compelling and click-worthy\r\n- No special characters except hyphens\r\n- Include brand mention if space allows\r\n\r\nMeta Title:`\r\n\r\n  const result = await generateText(prompt, { temperature: 0.7, maxTokens: 100 })\r\n  // Clean up and ensure length\r\n  return result.trim().substring(0, 60)\r\n}\r\n\r\n/**\r\n * Generate SEO meta description\r\n */\r\nexport async function generateMetaDescription(\r\n  productName: string,\r\n  description: string\r\n): Promise<string> {\r\n  const prompt = `Generate an SEO-optimized meta description for this product:\r\n\r\nProduct: ${productName}\r\nFull Description: ${description}\r\n\r\nRequirements:\r\n- 150-160 characters\r\n- Include primary keywords naturally\r\n- Compelling and informative\r\n- Include a subtle call-to-action\r\n- No special formatting\r\n\r\nMeta Description:`\r\n\r\n  const result = await generateText(prompt, { temperature: 0.7, maxTokens: 100 })\r\n  // Clean up and ensure length\r\n  return result.trim().substring(0, 160)\r\n}\r\n\r\n/**\r\n * Suggest keywords for product\r\n */\r\nexport async function suggestKeywords(\r\n  productName: string,\r\n  category: string\r\n): Promise<string[]> {\r\n  const prompt = `Suggest 5-7 SEO keywords for this e-commerce product:\r\n\r\nProduct: ${productName}\r\nCategory: ${category}\r\n\r\nReturn ONLY the keywords as a comma-separated list, no explanations.\r\n\r\nKeywords:`\r\n\r\n  const result = await generateText(prompt, { temperature: 0.6, maxTokens: 100 })\r\n  // Parse comma-separated keywords\r\n  return result.split(',').map(k => k.trim()).filter(k => k.length > 0)\r\n}\r\n\r\n/**\r\n * Generate alt text for product image\r\n */\r\nexport async function generateAltText(\r\n  productName: string,\r\n  imageContext?: string\r\n): Promise<string> {\r\n  const contextText = imageContext ? `\\nImage shows: ${imageContext}` : ''\r\n  \r\n  const prompt = `Generate descriptive alt text for a product image:\r\n\r\nProduct: ${productName}${contextText}\r\n\r\nRequirements:\r\n- Descriptive and specific\r\n- Include product name\r\n- 10-15 words maximum\r\n- SEO-friendly\r\n- No special characters\r\n\r\nAlt Text:`\r\n\r\n  const result = await generateText(prompt, { temperature: 0.6, maxTokens: 50 })\r\n  return result.trim()\r\n}\r\n\r\n/**\r\n * Analyze image quality (placeholder - would need vision API)\r\n */\r\nexport async function analyzeImageQuality(\r\n  imageUrl: string\r\n): Promise<ImageAnalysis> {\r\n  // This is a placeholder. Full implementation would require vision-capable models\r\n  // like GPT-4 Vision, Claude 3 Opus, or Google Gemini Vision\r\n  \r\n  return {\r\n    score: 85,\r\n    issues: [\r\n      'Resolution could be higher for zoom functionality',\r\n      'Background could be more neutral'\r\n    ],\r\n    suggestions: [\r\n      'Consider using a white or neutral background',\r\n      'Ensure image is at least 2000x2000px for best quality',\r\n      'Add lifestyle shots showing product in use'\r\n    ],\r\n    seoFriendly: true,\r\n    altTextSuggestion: await generateAltText('Product', 'shown from multiple angles')\r\n  }\r\n}\r\n\r\n/**\r\n * Calculate SEO score for product\r\n */\r\nexport async function calculateProductSEO(product: {\r\n  name?: string\r\n  description?: string\r\n  seo_title?: string\r\n  seo_description?: string\r\n  slug?: string\r\n}): Promise<{\r\n  overall: number\r\n  titleScore: number\r\n  descriptionScore: number\r\n  slugScore: number\r\n  contentScore: number\r\n  suggestions: string[]\r\n}> {\r\n  const suggestions: string[] = []\r\n  \r\n  // Title score (0-25 points)\r\n  let titleScore = 0\r\n  if (product.seo_title) {\r\n    titleScore += product.seo_title.length >= 30 && product.seo_title.length <= 60 ? 15 : 5\r\n    titleScore += product.name && product.seo_title.toLowerCase().includes(product.name.toLowerCase()) ? 10 : 0\r\n  } else {\r\n    suggestions.push('Add an SEO title (30-60 characters)')\r\n  }\r\n\r\n  // Description score (0-25 points)\r\n  let descriptionScore = 0\r\n  if (product.seo_description) {\r\n    descriptionScore += product.seo_description.length >= 120 && product.seo_description.length <= 160 ? 15 : 5\r\n    descriptionScore += product.name && product.seo_description.toLowerCase().includes(product.name.toLowerCase()) ? 10 : 0\r\n  } else {\r\n    suggestions.push('Add an SEO meta description (120-160 characters)')\r\n  }\r\n\r\n  // Slug score (0-20 points)\r\n  let slugScore = 0\r\n  if (product.slug) {\r\n    slugScore += product.slug.length > 0 && product.slug.length <= 60 ? 10 : 5\r\n    slugScore += /^[a-z0-9-]+$/.test(product.slug) ? 10 : 0\r\n  } else {\r\n    suggestions.push('Add a URL-friendly slug')\r\n  }\r\n\r\n  // Content score (0-30 points)\r\n  let contentScore = 0\r\n  if (product.description) {\r\n    contentScore += product.description.length >= 100 ? 15 : 5\r\n    contentScore += product.description.length >= 200 ? 15 : 0\r\n  } else {\r\n    suggestions.push('Add a detailed product description (200+ characters)')\r\n  }\r\n\r\n  const overall = titleScore + descriptionScore + slugScore + contentScore\r\n\r\n  if (overall < 70) {\r\n    suggestions.push('Overall SEO score is below recommended threshold')\r\n  }\r\n\r\n  return {\r\n    overall,\r\n    titleScore,\r\n    descriptionScore,\r\n    slugScore,\r\n    contentScore,\r\n    suggestions\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\ai\\client.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[730,733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[730,733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used.","line":91,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":91,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used.","line":124,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":124,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used.","line":209,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":209,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":257,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7756,7759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7756,7759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\r\n\r\nimport { getActiveApiKey } from '@/lib/ai/settings/actions'\r\n\r\n/**\r\n * Provider-Specific AI Clients\r\n * Each provider has its own API format and requirements\r\n */\r\n\r\nexport interface AIOptions {\r\n  temperature?: number\r\n  maxTokens?: number\r\n  model?: string\r\n}\r\n\r\n/**\r\n * OpenRouter Client\r\n * Uses OpenAI-compatible format with special headers\r\n * If no model is specified, OpenRouter will use your dashboard preset\r\n */\r\nasync function generateWithOpenRouter(\r\n  prompt: string,\r\n  apiKey: string,\r\n  options: AIOptions = {}\r\n): Promise<string> {\r\n  const siteUrl = process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'\r\n  \r\n  // Build request body - only include model if specified\r\n  const requestBody: any = {\r\n    messages: [{ role: 'user', content: prompt }],\r\n    temperature: options.temperature || 0.7,\r\n    max_tokens: options.maxTokens || 1000,\r\n  }\r\n  \r\n  // Only add model if explicitly provided, otherwise use OpenRouter preset\r\n  if (options.model) {\r\n    requestBody.model = options.model\r\n  }\r\n  \r\n  const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\r\n    method: 'POST',\r\n    headers: {\r\n      'Authorization': `Bearer ${apiKey}`,\r\n      'Content-Type': 'application/json',\r\n      'HTTP-Referer': siteUrl,\r\n      'X-Title': 'Crown and Crest Admin'\r\n    },\r\n    body: JSON.stringify(requestBody)\r\n  })\r\n\r\n  if (!response.ok) {\r\n    const errorText = await response.text()\r\n    console.error('OpenRouter error response:', errorText)\r\n    throw new Error(`OpenRouter API error: ${response.statusText}. ${errorText}`)\r\n  }\r\n\r\n  const data = await response.json()\r\n  \r\n  if (!data.choices || !data.choices[0] || !data.choices[0].message) {\r\n    console.error('Unexpected OpenRouter response:', data)\r\n    throw new Error('Invalid response format from OpenRouter')\r\n  }\r\n  \r\n  return data.choices[0].message.content || ''\r\n}\r\n\r\n/**\r\n * OpenAI Client\r\n * Standard OpenAI chat completions format\r\n */\r\nasync function generateWithOpenAI(\r\n  prompt: string,\r\n  apiKey: string,\r\n  options: AIOptions = {}\r\n): Promise<string> {\r\n  const response = await fetch('https://api.openai.com/v1/chat/completions', {\r\n    method: 'POST',\r\n    headers: {\r\n      'Authorization': `Bearer ${apiKey}`,\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify({\r\n      model: options.model || 'gpt-3.5-turbo',\r\n      messages: [{ role: 'user', content: prompt }],\r\n      temperature: options.temperature || 0.7,\r\n      max_tokens: options.maxTokens || 1000,\r\n    })\r\n  })\r\n\r\n  if (!response.ok) {\r\n    const error = await response.text()\r\n    throw new Error(`OpenAI API error: ${response.statusText}`)\r\n  }\r\n\r\n  const data = await response.json()\r\n  return data.choices[0]?.message?.content || ''\r\n}\r\n\r\n/**\r\n * Anthropic Claude Client\r\n * Uses messages API with different format\r\n */\r\nasync function generateWithAnthropic(\r\n  prompt: string,\r\n  apiKey: string,\r\n  options: AIOptions = {}\r\n): Promise<string> {\r\n  const response = await fetch('https://api.anthropic.com/v1/messages', {\r\n    method: 'POST',\r\n    headers: {\r\n      'x-api-key': apiKey,\r\n      'anthropic-version': '2023-06-01',\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify({\r\n      model: options.model || 'claude-3-haiku-20240307',\r\n      messages: [{ role: 'user', content: prompt }],\r\n      temperature: options.temperature || 0.7,\r\n      max_tokens: options.maxTokens || 1000,\r\n    })\r\n  })\r\n\r\n  if (!response.ok) {\r\n    const error = await response.text()\r\n    throw new Error(`Anthropic API error: ${response.statusText}`)\r\n  }\r\n\r\n  const data = await response.json()\r\n  return data.content[0]?.text || ''\r\n}\r\n\r\n/**\r\n * Google Gemini Client\r\n * Uses generateContent endpoint with API key in URL\r\n */\r\nasync function generateWithGoogle(\r\n  prompt: string,\r\n  apiKey: string,\r\n  options: AIOptions = {}\r\n): Promise<string> {\r\n  const model = options.model || 'gemini-1.5-flash'\r\n  \r\n  // Ensure model has models/ prefix for the endpoint\r\n  const modelPath = model.startsWith('models/') ? model : `models/${model}`\r\n  \r\n  // Correct Google AI endpoint format\r\n  const endpoint = `https://generativelanguage.googleapis.com/v1beta/${modelPath}:generateContent?key=${apiKey}`\r\n  \r\n  console.log('[Google Gemini] Using model:', model)\r\n  console.log('[Google Gemini] Endpoint:', endpoint.replace(apiKey, 'API_KEY_HIDDEN'))\r\n  \r\n  const response = await fetch(endpoint, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify({\r\n      contents: [{\r\n        parts: [{ text: prompt }]\r\n      }],\r\n      generationConfig: {\r\n        temperature: options.temperature || 0.7,\r\n        maxOutputTokens: options.maxTokens || 1000,\r\n      }\r\n    })\r\n  })\r\n\r\n  if (!response.ok) {\r\n    const errorText = await response.text()\r\n    console.error('[Google Gemini] Error response:', errorText)\r\n    throw new Error(`Google Gemini API error: ${response.statusText}. ${errorText}`)\r\n  }\r\n\r\n  const data = await response.json()\r\n  console.log('[Google Gemini] Response:', JSON.stringify(data).substring(0, 200))\r\n  \r\n  if (!data.candidates || !data.candidates[0]?.content?.parts?.[0]?.text) {\r\n    console.error('[Google Gemini] Unexpected response format:', data)\r\n    throw new Error('Invalid response format from Google Gemini')\r\n  }\r\n  \r\n  return data.candidates[0].content.parts[0].text\r\n}\r\n\r\n/**\r\n * Cohere Client\r\n * Uses generate endpoint with different format\r\n */\r\nasync function generateWithCohere(\r\n  prompt: string,\r\n  apiKey: string,\r\n  options: AIOptions = {}\r\n): Promise<string> {\r\n  const response = await fetch('https://api.cohere.ai/v1/generate', {\r\n    method: 'POST',\r\n    headers: {\r\n      'Authorization': `Bearer ${apiKey}`,\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify({\r\n      model: options.model || 'command-r',\r\n      prompt: prompt,\r\n      temperature: options.temperature || 0.7,\r\n      max_tokens: options.maxTokens || 1000,\r\n    })\r\n  })\r\n\r\n  if (!response.ok) {\r\n    const error = await response.text()\r\n    throw new Error(`Cohere API error: ${response.statusText}`)\r\n  }\r\n\r\n  const data = await response.json()\r\n  return data.generations[0]?.text || ''\r\n}\r\n\r\n/**\r\n * Universal AI Client - automatically routes to correct provider\r\n */\r\nexport async function generateText(\r\n  prompt: string,\r\n  options: AIOptions = {}\r\n): Promise<string> {\r\n  const activeKey = await getActiveApiKey()\r\n  \r\n  if (!activeKey) {\r\n    throw new Error('No active AI provider configured. Please set up AI in settings.')\r\n  }\r\n\r\n  // For OpenRouter: Don't pass model if not selected - let OpenRouter use dashboard preset\r\n  // For other providers: Use model from database or default\r\n  const modelToUse = activeKey.provider === 'openrouter' \r\n    ? options.model \r\n    : (options.model || activeKey.model)\r\n\r\n  try {\r\n    switch (activeKey.provider) {\r\n      case 'openrouter':\r\n        // Pass options without forcing a model if none selected\r\n        return await generateWithOpenRouter(prompt, activeKey.apiKey, { ...options, model: modelToUse })\r\n      \r\n      case 'openai':\r\n        return await generateWithOpenAI(prompt, activeKey.apiKey, { ...options, model: modelToUse })\r\n      \r\n      case 'anthropic':\r\n        return await generateWithAnthropic(prompt, activeKey.apiKey, { ...options, model: modelToUse })\r\n      \r\n      case 'google':\r\n        return await generateWithGoogle(prompt, activeKey.apiKey, { ...options, model: modelToUse })\r\n      \r\n      case 'cohere':\r\n        return await generateWithCohere(prompt, activeKey.apiKey, { ...options, model: modelToUse })\r\n      \r\n      default:\r\n        throw new Error(`Unsupported provider: ${activeKey.provider}`)\r\n    }\r\n  } catch (error: any) {\r\n    console.error('AI generation error:', error)\r\n    throw new Error(error.message || 'Failed to generate content')\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\ai\\failover.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2468,2471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2468,2471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5253,5256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5253,5256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5544,5547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5544,5547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * AI Failover System\r\n * Intelligent multi-model failover with automatic rate limit handling\r\n */\r\n\r\nimport { generateText } from './client'\r\nimport type { AIOptions } from './client'\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\nimport { createNotification, logAIUsage } from '@/lib/notifications/actions'\r\nimport { decrypt } from '@/lib/utils/encryption'\r\n\r\ninterface FailoverConfig {\r\n  provider: string\r\n  apiKey: string\r\n  models: string[]\r\n  priority: string[]\r\n  healthStatus: Record<string, ModelHealth>\r\n}\r\n\r\ninterface ModelHealth {\r\n  available: boolean\r\n  lastCheck: string\r\n  errorCount: number\r\n  lastError?: string\r\n}\r\n\r\ninterface FailoverResult {\r\n  content: string\r\n  modelUsed: string\r\n  attemptCount: number\r\n  failedModels: string[]\r\n  latency: number\r\n}\r\n\r\n/**\r\n * Generate content with automatic failover\r\n * Tries models in priority order until one succeeds\r\n */\r\nexport async function generateWithFailover(\r\n  prompt: string,\r\n  options: AIOptions = {}\r\n): Promise<FailoverResult> {\r\n  const startTime = Date.now()\r\n  \r\n  console.log('[Failover] Starting generation with failover...')\r\n  \r\n  // Get active API key configuration\r\n  const config = await getFailoverConfig()\r\n  \r\n  if (!config || config.priority.length === 0) {\r\n    throw new Error('No AI models configured for failover')\r\n  }\r\n\r\n  const failedModels: string[] = []\r\n  let attemptCount = 0\r\n\r\n  // Try models in priority order\r\n  for (const modelId of config.priority) {\r\n    // Skip if model is known to be unhealthy\r\n    if (config.healthStatus[modelId] && !config.healthStatus[modelId].available) {\r\n      console.log(`[Failover] Skipping unhealthy model: ${modelId}`)\r\n      continue\r\n    }\r\n\r\n    attemptCount++\r\n    const attemptStart = Date.now()\r\n    console.log(`[Failover] Attempt ${attemptCount}: Trying model ${modelId}`)\r\n    \r\n    try {\r\n      // Try to generate with this model\r\n      const content = await generateText(prompt, {\r\n        ...options,\r\n        model: modelId\r\n      })\r\n\r\n      const latency = Date.now() - attemptStart\r\n      const totalTime = Date.now() - startTime\r\n\r\n      console.log(`[Failover] ✓ Success with ${modelId} (${latency}ms)`)\r\n      \r\n      // Log successful usage\r\n      await logAIUsage(config.provider, modelId, true, undefined, latency)\r\n      \r\n      return {\r\n        content,\r\n        modelUsed: modelId,\r\n        attemptCount,\r\n        failedModels,\r\n        latency: totalTime\r\n      }\r\n    } catch (error: any) {\r\n      const latency = Date.now() - attemptStart\r\n      failedModels.push(modelId)\r\n      \r\n      console.error(`[Failover] ✗ Failed with ${modelId}:`, error.message)\r\n      \r\n      // Detect error type\r\n      const errorType = detectErrorType(error)\r\n      \r\n      // Log failed usage\r\n      await logAIUsage(config.provider, modelId, false, errorType, latency)\r\n\r\n      // Handle different error types\r\n      if (errorType === 'rate_limit') {\r\n        console.log(`[Failover] Rate limit hit on ${modelId}, trying next model...`)\r\n        \r\n        await createNotification({\r\n          type: 'rate_limit',\r\n          severity: 'warning',\r\n          model_id: modelId,\r\n          message: `Rate limit reached for ${modelId}`,\r\n          details: { \r\n            failedModels,\r\n            nextModel: config.priority[attemptCount] || 'none'\r\n          }\r\n        })\r\n        \r\n        // Continue to next model\r\n        continue\r\n      }\r\n\r\n      if (errorType === 'model_not_found') {\r\n        console.log(`[Failover] Model ${modelId} not found, marking as unhealthy`)\r\n        \r\n        await markModelUnhealthy(modelId, error.message)\r\n        \r\n        await createNotification({\r\n          type: 'model_deleted',\r\n          severity: 'error',\r\n          model_id: modelId,\r\n          message: `Model ${modelId} is no longer available`,\r\n          details: { error: error.message }\r\n        })\r\n        \r\n        // Continue to next model\r\n        continue\r\n      }\r\n\r\n      // For other errors, still try next model\r\n      console.log(`[Failover] Error type: ${errorType}, continuing to next model`)\r\n      continue\r\n    }\r\n  }\r\n\r\n  // All models failed\r\n  console.error('[Failover] All models failed!')\r\n  \r\n  await createNotification({\r\n    type: 'failover',\r\n    severity: 'critical',\r\n    message: `All ${config.priority.length} AI models failed`,\r\n    details: { \r\n      failedModels,\r\n      attemptCount\r\n    }\r\n  })\r\n  \r\n  throw new Error(`All AI models failed after ${attemptCount} attempts. Please check AI settings.`)\r\n}\r\n\r\n/**\r\n * Get failover configuration from active API key\r\n */\r\nasync function getFailoverConfig(): Promise<FailoverConfig | null> {\r\n  const { data: activeKey } = await supabaseAdmin\r\n    .from('ai_api_keys')\r\n    .select(`\r\n      id,\r\n      encrypted_key,\r\n      selected_models,\r\n      model_priority,\r\n      health_status,\r\n      ai_providers!inner (\r\n        name\r\n      )\r\n    `)\r\n    .eq('is_active', true)\r\n    .single()\r\n\r\n  if (!activeKey) {\r\n    return null\r\n  }\r\n\r\n  // Decrypt API key\r\n  const encryptionKey = process.env.AI_ENCRYPTION_KEY\r\n  if (!encryptionKey) {\r\n    throw new Error('AI_ENCRYPTION_KEY not set')\r\n  }\r\n\r\n  const apiKey = decrypt(activeKey.encrypted_key)\r\n\r\n  return {\r\n    provider: (activeKey.ai_providers as any).name,\r\n    apiKey,\r\n    models: activeKey.selected_models || [],\r\n    priority: activeKey.model_priority || (activeKey.selected_models || []),\r\n    healthStatus: activeKey.health_status || {}\r\n  }\r\n}\r\n\r\n/**\r\n * Detect error type from error message\r\n */\r\nfunction detectErrorType(error: any): string {\r\n  const msg = error.message?.toLowerCase() || ''\r\n  \r\n  if (msg.includes('rate limit') || msg.includes('429') || msg.includes('too many requests')) {\r\n    return 'rate_limit'\r\n  }\r\n  \r\n  if (msg.includes('quota') || msg.includes('insufficient')) {\r\n    return 'quota_exceeded'\r\n  }\r\n  \r\n  if (msg.includes('not found') || msg.includes('404') || msg.includes('does not exist')) {\r\n    return 'model_not_found'\r\n  }\r\n  \r\n  if (msg.includes('unauthorized') || msg.includes('401') || msg.includes('invalid api key')) {\r\n    return 'auth_error'\r\n  }\r\n  \r\n  if (msg.includes('timeout') || msg.includes('timed out')) {\r\n    return 'timeout'\r\n  }\r\n  \r\n  return 'unknown'\r\n}\r\n\r\n/**\r\n * Mark a model as unhealthy in the database\r\n */\r\nasync function markModelUnhealthy(modelId: string, error: string): Promise<void> {\r\n  const { data: activeKey } = await supabaseAdmin\r\n    .from('ai_api_keys')\r\n    .select('id, health_status')\r\n    .eq('is_active', true)\r\n    .single()\r\n\r\n  if (!activeKey) return\r\n\r\n  const healthStatus = activeKey.health_status || {}\r\n  \r\n  healthStatus[modelId] = {\r\n    available: false,\r\n    lastCheck: new Date().toISOString(),\r\n    errorCount: (healthStatus[modelId]?.errorCount || 0) + 1,\r\n    lastError: error\r\n  }\r\n\r\n  await supabaseAdmin\r\n    .from('ai_api_keys')\r\n    .update({ health_status: healthStatus })\r\n    .eq('id', activeKey.id)\r\n}\r\n\r\n/**\r\n * Update health status for a model\r\n */\r\nexport async function updateModelHealth(\r\n  modelId: string,\r\n  available: boolean,\r\n  error?: string\r\n): Promise<void> {\r\n  const { data: activeKey } = await supabaseAdmin\r\n    .from('ai_api_keys')\r\n    .select('id, health_status')\r\n    .eq('is_active', true)\r\n    .single()\r\n\r\n  if (!activeKey) return\r\n\r\n  const healthStatus = activeKey.health_status || {}\r\n  \r\n  healthStatus[modelId] = {\r\n    available,\r\n    lastCheck: new Date().toISOString(),\r\n    errorCount: available ? 0 : (healthStatus[modelId]?.errorCount || 0) + 1,\r\n    lastError: error\r\n  }\r\n\r\n  await supabaseAdmin\r\n    .from('ai_api_keys')\r\n    .update({ \r\n      health_status: healthStatus,\r\n      last_health_check: new Date().toISOString()\r\n    })\r\n    .eq('id', activeKey.id)\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\ai\\health-monitor.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[549,552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[549,552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[974,977],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[974,977],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3628,3631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3628,3631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4075,4078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4075,4078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * AI Health Monitoring System\r\n * Periodically checks model availability and updates health status\r\n */\r\n\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\nimport { testModelConnection } from './settings/discovery-actions'\r\nimport { updateModelHealth } from './failover'\r\nimport { createNotification } from '@/lib/notifications/actions'\r\nimport { decrypt } from '@/lib/utils/encryption'\r\n\r\ninterface ActiveKey {\r\n  id: string\r\n  provider_name: string\r\n  encrypted_key: string\r\n  selected_models: string[]\r\n  health_status: Record<string, any>\r\n}\r\n\r\n/**\r\n * Get all active API keys with their models\r\n */\r\nasync function getActiveApiKeys(): Promise<ActiveKey[]> {\r\n  const { data } = await supabaseAdmin\r\n    .from('ai_api_keys')\r\n    .select(`\r\n      id,\r\n      encrypted_key,\r\n      selected_models,\r\n      health_status,\r\n      ai_providers!inner (\r\n        name\r\n      )\r\n    `)\r\n    .eq('is_active', true)\r\n\r\n  if (!data) return []\r\n\r\n  return data.map((key: any) => ({\r\n    id: key.id,\r\n    provider_name: key.ai_providers.name,\r\n    encrypted_key: key.encrypted_key,\r\n    selected_models: key.selected_models || [],\r\n    health_status: key.health_status || {}\r\n  }))\r\n}\r\n\r\n/**\r\n * Run health checks on all active models\r\n */\r\nexport async function runHealthCheck(): Promise<{\r\n  checked: number\r\n  healthy: number\r\n  unhealthy: number\r\n  errors: string[]\r\n}> {\r\n  console.log('[Health Monitor] Starting health check...')\r\n  \r\n  const encryptionKey = process.env.AI_ENCRYPTION_KEY\r\n  if (!encryptionKey) {\r\n    throw new Error('AI_ENCRYPTION_KEY not configured')\r\n  }\r\n\r\n  let checked = 0\r\n  let healthy = 0\r\n  let unhealthy = 0\r\n  const errors: string[] = []\r\n\r\n  try {\r\n    const activeKeys = await getActiveApiKeys()\r\n    console.log(`[Health Monitor] Checking ${activeKeys.length} active API keys`)\r\n\r\n    for (const key of activeKeys) {\r\n      const apiKey = decrypt(key.encrypted_key)\r\n      const models = key.selected_models\r\n\r\n      if (models.length === 0) {\r\n        console.log(`[Health Monitor] No models configured for ${key.provider_name}`)\r\n        continue\r\n      }\r\n\r\n      for (const modelId of models) {\r\n        checked++\r\n        console.log(`[Health Monitor] Testing ${key.provider_name}/${modelId}...`)\r\n\r\n        try {\r\n          const result = await testModelConnection(\r\n            key.provider_name,\r\n            apiKey,\r\n            modelId\r\n          )\r\n\r\n          // Update health status\r\n          await updateModelHealth(modelId, result.success, result.error)\r\n\r\n          if (result.success) {\r\n            healthy++\r\n            console.log(`[Health Monitor] ✓ ${modelId} is healthy`)\r\n          } else {\r\n            unhealthy++\r\n            console.log(`[Health Monitor] ✗ ${modelId} is unhealthy: ${result.error}`)\r\n\r\n            // Check if model was previously healthy (new failure)\r\n            const wasHealthy = key.health_status[modelId]?.available !== false\r\n\r\n            if (wasHealthy) {\r\n              // Create notification for newly failed model\r\n              await createNotification({\r\n                type: 'health_check_failed',\r\n                severity: 'error',\r\n                model_id: modelId,\r\n                message: `Health check failed for ${modelId}`,\r\n                details: {\r\n                  provider: key.provider_name,\r\n                  error: result.error,\r\n                  timestamp: result.timestamp\r\n                }\r\n              })\r\n            }\r\n          }\r\n\r\n          // Rate limit protection - wait 1 second between checks\r\n          await new Promise(resolve => setTimeout(resolve, 1000))\r\n        } catch (error: any) {\r\n          unhealthy++\r\n          errors.push(`${modelId}: ${error.message}`)\r\n          console.error(`[Health Monitor] Error testing ${modelId}:`, error)\r\n\r\n          await updateModelHealth(modelId, false, error.message)\r\n        }\r\n      }\r\n    }\r\n\r\n    console.log(`[Health Monitor] Complete: ${checked} checked, ${healthy} healthy, ${unhealthy} unhealthy`)\r\n    \r\n    return { checked, healthy, unhealthy, errors }\r\n  } catch (error: any) {\r\n    console.error('[Health Monitor] Fatal error:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n/**\r\n * Get health check statistics\r\n */\r\nexport async function getHealthStats(): Promise<{\r\n  totalModels: number\r\n  healthyModels: number\r\n  unhealthyModels: number\r\n  lastCheck?: string\r\n}> {\r\n  const { data } = await supabaseAdmin\r\n    .from('ai_api_keys')\r\n    .select('selected_models, health_status, last_health_check')\r\n    .eq('is_active', true)\r\n    .single()\r\n\r\n  if (!data) {\r\n    return {\r\n      totalModels: 0,\r\n      healthyModels: 0,\r\n      unhealthyModels: 0\r\n    }\r\n  }\r\n\r\n  const models = data.selected_models || []\r\n  const healthStatus = data.health_status || {}\r\n\r\n  const healthyModels = models.filter(\r\n    (modelId: string) => healthStatus[modelId]?.available !== false\r\n  ).length\r\n\r\n  return {\r\n    totalModels: models.length,\r\n    healthyModels,\r\n    unhealthyModels: models.length - healthyModels,\r\n    lastCheck: data.last_health_check\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\ai\\provider-config.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[978,981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[978,981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * AI Provider Configuration System\r\n * Defines provider-specific settings and requirements\r\n */\r\n\r\nexport interface ProviderConfig {\r\n  name: string\r\n  displayName: string\r\n  baseUrl: string\r\n  authType: 'bearer' | 'api-key' | 'url-param'\r\n  authHeaderName?: string // e.g., 'x-api-key' for Anthropic\r\n  requiresVersion?: boolean\r\n  versionHeaderName?: string\r\n  additionalHeaders?: Record<string, string>\r\n  defaultModel: string\r\n  availableModels: ModelOption[]\r\n  configFields: ConfigField[]\r\n  pricing: {\r\n    freeTier: boolean\r\n    description: string\r\n  }\r\n  documentation: string\r\n}\r\n\r\nexport interface ModelOption {\r\n  id: string\r\n  name: string\r\n  description: string\r\n  contextWindow: number\r\n  pricing?: string\r\n}\r\n\r\nexport interface ConfigField {\r\n  key: string\r\n  label: string\r\n  type: 'text' | 'select' | 'number' | 'toggle'\r\n  required: boolean\r\n  placeholder?: string\r\n  helpText?: string\r\n  options?: { value: string; label: string }[]\r\n  defaultValue?: any\r\n}\r\n\r\n/**\r\n * Provider Configurations\r\n * Each provider can have custom settings\r\n */\r\nexport const PROVIDER_CONFIGS: Record<string, ProviderConfig> = {\r\n  openrouter: {\r\n    name: 'openrouter',\r\n    displayName: 'OpenRouter',\r\n    baseUrl: 'https://openrouter.ai/api/v1',\r\n    authType: 'bearer',\r\n    defaultModel: 'meta-llama/llama-3.1-8b-instruct:free',\r\n    additionalHeaders: {\r\n      'HTTP-Referer': process.env.NEXT_PUBLIC_SITE_URL || '',\r\n      'X-Title': 'Crown and Crest Admin'\r\n    },\r\n    availableModels: [\r\n      {\r\n        id: 'meta-llama/llama-3.1-8b-instruct:free',\r\n        name: 'Llama 3.1 8B (Free)',\r\n        description: 'Fast, free model from Meta',\r\n        contextWindow: 8192,\r\n        pricing: 'Free'\r\n      },\r\n      {\r\n        id: 'google/gemini-flash-1.5:free',\r\n        name: 'Gemini 1.5 Flash (Free)',\r\n        description: 'Google\\'s fast model',\r\n        contextWindow: 32768,\r\n        pricing: 'Free'\r\n      },\r\n      {\r\n        id: 'anthropic/claude-3-haiku',\r\n        name: 'Claude 3 Haiku',\r\n        description: 'Fast, affordable Claude model',\r\n        contextWindow: 200000,\r\n        pricing: '$0.25/1M tokens'\r\n      },\r\n      {\r\n        id: 'anthropic/claude-3.5-sonnet',\r\n        name: 'Claude 3.5 Sonnet',\r\n        description: 'Best balance of speed and capability',\r\n        contextWindow: 200000,\r\n        pricing: '$3/1M input'\r\n      },\r\n      {\r\n        id: 'openai/gpt-4-turbo',\r\n        name: 'GPT-4 Turbo',\r\n        description: 'OpenAI\\'s most capable model',\r\n        contextWindow: 128000,\r\n        pricing: '$10/1M input'\r\n      }\r\n    ],\r\n    configFields: [\r\n      {\r\n        key: 'siteUrl',\r\n        label: 'Site URL',\r\n        type: 'text',\r\n        required: false,\r\n        placeholder: 'https://yoursite.com',\r\n        helpText: 'Optional: For rankings on openrouter.ai'\r\n      },\r\n      {\r\n        key: 'appTitle',\r\n        label: 'App Title',\r\n        type: 'text',\r\n        required: false,\r\n        placeholder: 'My E-commerce Site',\r\n        helpText: 'Optional: For rankings on openrouter.ai'\r\n      }\r\n    ],\r\n    pricing: {\r\n      freeTier: true,\r\n      description: 'Free models available, pay-per-use for premium models'\r\n    },\r\n    documentation: 'https://openrouter.ai/docs'\r\n  },\r\n\r\n  openai: {\r\n    name: 'openai',\r\n    displayName: 'OpenAI',\r\n    baseUrl: 'https://api.openai.com/v1',\r\n    authType: 'bearer',\r\n    defaultModel: 'gpt-3.5-turbo',\r\n    availableModels: [\r\n      {\r\n        id: 'gpt-3.5-turbo',\r\n        name: 'GPT-3.5 Turbo',\r\n        description: 'Fast and affordable',\r\n        contextWindow: 16385,\r\n        pricing: '$0.50/1M input, $1.50/1M output'\r\n      },\r\n      {\r\n        id: 'gpt-4-turbo',\r\n        name: 'GPT-4 Turbo',\r\n        description: 'Most capable, best for complex tasks',\r\n        contextWindow: 128000,\r\n        pricing: '$10/1M input, $30/1M output'\r\n      },\r\n      {\r\n        id: 'gpt-4o',\r\n        name: 'GPT-4o',\r\n        description: 'Multimodal, fast',\r\n        contextWindow: 128000,\r\n        pricing: '$5/1M input, $15/1M output'\r\n      }\r\n    ],\r\n    configFields: [\r\n      {\r\n        key: 'organization',\r\n        label: 'Organization ID',\r\n        type: 'text',\r\n        required: false,\r\n        placeholder: 'org-...',\r\n        helpText: 'Optional: For organization-specific API usage'\r\n      }\r\n    ],\r\n    pricing: {\r\n      freeTier: false,\r\n      description: 'Pay-as-you-go, requires billing setup'\r\n    },\r\n    documentation: 'https://platform.openai.com/docs'\r\n  },\r\n\r\n  anthropic: {\r\n    name: 'anthropic',\r\n    displayName: 'Anthropic Claude',\r\n    baseUrl: 'https://api.anthropic.com/v1',\r\n    authType: 'api-key',\r\n    authHeaderName: 'x-api-key',\r\n    requiresVersion: true,\r\n    versionHeaderName: 'anthropic-version',\r\n    defaultModel: 'claude-3-haiku-20240307',\r\n    availableModels: [\r\n      {\r\n        id: 'claude-3-haiku-20240307',\r\n        name: 'Claude 3 Haiku',\r\n        description: 'Fastest, most affordable',\r\n        contextWindow: 200000,\r\n        pricing: '$0.25/1M input, $1.25/1M output'\r\n      },\r\n      {\r\n        id: 'claude-3-5-sonnet-20241022',\r\n        name: 'Claude 3.5 Sonnet',\r\n        description: 'Best balance of intelligence and speed',\r\n        contextWindow: 200000,\r\n        pricing: '$3/1M input, $15/1M output'\r\n      },\r\n      {\r\n        id: 'claude-3-opus-20240229',\r\n        name: 'Claude 3 Opus',\r\n        description: 'Most powerful, best for complex tasks',\r\n        contextWindow: 200000,\r\n        pricing: '$15/1M input, $75/1M output'\r\n      }\r\n    ],\r\n    configFields: [\r\n      {\r\n        key: 'version',\r\n        label: 'API Version',\r\n        type: 'select',\r\n        required: true,\r\n        options: [\r\n          { value: '2023-06-01', label: '2023-06-01 (Stable)' },\r\n          { value: '2023-01-01', label: '2023-01-01 (Legacy)' }\r\n        ],\r\n        defaultValue: '2023-06-01',\r\n        helpText: 'Anthropic API version'\r\n      }\r\n    ],\r\n    pricing: {\r\n      freeTier: false,\r\n      description: 'Pay-as-you-go, requires billing setup'\r\n    },\r\n    documentation: 'https://docs.anthropic.com/claude/reference'\r\n  },\r\n\r\n  google: {\r\n    name: 'google',\r\n    displayName: 'Google Gemini',\r\n    baseUrl: 'https://generativelanguage.googleapis.com/v1beta',\r\n    authType: 'url-param',\r\n    defaultModel: 'gemini-1.5-flash',\r\n    availableModels: [\r\n      {\r\n        id: 'gemini-1.5-flash',\r\n        name: 'Gemini 1.5 Flash',\r\n        description: 'Fast and efficient multimodal model',\r\n        contextWindow: 1000000,\r\n        pricing: 'Free up to 15 RPM'\r\n      },\r\n      {\r\n        id: 'gemini-1.5-pro',\r\n        name: 'Gemini 1.5 Pro',\r\n        description: 'Most capable with 2M context window',\r\n        contextWindow: 2000000,\r\n        pricing: 'Free up to 2 RPM, then $1.25/1M tokens'\r\n      },\r\n      {\r\n        id: 'gemini-1.5-flash-8b',\r\n        name: 'Gemini 1.5 Flash-8B',\r\n        description: 'Smallest and fastest',\r\n        contextWindow: 1000000,\r\n        pricing: 'Free'\r\n      }\r\n    ],\r\n    configFields: [\r\n      {\r\n        key: 'projectName',\r\n        label: 'Project Name',\r\n        type: 'text',\r\n        required: false,\r\n        placeholder: 'projects/458660769128',\r\n        helpText: 'Optional: Your Google Cloud project name (e.g., projects/123456789)'\r\n      },\r\n      {\r\n        key: 'projectNumber',\r\n        label: 'Project Number',\r\n        type: 'text',\r\n        required: false,\r\n        placeholder: '458660769128',\r\n        helpText: 'Optional: Your Google Cloud project number'\r\n      }\r\n    ],\r\n    pricing: {\r\n      freeTier: true,\r\n      description: 'Free tier: 15 requests/minute for Flash, 2 requests/minute for Pro'\r\n    },\r\n    documentation: 'https://ai.google.dev/docs'\r\n  },\r\n\r\n  cohere: {\r\n    name: 'cohere',\r\n    displayName: 'Cohere',\r\n    baseUrl: 'https://api.cohere.ai/v1',\r\n    authType: 'bearer',\r\n    defaultModel: 'command-r',\r\n    availableModels: [\r\n      {\r\n        id: 'command-r',\r\n        name: 'Command R',\r\n        description: 'Retrieval-augmented generation',\r\n        contextWindow: 128000,\r\n        pricing: '$0.50/1M input, $1.50/1M output'\r\n      },\r\n      {\r\n        id: 'command',\r\n        name: 'Command',\r\n        description: 'General purpose',\r\n        contextWindow: 4096,\r\n        pricing: '$1/1M tokens'\r\n      },\r\n      {\r\n        id: 'command-light',\r\n        name: 'Command Light',\r\n        description: 'Faster, lightweight',\r\n        contextWindow: 4096,\r\n        pricing: '$0.30/1M tokens'\r\n      }\r\n    ],\r\n    configFields: [],\r\n    pricing: {\r\n      freeTier: true,\r\n      description: 'Trial key: 1,000 calls/month free'\r\n    },\r\n    documentation: 'https://docs.cohere.com/reference/about'\r\n  }\r\n}\r\n\r\n/**\r\n * Get provider configuration by name\r\n */\r\nexport function getProviderConfig(providerName: string): ProviderConfig | null {\r\n  return PROVIDER_CONFIGS[providerName] || null\r\n}\r\n\r\n/**\r\n * Get all provider names\r\n */\r\nexport function getAllProviderNames(): string[] {\r\n  return Object.keys(PROVIDER_CONFIGS)\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\ai\\server-actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[467,470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[467,470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\r\n\r\n/**\r\n * Server Action wrapper for AI generation\r\n * Keeps supabaseAdmin server-side only\r\n */\r\n\r\nimport { generateWithFailover } from './failover'\r\n\r\nexport async function generateAIContent(\r\n  prompt: string,\r\n  options?: {\r\n    temperature?: number\r\n    maxTokens?: number\r\n  }\r\n) {\r\n  try {\r\n    const result = await generateWithFailover(prompt, options)\r\n    return {\r\n      success: true,\r\n      content: result.content\r\n    }\r\n  } catch (error: any) {\r\n    console.error('[AI Server Action] Generation failed:', error)\r\n    return {\r\n      success: false,\r\n      error: error.message || 'Failed to generate content'\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\ai\\settings\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1317,1320],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1317,1320],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1854,1857],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1854,1857],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3998,4001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3998,4001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":199,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5557,5560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5557,5560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":249,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7049,7052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7049,7052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'decryptedKey' is assigned a value but never used.","line":328,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":328,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":329,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8967,8970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8967,8970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":339,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9286,9289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9286,9289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\r\n\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\nimport { requireAdmin } from '@/lib/admin/auth'\r\nimport { encrypt, decrypt, maskApiKey, isValidApiKeyFormat } from '@/lib/utils/encryption'\r\nimport { revalidatePath } from 'next/cache'\r\n\r\nexport interface AIProvider {\r\n  id: string\r\n  name: string\r\n  display_name: string\r\n  base_url: string | null\r\n  is_active: boolean\r\n  keys: AIApiKey[]\r\n}\r\n\r\nexport interface AIApiKey {\r\n  id: string\r\n  provider_id: string\r\n  label: string | null\r\n  is_active: boolean\r\n  masked_key: string\r\n  last_used_at: string | null\r\n  created_at: string\r\n}\r\n\r\n/**\r\n * Get all AI providers with their masked API keys\r\n */\r\nexport async function getAIProviders(): Promise<AIProvider[]> {\r\n  await requireAdmin()\r\n\r\n  const { data: providers, error } = await supabaseAdmin\r\n    .from('ai_providers')\r\n    .select(`\r\n      *,\r\n      ai_api_keys (\r\n        id,\r\n        provider_id,\r\n        label,\r\n        is_active,\r\n        encrypted_key,\r\n        last_used_at,\r\n        created_at\r\n      )\r\n    `)\r\n    .order('display_name')\r\n\r\n  if (error) {\r\n    console.error('Error fetching AI providers:', error)\r\n    return []\r\n  }\r\n\r\n  // Mask API keys before sending to client\r\n  return providers.map(provider => ({\r\n    ...provider,\r\n    keys: provider.ai_api_keys.map((key: any) => ({\r\n      id: key.id,\r\n      provider_id: key.provider_id,\r\n      label: key.label,\r\n      is_active: key.is_active,\r\n      masked_key: maskApiKey(decrypt(key.encrypted_key)),\r\n      last_used_at: key.last_used_at,\r\n      created_at: key.created_at,\r\n    }))\r\n  }))\r\n}\r\n\r\n/**\r\n * Save new API key for a provider with provider-specific configuration\r\n * Now supports multiple models for failover\r\n */\r\nexport async function saveApiKey(\r\n  providerNameOrId: string,\r\n  apiKey: string,\r\n  label?: string,\r\n  config?: Record<string, any>,\r\n  selectedModel?: string,\r\n  selectedModels?: string[],  // NEW: Multiple models for failover\r\n  modelPriority?: string[]     // NEW: Priority order for failover\r\n): Promise<{ success: boolean; error?: string }> {\r\n  await requireAdmin()\r\n\r\n  // Validate API key format\r\n  if (!isValidApiKeyFormat(apiKey)) {\r\n    return { success: false, error: 'Invalid API key format' }\r\n  }\r\n\r\n  try {\r\n    // Look up provider UUID from name if needed\r\n    const { data: provider } = await supabaseAdmin\r\n      .from('ai_providers')\r\n      .select('id')\r\n      .eq('name', providerNameOrId)\r\n      .single()\r\n\r\n    if (!provider) {\r\n      return { success: false, error: 'Provider not found' }\r\n    }\r\n\r\n    const providerId = provider.id\r\n\r\n    // Encrypt the API key\r\n    const encryptedKey = encrypt(apiKey)\r\n\r\n    // Check if label already exists for this provider\r\n    if (label) {\r\n      const { data: existing } = await supabaseAdmin\r\n        .from('ai_api_keys')\r\n        .select('id')\r\n        .eq('provider_id', providerId)\r\n        .eq('label', label)\r\n        .single()\r\n\r\n      if (existing) {\r\n        return { success: false, error: 'A key with this label already exists' }\r\n      }\r\n    }\r\n\r\n    // Save encrypted key with config and model(s)\r\n    const { error } = await supabaseAdmin\r\n      .from('ai_api_keys')\r\n      .insert({\r\n        provider_id: providerId,\r\n        encrypted_key: encryptedKey,\r\n        label: label || null,\r\n        is_active: false, // Not active by default\r\n        config_json: config || {},\r\n        selected_model: selectedModel || (selectedModels && selectedModels[0]) || null,\r\n        selected_models: selectedModels && selectedModels.length > 0 ? selectedModels : (selectedModel ? [selectedModel] : []),\r\n        model_priority: modelPriority && modelPriority.length > 0 ? modelPriority : (selectedModels || (selectedModel ? [selectedModel] : [])),\r\n      })\r\n\r\n    if (error) {\r\n      console.error('Error saving API key:', error)\r\n      return { success: false, error: 'Failed to save API key' }\r\n    }\r\n\r\n    revalidatePath('/admin/settings/ai')\r\n    return { success: true }\r\n  } catch (error: any) {\r\n    console.error('Error in saveApiKey:', error)\r\n    return { success: false, error: error.message || 'Failed to save API key' }\r\n  }\r\n}\r\n\r\n/**\r\n * Set active API key for a provider (only one can be active)\r\n */\r\nexport async function setActiveApiKey(\r\n  keyId: string\r\n): Promise<{ success: boolean; error?: string }> {\r\n  await requireAdmin()\r\n\r\n  try {\r\n    // Get the key to find its provider\r\n    const { data: key } = await supabaseAdmin\r\n      .from('ai_api_keys')\r\n      .select('provider_id')\r\n      .eq('id', keyId)\r\n      .single()\r\n\r\n    if (!key) {\r\n      return { success: false, error: 'API key not found' }\r\n    }\r\n\r\n    // Deactivate all keys for this provider\r\n    await supabaseAdmin\r\n      .from('ai_api_keys')\r\n      .update({ is_active: false })\r\n      .eq('provider_id', key.provider_id)\r\n\r\n    // Activate the selected key\r\n    const { error } = await supabaseAdmin\r\n      .from('ai_api_keys')\r\n      .update({ \r\n        is_active: true,\r\n        last_used_at: new Date().toISOString()\r\n      })\r\n      .eq('id', keyId)\r\n\r\n    if (error) {\r\n      console.error('Error setting active key:', error)\r\n      return { success: false, error: 'Failed to activate API key' }\r\n    }\r\n\r\n    // Also set the provider as active\r\n    await supabaseAdmin\r\n      .from('ai_providers')\r\n      .update({ is_active: false })\r\n\r\n    await supabaseAdmin\r\n      .from('ai_providers')\r\n      .update({ is_active: true })\r\n      .eq('id', key.provider_id)\r\n\r\n    revalidatePath('/admin/settings/ai')\r\n    return { success: true }\r\n  } catch (error: any) {\r\n    console.error('Error in setActiveApiKey:', error)\r\n    return { success: false, error: error.message || 'Failed to activate API key' }\r\n  }\r\n}\r\n\r\n/**\r\n * Delete an API key (manual deletion only)\r\n */\r\nexport async function deleteApiKey(\r\n  keyId: string\r\n): Promise<{ success: boolean; error?: string }> {\r\n  console.log('[deleteApiKey] Starting deletion for key:', keyId)\r\n  \r\n  try {\r\n    // Verify admin status\r\n    await requireAdmin()\r\n    console.log('[deleteApiKey] Admin check passed')\r\n\r\n    // Verify key exists first\r\n    const { data: existingKey, error: fetchError } = await supabaseAdmin\r\n      .from('ai_api_keys')\r\n      .select('id, provider_id')\r\n      .eq('id', keyId)\r\n      .single()\r\n\r\n    if (fetchError || !existingKey) {\r\n      console.error('[deleteApiKey] Key not found:', fetchError)\r\n      return { success: false, error: 'API key not found' }\r\n    }\r\n\r\n    console.log('[deleteApiKey] Key found, proceeding with deletion')\r\n\r\n    // Delete the key\r\n    const { error: deleteError } = await supabaseAdmin\r\n      .from('ai_api_keys')\r\n      .delete()\r\n      .eq('id', keyId)\r\n\r\n    if (deleteError) {\r\n      console.error('[deleteApiKey] Delete failed:', deleteError)\r\n      return { \r\n        success: false, \r\n        error: `Database error: ${deleteError.message || 'Unknown error'}` \r\n      }\r\n    }\r\n\r\n    console.log('[deleteApiKey] Deletion successful')\r\n    revalidatePath('/admin/settings/ai')\r\n    return { success: true }\r\n  } catch (error: any) {\r\n    console.error('[deleteApiKey] Exception caught:', error)\r\n    return { \r\n      success: false, \r\n      error: error.message || 'An unexpected error occurred while deleting the API key' \r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Get the active provider's decrypted API key (for internal use only)\r\n */\r\nexport async function getActiveApiKey(): Promise<{\r\n  provider: string\r\n  apiKey: string\r\n  baseUrl: string\r\n  model?: string\r\n} | null> {\r\n  await requireAdmin()\r\n\r\n  const { data: activeProvider } = await supabaseAdmin\r\n    .from('ai_providers')\r\n    .select(`\r\n      name,\r\n      base_url,\r\n      ai_api_keys!inner (\r\n        encrypted_key,\r\n        selected_model\r\n      )\r\n    `)\r\n    .eq('is_active', true)\r\n    .eq('ai_api_keys.is_active', true)\r\n    .single()\r\n\r\n  if (!activeProvider || !activeProvider.ai_api_keys[0]) {\r\n    return null\r\n  }\r\n\r\n  try {\r\n    const decryptedKey = decrypt(activeProvider.ai_api_keys[0].encrypted_key)\r\n    \r\n    return {\r\n      provider: activeProvider.name,\r\n      apiKey: decryptedKey,\r\n      baseUrl: activeProvider.base_url || '',\r\n      model: activeProvider.ai_api_keys[0].selected_model,\r\n    }\r\n  } catch (error) {\r\n    console.error('Failed to decrypt active API key:', error)\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Test API key connection\r\n */\r\nexport async function testApiKeyConnection(\r\n  keyId: string\r\n): Promise<{ success: boolean; error?: string; message?: string }> {\r\n  await requireAdmin()\r\n\r\n  try {\r\n    // Get the key and provider info\r\n    const { data: key } = await supabaseAdmin\r\n      .from('ai_api_keys')\r\n      .select(`\r\n        encrypted_key,\r\n        ai_providers (\r\n          name,\r\n          base_url\r\n        )\r\n      `)\r\n      .eq('id', keyId)\r\n      .single()\r\n\r\n    if (!key) {\r\n      return { success: false, error: 'API key not found' }\r\n    }\r\n\r\n    const decryptedKey = decrypt(key.encrypted_key)\r\n    const provider = key.ai_providers as any\r\n\r\n    // Make a simple test request based on provider\r\n    // This is a placeholder - actual implementation depends on provider\r\n    // For now, just validate the key is decryptable\r\n    \r\n    return { \r\n      success: true, \r\n      message: `Successfully connected to ${provider.name}` \r\n    }\r\n  } catch (error: any) {\r\n    console.error('Error testing API key:', error)\r\n    return { success: false, error: error.message || 'Connection test failed' }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\ai\\settings\\discovery-actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1394,1397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1394,1397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2412,2415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2412,2415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2563,2566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2563,2566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3353,3356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3353,3356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4244,4247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4244,4247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4395,4398],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4395,4398],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5230,5233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5230,5233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":196,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6217,6220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6217,6220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":197,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6271,6274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6271,6274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":208,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6652,6655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6652,6655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateText' is assigned a value but never used.","line":231,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":231,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":266,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8310,8313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8310,8313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":303,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9431,9434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9431,9434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":318,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9753,9756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9753,9756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\r\n\r\nimport { requireAdmin } from '@/lib/admin/auth'\r\n\r\n/**\r\n * AI Model Discovery & Testing Actions\r\n * Auto-discover available models and test connections\r\n */\r\n\r\nexport interface DiscoveredModel {\r\n  id: string\r\n  name: string\r\n  description: string\r\n  pricing: string\r\n  tier: 'free' | 'paid'\r\n  available: boolean\r\n  contextWindow?: number\r\n  limits?: {\r\n    rpm?: number  // requests per minute\r\n    rpd?: number  // requests per day\r\n  }\r\n}\r\n\r\nexport interface TestResult {\r\n  model: string\r\n  success: boolean\r\n  latency?: number\r\n  response?: string\r\n  error?: string\r\n  timestamp: string\r\n}\r\n\r\n/**\r\n * Discover available models for a provider\r\n */\r\nexport async function discoverAvailableModels(\r\n  provider: string,\r\n  apiKey: string\r\n): Promise<{ success: boolean; models?: DiscoveredModel[]; error?: string }> {\r\n  await requireAdmin()\r\n\r\n  console.log(`[Discovery] Starting model discovery for: ${provider}`)\r\n\r\n  try {\r\n    switch (provider) {\r\n      case 'openrouter':\r\n        return await discoverOpenRouterModels(apiKey)\r\n      \r\n      case 'google':\r\n        return await discoverGoogleModels(apiKey)\r\n      \r\n      case 'openai':\r\n        return await discoverOpenAIModels(apiKey)\r\n      \r\n      default:\r\n        return { \r\n          success: false, \r\n          error: `Model discovery not yet implemented for ${provider}` \r\n        }\r\n    }\r\n  } catch (error: any) {\r\n    console.error('[Discovery] Error:', error)\r\n    return { \r\n      success: false, \r\n      error: error.message || 'Discovery failed' \r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * OpenRouter Model Discovery\r\n */\r\nasync function discoverOpenRouterModels(apiKey: string): Promise<{ success: boolean; models?: DiscoveredModel[]; error?: string }> {\r\n  try {\r\n    console.log('[OpenRouter] Fetching models...')\r\n    \r\n    const response = await fetch('https://openrouter.ai/api/v1/models', {\r\n      headers: {\r\n        'Authorization': `Bearer ${apiKey}`,\r\n        'Content-Type': 'application/json'\r\n      }\r\n    })\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text()\r\n      console.error('[OpenRouter] Error:', error)\r\n      return { success: false, error: `Failed to fetch models: ${response.statusText}` }\r\n    }\r\n\r\n    const data = await response.json()\r\n    console.log(`[OpenRouter] Found ${data.data?.length || 0} models`)\r\n\r\n    const models: DiscoveredModel[] = (data.data || [])\r\n      .filter((model: any) => !model.id.includes('extended'))  // Filter out extended context variants\r\n      .slice(0, 50)  // Limit to first 50 models\r\n      .map((model: any) => ({\r\n        id: model.id,\r\n        name: model.name || model.id,\r\n        description: model.description || 'No description',\r\n        pricing: model.pricing?.prompt === '0' ? 'Free' : `$${model.pricing?.prompt || '?'}/1M tokens`,\r\n        tier: model.pricing?.prompt === '0' ? 'free' as const : 'paid' as const,\r\n        available: true,\r\n        contextWindow: model.context_length || 0,\r\n        limits: model.pricing?.prompt === '0' ? { rpm: 20 } : undefined\r\n      }))\r\n\r\n    // Sort: free models first, then by name\r\n    models.sort((a, b) => {\r\n      if (a.tier === 'free' && b.tier !== 'free') return -1\r\n      if (a.tier !== 'free' && b.tier === 'free') return 1\r\n      return a.name.localeCompare(b.name)\r\n    })\r\n\r\n    return { success: true, models }\r\n  } catch (error: any) {\r\n    console.error('[OpenRouter] Exception:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\n/**\r\n * Google Gemini Model Discovery\r\n */\r\nasync function discoverGoogleModels(apiKey: string): Promise<{ success: boolean; models?: DiscoveredModel[]; error?: string }> {\r\n  try {\r\n    console.log('[Google] Fetching models...')\r\n    \r\n    const response = await fetch(\r\n      `https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`\r\n    )\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text()\r\n      console.error('[Google] Error:', error)\r\n      return { success: false, error: `Failed to fetch models: ${response.statusText}` }\r\n    }\r\n\r\n    const data = await response.json()\r\n    console.log(`[Google] Found ${data.models?.length || 0} models`)\r\n\r\n    const models: DiscoveredModel[] = (data.models || [])\r\n      .filter((model: any) => \r\n        model.supportedGenerationMethods?.includes('generateContent') &&\r\n        model.name.includes('gemini')\r\n      )\r\n      .map((model: any) => {\r\n        // Extract just the model ID without the \"models/\" prefix\r\n        // Google returns \"models/gemini-1.5-flash\" but we only need \"gemini-1.5-flash\"\r\n        const modelId = model.name.replace('models/', '')\r\n        const isFree = modelId.includes('flash') || modelId.includes('1.5')\r\n        \r\n        return {\r\n          id: modelId,\r\n          name: model.displayName || modelId,\r\n          description: model.description || 'Google Gemini model',\r\n          pricing: isFree ? 'Free (rate limited)' : 'Paid',\r\n          tier: isFree ? 'free' as const : 'paid' as const,\r\n          available: true,\r\n          contextWindow: model.inputTokenLimit || 0,\r\n          limits: isFree ? { rpm: modelId.includes('pro') ? 2 : 15 } : undefined\r\n        }\r\n      })\r\n\r\n    return { success: true, models }\r\n  } catch (error: any) {\r\n    console.error('[Google] Exception:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\n/**\r\n * OpenAI Model Discovery\r\n */\r\nasync function discoverOpenAIModels(apiKey: string): Promise<{ success: boolean; models?: DiscoveredModel[]; error?: string }> {\r\n  try {\r\n    console.log('[OpenAI] Fetching models...')\r\n    \r\n    const response = await fetch('https://api.openai.com/v1/models', {\r\n      headers: {\r\n        'Authorization': `Bearer ${apiKey}`,\r\n        'Content-Type': 'application/json'\r\n      }\r\n    })\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text()\r\n      console.error('[OpenAI] Error:', error)\r\n      return { success: false, error: `Failed to fetch models: ${response.statusText}` }\r\n    }\r\n\r\n    const data = await response.json()\r\n    console.log(`[OpenAI] Found ${data.data?.length || 0} models`)\r\n\r\n    // Filter for GPT models only\r\n    const models: DiscoveredModel[] = (data.data || [])\r\n      .filter((model: any) => model.id.includes('gpt'))\r\n      .map((model: any) => ({\r\n        id: model.id,\r\n        name: model.id,\r\n        description: `OpenAI ${model.id}`,\r\n        pricing: model.id.includes('3.5') ? '$0.50/1M tokens' : '$10/1M tokens',\r\n        tier: 'paid' as const,\r\n        available: true,\r\n        contextWindow: model.id.includes('gpt-4') ? 128000 : 16385\r\n      }))\r\n\r\n    return { success: true, models }\r\n  } catch (error: any) {\r\n    console.error('[OpenAI] Exception:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\n/**\r\n * Test a specific model with a sample prompt\r\n */\r\nexport async function testModelConnection(\r\n  provider: string,\r\n  apiKey: string,\r\n  modelId: string\r\n): Promise<TestResult> {\r\n  await requireAdmin()\r\n\r\n  const testPrompt = \"Say 'Hello' in one word.\"\r\n  const startTime = Date.now()\r\n\r\n  console.log(`[Test] Testing ${provider}/${modelId}...`)\r\n\r\n  try {\r\n    // Dynamic import the AI client\r\n    const { generateText } = await import('@/lib/ai/client')\r\n    \r\n    // This is a simplified test - we'd need to call the specific provider\r\n    // For now, just test if the model ID is valid\r\n    const response = await fetch(getTestEndpoint(provider, modelId, apiKey), {\r\n      method: 'POST',\r\n      headers: getTestHeaders(provider, apiKey),\r\n      body: JSON.stringify(getTestBody(provider, modelId, testPrompt))\r\n    })\r\n\r\n    const latency = Date.now() - startTime\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text()\r\n      console.error(`[Test] Failed: ${error}`)\r\n      return {\r\n        model: modelId,\r\n        success: false,\r\n        error: `HTTP ${response.status}: ${error.substring(0, 100)}`,\r\n        timestamp: new Date().toISOString()\r\n      }\r\n    }\r\n\r\n    const data = await response.json()\r\n    const responseText = extractResponse(provider, data)\r\n\r\n    console.log(`[Test] Success: ${responseText} (${latency}ms)`)\r\n\r\n    return {\r\n      model: modelId,\r\n      success: true,\r\n      latency,\r\n      response: responseText,\r\n      timestamp: new Date().toISOString()\r\n    }\r\n  } catch (error: any) {\r\n    console.error(`[Test] Exception:`, error)\r\n    return {\r\n      model: modelId,\r\n      success: false,\r\n      error: error.message,\r\n      timestamp: new Date().toISOString()\r\n    }\r\n  }\r\n}\r\n\r\n// Helper functions for testing\r\nfunction getTestEndpoint(provider: string, modelId: string, apiKey: string): string {\r\n  switch (provider) {\r\n    case 'openrouter':\r\n      return 'https://openrouter.ai/api/v1/chat/completions'\r\n    case 'google':\r\n      return `https://generativelanguage.googleapis.com/v1beta/models/${modelId}:generateContent?key=${apiKey}`\r\n    case 'openai':\r\n      return 'https://api.openai.com/v1/chat/completions'\r\n    default:\r\n      throw new Error(`Unsupported provider: ${provider}`)\r\n  }\r\n}\r\n\r\nfunction getTestHeaders(provider: string, apiKey: string): Record<string, string> {\r\n  const headers: Record<string, string> = {\r\n    'Content-Type': 'application/json'\r\n  }\r\n\r\n  if (provider === 'openrouter' || provider === 'openai') {\r\n    headers['Authorization'] = `Bearer ${apiKey}`\r\n  }\r\n\r\n  return headers\r\n}\r\n\r\nfunction getTestBody(provider: string, modelId: string, prompt: string): any {\r\n  if (provider === 'google') {\r\n    return {\r\n      contents: [{ parts: [{ text: prompt }] }]\r\n    }\r\n  }\r\n\r\n  // OpenRouter & OpenAI use same format\r\n  return {\r\n    model: modelId,\r\n    messages: [{ role: 'user', content: prompt }],\r\n    max_tokens: 10\r\n  }\r\n}\r\n\r\nfunction extractResponse(provider: string, data: any): string {\r\n  if (provider === 'google') {\r\n    return data.candidates?.[0]?.content?.parts?.[0]?.text || 'No response'\r\n  }\r\n\r\n  // OpenRouter & OpenAI\r\n  return data.choices?.[0]?.message?.content || 'No response'\r\n}\r\n\r\n/**\r\n * Test multiple models in batch\r\n */\r\nexport async function testMultipleModels(\r\n  provider: string,\r\n  apiKey: string,\r\n  modelIds: string[]\r\n): Promise<TestResult[]> {\r\n  await requireAdmin()\r\n\r\n  console.log(`[Batch Test] Testing ${modelIds.length} models...`)\r\n\r\n  const results: TestResult[] = []\r\n\r\n  // Test one at a time to avoid rate limits\r\n  for (const modelId of modelIds) {\r\n    const result = await testModelConnection(provider, apiKey, modelId)\r\n    results.push(result)\r\n    \r\n    // Wait 1 second between tests to respect rate limits\r\n    await new Promise(resolve => setTimeout(resolve, 1000))\r\n  }\r\n\r\n  return results\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\cart\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\cart\\guestCart.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\checkout\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\cloudinary\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1396,1399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1396,1399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2086,2089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2086,2089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\r\n\r\nimport { generateCloudinarySignature, getCloudinaryAdmin } from './server'\r\nimport { Readable } from 'stream'\r\n\r\nexport async function getCloudinarySignature() {\r\n  const cloudName = process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME || process.env.CLOUDINARY_CLOUD_NAME\r\n  const apiKey = process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY || process.env.CLOUDINARY_API_KEY\r\n\r\n  if (!cloudName || !apiKey) {\r\n    throw new Error('Missing Cloudinary configuration: NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME or NEXT_PUBLIC_CLOUDINARY_API_KEY')\r\n  }\r\n\r\n  const timestamp = Math.round(new Date().getTime() / 1000)\r\n  const folder = 'product-images'\r\n\r\n  const params = {\r\n    timestamp,\r\n    folder,\r\n  }\r\n\r\n  const signature = generateCloudinarySignature(params)\r\n\r\n  return {\r\n    signature,\r\n    timestamp,\r\n    folder,\r\n    cloudName,\r\n    apiKey\r\n  }\r\n}\r\n\r\nexport async function uploadProductImage(formData: FormData) {\r\n  try {\r\n    console.log('Starting uploadProductImage...')\r\n    const file = formData.get('file') as File\r\n    if (!file) {\r\n        console.error('No file provided in formData')\r\n        throw new Error('No file provided')\r\n    }\r\n    console.log('File received:', file.name, file.size, file.type)\r\n\r\n    const arrayBuffer = await file.arrayBuffer()\r\n    const buffer = Buffer.from(arrayBuffer)\r\n    console.log('Buffer created, size:', buffer.length)\r\n\r\n    return new Promise<any>((resolve, reject) => {\r\n        const uploadStream = getCloudinaryAdmin().uploader.upload_stream(\r\n        { folder: 'product-images' },\r\n        (error, result) => {\r\n            if (error) {\r\n                console.error('Cloudinary upload_stream error:', error)\r\n                reject(new Error(`Cloudinary upload failed: ${error.message}`))\r\n            } else {\r\n                console.log('Cloudinary upload success:', result?.secure_url)\r\n                resolve(result)\r\n            }\r\n        }\r\n        )\r\n        \r\n        const stream = new Readable()\r\n        stream.push(buffer)\r\n        stream.push(null)\r\n        stream.pipe(uploadStream)\r\n    })\r\n  } catch (error: any) {\r\n    console.error('uploadProductImage exception:', error)\r\n    throw new Error(error.message || 'Upload action failed')\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\cloudinary\\server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\cloudinary\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\constants\\categories.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\constants\\colors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\constants\\sizes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\currency.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\design\\tokens.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\firebase\\admin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\firebase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\homepage\\getHomepageData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\inventory\\actions.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_variantId' is defined but never used.","line":129,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":129,"endColumn":46,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_qty' is defined but never used.","line":129,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":129,"endColumn":60,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_reservationId' is defined but never used.","line":136,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":136,"endColumn":55,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_reservationId' is defined but never used.","line":142,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":142,"endColumn":56,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\inventory\\reservations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\metadata.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\notifications\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[536,539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[536,539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\r\n\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\nimport { requireAdmin } from '@/lib/admin/auth'\r\nimport { revalidatePath } from 'next/cache'\r\n\r\n/**\r\n * AI Notification System\r\n * Manages real-time notifications for AI events\r\n */\r\n\r\nexport interface AINotification {\r\n  id: string\r\n  type: 'model_deleted' | 'rate_limit' | 'failover' | 'health_check_failed' | 'info'\r\n  severity: 'info' | 'warning' | 'error' | 'critical'\r\n  provider_id?: string\r\n  model_id?: string\r\n  message: string\r\n  details?: Record<string, any>\r\n  is_read: boolean\r\n  created_at: string\r\n  expires_at?: string\r\n}\r\n\r\n/**\r\n * Get unread notifications for admin\r\n */\r\nexport async function getUnreadNotifications(): Promise<{\r\n  notifications: AINotification[]\r\n  count: number\r\n}> {\r\n  await requireAdmin()\r\n\r\n  const { data, error } = await supabaseAdmin\r\n    .from('ai_notifications')\r\n    .select('*')\r\n    .eq('is_read', false)\r\n    .order('created_at', { ascending: false })\r\n    .limit(50)\r\n\r\n  if (error) {\r\n    console.error('[Notifications] Error fetching:', error)\r\n    return { notifications: [], count: 0 }\r\n  }\r\n\r\n  return {\r\n    notifications: data || [],\r\n    count: data?.length || 0\r\n  }\r\n}\r\n\r\n/**\r\n * Get all notifications (read and unread)\r\n */\r\nexport async function getAllNotifications(limit = 100): Promise<AINotification[]> {\r\n  await requireAdmin()\r\n\r\n  const { data } = await supabaseAdmin\r\n    .from('ai_notifications')\r\n    .select('*')\r\n    .order('created_at', { ascending: false })\r\n    .limit(limit)\r\n\r\n  return data || []\r\n}\r\n\r\n/**\r\n * Mark a notification as read\r\n */\r\nexport async function markNotificationRead(id: string): Promise<void> {\r\n  await requireAdmin()\r\n\r\n  await supabaseAdmin\r\n    .from('ai_notifications')\r\n    .update({ is_read: true })\r\n    .eq('id', id)\r\n}\r\n\r\n/**\r\n * Mark all notifications as read\r\n */\r\nexport async function markAllNotificationsRead(): Promise<void> {\r\n  await requireAdmin()\r\n\r\n  await supabaseAdmin\r\n    .from('ai_notifications')\r\n    .update({ is_read: true })\r\n    .eq('is_read', false)\r\n\r\n  revalidatePath('/admin')\r\n}\r\n\r\n/**\r\n * Delete a notification\r\n */\r\nexport async function deleteNotification(id: string): Promise<void> {\r\n  await requireAdmin()\r\n\r\n  await supabaseAdmin\r\n    .from('ai_notifications')\r\n    .delete()\r\n    .eq('id', id)\r\n}\r\n\r\n/**\r\n * Create a new notification\r\n */\r\nexport async function createNotification(\r\n  notification: Omit<AINotification, 'id' | 'created_at' | 'is_read' | 'expires_at'>\r\n): Promise<void> {\r\n  console.log('[Notification] Creating:', notification.type, notification.message)\r\n\r\n  const expiresAt = getExpiryDate(notification.type)\r\n\r\n  const { error } = await supabaseAdmin\r\n    .from('ai_notifications')\r\n    .insert({\r\n      ...notification,\r\n      is_read: false,\r\n      expires_at: expiresAt\r\n    })\r\n\r\n  if (error) {\r\n    console.error('[Notification] Error creating:', error)\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up expired notifications\r\n */\r\nexport async function cleanupExpiredNotifications(): Promise<void> {\r\n  await supabaseAdmin\r\n    .from('ai_notifications')\r\n    .delete()\r\n    .lt('expires_at', new Date().toISOString())\r\n\r\n  console.log('[Notifications] Cleaned up expired notifications')\r\n}\r\n\r\n/**\r\n * Get expiry date based on notification type\r\n */\r\nfunction getExpiryDate(type: AINotification['type']): string {\r\n  const now = new Date()\r\n  \r\n  switch (type) {\r\n    case 'info':\r\n      // Info notifications expire after 7 days\r\n      return new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString()\r\n    \r\n    case 'rate_limit':\r\n    case 'failover':\r\n      // Rate limit/failover expire after 24 hours\r\n      return new Date(now.getTime() + 24 * 60 * 60 * 1000).toISOString()\r\n    \r\n    case 'model_deleted':\r\n    case 'health_check_failed':\r\n    case 'warning':\r\n    case 'error':\r\n    case 'critical':\r\n      // Important notifications expire after 30 days\r\n      return new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000).toISOString()\r\n    \r\n    default:\r\n      return new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000).toISOString()\r\n  }\r\n}\r\n\r\n/**\r\n * Log AI usage for analytics\r\n */\r\nexport async function logAIUsage(\r\n  provider: string,\r\n  modelId: string,\r\n  success: boolean,\r\n  errorType?: string,\r\n  latencyMs?: number,\r\n  tokensUsed?: number\r\n): Promise<void> {\r\n  await supabaseAdmin\r\n    .from('ai_usage_log')\r\n    .insert({\r\n      provider,\r\n      model_id: modelId,\r\n      success,\r\n      error_type: errorType || null,\r\n      latency_ms: latencyMs || null,\r\n      tokens_used: tokensUsed || null\r\n    })\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\observability\\cronMonitoring.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\observability\\errorTracking.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[312,315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[312,315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2175,2178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2175,2178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2497,2500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2497,2500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2770,2773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2770,2773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3041,3044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3041,3044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Error tracking utility for server-side errors\r\n * Captures errors with context, sends to monitoring service\r\n * Non-blocking: all errors logged fire-and-forget\r\n */\r\n\r\ninterface ErrorContext {\r\n  orderId?: string\r\n  userId?: string\r\n  action?: string\r\n  environment?: string\r\n  metadata?: Record<string, any>\r\n}\r\n\r\ninterface TrackedError {\r\n  message: string\r\n  stack?: string\r\n  context: ErrorContext\r\n  timestamp: string\r\n  severity: 'error' | 'warn' | 'info'\r\n}\r\n\r\nconst MONITORING_ENABLED = process.env.ENABLE_ERROR_TRACKING === 'true'\r\nconst MONITORING_ENDPOINT = process.env.ERROR_TRACKING_ENDPOINT\r\n\r\n/**\r\n * Track an error with context (fire-and-forget)\r\n * Never throws or blocks execution\r\n */\r\nexport async function trackError(\r\n  error: Error | unknown,\r\n  context: ErrorContext,\r\n  severity: 'error' | 'warn' | 'info' = 'error'\r\n): Promise<void> {\r\n  if (!MONITORING_ENABLED) return\r\n\r\n  try {\r\n    const trackedError: TrackedError = {\r\n      message: error instanceof Error ? error.message : String(error),\r\n      stack: error instanceof Error ? error.stack : undefined,\r\n      context: {\r\n        ...context,\r\n        environment: process.env.NODE_ENV,\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n      severity,\r\n    }\r\n\r\n    // Log locally (important even if remote fails)\r\n    console.error('[TRACKED_ERROR]', JSON.stringify(trackedError))\r\n\r\n    // Send to monitoring endpoint (non-blocking)\r\n    if (MONITORING_ENDPOINT) {\r\n      // Fire-and-forget fetch\r\n      fetch(MONITORING_ENDPOINT, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(trackedError),\r\n      }).catch(() => {\r\n        // Silently fail - monitoring errors should never impact application\r\n        console.error('[MONITORING_SEND_FAILED]', trackedError.message)\r\n      })\r\n    }\r\n  } catch (err) {\r\n    // Last resort: log that error tracking itself failed\r\n    console.error('[ERROR_TRACKING_FAILED]', String(err))\r\n  }\r\n}\r\n\r\n/**\r\n * Track structured error for a specific flow\r\n */\r\nexport function trackPaymentError(\r\n  error: Error | unknown,\r\n  orderId: string,\r\n  additionalContext?: Record<string, any>\r\n): Promise<void> {\r\n  return trackError(error, {\r\n    orderId,\r\n    action: 'payment_verification',\r\n    metadata: additionalContext,\r\n  })\r\n}\r\n\r\nexport function trackInventoryError(\r\n  error: Error | unknown,\r\n  action: 'commit' | 'release' | 'reserve',\r\n  variantId?: string,\r\n  additionalContext?: Record<string, any>\r\n): Promise<void> {\r\n  return trackError(error, {\r\n    action: `inventory_${action}`,\r\n    metadata: { variantId, ...additionalContext },\r\n  })\r\n}\r\n\r\nexport function trackCronError(\r\n  error: Error | unknown,\r\n  cronName: string,\r\n  additionalContext?: Record<string, any>\r\n): Promise<void> {\r\n  return trackError(error, {\r\n    action: `cron_${cronName}`,\r\n    metadata: additionalContext,\r\n  })\r\n}\r\n\r\nexport function trackAdminError(\r\n  error: Error | unknown,\r\n  action: string,\r\n  userId?: string,\r\n  additionalContext?: Record<string, any>\r\n): Promise<void> {\r\n  return trackError(error, {\r\n    userId,\r\n    action: `admin_${action}`,\r\n    metadata: additionalContext,\r\n  })\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\observability\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\observability\\structuredLogging.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[370,373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[370,373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4339,4342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4339,4342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Structured logging utility for production observability\r\n * Provides JSON-structured logs for critical flows\r\n * All logs include context, timestamp, and severity level\r\n */\r\n\r\ninterface LogContext {\r\n  orderId?: string\r\n  userId?: string\r\n  variantId?: string\r\n  action?: string\r\n  duration?: number // ms\r\n  rowsProcessed?: number\r\n  metadata?: Record<string, any>\r\n}\r\n\r\ninterface StructuredLog {\r\n  timestamp: string\r\n  level: 'info' | 'warn' | 'error'\r\n  message: string\r\n  context: LogContext\r\n  environment: string\r\n}\r\n\r\nconst STRUCTURED_LOGGING_ENABLED = process.env.ENABLE_STRUCTURED_LOGGING !== 'false'\r\n\r\n/**\r\n * Log a structured message\r\n */\r\nfunction logStructured(\r\n  level: 'info' | 'warn' | 'error',\r\n  message: string,\r\n  context: LogContext = {}\r\n): void {\r\n  if (!STRUCTURED_LOGGING_ENABLED) return\r\n\r\n  const log: StructuredLog = {\r\n    timestamp: new Date().toISOString(),\r\n    level,\r\n    message,\r\n    context,\r\n    environment: process.env.NODE_ENV || 'development',\r\n  }\r\n\r\n  // Prefix indicates log type for easy filtering\r\n  const prefix = `[${level.toUpperCase()}]`\r\n  console.log(`${prefix} ${JSON.stringify(log)}`)\r\n}\r\n\r\n/**\r\n * Info-level logs (normal operations)\r\n */\r\nexport const logInfo = {\r\n  paymentVerificationStart: (orderId: string) =>\r\n    logStructured('info', 'Payment verification started', { orderId, action: 'payment_verify_start' }),\r\n  \r\n  paymentVerificationComplete: (orderId: string, duration: number) =>\r\n    logStructured('info', 'Payment verification completed', { orderId, action: 'payment_verify_complete', duration }),\r\n  \r\n  inventoryCommit: (variantId: string, quantity: number, duration: number) =>\r\n    logStructured('info', 'Inventory committed', { variantId, action: 'inventory_commit', duration, metadata: { quantity } }),\r\n  \r\n  inventoryRelease: (orderId: string, variantId: string, quantity: number, duration: number) =>\r\n    logStructured('info', 'Inventory released', { orderId, variantId, action: 'inventory_release', duration, metadata: { quantity } }),\r\n  \r\n  cronExecutionStart: (cronName: string) =>\r\n    logStructured('info', `Cron job started: ${cronName}`, { action: `cron_${cronName}_start` }),\r\n  \r\n  cronExecutionComplete: (cronName: string, duration: number, rowsProcessed: number) =>\r\n    logStructured('info', `Cron job completed: ${cronName}`, { action: `cron_${cronName}_complete`, duration, rowsProcessed }),\r\n  \r\n  recoveryAttemptStart: (orderId: string, recoveryType: string) =>\r\n    logStructured('info', `Recovery attempt started: ${recoveryType}`, { orderId, action: 'recovery_start', metadata: { type: recoveryType } }),\r\n  \r\n  recoveryAttemptComplete: (orderId: string, recoveryType: string, duration: number, success: boolean) =>\r\n    logStructured('info', `Recovery attempt completed: ${recoveryType}`, { orderId, action: 'recovery_complete', duration, metadata: { type: recoveryType, success } }),\r\n}\r\n\r\n/**\r\n * Warn-level logs (retryable issues, degraded state)\r\n */\r\nexport const logWarn = {\r\n  paymentVerificationRetry: (orderId: string, attempt: number, reason: string) =>\r\n    logStructured('warn', 'Payment verification retry', { orderId, action: 'payment_verify_retry', metadata: { attempt, reason } }),\r\n  \r\n  inventoryReleaseRetry: (orderId: string, attempt: number, reason: string) =>\r\n    logStructured('warn', 'Inventory release retry', { orderId, action: 'inventory_release_retry', metadata: { attempt, reason } }),\r\n  \r\n  cronExecutionTimeout: (cronName: string, expectedDuration: number, actualDuration: number) =>\r\n    logStructured('warn', `Cron job exceeded timeout: ${cronName}`, { action: `cron_${cronName}_timeout`, metadata: { expectedDuration, actualDuration } }),\r\n  \r\n  recoveryAttemptFailed: (orderId: string, recoveryType: string, reason: string) =>\r\n    logStructured('warn', `Recovery attempt failed: ${recoveryType}`, { orderId, action: 'recovery_failed', metadata: { type: recoveryType, reason } }),\r\n  \r\n  inventoryInconsistency: (variantId: string, expected: number, actual: number) =>\r\n    logStructured('warn', 'Inventory inconsistency detected', { variantId, action: 'inventory_inconsistency', metadata: { expected, actual } }),\r\n}\r\n\r\n/**\r\n * Error-level logs (action required)\r\n */\r\nexport const logError = {\r\n  paymentVerificationFailed: (orderId: string, reason: string, metadata?: Record<string, any>) =>\r\n    logStructured('error', 'Payment verification failed', { orderId, action: 'payment_verify_failed', metadata: { reason, ...metadata } }),\r\n  \r\n  inventoryCommitFailed: (orderId: string, variantId: string, reason: string) =>\r\n    logStructured('error', 'Inventory commit failed', { orderId, variantId, action: 'inventory_commit_failed', metadata: { reason } }),\r\n  \r\n  inventoryReleaseFailed: (orderId: string, variantId: string, reason: string) =>\r\n    logStructured('error', 'Inventory release failed', { orderId, variantId, action: 'inventory_release_failed', metadata: { reason } }),\r\n  \r\n  cronExecutionFailed: (cronName: string, reason: string, duration: number) =>\r\n    logStructured('error', `Cron job failed: ${cronName}`, { action: `cron_${cronName}_failed`, duration, metadata: { reason } }),\r\n  \r\n  recoveryAttemptUnrecoverable: (orderId: string, recoveryType: string, reason: string) =>\r\n    logStructured('error', `Recovery attempt unrecoverable: ${recoveryType}`, { orderId, action: 'recovery_unrecoverable', metadata: { type: recoveryType, reason } }),\r\n  \r\n  razorpayWebhookInvalid: (orderId: string, reason: string) =>\r\n    logStructured('error', 'Invalid Razorpay webhook', { orderId, action: 'webhook_invalid', metadata: { reason } }),\r\n}\r\n\r\n/**\r\n * Helper to measure operation duration\r\n */\r\nexport function createDurationTracker() {\r\n  const start = Date.now()\r\n  return {\r\n    end: () => Date.now() - start,\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\orders\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\orders\\feedback.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'recommendationContext' is never reassigned. Use 'const' instead.","line":120,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":123,"endColumn":4,"fix":{"range":[3088,3260],"text":"const recommendationContext: {\r\n    size_profile_id: string | null\r\n    recommended_size: string | null\r\n  } = {\r\n    size_profile_id: null,\r\n    recommended_size: null,\r\n  }"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'productSizeProfiles' is assigned a value but never used.","line":129,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":129,"endColumn":36}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"'use server'\r\n\r\nimport { supabaseServer } from '@/lib/supabase/server'\r\nimport { getCurrentUser } from '@/lib/auth'\r\nimport { OrderItemFeedback, FeedbackType } from '@/types/order'\r\n\r\n/**\r\n * Get order item with product details for feedback context\r\n */\r\nexport async function getOrderItemForFeedback(itemId: string) {\r\n  const user = await getCurrentUser()\r\n  if (!user) {\r\n    throw new Error('Unauthorized: User not logged in')\r\n  }\r\n\r\n  // Fetch order item with order verification\r\n  const { data: orderItem, error: itemError } = await supabaseServer\r\n    .from('order_items')\r\n    .select(\r\n      `\r\n      *,\r\n      order_id\r\n    `\r\n    )\r\n    .eq('id', itemId)\r\n    .maybeSingle()\r\n\r\n  if (itemError || !orderItem) {\r\n    throw new Error('Order item not found')\r\n  }\r\n\r\n  // Verify user owns this order\r\n  const { data: order, error: orderError } = await supabaseServer\r\n    .from('orders')\r\n    .select('firebase_uid, status')\r\n    .eq('id', orderItem.order_id)\r\n    .maybeSingle()\r\n\r\n  if (orderError || !order || order.firebase_uid !== user.uid) {\r\n    throw new Error('Unauthorized: You do not own this order')\r\n  }\r\n\r\n  return {\r\n    item: orderItem,\r\n    order_status: order.status,\r\n  }\r\n}\r\n\r\n/**\r\n * Get existing feedback for an order item (if any)\r\n */\r\nexport async function getFeedbackForOrderItem(\r\n  itemId: string\r\n): Promise<OrderItemFeedback | null> {\r\n  const user = await getCurrentUser()\r\n  if (!user) {\r\n    throw new Error('Unauthorized: User not logged in')\r\n  }\r\n\r\n  // Verify ownership first\r\n  await getOrderItemForFeedback(itemId)\r\n\r\n  const { data: feedback, error } = await supabaseServer\r\n    .from('order_item_feedback')\r\n    .select('*')\r\n    .eq('order_item_id', itemId)\r\n    .maybeSingle()\r\n\r\n  if (error && error.code !== 'PGRST116') {\r\n    // PGRST116 = no rows returned\r\n    throw error\r\n  }\r\n\r\n  return feedback || null\r\n}\r\n\r\n/**\r\n * Save feedback for an order item\r\n * - Creates new feedback if doesn't exist\r\n * - Updates existing feedback\r\n * - Triggers fit stats update and learning logic\r\n */\r\nexport async function saveFeedback(\r\n  itemId: string,\r\n  feedbackType: FeedbackType,\r\n  notes?: string\r\n): Promise<OrderItemFeedback> {\r\n  const user = await getCurrentUser()\r\n  if (!user) {\r\n    throw new Error('Unauthorized: User not logged in')\r\n  }\r\n\r\n  // Validate feedback type\r\n  const validTypes: FeedbackType[] = [\r\n    'TOO_SMALL',\r\n    'TOO_LARGE',\r\n    'FITS_WELL',\r\n    'QUALITY_ISSUE',\r\n    'OTHER',\r\n  ]\r\n  if (!validTypes.includes(feedbackType)) {\r\n    throw new Error(`Invalid feedback type: ${feedbackType}`)\r\n  }\r\n\r\n  // Verify user owns this order item and get details\r\n  const { item: orderItem } = await getOrderItemForFeedback(itemId)\r\n\r\n  // Get order details for context (what was recommended vs selected)\r\n  const { data: product, error: productError } = await supabaseServer\r\n    .from('products')\r\n    .select('id')\r\n    .eq('id', orderItem.product_id)\r\n    .maybeSingle()\r\n\r\n  if (productError || !product) {\r\n    throw new Error('Product not found')\r\n  }\r\n\r\n  // Get Sizebook recommendation context if available\r\n  let recommendationContext: {\r\n    size_profile_id: string | null\r\n    recommended_size: string | null\r\n  } = {\r\n    size_profile_id: null,\r\n    recommended_size: null,\r\n  }\r\n\r\n  // Extract category from product size profiles (if Sizebook was enabled)\r\n  const { data: productSizeProfiles } = await supabaseServer\r\n    .from('product_size_profiles')\r\n    .select('size_profile_id, size_profiles!inner(id, name)')\r\n    .eq('product_id', orderItem.product_id)\r\n    .limit(1)\r\n\r\n  // For now, just note that this feedback is tied to order_item_variant (selected_size)\r\n  // In a real scenario, you'd fetch the recommendation that was shown at purchase time\r\n  // For Phase 16, we'll assume the variant name in order_item.variant_label is the selected size\r\n\r\n  // Upsert feedback (one per order item)\r\n  const { data: feedback, error: upsertError } = await supabaseServer\r\n    .from('order_item_feedback')\r\n    .upsert(\r\n      {\r\n        order_item_id: itemId,\r\n        user_uid: user.uid,\r\n        size_profile_id: recommendationContext.size_profile_id,\r\n        recommended_size: recommendationContext.recommended_size,\r\n        selected_size: orderItem.variant_label || 'UNKNOWN',\r\n        feedback_type: feedbackType,\r\n        notes: notes?.trim() || null,\r\n      },\r\n      {\r\n        onConflict: 'order_item_id',\r\n      }\r\n    )\r\n    .select()\r\n    .single()\r\n\r\n  if (upsertError) {\r\n    throw new Error(`Failed to save feedback: ${upsertError.message}`)\r\n  }\r\n\r\n  // Trigger learning logic (async, fires background job)\r\n  // This will:\r\n  // 1. Update fit stats\r\n  // 2. Compute adjustments if thresholds met\r\n  // 3. Log adjustment history\r\n  // Fire and forget - don't block on completion\r\n  updateFitStatsFromFeedback(feedback.id).catch((err) => {\r\n    console.error('[Sizebook Learning] Failed to update fit stats:', err)\r\n  })\r\n\r\n  return feedback\r\n}\r\n\r\n/**\r\n * Internal: Update fit stats based on feedback\r\n * This is called after feedback is saved\r\n * Runs learning logic to adjust size profiles\r\n */\r\nasync function updateFitStatsFromFeedback(feedbackId: string) {\r\n  try {\r\n    // Fetch the feedback\r\n    const { data: feedback, error: fetchError } = await supabaseServer\r\n      .from('order_item_feedback')\r\n      .select('*')\r\n      .eq('id', feedbackId)\r\n      .single()\r\n\r\n    if (fetchError || !feedback) {\r\n      throw new Error('Feedback not found for learning')\r\n    }\r\n\r\n    // If feedback has no size profile, skip learning (no Sizebook context)\r\n    if (!feedback.size_profile_id) {\r\n      return\r\n    }\r\n\r\n    // Fetch size profile to get category\r\n    const { data: sizeProfile, error: profileError } = await supabaseServer\r\n      .from('size_profiles')\r\n      .select('id, category, measurements')\r\n      .eq('id', feedback.size_profile_id)\r\n      .single()\r\n\r\n    if (profileError || !sizeProfile) {\r\n      throw new Error('Size profile not found')\r\n    }\r\n\r\n    // Get all metrics for this profile's category\r\n    const metrics = Object.keys(sizeProfile.measurements || {})\r\n\r\n    // For each metric, increment the fit stat counter\r\n    for (const metric of metrics) {\r\n      const { error: updateError } = await supabaseServer.rpc(\r\n        'increment_fit_stat',\r\n        {\r\n          p_size_profile_id: feedback.size_profile_id,\r\n          p_metric: metric,\r\n          p_feedback_type: feedback.feedback_type,\r\n        }\r\n      )\r\n\r\n      if (updateError) {\r\n        console.error(\r\n          `[Sizebook Learning] Failed to increment stat for ${metric}:`,\r\n          updateError\r\n        )\r\n      }\r\n    }\r\n\r\n    // Check if adjustments should be made (sample size ≥ 10)\r\n    // This is handled by a separate admin function (see admin/feedback.ts)\r\n    // For now, just log that stats were updated\r\n    console.log(\r\n      `[Sizebook Learning] Updated fit stats for profile ${feedback.size_profile_id}`\r\n    )\r\n  } catch (err) {\r\n    console.error('[Sizebook Learning] Error in updateFitStatsFromFeedback:', err)\r\n    throw err\r\n  }\r\n}\r\n\r\n/**\r\n * Delete feedback (user can delete their own feedback)\r\n */\r\nexport async function deleteFeedback(feedbackId: string): Promise<void> {\r\n  const user = await getCurrentUser()\r\n  if (!user) {\r\n    throw new Error('Unauthorized: User not logged in')\r\n  }\r\n\r\n  // Verify ownership\r\n  const { data: feedback, error: fetchError } = await supabaseServer\r\n    .from('order_item_feedback')\r\n    .select('user_uid')\r\n    .eq('id', feedbackId)\r\n    .single()\r\n\r\n  if (fetchError || !feedback || feedback.user_uid !== user.uid) {\r\n    throw new Error('Unauthorized: You do not own this feedback')\r\n  }\r\n\r\n  // Delete\r\n  const { error: deleteError } = await supabaseServer\r\n    .from('order_item_feedback')\r\n    .delete()\r\n    .eq('id', feedbackId)\r\n\r\n  if (deleteError) {\r\n    throw new Error(`Failed to delete feedback: ${deleteError.message}`)\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\razorpay.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\shiprocket\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\shiprocket\\client.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[291,294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[291,294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Shiprocket HTTP Client\r\n// Generic request handler with automatic token injection\r\n\r\nimport { getShiprocketToken } from './auth'\r\n\r\nconst SHIPROCKET_API_URL = 'https://apiv2.shiprocket.in/v1'\r\n\r\ninterface RequestOptions {\r\n  method?: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE'\r\n  body?: any\r\n  params?: Record<string, string | number | boolean>\r\n}\r\n\r\n/**\r\n * Generic Shiprocket API request handler\r\n * Automatically injects Bearer token and handles auth refresh\r\n */\r\nexport async function shiprocketRequest<T>(\r\n  endpoint: string,\r\n  options: RequestOptions = {}\r\n): Promise<T> {\r\n  const { method = 'GET', body, params } = options\r\n\r\n  // Get valid auth token\r\n  const token = await getShiprocketToken()\r\n\r\n  // Build URL with query params\r\n  const url = new URL(`${SHIPROCKET_API_URL}${endpoint}`)\r\n  if (params) {\r\n    Object.entries(params).forEach(([key, value]) => {\r\n      url.searchParams.append(key, String(value))\r\n    })\r\n  }\r\n\r\n  // Build request config\r\n  const config: RequestInit = {\r\n    method,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Authorization': `Bearer ${token}`,\r\n    },\r\n  }\r\n\r\n  if (body && method !== 'GET') {\r\n    config.body = JSON.stringify(body)\r\n  }\r\n\r\n  try {\r\n    console.log(`[SHIPROCKET_CLIENT] ${method} ${endpoint}`)\r\n    const response = await fetch(url.toString(), config)\r\n\r\n    // Handle 401 - token might be expired, try refresh once\r\n    if (response.status === 401) {\r\n      console.warn('[SHIPROCKET_CLIENT] 401 Unauthorized - token may be expired')\r\n      // Retry logic could be added here, but for now just throw\r\n      throw new Error('Shiprocket authentication failed')\r\n    }\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text()\r\n      console.error(`[SHIPROCKET_CLIENT] API error:`, response.status, errorText)\r\n      throw new Error(`Shiprocket API error: ${response.status} - ${errorText}`)\r\n    }\r\n\r\n    const data: T = await response.json()\r\n    return data\r\n\r\n  } catch (error) {\r\n    console.error(`[SHIPROCKET_CLIENT] Request failed for ${endpoint}:`, error)\r\n    throw error\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\shiprocket\\pincode.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\shiprocket\\shipment.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2550,2553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2550,2553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":184,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5347,5350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5347,5350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Shiprocket Shipment Creation & Tracking\r\n\r\nimport { shiprocketRequest } from './client'\r\nimport { supabaseAdmin } from '@/lib/supabase/admin'\r\nimport {\r\n  ShiprocketShipmentCreatePayload,\r\n  ShiprocketShipmentCreateResponse,\r\n  ShiprocketTrackingData,\r\n  ShipmentStatus,\r\n} from './types'\r\n\r\n/**\r\n * Create shipment in Shiprocket for an order\r\n * Fetches order details from database and creates shipment\r\n * Updates order with tracking info\r\n * \r\n * @param orderId - Internal order UUID\r\n * @returns Shipment ID and AWB code\r\n */\r\nexport async function createShipment(orderId: string): Promise<{\r\n  shipmentId: number\r\n  awbCode: string | null\r\n  courierName: string | null\r\n}> {\r\n  console.log('[SHIPROCKET_SHIPMENT] Creating shipment for order:', orderId)\r\n\r\n  // 1. Fetch order details from database\r\n  const { data: order, error: orderError } = await supabaseAdmin\r\n    .from('orders')\r\n    .select(`\r\n      *,\r\n      order_items (\r\n        *,\r\n        variants:variant_id (\r\n          id,\r\n          sku,\r\n          size,\r\n          color,\r\n          products:product_id (\r\n            id,\r\n            name,\r\n            shipping_weight,\r\n            shipping_dimensions\r\n          )\r\n        )\r\n      )\r\n    `)\r\n    .eq('id', orderId)\r\n    .single()\r\n\r\n  if (orderError || !order) {\r\n    throw new Error(`Order not found: ${orderId}`)\r\n  }\r\n\r\n  // 2. Validate order has shipping address\r\n  if (!order.shipping_address) {\r\n    throw new Error('Order missing shipping address')\r\n  }\r\n\r\n  const address = typeof order.shipping_address === 'string' \r\n    ? JSON.parse(order.shipping_address) \r\n    : order.shipping_address\r\n\r\n  // 3. Calculate total weight and dimensions\r\n  const totalWeight = calculateTotalWeight(order.order_items)\r\n  const dimensions = getDefaultDimensions() // Default box dimensions\r\n\r\n  // 4. Build Shiprocket order payload\r\n  const payload: ShiprocketShipmentCreatePayload = {\r\n    order_id: order.id.slice(0, 40), // Shiprocket order ID (unique)\r\n    order_date: new Date(order.created_at).toISOString().split('T')[0],\r\n    billing_customer_name: address.fullName || 'Customer',\r\n    billing_address: address.addressLine1,\r\n    billing_address_2: address.addressLine2 || '',\r\n    billing_city: address.city,\r\n    billing_pincode: address.pincode,\r\n    billing_state: address.state,\r\n    billing_country: 'India',\r\n    billing_email: order.customer_email || 'customer@example.com',\r\n    billing_phone: order.customer_phone || '9999999999',\r\n    shipping_is_billing: true,\r\n    order_items: order.order_items.map((item: any) => {\r\n      const variant = item.variants\r\n      const product = variant?.products\r\n      return {\r\n        name: product?.name || 'Product',\r\n        sku: variant?.sku || item.variant_id,\r\n        units: item.quantity,\r\n        selling_price: item.price_at_purchase,\r\n        discount: 0,\r\n        tax: 0,\r\n      }\r\n    }),\r\n    payment_method: order.is_cod ? 'COD' : 'Prepaid',\r\n    sub_total: order.amount,\r\n    length: dimensions.length,\r\n    breadth: dimensions.breadth,\r\n    height: dimensions.height,\r\n    weight: totalWeight,\r\n  }\r\n\r\n  try {\r\n    // 5. Create shipment in Shiprocket\r\n    const response = await shiprocketRequest<ShiprocketShipmentCreateResponse>(\r\n      '/orders/create/adhoc',\r\n      {\r\n        method: 'POST',\r\n        body: payload,\r\n      }\r\n    )\r\n\r\n    console.log('[SHIPROCKET_SHIPMENT] Shipment created:', response.shipment_id)\r\n\r\n    // 6. Update order in database with shipment details\r\n    await supabaseAdmin\r\n      .from('orders')\r\n      .update({\r\n        shiprocket_shipment_id: String(response.shipment_id),\r\n        shiprocket_order_id: String(response.order_id),\r\n        tracking_id: response.awb_code,\r\n        courier_name: response.courier_name,\r\n        shipment_status: 'CREATED',\r\n        last_tracking_update: new Date().toISOString(),\r\n      })\r\n      .eq('id', orderId)\r\n\r\n    return {\r\n      shipmentId: response.shipment_id,\r\n      awbCode: response.awb_code,\r\n      courierName: response.courier_name,\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('[SHIPROCKET_SHIPMENT] Error creating shipment:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n/**\r\n * Get tracking details for an AWB\r\n */\r\nexport async function getTrackingDetails(awb: string): Promise<ShiprocketTrackingData | null> {\r\n  try {\r\n    const response = await shiprocketRequest<ShiprocketTrackingData>(\r\n      '/courier/track/awb',\r\n      {\r\n        method: 'GET',\r\n        params: { awb },\r\n      }\r\n    )\r\n\r\n    return response\r\n\r\n  } catch (error) {\r\n    console.error('[SHIPROCKET_SHIPMENT] Error fetching tracking:', error)\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Map Shiprocket status to our internal shipment status\r\n */\r\nexport function mapShiprocketStatus(shiprocketStatus: string): ShipmentStatus {\r\n  const statusMap: Record<string, ShipmentStatus> = {\r\n    'NEW': 'CREATED',\r\n    'PICKUP_SCHEDULED': 'CREATED',\r\n    'PICKUP_PENDING': 'CREATED',\r\n    'PICKED_UP': 'PICKED_UP',\r\n    'IN_TRANSIT': 'IN_TRANSIT',\r\n    'OUT_FOR_DELIVERY': 'OUT_FOR_DELIVERY',\r\n    'DELIVERED': 'DELIVERED',\r\n    'RTO_INITIATED': 'RTO_INITIATED',\r\n    'RTO_DELIVERED': 'RTO_DELIVERED',\r\n    'CANCELLED': 'CANCELLED',\r\n    'LOST': 'LOST',\r\n  }\r\n\r\n  return statusMap[shiprocketStatus] || 'IN_TRANSIT'\r\n}\r\n\r\n/**\r\n * Calculate total weight from order items\r\n */\r\nfunction calculateTotalWeight(items: any[]): number {\r\n  const totalWeight = items.reduce((sum, item) => {\r\n    const product = item.variants?.products\r\n    const weight = product?.shipping_weight || 0.5 // Default 500g per item\r\n    return sum + (weight * item.quantity)\r\n  }, 0)\r\n\r\n  return Math.max(totalWeight, 0.5) // Minimum 500g\r\n}\r\n\r\n/**\r\n * Get default box dimensions (can be customized per product later)\r\n */\r\nfunction getDefaultDimensions() {\r\n  return {\r\n    length: 30, // cm\r\n    breadth: 20, // cm\r\n    height: 10, // cm\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\shiprocket\\shipping.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'codAmount' is defined but never used.","line":108,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Shiprocket Shipping Rate Calculation & Courier Selection\r\n\r\nimport { shiprocketRequest } from './client'\r\nimport { ShiprocketCourierRecommendation } from './types'\r\n\r\nexport interface ShippingRateParams {\r\n  pickupPincode: string\r\n  deliveryPincode: string\r\n  weight: number // in kg\r\n  codAmount?: number // COD order value\r\n  declaredValue: number // Product value for insurance\r\n}\r\n\r\nexport interface CourierOption {\r\n  courierId: number\r\n  courierName: string\r\n  rate: number\r\n  estimatedDays: number\r\n  codCharges: number\r\n  supportsCod: boolean\r\n  rating: number\r\n}\r\n\r\n/**\r\n * Get available shipping rates from Shiprocket\r\n * Returns list of courier options with rates and ETAs\r\n */\r\nexport async function getShippingRates(\r\n  params: ShippingRateParams\r\n): Promise<CourierOption[]> {\r\n  const { pickupPincode, deliveryPincode, weight, codAmount, declaredValue } = params\r\n\r\n  try {\r\n    const response = await shiprocketRequest<{ data: ShiprocketCourierRecommendation[] }>(\r\n      '/courier/serviceability',\r\n      {\r\n        method: 'GET',\r\n        params: {\r\n          pickup_postcode: pickupPincode,\r\n          delivery_postcode: deliveryPincode,\r\n          weight,\r\n          cod: codAmount ? 1 : 0,\r\n          declared_value: declaredValue,\r\n          ...(codAmount && { order_value: codAmount }),\r\n        },\r\n      }\r\n    )\r\n\r\n    const couriers: CourierOption[] = response.data.map((courier) => ({\r\n      courierId: courier.courier_company_id,\r\n      courierName: courier.courier_name,\r\n      rate: courier.rate + (codAmount ? courier.cod_charges : 0),\r\n      estimatedDays: courier.estimated_delivery_days,\r\n      codCharges: courier.cod_charges,\r\n      supportsCod: codAmount ? true : false,\r\n      rating: courier.rating,\r\n    }))\r\n\r\n    console.log('[SHIPROCKET_SHIPPING] Found', couriers.length, 'courier options')\r\n    return couriers\r\n\r\n  } catch (error) {\r\n    console.error('[SHIPROCKET_SHIPPING] Error fetching shipping rates:', error)\r\n    \r\n    // Graceful fallback - return default option\r\n    return [{\r\n      courierId: 0,\r\n      courierName: 'Standard Shipping',\r\n      rate: 20, // Flat ₹20 fallback\r\n      estimatedDays: 7,\r\n      codCharges: 0,\r\n      supportsCod: true,\r\n      rating: 0,\r\n    }]\r\n  }\r\n}\r\n\r\n/**\r\n * Select best courier based on cost and reliability\r\n * Prioritizes: 1) Cost, 2) Delivery speed, 3) Rating\r\n */\r\nexport function selectBestCourier(options: CourierOption[]): CourierOption | null {\r\n  if (options.length === 0) return null\r\n\r\n  // Sort by rate (ascending), then by estimated days (ascending), then by rating (descending)\r\n  const sorted = [...options].sort((a, b) => {\r\n    // Primary: Lowest rate\r\n    if (a.rate !== b.rate) return a.rate - b.rate\r\n    \r\n    // Secondary: Fastest delivery\r\n    if (a.estimatedDays !== b.estimatedDays) return a.estimatedDays - b.estimatedDays\r\n    \r\n    // Tertiary: Highest rating\r\n    return b.rating - a.rating\r\n  })\r\n\r\n  const best = sorted[0]\r\n  console.log('[SHIPROCKET_SHIPPING] Selected best courier:', best.courierName, '₹', best.rate)\r\n  \r\n  return best\r\n}\r\n\r\n/**\r\n * Validate COD availability for a specific courier and pincode\r\n */\r\nexport function validateCodLogistics(\r\n  courier: CourierOption,\r\n  codAmount: number\r\n): { allowed: boolean; reason?: string } {\r\n  if (!courier.supportsCod) {\r\n    return {\r\n      allowed: false,\r\n      reason: `${courier.courierName} does not support COD to this pincode`,\r\n    }\r\n  }\r\n\r\n  // Additional validation: COD amount limits (if needed)\r\n  // Shiprocket typically has COD limits, but we'll rely on API validation\r\n  \r\n  return {\r\n    allowed: true,\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\shiprocket\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\sizebook\\admin-actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2399,2402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2399,2402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Phase 13: Sizebook Foundation - Admin Server Actions\r\n// Purpose: Admin-only CRUD operations for size profiles and product mappings\r\n// Guards: All actions require admin role\r\n\r\n'use server';\r\n\r\nimport { supabaseServer } from '@/lib/supabase/server';\r\nimport { requireAdmin } from '@/lib/admin/auth';\r\nimport type {\r\n  SizeProfile,\r\n  ProductSizeProfile,\r\n  ProductSizeProfileExtended,\r\n  CreateSizeProfilePayload,\r\n  UpdateSizeProfilePayload,\r\n  AssignSizeProfilePayload,\r\n  SizebookActionResult,\r\n} from '@/types/sizebook';\r\n\r\n// ==========================================\r\n// Size Profile CRUD\r\n// ==========================================\r\n\r\n/**\r\n * Create a new size profile (admin only)\r\n * \r\n * @example\r\n * ```ts\r\n * const result = await createSizeProfile({\r\n *   name: 'M',\r\n *   category: 'men_top',\r\n *   measurements: { chest_cm: 96, waist_cm: 81, shoulder_cm: 45, length_cm: 72 },\r\n *   fit_rules: { tolerance_cm: 3 }\r\n * });\r\n * ```\r\n */\r\nexport async function createSizeProfile(\r\n  payload: CreateSizeProfilePayload\r\n): Promise<SizebookActionResult<SizeProfile>> {\r\n  try {\r\n    // Admin guard\r\n    await requireAdmin();\r\n\r\n    // Insert new size profile\r\n    const { data, error } = await supabaseServer\r\n      .from('size_profiles')\r\n      .insert({\r\n        name: payload.name,\r\n        category: payload.category,\r\n        measurements: payload.measurements,\r\n        fit_rules: payload.fit_rules ?? {},\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error('[createSizeProfile] Database error:', error);\r\n      \r\n      // Handle unique constraint violation\r\n      if (error.code === '23505') {\r\n        return {\r\n          success: false,\r\n          error: `Size \"${payload.name}\" already exists for category \"${payload.category}\"`,\r\n        };\r\n      }\r\n      \r\n      return { success: false, error: 'Failed to create size profile' };\r\n    }\r\n\r\n    return { success: true, data };\r\n  } catch (error) {\r\n    console.error('[createSizeProfile] Error:', error);\r\n    return { success: false, error: 'Failed to create size profile' };\r\n  }\r\n}\r\n\r\n/**\r\n * Update existing size profile (admin only)\r\n */\r\nexport async function updateSizeProfile(\r\n  payload: UpdateSizeProfilePayload\r\n): Promise<SizebookActionResult<SizeProfile>> {\r\n  try {\r\n    await requireAdmin();\r\n\r\n    // Build update object (only include provided fields)\r\n    const updates: any = { updated_at: new Date().toISOString() };\r\n    if (payload.name !== undefined) updates.name = payload.name;\r\n    if (payload.measurements !== undefined) updates.measurements = payload.measurements;\r\n    if (payload.fit_rules !== undefined) updates.fit_rules = payload.fit_rules;\r\n\r\n    const { data, error } = await supabaseServer\r\n      .from('size_profiles')\r\n      .update(updates)\r\n      .eq('id', payload.id)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error('[updateSizeProfile] Database error:', error);\r\n      return { success: false, error: 'Failed to update size profile' };\r\n    }\r\n\r\n    return { success: true, data };\r\n  } catch (error) {\r\n    console.error('[updateSizeProfile] Error:', error);\r\n    return { success: false, error: 'Failed to update size profile' };\r\n  }\r\n}\r\n\r\n/**\r\n * Delete size profile (admin only)\r\n * Note: This will cascade delete all product_size_profiles mappings\r\n */\r\nexport async function deleteSizeProfile(\r\n  id: string\r\n): Promise<SizebookActionResult> {\r\n  try {\r\n    await requireAdmin();\r\n\r\n    const { error } = await supabaseServer\r\n      .from('size_profiles')\r\n      .delete()\r\n      .eq('id', id);\r\n\r\n    if (error) {\r\n      console.error('[deleteSizeProfile] Database error:', error);\r\n      return { success: false, error: 'Failed to delete size profile' };\r\n    }\r\n\r\n    return { success: true, data: undefined };\r\n  } catch (error) {\r\n    console.error('[deleteSizeProfile] Error:', error);\r\n    return { success: false, error: 'Failed to delete size profile' };\r\n  }\r\n}\r\n\r\n/**\r\n * List all size profiles, optionally filtered by category (admin only)\r\n */\r\nexport async function listSizeProfiles(\r\n  category?: string\r\n): Promise<SizebookActionResult<SizeProfile[]>> {\r\n  try {\r\n    await requireAdmin();\r\n\r\n    let query = supabaseServer\r\n      .from('size_profiles')\r\n      .select('*')\r\n      .order('category', { ascending: true })\r\n      .order('name', { ascending: true });\r\n\r\n    if (category) {\r\n      query = query.eq('category', category);\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n      console.error('[listSizeProfiles] Database error:', error);\r\n      return { success: false, error: 'Failed to list size profiles' };\r\n    }\r\n\r\n    return { success: true, data: data ?? [] };\r\n  } catch (error) {\r\n    console.error('[listSizeProfiles] Error:', error);\r\n    return { success: false, error: 'Failed to list size profiles' };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// Product-Size Profile Mappings\r\n// ==========================================\r\n\r\n/**\r\n * Assign size profile to product (admin only)\r\n * \r\n * @example\r\n * ```ts\r\n * const result = await assignSizeProfileToProduct({\r\n *   product_id: 'abc-123',\r\n *   size_profile_id: 'def-456',\r\n *   notes: 'This product runs slightly small'\r\n * });\r\n * ```\r\n */\r\nexport async function assignSizeProfileToProduct(\r\n  payload: AssignSizeProfilePayload\r\n): Promise<SizebookActionResult<ProductSizeProfile>> {\r\n  try {\r\n    await requireAdmin();\r\n\r\n    const { data, error } = await supabaseServer\r\n      .from('product_size_profiles')\r\n      .insert({\r\n        product_id: payload.product_id,\r\n        size_profile_id: payload.size_profile_id,\r\n        notes: payload.notes,\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error('[assignSizeProfileToProduct] Database error:', error);\r\n      \r\n      // Handle duplicate assignment\r\n      if (error.code === '23505') {\r\n        return {\r\n          success: false,\r\n          error: 'This size profile is already assigned to this product',\r\n        };\r\n      }\r\n      \r\n      return { success: false, error: 'Failed to assign size profile' };\r\n    }\r\n\r\n    return { success: true, data };\r\n  } catch (error) {\r\n    console.error('[assignSizeProfileToProduct] Error:', error);\r\n    return { success: false, error: 'Failed to assign size profile' };\r\n  }\r\n}\r\n\r\n/**\r\n * Remove size profile from product (admin only)\r\n */\r\nexport async function removeSizeProfileFromProduct(\r\n  product_id: string,\r\n  size_profile_id: string\r\n): Promise<SizebookActionResult> {\r\n  try {\r\n    await requireAdmin();\r\n\r\n    const { error } = await supabaseServer\r\n      .from('product_size_profiles')\r\n      .delete()\r\n      .eq('product_id', product_id)\r\n      .eq('size_profile_id', size_profile_id);\r\n\r\n    if (error) {\r\n      console.error('[removeSizeProfileFromProduct] Database error:', error);\r\n      return { success: false, error: 'Failed to remove size profile' };\r\n    }\r\n\r\n    return { success: true, data: undefined };\r\n  } catch (error) {\r\n    console.error('[removeSizeProfileFromProduct] Error:', error);\r\n    return { success: false, error: 'Failed to remove size profile' };\r\n  }\r\n}\r\n\r\n/**\r\n * Get all size profiles assigned to a product (admin only)\r\n * Returns full size profile details via join\r\n */\r\nexport async function getProductSizeProfiles(\r\n  product_id: string\r\n): Promise<SizebookActionResult<ProductSizeProfileExtended[]>> {\r\n  try {\r\n    await requireAdmin();\r\n\r\n    const { data, error } = await supabaseServer\r\n      .from('product_size_profiles')\r\n      .select(`\r\n        *,\r\n        size_profile:size_profiles(*)\r\n      `)\r\n      .eq('product_id', product_id)\r\n      .order('size_profile.name', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('[getProductSizeProfiles] Database error:', error);\r\n      return { success: false, error: 'Failed to get product size profiles' };\r\n    }\r\n\r\n    return { success: true, data: data ?? [] };\r\n  } catch (error) {\r\n    console.error('[getProductSizeProfiles] Error:', error);\r\n    return { success: false, error: 'Failed to get product size profiles' };\r\n  }\r\n}\r\n\r\n/**\r\n * Update notes for product-size mapping (admin only)\r\n */\r\nexport async function updateProductSizeProfileNotes(\r\n  product_id: string,\r\n  size_profile_id: string,\r\n  notes: string\r\n): Promise<SizebookActionResult<ProductSizeProfile>> {\r\n  try {\r\n    await requireAdmin();\r\n\r\n    const { data, error } = await supabaseServer\r\n      .from('product_size_profiles')\r\n      .update({ notes })\r\n      .eq('product_id', product_id)\r\n      .eq('size_profile_id', size_profile_id)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error('[updateProductSizeProfileNotes] Database error:', error);\r\n      return { success: false, error: 'Failed to update notes' };\r\n    }\r\n\r\n    return { success: true, data };\r\n  } catch (error) {\r\n    console.error('[updateProductSizeProfileNotes] Error:', error);\r\n    return { success: false, error: 'Failed to update notes' };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\sizebook\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\sizebook\\recommendation.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SizeRecommendation' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DISTANCE_PENALTY_PER_CM' is assigned a value but never used.","line":29,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Phase 13: Sizebook Foundation - Size Recommendation Engine\r\n// Purpose: Pure function to compute size recommendations based on measurements\r\n// Algorithm: Calculate distance between user measurements and each size profile\r\n// Phase 16: Enhanced to apply learned adjustments from feedback\r\n\r\nimport type {\r\n  Measurements,\r\n  SizeProfile,\r\n  SizeRecommendation,\r\n  RecommendationInput,\r\n  RecommendationResult,\r\n} from '@/types/sizebook';\r\nimport type { FitStatsSummary } from '@/types/order';\r\n\r\n// ==========================================\r\n// Constants\r\n// ==========================================\r\n\r\n/** Default tolerance in cm for measurement matching */\r\nconst DEFAULT_TOLERANCE_CM = 3;\r\n\r\n/** Minimum confidence score to return a recommendation (0-100) */\r\nconst MIN_CONFIDENCE_THRESHOLD = 60;\r\n\r\n/** Maximum distance score for perfect match (used in confidence calculation) */\r\nconst PERFECT_MATCH_DISTANCE = 0;\r\n\r\n/** Distance penalty per cm of deviation */\r\nconst DISTANCE_PENALTY_PER_CM = 5;\r\n\r\n// ==========================================\r\n// Core Recommendation Engine\r\n// ==========================================\r\n\r\n/**\r\n * Compute size recommendation for user based on measurements\r\n * \r\n * @param input - User measurements and available size profiles\r\n * @returns Size recommendation with confidence score, or null if no good match\r\n * \r\n * @example\r\n * ```ts\r\n * const recommendation = computeSizeRecommendation({\r\n *   user_measurements: { chest_cm: 98, waist_cm: 84, shoulder_cm: 46 },\r\n *   available_sizes: [sizeS, sizeM, sizeL, sizeXL]\r\n * });\r\n * \r\n * if (recommendation) {\r\n *   console.log(`Recommended: ${recommendation.recommended_size} (${recommendation.confidence}% confident)`);\r\n * }\r\n * ```\r\n */\r\nexport function computeSizeRecommendation(\r\n  input: RecommendationInput\r\n): RecommendationResult {\r\n  const { user_measurements, available_sizes } = input;\r\n\r\n  // Validation: Need at least one size profile\r\n  if (!available_sizes || available_sizes.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  // Validation: User must have at least one measurement\r\n  const userMeasurementKeys = Object.keys(user_measurements).filter(\r\n    (key) => typeof user_measurements[key] === 'number'\r\n  );\r\n  if (userMeasurementKeys.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  // Calculate match score for each size\r\n  const matches = available_sizes.map((size) => {\r\n    const score = calculateMatchScore(user_measurements, size);\r\n    return { size, score };\r\n  });\r\n\r\n  // Find best match\r\n  const bestMatch = matches.reduce((best, current) =>\r\n    current.score.distance < best.score.distance ? current : best\r\n  );\r\n\r\n  // Convert distance to confidence score (0-100)\r\n  const confidence = distanceToConfidence(bestMatch.score.distance);\r\n\r\n  // Return null if confidence too low\r\n  if (confidence < MIN_CONFIDENCE_THRESHOLD) {\r\n    return null;\r\n  }\r\n\r\n  return {\r\n    recommended_size: bestMatch.size.name,\r\n    size_profile_id: bestMatch.size.id,\r\n    confidence,\r\n    reason: generateRecommendationReason(bestMatch.score, confidence),\r\n  };\r\n}\r\n\r\n// ==========================================\r\n// Match Scoring Algorithm\r\n// ==========================================\r\n\r\ninterface MatchScore {\r\n  distance: number;  // Lower is better\r\n  matched_measurements: number;  // How many measurements were compared\r\n  details: { [key: string]: number };  // Per-measurement deviations\r\n}\r\n\r\n/**\r\n * Calculate how well user measurements match a size profile\r\n * Uses weighted Euclidean distance with tolerance\r\n */\r\nfunction calculateMatchScore(\r\n  userMeasurements: Measurements,\r\n  sizeProfile: SizeProfile\r\n): MatchScore {\r\n  const tolerance = sizeProfile.fit_rules?.tolerance_cm ?? DEFAULT_TOLERANCE_CM;\r\n  const stretchAllowance = sizeProfile.fit_rules?.stretch_allowance ?? 0;\r\n\r\n  let totalDistance = 0;\r\n  let matchedCount = 0;\r\n  const details: { [key: string]: number } = {};\r\n\r\n  // Compare each measurement that exists in both user and size profile\r\n  for (const key of Object.keys(userMeasurements)) {\r\n    const userValue = userMeasurements[key];\r\n    const sizeValue = sizeProfile.measurements[key];\r\n\r\n    // Skip if measurement missing from either side\r\n    if (typeof userValue !== 'number' || typeof sizeValue !== 'number') {\r\n      continue;\r\n    }\r\n\r\n    // Calculate deviation with tolerance and stretch allowance\r\n    let deviation = Math.abs(userValue - sizeValue);\r\n\r\n    // Apply stretch allowance (user can be slightly larger for stretch fabrics)\r\n    if (userValue > sizeValue && stretchAllowance > 0) {\r\n      deviation = Math.max(0, deviation - stretchAllowance);\r\n    }\r\n\r\n    // Apply tolerance (small deviations are acceptable)\r\n    deviation = Math.max(0, deviation - tolerance);\r\n\r\n    details[key] = deviation;\r\n    totalDistance += deviation * deviation;  // Squared for Euclidean distance\r\n    matchedCount++;\r\n  }\r\n\r\n  // No measurements in common - worst possible match\r\n  if (matchedCount === 0) {\r\n    return {\r\n      distance: Infinity,\r\n      matched_measurements: 0,\r\n      details: {},\r\n    };\r\n  }\r\n\r\n  // Root mean square distance\r\n  const distance = Math.sqrt(totalDistance / matchedCount);\r\n\r\n  return {\r\n    distance,\r\n    matched_measurements: matchedCount,\r\n    details,\r\n  };\r\n}\r\n\r\n/**\r\n * Convert distance score to confidence percentage (0-100)\r\n * \r\n * - distance = 0 (perfect match) → 100% confidence\r\n * - distance = 5cm → 75% confidence\r\n * - distance = 10cm → 50% confidence\r\n * - distance > 15cm → below threshold\r\n */\r\nfunction distanceToConfidence(distance: number): number {\r\n  if (distance === PERFECT_MATCH_DISTANCE) {\r\n    return 100;\r\n  }\r\n\r\n  // Exponential decay: confidence drops faster as distance increases\r\n  const confidence = 100 * Math.exp(-distance / 8);\r\n\r\n  return Math.round(Math.max(0, Math.min(100, confidence)));\r\n}\r\n\r\n/**\r\n * Generate human-readable reason for recommendation\r\n */\r\nfunction generateRecommendationReason(\r\n  score: MatchScore,\r\n  confidence: number\r\n): string {\r\n  if (confidence >= 90) {\r\n    return 'Excellent match based on your measurements';\r\n  } else if (confidence >= 75) {\r\n    return 'Good match based on your measurements';\r\n  } else {\r\n    return 'Suggested match based on your measurements';\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// Validation Helpers\r\n// ==========================================\r\n\r\n/**\r\n * Validate that measurements are within reasonable ranges\r\n * (Used by user profile actions to prevent clearly wrong data)\r\n */\r\nexport function validateMeasurements(measurements: Measurements): {\r\n  valid: boolean;\r\n  errors: string[];\r\n} {\r\n  const errors: string[] = [];\r\n\r\n  // Define reasonable ranges (in cm)\r\n  const ranges: { [key: string]: { min: number; max: number } } = {\r\n    chest_cm: { min: 70, max: 150 },\r\n    bust_cm: { min: 70, max: 150 },\r\n    waist_cm: { min: 50, max: 150 },\r\n    hip_cm: { min: 70, max: 160 },\r\n    shoulder_cm: { min: 30, max: 70 },\r\n    length_cm: { min: 40, max: 120 },\r\n    inseam_cm: { min: 50, max: 100 },\r\n    rise_cm: { min: 20, max: 40 },\r\n    thigh_cm: { min: 40, max: 90 },\r\n  };\r\n\r\n  for (const [key, value] of Object.entries(measurements)) {\r\n    if (typeof value !== 'number') continue;\r\n\r\n    const range = ranges[key];\r\n    if (!range) continue;  // Unknown measurement type, skip\r\n\r\n    if (value < range.min || value > range.max) {\r\n      errors.push(\r\n        `${key.replace('_cm', '').replace('_', ' ')} must be between ${range.min}-${range.max}cm`\r\n      );\r\n    }\r\n  }\r\n\r\n  return {\r\n    valid: errors.length === 0,\r\n    errors,\r\n  };\r\n}\r\n\r\n/**\r\n * Check if two measurement sets have at least one common measurement\r\n * (Used to validate that recommendation is possible)\r\n */\r\nexport function hasCommonMeasurements(\r\n  measurements1: Measurements,\r\n  measurements2: Measurements\r\n): boolean {\r\n  const keys1 = Object.keys(measurements1).filter(\r\n    (k) => typeof measurements1[k] === 'number'\r\n  );\r\n  const keys2 = Object.keys(measurements2).filter(\r\n    (k) => typeof measurements2[k] === 'number'\r\n  );\r\n\r\n  return keys1.some((key) => keys2.includes(key));\r\n}\r\n\r\n// ==========================================\r\n// Phase 16: Learning-Based Adjustment\r\n// ==========================================\r\n\r\n/**\r\n * Apply learned adjustments to size profiles based on fit feedback\r\n * \r\n * Adjustments are applied to the profile's measurements and tolerance\r\n * based on accumulated user feedback (too small, too large, fits well)\r\n * \r\n * Example:\r\n * - If users consistently report chest too small → increase tolerance by +0.5cm\r\n * - If users consistently report chest too large → decrease tolerance by -0.5cm\r\n */\r\nexport function applyLearnedAdjustments(\r\n  size: SizeProfile,\r\n  fitStats: FitStatsSummary[] | null\r\n): SizeProfile {\r\n  // If no fit stats available, return profile unchanged\r\n  if (!fitStats || fitStats.length === 0) {\r\n    return size;\r\n  }\r\n\r\n  // Create adjusted copy of size profile\r\n  const adjustedSize = { ...size };\r\n  const adjustedMeasurements = { ...size.measurements };\r\n  // const adjustedTolerance = size.fit_rules?.tolerance_cm ?? DEFAULT_TOLERANCE_CM;\r\n\r\n  // Apply adjustments per metric\r\n  for (const stat of fitStats) {\r\n    const adjustment = stat.adjustment_cm\r\n    if (adjustment === 0 || !stat.metric) {\r\n      continue\r\n    }\r\n\r\n    // Apply adjustment to measurement value\r\n    // Example: If chest_cm adjustment is +1.5cm, add to the size's chest measurement\r\n    const currentValue = adjustedMeasurements[stat.metric]\r\n    if (typeof currentValue === 'number') {\r\n      adjustedMeasurements[stat.metric] = currentValue + adjustment\r\n    }\r\n  }\r\n\r\n  adjustedSize.measurements = adjustedMeasurements;\r\n  return adjustedSize;\r\n}\r\n\r\n/**\r\n * Compute recommendation with learned adjustments applied\r\n * \r\n * This is the production version called on PDP:\r\n * 1. Fetch fit stats for the product's size profiles\r\n * 2. Apply learned adjustments to each profile\r\n * 3. Compute recommendation with adjusted profiles\r\n * 4. Return confidence potentially lowered if adjustments skewed the match\r\n * \r\n * @param input - User measurements and available size profiles\r\n * @param fitStats - Optional: Fit statistics per size profile (from database)\r\n * @returns Recommendation with adjustments applied\r\n */\r\nexport function computeSizeRecommendationWithAdjustments(\r\n  input: RecommendationInput,\r\n  fitStatsMap: Map<string, FitStatsSummary[]> | null = null\r\n): RecommendationResult {\r\n  let { available_sizes } = input;\r\n\r\n  // Apply learned adjustments if available\r\n  if (fitStatsMap && fitStatsMap.size > 0) {\r\n    available_sizes = available_sizes.map((size) => {\r\n      const stats = fitStatsMap.get(size.id) || null\r\n      return applyLearnedAdjustments(size, stats)\r\n    })\r\n  }\r\n\r\n  // Compute recommendation with adjusted profiles\r\n  const baseRecommendation = computeSizeRecommendation({\r\n    ...input,\r\n    available_sizes,\r\n  });\r\n\r\n  // If fit stats were applied and confidence dropped significantly,\r\n  // we may want to log this for monitoring (future enhancement)\r\n  return baseRecommendation;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\sizebook\\user-actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\supabase\\admin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\supabase\\server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\lib\\utils\\encryption.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\proxy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\types\\cart.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\types\\collection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\types\\global.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\types\\homepage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\types\\order.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\types\\product.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\user\\Desktop\\Web App\\crown-and-crest\\src\\types\\sizebook.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]